(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var pl={exports:{}},Ri={},yl={exports:{}},Ie={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Td;function Fp(){if(Td)return Ie;Td=1;var l=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.iterator;function E(D){return D===null||typeof D!="object"?null:(D=p&&D[p]||D["@@iterator"],typeof D=="function"?D:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function v(D,$,re){this.props=D,this.context=$,this.refs=S,this.updater=re||T}v.prototype.isReactComponent={},v.prototype.setState=function(D,$){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,$,"setState")},v.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function R(){}R.prototype=v.prototype;function k(D,$,re){this.props=D,this.context=$,this.refs=S,this.updater=re||T}var C=k.prototype=new R;C.constructor=k,x(C,v.prototype),C.isPureReactComponent=!0;var M=Array.isArray,_=Object.prototype.hasOwnProperty,V={current:null},U={key:!0,ref:!0,__self:!0,__source:!0};function j(D,$,re){var ce,xe={},Te=null,Re=null;if($!=null)for(ce in $.ref!==void 0&&(Re=$.ref),$.key!==void 0&&(Te=""+$.key),$)_.call($,ce)&&!U.hasOwnProperty(ce)&&(xe[ce]=$[ce]);var Ce=arguments.length-2;if(Ce===1)xe.children=re;else if(1<Ce){for(var be=Array(Ce),vt=0;vt<Ce;vt++)be[vt]=arguments[vt+2];xe.children=be}if(D&&D.defaultProps)for(ce in Ce=D.defaultProps,Ce)xe[ce]===void 0&&(xe[ce]=Ce[ce]);return{$$typeof:l,type:D,key:Te,ref:Re,props:xe,_owner:V.current}}function ee(D,$){return{$$typeof:l,type:D.type,key:$,ref:D.ref,props:D.props,_owner:D._owner}}function H(D){return typeof D=="object"&&D!==null&&D.$$typeof===l}function Q(D){var $={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(re){return $[re]})}var ge=/\/+/g;function te(D,$){return typeof D=="object"&&D!==null&&D.key!=null?Q(""+D.key):$.toString(36)}function fe(D,$,re,ce,xe){var Te=typeof D;(Te==="undefined"||Te==="boolean")&&(D=null);var Re=!1;if(D===null)Re=!0;else switch(Te){case"string":case"number":Re=!0;break;case"object":switch(D.$$typeof){case l:case e:Re=!0}}if(Re)return Re=D,xe=xe(Re),D=ce===""?"."+te(Re,0):ce,M(xe)?(re="",D!=null&&(re=D.replace(ge,"$&/")+"/"),fe(xe,$,re,"",function(vt){return vt})):xe!=null&&(H(xe)&&(xe=ee(xe,re+(!xe.key||Re&&Re.key===xe.key?"":(""+xe.key).replace(ge,"$&/")+"/")+D)),$.push(xe)),1;if(Re=0,ce=ce===""?".":ce+":",M(D))for(var Ce=0;Ce<D.length;Ce++){Te=D[Ce];var be=ce+te(Te,Ce);Re+=fe(Te,$,re,be,xe)}else if(be=E(D),typeof be=="function")for(D=be.call(D),Ce=0;!(Te=D.next()).done;)Te=Te.value,be=ce+te(Te,Ce++),Re+=fe(Te,$,re,be,xe);else if(Te==="object")throw $=String(D),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.");return Re}function de(D,$,re){if(D==null)return D;var ce=[],xe=0;return fe(D,ce,"","",function(Te){return $.call(re,Te,xe++)}),ce}function oe(D){if(D._status===-1){var $=D._result;$=$(),$.then(function(re){(D._status===0||D._status===-1)&&(D._status=1,D._result=re)},function(re){(D._status===0||D._status===-1)&&(D._status=2,D._result=re)}),D._status===-1&&(D._status=0,D._result=$)}if(D._status===1)return D._result.default;throw D._result}var he={current:null},q={transition:null},z={ReactCurrentDispatcher:he,ReactCurrentBatchConfig:q,ReactCurrentOwner:V};function K(){throw Error("act(...) is not supported in production builds of React.")}return Ie.Children={map:de,forEach:function(D,$,re){de(D,function(){$.apply(this,arguments)},re)},count:function(D){var $=0;return de(D,function(){$++}),$},toArray:function(D){return de(D,function($){return $})||[]},only:function(D){if(!H(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},Ie.Component=v,Ie.Fragment=t,Ie.Profiler=s,Ie.PureComponent=k,Ie.StrictMode=r,Ie.Suspense=f,Ie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z,Ie.act=K,Ie.cloneElement=function(D,$,re){if(D==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+D+".");var ce=x({},D.props),xe=D.key,Te=D.ref,Re=D._owner;if($!=null){if($.ref!==void 0&&(Te=$.ref,Re=V.current),$.key!==void 0&&(xe=""+$.key),D.type&&D.type.defaultProps)var Ce=D.type.defaultProps;for(be in $)_.call($,be)&&!U.hasOwnProperty(be)&&(ce[be]=$[be]===void 0&&Ce!==void 0?Ce[be]:$[be])}var be=arguments.length-2;if(be===1)ce.children=re;else if(1<be){Ce=Array(be);for(var vt=0;vt<be;vt++)Ce[vt]=arguments[vt+2];ce.children=Ce}return{$$typeof:l,type:D.type,key:xe,ref:Te,props:ce,_owner:Re}},Ie.createContext=function(D){return D={$$typeof:a,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},D.Provider={$$typeof:o,_context:D},D.Consumer=D},Ie.createElement=j,Ie.createFactory=function(D){var $=j.bind(null,D);return $.type=D,$},Ie.createRef=function(){return{current:null}},Ie.forwardRef=function(D){return{$$typeof:c,render:D}},Ie.isValidElement=H,Ie.lazy=function(D){return{$$typeof:g,_payload:{_status:-1,_result:D},_init:oe}},Ie.memo=function(D,$){return{$$typeof:h,type:D,compare:$===void 0?null:$}},Ie.startTransition=function(D){var $=q.transition;q.transition={};try{D()}finally{q.transition=$}},Ie.unstable_act=K,Ie.useCallback=function(D,$){return he.current.useCallback(D,$)},Ie.useContext=function(D){return he.current.useContext(D)},Ie.useDebugValue=function(){},Ie.useDeferredValue=function(D){return he.current.useDeferredValue(D)},Ie.useEffect=function(D,$){return he.current.useEffect(D,$)},Ie.useId=function(){return he.current.useId()},Ie.useImperativeHandle=function(D,$,re){return he.current.useImperativeHandle(D,$,re)},Ie.useInsertionEffect=function(D,$){return he.current.useInsertionEffect(D,$)},Ie.useLayoutEffect=function(D,$){return he.current.useLayoutEffect(D,$)},Ie.useMemo=function(D,$){return he.current.useMemo(D,$)},Ie.useReducer=function(D,$,re){return he.current.useReducer(D,$,re)},Ie.useRef=function(D){return he.current.useRef(D)},Ie.useState=function(D){return he.current.useState(D)},Ie.useSyncExternalStore=function(D,$,re){return he.current.useSyncExternalStore(D,$,re)},Ie.useTransition=function(){return he.current.useTransition()},Ie.version="18.3.1",Ie}var Sd;function ou(){return Sd||(Sd=1,yl.exports=Fp()),yl.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vd;function bp(){if(vd)return Ri;vd=1;var l=ou(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(c,f,h){var g,p={},E=null,T=null;h!==void 0&&(E=""+h),f.key!==void 0&&(E=""+f.key),f.ref!==void 0&&(T=f.ref);for(g in f)r.call(f,g)&&!o.hasOwnProperty(g)&&(p[g]=f[g]);if(c&&c.defaultProps)for(g in f=c.defaultProps,f)p[g]===void 0&&(p[g]=f[g]);return{$$typeof:e,type:c,key:E,ref:T,props:p,_owner:s.current}}return Ri.Fragment=t,Ri.jsx=a,Ri.jsxs=a,Ri}var Ld;function Op(){return Ld||(Ld=1,pl.exports=bp()),pl.exports}var Le=Op(),Gs={},El={exports:{}},xt={},xl={exports:{}},Tl={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ad;function Np(){return Ad||(Ad=1,function(l){function e(q,z){var K=q.length;q.push(z);e:for(;0<K;){var D=K-1>>>1,$=q[D];if(0<s($,z))q[D]=z,q[K]=$,K=D;else break e}}function t(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var z=q[0],K=q.pop();if(K!==z){q[0]=K;e:for(var D=0,$=q.length,re=$>>>1;D<re;){var ce=2*(D+1)-1,xe=q[ce],Te=ce+1,Re=q[Te];if(0>s(xe,K))Te<$&&0>s(Re,xe)?(q[D]=Re,q[Te]=K,D=Te):(q[D]=xe,q[ce]=K,D=ce);else if(Te<$&&0>s(Re,K))q[D]=Re,q[Te]=K,D=Te;else break e}}return z}function s(q,z){var K=q.sortIndex-z.sortIndex;return K!==0?K:q.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;l.unstable_now=function(){return o.now()}}else{var a=Date,c=a.now();l.unstable_now=function(){return a.now()-c}}var f=[],h=[],g=1,p=null,E=3,T=!1,x=!1,S=!1,v=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,k=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(q){for(var z=t(h);z!==null;){if(z.callback===null)r(h);else if(z.startTime<=q)r(h),z.sortIndex=z.expirationTime,e(f,z);else break;z=t(h)}}function M(q){if(S=!1,C(q),!x)if(t(f)!==null)x=!0,oe(_);else{var z=t(h);z!==null&&he(M,z.startTime-q)}}function _(q,z){x=!1,S&&(S=!1,R(j),j=-1),T=!0;var K=E;try{for(C(z),p=t(f);p!==null&&(!(p.expirationTime>z)||q&&!Q());){var D=p.callback;if(typeof D=="function"){p.callback=null,E=p.priorityLevel;var $=D(p.expirationTime<=z);z=l.unstable_now(),typeof $=="function"?p.callback=$:p===t(f)&&r(f),C(z)}else r(f);p=t(f)}if(p!==null)var re=!0;else{var ce=t(h);ce!==null&&he(M,ce.startTime-z),re=!1}return re}finally{p=null,E=K,T=!1}}var V=!1,U=null,j=-1,ee=5,H=-1;function Q(){return!(l.unstable_now()-H<ee)}function ge(){if(U!==null){var q=l.unstable_now();H=q;var z=!0;try{z=U(!0,q)}finally{z?te():(V=!1,U=null)}}else V=!1}var te;if(typeof k=="function")te=function(){k(ge)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,de=fe.port2;fe.port1.onmessage=ge,te=function(){de.postMessage(null)}}else te=function(){v(ge,0)};function oe(q){U=q,V||(V=!0,te())}function he(q,z){j=v(function(){q(l.unstable_now())},z)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(q){q.callback=null},l.unstable_continueExecution=function(){x||T||(x=!0,oe(_))},l.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<q?Math.floor(1e3/q):5},l.unstable_getCurrentPriorityLevel=function(){return E},l.unstable_getFirstCallbackNode=function(){return t(f)},l.unstable_next=function(q){switch(E){case 1:case 2:case 3:var z=3;break;default:z=E}var K=E;E=z;try{return q()}finally{E=K}},l.unstable_pauseExecution=function(){},l.unstable_requestPaint=function(){},l.unstable_runWithPriority=function(q,z){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var K=E;E=q;try{return z()}finally{E=K}},l.unstable_scheduleCallback=function(q,z,K){var D=l.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?D+K:D):K=D,q){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=K+$,q={id:g++,callback:z,priorityLevel:q,startTime:K,expirationTime:$,sortIndex:-1},K>D?(q.sortIndex=K,e(h,q),t(f)===null&&q===t(h)&&(S?(R(j),j=-1):S=!0,he(M,K-D))):(q.sortIndex=$,e(f,q),x||T||(x=!0,oe(_))),q},l.unstable_shouldYield=Q,l.unstable_wrapCallback=function(q){var z=E;return function(){var K=E;E=z;try{return q.apply(this,arguments)}finally{E=K}}}}(Tl)),Tl}var Rd;function Mp(){return Rd||(Rd=1,xl.exports=Np()),xl.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Id;function Up(){if(Id)return xt;Id=1;var l=ou(),e=Mp();function t(n){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+n,u=1;u<arguments.length;u++)i+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function o(n,i){a(n,i),a(n+"Capture",i)}function a(n,i){for(s[n]=i,n=0;n<i.length;n++)r.add(i[n])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),f=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},p={};function E(n){return f.call(p,n)?!0:f.call(g,n)?!1:h.test(n)?p[n]=!0:(g[n]=!0,!1)}function T(n,i,u,d){if(u!==null&&u.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return d?!1:u!==null?!u.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function x(n,i,u,d){if(i===null||typeof i>"u"||T(n,i,u,d))return!0;if(d)return!1;if(u!==null)switch(u.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function S(n,i,u,d,m,y,A){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=d,this.attributeNamespace=m,this.mustUseProperty=u,this.propertyName=n,this.type=i,this.sanitizeURL=y,this.removeEmptyString=A}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){v[n]=new S(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var i=n[0];v[i]=new S(i,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){v[n]=new S(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){v[n]=new S(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){v[n]=new S(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){v[n]=new S(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){v[n]=new S(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){v[n]=new S(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){v[n]=new S(n,5,!1,n.toLowerCase(),null,!1,!1)});var R=/[\-:]([a-z])/g;function k(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var i=n.replace(R,k);v[i]=new S(i,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var i=n.replace(R,k);v[i]=new S(i,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var i=n.replace(R,k);v[i]=new S(i,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){v[n]=new S(n,1,!1,n.toLowerCase(),null,!1,!1)}),v.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){v[n]=new S(n,1,!1,n.toLowerCase(),null,!0,!0)});function C(n,i,u,d){var m=v.hasOwnProperty(i)?v[i]:null;(m!==null?m.type!==0:d||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(x(i,u,m,d)&&(u=null),d||m===null?E(i)&&(u===null?n.removeAttribute(i):n.setAttribute(i,""+u)):m.mustUseProperty?n[m.propertyName]=u===null?m.type===3?!1:"":u:(i=m.attributeName,d=m.attributeNamespace,u===null?n.removeAttribute(i):(m=m.type,u=m===3||m===4&&u===!0?"":""+u,d?n.setAttributeNS(d,i,u):n.setAttribute(i,u))))}var M=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),V=Symbol.for("react.portal"),U=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),ee=Symbol.for("react.profiler"),H=Symbol.for("react.provider"),Q=Symbol.for("react.context"),ge=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),fe=Symbol.for("react.suspense_list"),de=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),he=Symbol.for("react.offscreen"),q=Symbol.iterator;function z(n){return n===null||typeof n!="object"?null:(n=q&&n[q]||n["@@iterator"],typeof n=="function"?n:null)}var K=Object.assign,D;function $(n){if(D===void 0)try{throw Error()}catch(u){var i=u.stack.trim().match(/\n( *(at )?)/);D=i&&i[1]||""}return`
`+D+n}var re=!1;function ce(n,i){if(!n||re)return"";re=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(B){var d=B}Reflect.construct(n,[],i)}else{try{i.call()}catch(B){d=B}n.call(i.prototype)}else{try{throw Error()}catch(B){d=B}n()}}catch(B){if(B&&d&&typeof B.stack=="string"){for(var m=B.stack.split(`
`),y=d.stack.split(`
`),A=m.length-1,I=y.length-1;1<=A&&0<=I&&m[A]!==y[I];)I--;for(;1<=A&&0<=I;A--,I--)if(m[A]!==y[I]){if(A!==1||I!==1)do if(A--,I--,0>I||m[A]!==y[I]){var w=`
`+m[A].replace(" at new "," at ");return n.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",n.displayName)),w}while(1<=A&&0<=I);break}}}finally{re=!1,Error.prepareStackTrace=u}return(n=n?n.displayName||n.name:"")?$(n):""}function xe(n){switch(n.tag){case 5:return $(n.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return n=ce(n.type,!1),n;case 11:return n=ce(n.type.render,!1),n;case 1:return n=ce(n.type,!0),n;default:return""}}function Te(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case U:return"Fragment";case V:return"Portal";case ee:return"Profiler";case j:return"StrictMode";case te:return"Suspense";case fe:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Q:return(n.displayName||"Context")+".Consumer";case H:return(n._context.displayName||"Context")+".Provider";case ge:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case de:return i=n.displayName||null,i!==null?i:Te(n.type)||"Memo";case oe:i=n._payload,n=n._init;try{return Te(n(i))}catch{}}return null}function Re(n){var i=n.type;switch(n.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=i.render,n=n.displayName||n.name||"",i.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Te(i);case 8:return i===j?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Ce(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function be(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function vt(n){var i=be(n)?"checked":"value",u=Object.getOwnPropertyDescriptor(n.constructor.prototype,i),d=""+n[i];if(!n.hasOwnProperty(i)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var m=u.get,y=u.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return m.call(this)},set:function(A){d=""+A,y.call(this,A)}}),Object.defineProperty(n,i,{enumerable:u.enumerable}),{getValue:function(){return d},setValue:function(A){d=""+A},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function _i(n){n._valueTracker||(n._valueTracker=vt(n))}function Ru(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var u=i.getValue(),d="";return n&&(d=be(n)?n.checked?"true":"false":n.value),n=d,n!==u?(i.setValue(n),!0):!1}function Pi(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Lo(n,i){var u=i.checked;return K({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??n._wrapperState.initialChecked})}function Iu(n,i){var u=i.defaultValue==null?"":i.defaultValue,d=i.checked!=null?i.checked:i.defaultChecked;u=Ce(i.value!=null?i.value:u),n._wrapperState={initialChecked:d,initialValue:u,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Cu(n,i){i=i.checked,i!=null&&C(n,"checked",i,!1)}function Ao(n,i){Cu(n,i);var u=Ce(i.value),d=i.type;if(u!=null)d==="number"?(u===0&&n.value===""||n.value!=u)&&(n.value=""+u):n.value!==""+u&&(n.value=""+u);else if(d==="submit"||d==="reset"){n.removeAttribute("value");return}i.hasOwnProperty("value")?Ro(n,i.type,u):i.hasOwnProperty("defaultValue")&&Ro(n,i.type,Ce(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(n.defaultChecked=!!i.defaultChecked)}function wu(n,i,u){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var d=i.type;if(!(d!=="submit"&&d!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+n._wrapperState.initialValue,u||i===n.value||(n.value=i),n.defaultValue=i}u=n.name,u!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,u!==""&&(n.name=u)}function Ro(n,i,u){(i!=="number"||Pi(n.ownerDocument)!==n)&&(u==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+u&&(n.defaultValue=""+u))}var $r=Array.isArray;function rr(n,i,u,d){if(n=n.options,i){i={};for(var m=0;m<u.length;m++)i["$"+u[m]]=!0;for(u=0;u<n.length;u++)m=i.hasOwnProperty("$"+n[u].value),n[u].selected!==m&&(n[u].selected=m),m&&d&&(n[u].defaultSelected=!0)}else{for(u=""+Ce(u),i=null,m=0;m<n.length;m++){if(n[m].value===u){n[m].selected=!0,d&&(n[m].defaultSelected=!0);return}i!==null||n[m].disabled||(i=n[m])}i!==null&&(i.selected=!0)}}function Io(n,i){if(i.dangerouslySetInnerHTML!=null)throw Error(t(91));return K({},i,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Du(n,i){var u=i.value;if(u==null){if(u=i.children,i=i.defaultValue,u!=null){if(i!=null)throw Error(t(92));if($r(u)){if(1<u.length)throw Error(t(93));u=u[0]}i=u}i==null&&(i=""),u=i}n._wrapperState={initialValue:Ce(u)}}function ku(n,i){var u=Ce(i.value),d=Ce(i.defaultValue);u!=null&&(u=""+u,u!==n.value&&(n.value=u),i.defaultValue==null&&n.defaultValue!==u&&(n.defaultValue=u)),d!=null&&(n.defaultValue=""+d)}function _u(n){var i=n.textContent;i===n._wrapperState.initialValue&&i!==""&&i!==null&&(n.value=i)}function Pu(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Co(n,i){return n==null||n==="http://www.w3.org/1999/xhtml"?Pu(i):n==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Fi,Fu=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,u,d,m){MSApp.execUnsafeLocalFunction(function(){return n(i,u,d,m)})}:n}(function(n,i){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=i;else{for(Fi=Fi||document.createElement("div"),Fi.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Fi.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;i.firstChild;)n.appendChild(i.firstChild)}});function Gr(n,i){if(i){var u=n.firstChild;if(u&&u===n.lastChild&&u.nodeType===3){u.nodeValue=i;return}}n.textContent=i}var Kr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ug=["Webkit","ms","Moz","O"];Object.keys(Kr).forEach(function(n){Ug.forEach(function(i){i=i+n.charAt(0).toUpperCase()+n.substring(1),Kr[i]=Kr[n]})});function bu(n,i,u){return i==null||typeof i=="boolean"||i===""?"":u||typeof i!="number"||i===0||Kr.hasOwnProperty(n)&&Kr[n]?(""+i).trim():i+"px"}function Ou(n,i){n=n.style;for(var u in i)if(i.hasOwnProperty(u)){var d=u.indexOf("--")===0,m=bu(u,i[u],d);u==="float"&&(u="cssFloat"),d?n.setProperty(u,m):n[u]=m}}var Bg=K({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function wo(n,i){if(i){if(Bg[n]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(t(137,n));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(t(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(t(61))}if(i.style!=null&&typeof i.style!="object")throw Error(t(62))}}function Do(n,i){if(n.indexOf("-")===-1)return typeof i.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ko=null;function _o(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Po=null,ir=null,sr=null;function Nu(n){if(n=ci(n)){if(typeof Po!="function")throw Error(t(280));var i=n.stateNode;i&&(i=ns(i),Po(n.stateNode,n.type,i))}}function Mu(n){ir?sr?sr.push(n):sr=[n]:ir=n}function Uu(){if(ir){var n=ir,i=sr;if(sr=ir=null,Nu(n),i)for(n=0;n<i.length;n++)Nu(i[n])}}function Bu(n,i){return n(i)}function $u(){}var Fo=!1;function Gu(n,i,u){if(Fo)return n(i,u);Fo=!0;try{return Bu(n,i,u)}finally{Fo=!1,(ir!==null||sr!==null)&&($u(),Uu())}}function Vr(n,i){var u=n.stateNode;if(u===null)return null;var d=ns(u);if(d===null)return null;u=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(u&&typeof u!="function")throw Error(t(231,i,typeof u));return u}var bo=!1;if(c)try{var Hr={};Object.defineProperty(Hr,"passive",{get:function(){bo=!0}}),window.addEventListener("test",Hr,Hr),window.removeEventListener("test",Hr,Hr)}catch{bo=!1}function $g(n,i,u,d,m,y,A,I,w){var B=Array.prototype.slice.call(arguments,3);try{i.apply(u,B)}catch(X){this.onError(X)}}var zr=!1,bi=null,Oi=!1,Oo=null,Gg={onError:function(n){zr=!0,bi=n}};function Kg(n,i,u,d,m,y,A,I,w){zr=!1,bi=null,$g.apply(Gg,arguments)}function Vg(n,i,u,d,m,y,A,I,w){if(Kg.apply(this,arguments),zr){if(zr){var B=bi;zr=!1,bi=null}else throw Error(t(198));Oi||(Oi=!0,Oo=B)}}function Bn(n){var i=n,u=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,i.flags&4098&&(u=i.return),n=i.return;while(n)}return i.tag===3?u:null}function Ku(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function Vu(n){if(Bn(n)!==n)throw Error(t(188))}function Hg(n){var i=n.alternate;if(!i){if(i=Bn(n),i===null)throw Error(t(188));return i!==n?null:n}for(var u=n,d=i;;){var m=u.return;if(m===null)break;var y=m.alternate;if(y===null){if(d=m.return,d!==null){u=d;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===u)return Vu(m),n;if(y===d)return Vu(m),i;y=y.sibling}throw Error(t(188))}if(u.return!==d.return)u=m,d=y;else{for(var A=!1,I=m.child;I;){if(I===u){A=!0,u=m,d=y;break}if(I===d){A=!0,d=m,u=y;break}I=I.sibling}if(!A){for(I=y.child;I;){if(I===u){A=!0,u=y,d=m;break}if(I===d){A=!0,d=y,u=m;break}I=I.sibling}if(!A)throw Error(t(189))}}if(u.alternate!==d)throw Error(t(190))}if(u.tag!==3)throw Error(t(188));return u.stateNode.current===u?n:i}function Hu(n){return n=Hg(n),n!==null?zu(n):null}function zu(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var i=zu(n);if(i!==null)return i;n=n.sibling}return null}var Wu=e.unstable_scheduleCallback,ju=e.unstable_cancelCallback,zg=e.unstable_shouldYield,Wg=e.unstable_requestPaint,He=e.unstable_now,jg=e.unstable_getCurrentPriorityLevel,No=e.unstable_ImmediatePriority,Yu=e.unstable_UserBlockingPriority,Ni=e.unstable_NormalPriority,Yg=e.unstable_LowPriority,qu=e.unstable_IdlePriority,Mi=null,jt=null;function qg(n){if(jt&&typeof jt.onCommitFiberRoot=="function")try{jt.onCommitFiberRoot(Mi,n,void 0,(n.current.flags&128)===128)}catch{}}var Mt=Math.clz32?Math.clz32:Jg,Xg=Math.log,Qg=Math.LN2;function Jg(n){return n>>>=0,n===0?32:31-(Xg(n)/Qg|0)|0}var Ui=64,Bi=4194304;function Wr(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function $i(n,i){var u=n.pendingLanes;if(u===0)return 0;var d=0,m=n.suspendedLanes,y=n.pingedLanes,A=u&268435455;if(A!==0){var I=A&~m;I!==0?d=Wr(I):(y&=A,y!==0&&(d=Wr(y)))}else A=u&~m,A!==0?d=Wr(A):y!==0&&(d=Wr(y));if(d===0)return 0;if(i!==0&&i!==d&&!(i&m)&&(m=d&-d,y=i&-i,m>=y||m===16&&(y&4194240)!==0))return i;if(d&4&&(d|=u&16),i=n.entangledLanes,i!==0)for(n=n.entanglements,i&=d;0<i;)u=31-Mt(i),m=1<<u,d|=n[u],i&=~m;return d}function Zg(n,i){switch(n){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function em(n,i){for(var u=n.suspendedLanes,d=n.pingedLanes,m=n.expirationTimes,y=n.pendingLanes;0<y;){var A=31-Mt(y),I=1<<A,w=m[A];w===-1?(!(I&u)||I&d)&&(m[A]=Zg(I,i)):w<=i&&(n.expiredLanes|=I),y&=~I}}function Mo(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Xu(){var n=Ui;return Ui<<=1,!(Ui&4194240)&&(Ui=64),n}function Uo(n){for(var i=[],u=0;31>u;u++)i.push(n);return i}function jr(n,i,u){n.pendingLanes|=i,i!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,i=31-Mt(i),n[i]=u}function tm(n,i){var u=n.pendingLanes&~i;n.pendingLanes=i,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=i,n.mutableReadLanes&=i,n.entangledLanes&=i,i=n.entanglements;var d=n.eventTimes;for(n=n.expirationTimes;0<u;){var m=31-Mt(u),y=1<<m;i[m]=0,d[m]=-1,n[m]=-1,u&=~y}}function Bo(n,i){var u=n.entangledLanes|=i;for(n=n.entanglements;u;){var d=31-Mt(u),m=1<<d;m&i|n[d]&i&&(n[d]|=i),u&=~m}}var Pe=0;function Qu(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Ju,$o,Zu,ec,tc,Go=!1,Gi=[],En=null,xn=null,Tn=null,Yr=new Map,qr=new Map,Sn=[],nm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nc(n,i){switch(n){case"focusin":case"focusout":En=null;break;case"dragenter":case"dragleave":xn=null;break;case"mouseover":case"mouseout":Tn=null;break;case"pointerover":case"pointerout":Yr.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":qr.delete(i.pointerId)}}function Xr(n,i,u,d,m,y){return n===null||n.nativeEvent!==y?(n={blockedOn:i,domEventName:u,eventSystemFlags:d,nativeEvent:y,targetContainers:[m]},i!==null&&(i=ci(i),i!==null&&$o(i)),n):(n.eventSystemFlags|=d,i=n.targetContainers,m!==null&&i.indexOf(m)===-1&&i.push(m),n)}function rm(n,i,u,d,m){switch(i){case"focusin":return En=Xr(En,n,i,u,d,m),!0;case"dragenter":return xn=Xr(xn,n,i,u,d,m),!0;case"mouseover":return Tn=Xr(Tn,n,i,u,d,m),!0;case"pointerover":var y=m.pointerId;return Yr.set(y,Xr(Yr.get(y)||null,n,i,u,d,m)),!0;case"gotpointercapture":return y=m.pointerId,qr.set(y,Xr(qr.get(y)||null,n,i,u,d,m)),!0}return!1}function rc(n){var i=$n(n.target);if(i!==null){var u=Bn(i);if(u!==null){if(i=u.tag,i===13){if(i=Ku(u),i!==null){n.blockedOn=i,tc(n.priority,function(){Zu(u)});return}}else if(i===3&&u.stateNode.current.memoizedState.isDehydrated){n.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ki(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var u=Vo(n.domEventName,n.eventSystemFlags,i[0],n.nativeEvent);if(u===null){u=n.nativeEvent;var d=new u.constructor(u.type,u);ko=d,u.target.dispatchEvent(d),ko=null}else return i=ci(u),i!==null&&$o(i),n.blockedOn=u,!1;i.shift()}return!0}function ic(n,i,u){Ki(n)&&u.delete(i)}function im(){Go=!1,En!==null&&Ki(En)&&(En=null),xn!==null&&Ki(xn)&&(xn=null),Tn!==null&&Ki(Tn)&&(Tn=null),Yr.forEach(ic),qr.forEach(ic)}function Qr(n,i){n.blockedOn===i&&(n.blockedOn=null,Go||(Go=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,im)))}function Jr(n){function i(m){return Qr(m,n)}if(0<Gi.length){Qr(Gi[0],n);for(var u=1;u<Gi.length;u++){var d=Gi[u];d.blockedOn===n&&(d.blockedOn=null)}}for(En!==null&&Qr(En,n),xn!==null&&Qr(xn,n),Tn!==null&&Qr(Tn,n),Yr.forEach(i),qr.forEach(i),u=0;u<Sn.length;u++)d=Sn[u],d.blockedOn===n&&(d.blockedOn=null);for(;0<Sn.length&&(u=Sn[0],u.blockedOn===null);)rc(u),u.blockedOn===null&&Sn.shift()}var or=M.ReactCurrentBatchConfig,Vi=!0;function sm(n,i,u,d){var m=Pe,y=or.transition;or.transition=null;try{Pe=1,Ko(n,i,u,d)}finally{Pe=m,or.transition=y}}function om(n,i,u,d){var m=Pe,y=or.transition;or.transition=null;try{Pe=4,Ko(n,i,u,d)}finally{Pe=m,or.transition=y}}function Ko(n,i,u,d){if(Vi){var m=Vo(n,i,u,d);if(m===null)oa(n,i,d,Hi,u),nc(n,d);else if(rm(m,n,i,u,d))d.stopPropagation();else if(nc(n,d),i&4&&-1<nm.indexOf(n)){for(;m!==null;){var y=ci(m);if(y!==null&&Ju(y),y=Vo(n,i,u,d),y===null&&oa(n,i,d,Hi,u),y===m)break;m=y}m!==null&&d.stopPropagation()}else oa(n,i,d,null,u)}}var Hi=null;function Vo(n,i,u,d){if(Hi=null,n=_o(d),n=$n(n),n!==null)if(i=Bn(n),i===null)n=null;else if(u=i.tag,u===13){if(n=Ku(i),n!==null)return n;n=null}else if(u===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null);return Hi=n,null}function sc(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jg()){case No:return 1;case Yu:return 4;case Ni:case Yg:return 16;case qu:return 536870912;default:return 16}default:return 16}}var vn=null,Ho=null,zi=null;function oc(){if(zi)return zi;var n,i=Ho,u=i.length,d,m="value"in vn?vn.value:vn.textContent,y=m.length;for(n=0;n<u&&i[n]===m[n];n++);var A=u-n;for(d=1;d<=A&&i[u-d]===m[y-d];d++);return zi=m.slice(n,1<d?1-d:void 0)}function Wi(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function ji(){return!0}function ac(){return!1}function Lt(n){function i(u,d,m,y,A){this._reactName=u,this._targetInst=m,this.type=d,this.nativeEvent=y,this.target=A,this.currentTarget=null;for(var I in n)n.hasOwnProperty(I)&&(u=n[I],this[I]=u?u(y):y[I]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?ji:ac,this.isPropagationStopped=ac,this}return K(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=ji)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=ji)},persist:function(){},isPersistent:ji}),i}var ar={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zo=Lt(ar),Zr=K({},ar,{view:0,detail:0}),am=Lt(Zr),Wo,jo,ei,Yi=K({},Zr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qo,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ei&&(ei&&n.type==="mousemove"?(Wo=n.screenX-ei.screenX,jo=n.screenY-ei.screenY):jo=Wo=0,ei=n),Wo)},movementY:function(n){return"movementY"in n?n.movementY:jo}}),lc=Lt(Yi),lm=K({},Yi,{dataTransfer:0}),um=Lt(lm),cm=K({},Zr,{relatedTarget:0}),Yo=Lt(cm),fm=K({},ar,{animationName:0,elapsedTime:0,pseudoElement:0}),dm=Lt(fm),hm=K({},ar,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),gm=Lt(hm),mm=K({},ar,{data:0}),uc=Lt(mm),pm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ym={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Em={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xm(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=Em[n])?!!i[n]:!1}function qo(){return xm}var Tm=K({},Zr,{key:function(n){if(n.key){var i=pm[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=Wi(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?ym[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qo,charCode:function(n){return n.type==="keypress"?Wi(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Wi(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Sm=Lt(Tm),vm=K({},Yi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cc=Lt(vm),Lm=K({},Zr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qo}),Am=Lt(Lm),Rm=K({},ar,{propertyName:0,elapsedTime:0,pseudoElement:0}),Im=Lt(Rm),Cm=K({},Yi,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),wm=Lt(Cm),Dm=[9,13,27,32],Xo=c&&"CompositionEvent"in window,ti=null;c&&"documentMode"in document&&(ti=document.documentMode);var km=c&&"TextEvent"in window&&!ti,fc=c&&(!Xo||ti&&8<ti&&11>=ti),dc=" ",hc=!1;function gc(n,i){switch(n){case"keyup":return Dm.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mc(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var lr=!1;function _m(n,i){switch(n){case"compositionend":return mc(i);case"keypress":return i.which!==32?null:(hc=!0,dc);case"textInput":return n=i.data,n===dc&&hc?null:n;default:return null}}function Pm(n,i){if(lr)return n==="compositionend"||!Xo&&gc(n,i)?(n=oc(),zi=Ho=vn=null,lr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return fc&&i.locale!=="ko"?null:i.data;default:return null}}var Fm={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pc(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!Fm[n.type]:i==="textarea"}function yc(n,i,u,d){Mu(d),i=Zi(i,"onChange"),0<i.length&&(u=new zo("onChange","change",null,u,d),n.push({event:u,listeners:i}))}var ni=null,ri=null;function bm(n){Oc(n,0)}function qi(n){var i=hr(n);if(Ru(i))return n}function Om(n,i){if(n==="change")return i}var Ec=!1;if(c){var Qo;if(c){var Jo="oninput"in document;if(!Jo){var xc=document.createElement("div");xc.setAttribute("oninput","return;"),Jo=typeof xc.oninput=="function"}Qo=Jo}else Qo=!1;Ec=Qo&&(!document.documentMode||9<document.documentMode)}function Tc(){ni&&(ni.detachEvent("onpropertychange",Sc),ri=ni=null)}function Sc(n){if(n.propertyName==="value"&&qi(ri)){var i=[];yc(i,ri,n,_o(n)),Gu(bm,i)}}function Nm(n,i,u){n==="focusin"?(Tc(),ni=i,ri=u,ni.attachEvent("onpropertychange",Sc)):n==="focusout"&&Tc()}function Mm(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return qi(ri)}function Um(n,i){if(n==="click")return qi(i)}function Bm(n,i){if(n==="input"||n==="change")return qi(i)}function $m(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var Ut=typeof Object.is=="function"?Object.is:$m;function ii(n,i){if(Ut(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var u=Object.keys(n),d=Object.keys(i);if(u.length!==d.length)return!1;for(d=0;d<u.length;d++){var m=u[d];if(!f.call(i,m)||!Ut(n[m],i[m]))return!1}return!0}function vc(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Lc(n,i){var u=vc(n);n=0;for(var d;u;){if(u.nodeType===3){if(d=n+u.textContent.length,n<=i&&d>=i)return{node:u,offset:i-n};n=d}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=vc(u)}}function Ac(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?Ac(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function Rc(){for(var n=window,i=Pi();i instanceof n.HTMLIFrameElement;){try{var u=typeof i.contentWindow.location.href=="string"}catch{u=!1}if(u)n=i.contentWindow;else break;i=Pi(n.document)}return i}function Zo(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}function Gm(n){var i=Rc(),u=n.focusedElem,d=n.selectionRange;if(i!==u&&u&&u.ownerDocument&&Ac(u.ownerDocument.documentElement,u)){if(d!==null&&Zo(u)){if(i=d.start,n=d.end,n===void 0&&(n=i),"selectionStart"in u)u.selectionStart=i,u.selectionEnd=Math.min(n,u.value.length);else if(n=(i=u.ownerDocument||document)&&i.defaultView||window,n.getSelection){n=n.getSelection();var m=u.textContent.length,y=Math.min(d.start,m);d=d.end===void 0?y:Math.min(d.end,m),!n.extend&&y>d&&(m=d,d=y,y=m),m=Lc(u,y);var A=Lc(u,d);m&&A&&(n.rangeCount!==1||n.anchorNode!==m.node||n.anchorOffset!==m.offset||n.focusNode!==A.node||n.focusOffset!==A.offset)&&(i=i.createRange(),i.setStart(m.node,m.offset),n.removeAllRanges(),y>d?(n.addRange(i),n.extend(A.node,A.offset)):(i.setEnd(A.node,A.offset),n.addRange(i)))}}for(i=[],n=u;n=n.parentNode;)n.nodeType===1&&i.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<i.length;u++)n=i[u],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Km=c&&"documentMode"in document&&11>=document.documentMode,ur=null,ea=null,si=null,ta=!1;function Ic(n,i,u){var d=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;ta||ur==null||ur!==Pi(d)||(d=ur,"selectionStart"in d&&Zo(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),si&&ii(si,d)||(si=d,d=Zi(ea,"onSelect"),0<d.length&&(i=new zo("onSelect","select",null,i,u),n.push({event:i,listeners:d}),i.target=ur)))}function Xi(n,i){var u={};return u[n.toLowerCase()]=i.toLowerCase(),u["Webkit"+n]="webkit"+i,u["Moz"+n]="moz"+i,u}var cr={animationend:Xi("Animation","AnimationEnd"),animationiteration:Xi("Animation","AnimationIteration"),animationstart:Xi("Animation","AnimationStart"),transitionend:Xi("Transition","TransitionEnd")},na={},Cc={};c&&(Cc=document.createElement("div").style,"AnimationEvent"in window||(delete cr.animationend.animation,delete cr.animationiteration.animation,delete cr.animationstart.animation),"TransitionEvent"in window||delete cr.transitionend.transition);function Qi(n){if(na[n])return na[n];if(!cr[n])return n;var i=cr[n],u;for(u in i)if(i.hasOwnProperty(u)&&u in Cc)return na[n]=i[u];return n}var wc=Qi("animationend"),Dc=Qi("animationiteration"),kc=Qi("animationstart"),_c=Qi("transitionend"),Pc=new Map,Fc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ln(n,i){Pc.set(n,i),o(i,[n])}for(var ra=0;ra<Fc.length;ra++){var ia=Fc[ra],Vm=ia.toLowerCase(),Hm=ia[0].toUpperCase()+ia.slice(1);Ln(Vm,"on"+Hm)}Ln(wc,"onAnimationEnd"),Ln(Dc,"onAnimationIteration"),Ln(kc,"onAnimationStart"),Ln("dblclick","onDoubleClick"),Ln("focusin","onFocus"),Ln("focusout","onBlur"),Ln(_c,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var oi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zm=new Set("cancel close invalid load scroll toggle".split(" ").concat(oi));function bc(n,i,u){var d=n.type||"unknown-event";n.currentTarget=u,Vg(d,i,void 0,n),n.currentTarget=null}function Oc(n,i){i=(i&4)!==0;for(var u=0;u<n.length;u++){var d=n[u],m=d.event;d=d.listeners;e:{var y=void 0;if(i)for(var A=d.length-1;0<=A;A--){var I=d[A],w=I.instance,B=I.currentTarget;if(I=I.listener,w!==y&&m.isPropagationStopped())break e;bc(m,I,B),y=w}else for(A=0;A<d.length;A++){if(I=d[A],w=I.instance,B=I.currentTarget,I=I.listener,w!==y&&m.isPropagationStopped())break e;bc(m,I,B),y=w}}}if(Oi)throw n=Oo,Oi=!1,Oo=null,n}function Me(n,i){var u=i[da];u===void 0&&(u=i[da]=new Set);var d=n+"__bubble";u.has(d)||(Nc(i,n,2,!1),u.add(d))}function sa(n,i,u){var d=0;i&&(d|=4),Nc(u,n,d,i)}var Ji="_reactListening"+Math.random().toString(36).slice(2);function ai(n){if(!n[Ji]){n[Ji]=!0,r.forEach(function(u){u!=="selectionchange"&&(zm.has(u)||sa(u,!1,n),sa(u,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[Ji]||(i[Ji]=!0,sa("selectionchange",!1,i))}}function Nc(n,i,u,d){switch(sc(i)){case 1:var m=sm;break;case 4:m=om;break;default:m=Ko}u=m.bind(null,i,u,n),m=void 0,!bo||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(m=!0),d?m!==void 0?n.addEventListener(i,u,{capture:!0,passive:m}):n.addEventListener(i,u,!0):m!==void 0?n.addEventListener(i,u,{passive:m}):n.addEventListener(i,u,!1)}function oa(n,i,u,d,m){var y=d;if(!(i&1)&&!(i&2)&&d!==null)e:for(;;){if(d===null)return;var A=d.tag;if(A===3||A===4){var I=d.stateNode.containerInfo;if(I===m||I.nodeType===8&&I.parentNode===m)break;if(A===4)for(A=d.return;A!==null;){var w=A.tag;if((w===3||w===4)&&(w=A.stateNode.containerInfo,w===m||w.nodeType===8&&w.parentNode===m))return;A=A.return}for(;I!==null;){if(A=$n(I),A===null)return;if(w=A.tag,w===5||w===6){d=y=A;continue e}I=I.parentNode}}d=d.return}Gu(function(){var B=y,X=_o(u),J=[];e:{var Y=Pc.get(n);if(Y!==void 0){var ne=zo,ae=n;switch(n){case"keypress":if(Wi(u)===0)break e;case"keydown":case"keyup":ne=Sm;break;case"focusin":ae="focus",ne=Yo;break;case"focusout":ae="blur",ne=Yo;break;case"beforeblur":case"afterblur":ne=Yo;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ne=lc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ne=um;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ne=Am;break;case wc:case Dc:case kc:ne=dm;break;case _c:ne=Im;break;case"scroll":ne=am;break;case"wheel":ne=wm;break;case"copy":case"cut":case"paste":ne=gm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ne=cc}var le=(i&4)!==0,ze=!le&&n==="scroll",b=le?Y!==null?Y+"Capture":null:Y;le=[];for(var P=B,N;P!==null;){N=P;var Z=N.stateNode;if(N.tag===5&&Z!==null&&(N=Z,b!==null&&(Z=Vr(P,b),Z!=null&&le.push(li(P,Z,N)))),ze)break;P=P.return}0<le.length&&(Y=new ne(Y,ae,null,u,X),J.push({event:Y,listeners:le}))}}if(!(i&7)){e:{if(Y=n==="mouseover"||n==="pointerover",ne=n==="mouseout"||n==="pointerout",Y&&u!==ko&&(ae=u.relatedTarget||u.fromElement)&&($n(ae)||ae[on]))break e;if((ne||Y)&&(Y=X.window===X?X:(Y=X.ownerDocument)?Y.defaultView||Y.parentWindow:window,ne?(ae=u.relatedTarget||u.toElement,ne=B,ae=ae?$n(ae):null,ae!==null&&(ze=Bn(ae),ae!==ze||ae.tag!==5&&ae.tag!==6)&&(ae=null)):(ne=null,ae=B),ne!==ae)){if(le=lc,Z="onMouseLeave",b="onMouseEnter",P="mouse",(n==="pointerout"||n==="pointerover")&&(le=cc,Z="onPointerLeave",b="onPointerEnter",P="pointer"),ze=ne==null?Y:hr(ne),N=ae==null?Y:hr(ae),Y=new le(Z,P+"leave",ne,u,X),Y.target=ze,Y.relatedTarget=N,Z=null,$n(X)===B&&(le=new le(b,P+"enter",ae,u,X),le.target=N,le.relatedTarget=ze,Z=le),ze=Z,ne&&ae)t:{for(le=ne,b=ae,P=0,N=le;N;N=fr(N))P++;for(N=0,Z=b;Z;Z=fr(Z))N++;for(;0<P-N;)le=fr(le),P--;for(;0<N-P;)b=fr(b),N--;for(;P--;){if(le===b||b!==null&&le===b.alternate)break t;le=fr(le),b=fr(b)}le=null}else le=null;ne!==null&&Mc(J,Y,ne,le,!1),ae!==null&&ze!==null&&Mc(J,ze,ae,le,!0)}}e:{if(Y=B?hr(B):window,ne=Y.nodeName&&Y.nodeName.toLowerCase(),ne==="select"||ne==="input"&&Y.type==="file")var ue=Om;else if(pc(Y))if(Ec)ue=Bm;else{ue=Mm;var me=Nm}else(ne=Y.nodeName)&&ne.toLowerCase()==="input"&&(Y.type==="checkbox"||Y.type==="radio")&&(ue=Um);if(ue&&(ue=ue(n,B))){yc(J,ue,u,X);break e}me&&me(n,Y,B),n==="focusout"&&(me=Y._wrapperState)&&me.controlled&&Y.type==="number"&&Ro(Y,"number",Y.value)}switch(me=B?hr(B):window,n){case"focusin":(pc(me)||me.contentEditable==="true")&&(ur=me,ea=B,si=null);break;case"focusout":si=ea=ur=null;break;case"mousedown":ta=!0;break;case"contextmenu":case"mouseup":case"dragend":ta=!1,Ic(J,u,X);break;case"selectionchange":if(Km)break;case"keydown":case"keyup":Ic(J,u,X)}var pe;if(Xo)e:{switch(n){case"compositionstart":var ve="onCompositionStart";break e;case"compositionend":ve="onCompositionEnd";break e;case"compositionupdate":ve="onCompositionUpdate";break e}ve=void 0}else lr?gc(n,u)&&(ve="onCompositionEnd"):n==="keydown"&&u.keyCode===229&&(ve="onCompositionStart");ve&&(fc&&u.locale!=="ko"&&(lr||ve!=="onCompositionStart"?ve==="onCompositionEnd"&&lr&&(pe=oc()):(vn=X,Ho="value"in vn?vn.value:vn.textContent,lr=!0)),me=Zi(B,ve),0<me.length&&(ve=new uc(ve,n,null,u,X),J.push({event:ve,listeners:me}),pe?ve.data=pe:(pe=mc(u),pe!==null&&(ve.data=pe)))),(pe=km?_m(n,u):Pm(n,u))&&(B=Zi(B,"onBeforeInput"),0<B.length&&(X=new uc("onBeforeInput","beforeinput",null,u,X),J.push({event:X,listeners:B}),X.data=pe))}Oc(J,i)})}function li(n,i,u){return{instance:n,listener:i,currentTarget:u}}function Zi(n,i){for(var u=i+"Capture",d=[];n!==null;){var m=n,y=m.stateNode;m.tag===5&&y!==null&&(m=y,y=Vr(n,u),y!=null&&d.unshift(li(n,y,m)),y=Vr(n,i),y!=null&&d.push(li(n,y,m))),n=n.return}return d}function fr(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Mc(n,i,u,d,m){for(var y=i._reactName,A=[];u!==null&&u!==d;){var I=u,w=I.alternate,B=I.stateNode;if(w!==null&&w===d)break;I.tag===5&&B!==null&&(I=B,m?(w=Vr(u,y),w!=null&&A.unshift(li(u,w,I))):m||(w=Vr(u,y),w!=null&&A.push(li(u,w,I)))),u=u.return}A.length!==0&&n.push({event:i,listeners:A})}var Wm=/\r\n?/g,jm=/\u0000|\uFFFD/g;function Uc(n){return(typeof n=="string"?n:""+n).replace(Wm,`
`).replace(jm,"")}function es(n,i,u){if(i=Uc(i),Uc(n)!==i&&u)throw Error(t(425))}function ts(){}var aa=null,la=null;function ua(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var ca=typeof setTimeout=="function"?setTimeout:void 0,Ym=typeof clearTimeout=="function"?clearTimeout:void 0,Bc=typeof Promise=="function"?Promise:void 0,qm=typeof queueMicrotask=="function"?queueMicrotask:typeof Bc<"u"?function(n){return Bc.resolve(null).then(n).catch(Xm)}:ca;function Xm(n){setTimeout(function(){throw n})}function fa(n,i){var u=i,d=0;do{var m=u.nextSibling;if(n.removeChild(u),m&&m.nodeType===8)if(u=m.data,u==="/$"){if(d===0){n.removeChild(m),Jr(i);return}d--}else u!=="$"&&u!=="$?"&&u!=="$!"||d++;u=m}while(u);Jr(i)}function An(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return n}function $c(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var u=n.data;if(u==="$"||u==="$!"||u==="$?"){if(i===0)return n;i--}else u==="/$"&&i++}n=n.previousSibling}return null}var dr=Math.random().toString(36).slice(2),Yt="__reactFiber$"+dr,ui="__reactProps$"+dr,on="__reactContainer$"+dr,da="__reactEvents$"+dr,Qm="__reactListeners$"+dr,Jm="__reactHandles$"+dr;function $n(n){var i=n[Yt];if(i)return i;for(var u=n.parentNode;u;){if(i=u[on]||u[Yt]){if(u=i.alternate,i.child!==null||u!==null&&u.child!==null)for(n=$c(n);n!==null;){if(u=n[Yt])return u;n=$c(n)}return i}n=u,u=n.parentNode}return null}function ci(n){return n=n[Yt]||n[on],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function hr(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(t(33))}function ns(n){return n[ui]||null}var ha=[],gr=-1;function Rn(n){return{current:n}}function Ue(n){0>gr||(n.current=ha[gr],ha[gr]=null,gr--)}function Oe(n,i){gr++,ha[gr]=n.current,n.current=i}var In={},at=Rn(In),gt=Rn(!1),Gn=In;function mr(n,i){var u=n.type.contextTypes;if(!u)return In;var d=n.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===i)return d.__reactInternalMemoizedMaskedChildContext;var m={},y;for(y in u)m[y]=i[y];return d&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=m),m}function mt(n){return n=n.childContextTypes,n!=null}function rs(){Ue(gt),Ue(at)}function Gc(n,i,u){if(at.current!==In)throw Error(t(168));Oe(at,i),Oe(gt,u)}function Kc(n,i,u){var d=n.stateNode;if(i=i.childContextTypes,typeof d.getChildContext!="function")return u;d=d.getChildContext();for(var m in d)if(!(m in i))throw Error(t(108,Re(n)||"Unknown",m));return K({},u,d)}function is(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||In,Gn=at.current,Oe(at,n),Oe(gt,gt.current),!0}function Vc(n,i,u){var d=n.stateNode;if(!d)throw Error(t(169));u?(n=Kc(n,i,Gn),d.__reactInternalMemoizedMergedChildContext=n,Ue(gt),Ue(at),Oe(at,n)):Ue(gt),Oe(gt,u)}var an=null,ss=!1,ga=!1;function Hc(n){an===null?an=[n]:an.push(n)}function Zm(n){ss=!0,Hc(n)}function Cn(){if(!ga&&an!==null){ga=!0;var n=0,i=Pe;try{var u=an;for(Pe=1;n<u.length;n++){var d=u[n];do d=d(!0);while(d!==null)}an=null,ss=!1}catch(m){throw an!==null&&(an=an.slice(n+1)),Wu(No,Cn),m}finally{Pe=i,ga=!1}}return null}var pr=[],yr=0,os=null,as=0,Ct=[],wt=0,Kn=null,ln=1,un="";function Vn(n,i){pr[yr++]=as,pr[yr++]=os,os=n,as=i}function zc(n,i,u){Ct[wt++]=ln,Ct[wt++]=un,Ct[wt++]=Kn,Kn=n;var d=ln;n=un;var m=32-Mt(d)-1;d&=~(1<<m),u+=1;var y=32-Mt(i)+m;if(30<y){var A=m-m%5;y=(d&(1<<A)-1).toString(32),d>>=A,m-=A,ln=1<<32-Mt(i)+m|u<<m|d,un=y+n}else ln=1<<y|u<<m|d,un=n}function ma(n){n.return!==null&&(Vn(n,1),zc(n,1,0))}function pa(n){for(;n===os;)os=pr[--yr],pr[yr]=null,as=pr[--yr],pr[yr]=null;for(;n===Kn;)Kn=Ct[--wt],Ct[wt]=null,un=Ct[--wt],Ct[wt]=null,ln=Ct[--wt],Ct[wt]=null}var At=null,Rt=null,Be=!1,Bt=null;function Wc(n,i){var u=Pt(5,null,null,0);u.elementType="DELETED",u.stateNode=i,u.return=n,i=n.deletions,i===null?(n.deletions=[u],n.flags|=16):i.push(u)}function jc(n,i){switch(n.tag){case 5:var u=n.type;return i=i.nodeType!==1||u.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(n.stateNode=i,At=n,Rt=An(i.firstChild),!0):!1;case 6:return i=n.pendingProps===""||i.nodeType!==3?null:i,i!==null?(n.stateNode=i,At=n,Rt=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(u=Kn!==null?{id:ln,overflow:un}:null,n.memoizedState={dehydrated:i,treeContext:u,retryLane:1073741824},u=Pt(18,null,null,0),u.stateNode=i,u.return=n,n.child=u,At=n,Rt=null,!0):!1;default:return!1}}function ya(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Ea(n){if(Be){var i=Rt;if(i){var u=i;if(!jc(n,i)){if(ya(n))throw Error(t(418));i=An(u.nextSibling);var d=At;i&&jc(n,i)?Wc(d,u):(n.flags=n.flags&-4097|2,Be=!1,At=n)}}else{if(ya(n))throw Error(t(418));n.flags=n.flags&-4097|2,Be=!1,At=n}}}function Yc(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;At=n}function ls(n){if(n!==At)return!1;if(!Be)return Yc(n),Be=!0,!1;var i;if((i=n.tag!==3)&&!(i=n.tag!==5)&&(i=n.type,i=i!=="head"&&i!=="body"&&!ua(n.type,n.memoizedProps)),i&&(i=Rt)){if(ya(n))throw qc(),Error(t(418));for(;i;)Wc(n,i),i=An(i.nextSibling)}if(Yc(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(t(317));e:{for(n=n.nextSibling,i=0;n;){if(n.nodeType===8){var u=n.data;if(u==="/$"){if(i===0){Rt=An(n.nextSibling);break e}i--}else u!=="$"&&u!=="$!"&&u!=="$?"||i++}n=n.nextSibling}Rt=null}}else Rt=At?An(n.stateNode.nextSibling):null;return!0}function qc(){for(var n=Rt;n;)n=An(n.nextSibling)}function Er(){Rt=At=null,Be=!1}function xa(n){Bt===null?Bt=[n]:Bt.push(n)}var ep=M.ReactCurrentBatchConfig;function fi(n,i,u){if(n=u.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(t(309));var d=u.stateNode}if(!d)throw Error(t(147,n));var m=d,y=""+n;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===y?i.ref:(i=function(A){var I=m.refs;A===null?delete I[y]:I[y]=A},i._stringRef=y,i)}if(typeof n!="string")throw Error(t(284));if(!u._owner)throw Error(t(290,n))}return n}function us(n,i){throw n=Object.prototype.toString.call(i),Error(t(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n))}function Xc(n){var i=n._init;return i(n._payload)}function Qc(n){function i(b,P){if(n){var N=b.deletions;N===null?(b.deletions=[P],b.flags|=16):N.push(P)}}function u(b,P){if(!n)return null;for(;P!==null;)i(b,P),P=P.sibling;return null}function d(b,P){for(b=new Map;P!==null;)P.key!==null?b.set(P.key,P):b.set(P.index,P),P=P.sibling;return b}function m(b,P){return b=On(b,P),b.index=0,b.sibling=null,b}function y(b,P,N){return b.index=N,n?(N=b.alternate,N!==null?(N=N.index,N<P?(b.flags|=2,P):N):(b.flags|=2,P)):(b.flags|=1048576,P)}function A(b){return n&&b.alternate===null&&(b.flags|=2),b}function I(b,P,N,Z){return P===null||P.tag!==6?(P=cl(N,b.mode,Z),P.return=b,P):(P=m(P,N),P.return=b,P)}function w(b,P,N,Z){var ue=N.type;return ue===U?X(b,P,N.props.children,Z,N.key):P!==null&&(P.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===oe&&Xc(ue)===P.type)?(Z=m(P,N.props),Z.ref=fi(b,P,N),Z.return=b,Z):(Z=Fs(N.type,N.key,N.props,null,b.mode,Z),Z.ref=fi(b,P,N),Z.return=b,Z)}function B(b,P,N,Z){return P===null||P.tag!==4||P.stateNode.containerInfo!==N.containerInfo||P.stateNode.implementation!==N.implementation?(P=fl(N,b.mode,Z),P.return=b,P):(P=m(P,N.children||[]),P.return=b,P)}function X(b,P,N,Z,ue){return P===null||P.tag!==7?(P=Qn(N,b.mode,Z,ue),P.return=b,P):(P=m(P,N),P.return=b,P)}function J(b,P,N){if(typeof P=="string"&&P!==""||typeof P=="number")return P=cl(""+P,b.mode,N),P.return=b,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case _:return N=Fs(P.type,P.key,P.props,null,b.mode,N),N.ref=fi(b,null,P),N.return=b,N;case V:return P=fl(P,b.mode,N),P.return=b,P;case oe:var Z=P._init;return J(b,Z(P._payload),N)}if($r(P)||z(P))return P=Qn(P,b.mode,N,null),P.return=b,P;us(b,P)}return null}function Y(b,P,N,Z){var ue=P!==null?P.key:null;if(typeof N=="string"&&N!==""||typeof N=="number")return ue!==null?null:I(b,P,""+N,Z);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case _:return N.key===ue?w(b,P,N,Z):null;case V:return N.key===ue?B(b,P,N,Z):null;case oe:return ue=N._init,Y(b,P,ue(N._payload),Z)}if($r(N)||z(N))return ue!==null?null:X(b,P,N,Z,null);us(b,N)}return null}function ne(b,P,N,Z,ue){if(typeof Z=="string"&&Z!==""||typeof Z=="number")return b=b.get(N)||null,I(P,b,""+Z,ue);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case _:return b=b.get(Z.key===null?N:Z.key)||null,w(P,b,Z,ue);case V:return b=b.get(Z.key===null?N:Z.key)||null,B(P,b,Z,ue);case oe:var me=Z._init;return ne(b,P,N,me(Z._payload),ue)}if($r(Z)||z(Z))return b=b.get(N)||null,X(P,b,Z,ue,null);us(P,Z)}return null}function ae(b,P,N,Z){for(var ue=null,me=null,pe=P,ve=P=0,Ze=null;pe!==null&&ve<N.length;ve++){pe.index>ve?(Ze=pe,pe=null):Ze=pe.sibling;var ke=Y(b,pe,N[ve],Z);if(ke===null){pe===null&&(pe=Ze);break}n&&pe&&ke.alternate===null&&i(b,pe),P=y(ke,P,ve),me===null?ue=ke:me.sibling=ke,me=ke,pe=Ze}if(ve===N.length)return u(b,pe),Be&&Vn(b,ve),ue;if(pe===null){for(;ve<N.length;ve++)pe=J(b,N[ve],Z),pe!==null&&(P=y(pe,P,ve),me===null?ue=pe:me.sibling=pe,me=pe);return Be&&Vn(b,ve),ue}for(pe=d(b,pe);ve<N.length;ve++)Ze=ne(pe,b,ve,N[ve],Z),Ze!==null&&(n&&Ze.alternate!==null&&pe.delete(Ze.key===null?ve:Ze.key),P=y(Ze,P,ve),me===null?ue=Ze:me.sibling=Ze,me=Ze);return n&&pe.forEach(function(Nn){return i(b,Nn)}),Be&&Vn(b,ve),ue}function le(b,P,N,Z){var ue=z(N);if(typeof ue!="function")throw Error(t(150));if(N=ue.call(N),N==null)throw Error(t(151));for(var me=ue=null,pe=P,ve=P=0,Ze=null,ke=N.next();pe!==null&&!ke.done;ve++,ke=N.next()){pe.index>ve?(Ze=pe,pe=null):Ze=pe.sibling;var Nn=Y(b,pe,ke.value,Z);if(Nn===null){pe===null&&(pe=Ze);break}n&&pe&&Nn.alternate===null&&i(b,pe),P=y(Nn,P,ve),me===null?ue=Nn:me.sibling=Nn,me=Nn,pe=Ze}if(ke.done)return u(b,pe),Be&&Vn(b,ve),ue;if(pe===null){for(;!ke.done;ve++,ke=N.next())ke=J(b,ke.value,Z),ke!==null&&(P=y(ke,P,ve),me===null?ue=ke:me.sibling=ke,me=ke);return Be&&Vn(b,ve),ue}for(pe=d(b,pe);!ke.done;ve++,ke=N.next())ke=ne(pe,b,ve,ke.value,Z),ke!==null&&(n&&ke.alternate!==null&&pe.delete(ke.key===null?ve:ke.key),P=y(ke,P,ve),me===null?ue=ke:me.sibling=ke,me=ke);return n&&pe.forEach(function(Pp){return i(b,Pp)}),Be&&Vn(b,ve),ue}function ze(b,P,N,Z){if(typeof N=="object"&&N!==null&&N.type===U&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case _:e:{for(var ue=N.key,me=P;me!==null;){if(me.key===ue){if(ue=N.type,ue===U){if(me.tag===7){u(b,me.sibling),P=m(me,N.props.children),P.return=b,b=P;break e}}else if(me.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===oe&&Xc(ue)===me.type){u(b,me.sibling),P=m(me,N.props),P.ref=fi(b,me,N),P.return=b,b=P;break e}u(b,me);break}else i(b,me);me=me.sibling}N.type===U?(P=Qn(N.props.children,b.mode,Z,N.key),P.return=b,b=P):(Z=Fs(N.type,N.key,N.props,null,b.mode,Z),Z.ref=fi(b,P,N),Z.return=b,b=Z)}return A(b);case V:e:{for(me=N.key;P!==null;){if(P.key===me)if(P.tag===4&&P.stateNode.containerInfo===N.containerInfo&&P.stateNode.implementation===N.implementation){u(b,P.sibling),P=m(P,N.children||[]),P.return=b,b=P;break e}else{u(b,P);break}else i(b,P);P=P.sibling}P=fl(N,b.mode,Z),P.return=b,b=P}return A(b);case oe:return me=N._init,ze(b,P,me(N._payload),Z)}if($r(N))return ae(b,P,N,Z);if(z(N))return le(b,P,N,Z);us(b,N)}return typeof N=="string"&&N!==""||typeof N=="number"?(N=""+N,P!==null&&P.tag===6?(u(b,P.sibling),P=m(P,N),P.return=b,b=P):(u(b,P),P=cl(N,b.mode,Z),P.return=b,b=P),A(b)):u(b,P)}return ze}var xr=Qc(!0),Jc=Qc(!1),cs=Rn(null),fs=null,Tr=null,Ta=null;function Sa(){Ta=Tr=fs=null}function va(n){var i=cs.current;Ue(cs),n._currentValue=i}function La(n,i,u){for(;n!==null;){var d=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),n===u)break;n=n.return}}function Sr(n,i){fs=n,Ta=Tr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&i&&(pt=!0),n.firstContext=null)}function Dt(n){var i=n._currentValue;if(Ta!==n)if(n={context:n,memoizedValue:i,next:null},Tr===null){if(fs===null)throw Error(t(308));Tr=n,fs.dependencies={lanes:0,firstContext:n}}else Tr=Tr.next=n;return i}var Hn=null;function Aa(n){Hn===null?Hn=[n]:Hn.push(n)}function Zc(n,i,u,d){var m=i.interleaved;return m===null?(u.next=u,Aa(i)):(u.next=m.next,m.next=u),i.interleaved=u,cn(n,d)}function cn(n,i){n.lanes|=i;var u=n.alternate;for(u!==null&&(u.lanes|=i),u=n,n=n.return;n!==null;)n.childLanes|=i,u=n.alternate,u!==null&&(u.childLanes|=i),u=n,n=n.return;return u.tag===3?u.stateNode:null}var wn=!1;function Ra(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ef(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function fn(n,i){return{eventTime:n,lane:i,tag:0,payload:null,callback:null,next:null}}function Dn(n,i,u){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,De&2){var m=d.pending;return m===null?i.next=i:(i.next=m.next,m.next=i),d.pending=i,cn(n,u)}return m=d.interleaved,m===null?(i.next=i,Aa(d)):(i.next=m.next,m.next=i),d.interleaved=i,cn(n,u)}function ds(n,i,u){if(i=i.updateQueue,i!==null&&(i=i.shared,(u&4194240)!==0)){var d=i.lanes;d&=n.pendingLanes,u|=d,i.lanes=u,Bo(n,u)}}function tf(n,i){var u=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,u===d)){var m=null,y=null;if(u=u.firstBaseUpdate,u!==null){do{var A={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};y===null?m=y=A:y=y.next=A,u=u.next}while(u!==null);y===null?m=y=i:y=y.next=i}else m=y=i;u={baseState:d.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:d.shared,effects:d.effects},n.updateQueue=u;return}n=u.lastBaseUpdate,n===null?u.firstBaseUpdate=i:n.next=i,u.lastBaseUpdate=i}function hs(n,i,u,d){var m=n.updateQueue;wn=!1;var y=m.firstBaseUpdate,A=m.lastBaseUpdate,I=m.shared.pending;if(I!==null){m.shared.pending=null;var w=I,B=w.next;w.next=null,A===null?y=B:A.next=B,A=w;var X=n.alternate;X!==null&&(X=X.updateQueue,I=X.lastBaseUpdate,I!==A&&(I===null?X.firstBaseUpdate=B:I.next=B,X.lastBaseUpdate=w))}if(y!==null){var J=m.baseState;A=0,X=B=w=null,I=y;do{var Y=I.lane,ne=I.eventTime;if((d&Y)===Y){X!==null&&(X=X.next={eventTime:ne,lane:0,tag:I.tag,payload:I.payload,callback:I.callback,next:null});e:{var ae=n,le=I;switch(Y=i,ne=u,le.tag){case 1:if(ae=le.payload,typeof ae=="function"){J=ae.call(ne,J,Y);break e}J=ae;break e;case 3:ae.flags=ae.flags&-65537|128;case 0:if(ae=le.payload,Y=typeof ae=="function"?ae.call(ne,J,Y):ae,Y==null)break e;J=K({},J,Y);break e;case 2:wn=!0}}I.callback!==null&&I.lane!==0&&(n.flags|=64,Y=m.effects,Y===null?m.effects=[I]:Y.push(I))}else ne={eventTime:ne,lane:Y,tag:I.tag,payload:I.payload,callback:I.callback,next:null},X===null?(B=X=ne,w=J):X=X.next=ne,A|=Y;if(I=I.next,I===null){if(I=m.shared.pending,I===null)break;Y=I,I=Y.next,Y.next=null,m.lastBaseUpdate=Y,m.shared.pending=null}}while(!0);if(X===null&&(w=J),m.baseState=w,m.firstBaseUpdate=B,m.lastBaseUpdate=X,i=m.shared.interleaved,i!==null){m=i;do A|=m.lane,m=m.next;while(m!==i)}else y===null&&(m.shared.lanes=0);jn|=A,n.lanes=A,n.memoizedState=J}}function nf(n,i,u){if(n=i.effects,i.effects=null,n!==null)for(i=0;i<n.length;i++){var d=n[i],m=d.callback;if(m!==null){if(d.callback=null,d=u,typeof m!="function")throw Error(t(191,m));m.call(d)}}}var di={},qt=Rn(di),hi=Rn(di),gi=Rn(di);function zn(n){if(n===di)throw Error(t(174));return n}function Ia(n,i){switch(Oe(gi,i),Oe(hi,n),Oe(qt,di),n=i.nodeType,n){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Co(null,"");break;default:n=n===8?i.parentNode:i,i=n.namespaceURI||null,n=n.tagName,i=Co(i,n)}Ue(qt),Oe(qt,i)}function vr(){Ue(qt),Ue(hi),Ue(gi)}function rf(n){zn(gi.current);var i=zn(qt.current),u=Co(i,n.type);i!==u&&(Oe(hi,n),Oe(qt,u))}function Ca(n){hi.current===n&&(Ue(qt),Ue(hi))}var $e=Rn(0);function gs(n){for(var i=n;i!==null;){if(i.tag===13){var u=i.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var wa=[];function Da(){for(var n=0;n<wa.length;n++)wa[n]._workInProgressVersionPrimary=null;wa.length=0}var ms=M.ReactCurrentDispatcher,ka=M.ReactCurrentBatchConfig,Wn=0,Ge=null,Ye=null,Qe=null,ps=!1,mi=!1,pi=0,tp=0;function lt(){throw Error(t(321))}function _a(n,i){if(i===null)return!1;for(var u=0;u<i.length&&u<n.length;u++)if(!Ut(n[u],i[u]))return!1;return!0}function Pa(n,i,u,d,m,y){if(Wn=y,Ge=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,ms.current=n===null||n.memoizedState===null?sp:op,n=u(d,m),mi){y=0;do{if(mi=!1,pi=0,25<=y)throw Error(t(301));y+=1,Qe=Ye=null,i.updateQueue=null,ms.current=ap,n=u(d,m)}while(mi)}if(ms.current=xs,i=Ye!==null&&Ye.next!==null,Wn=0,Qe=Ye=Ge=null,ps=!1,i)throw Error(t(300));return n}function Fa(){var n=pi!==0;return pi=0,n}function Xt(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qe===null?Ge.memoizedState=Qe=n:Qe=Qe.next=n,Qe}function kt(){if(Ye===null){var n=Ge.alternate;n=n!==null?n.memoizedState:null}else n=Ye.next;var i=Qe===null?Ge.memoizedState:Qe.next;if(i!==null)Qe=i,Ye=n;else{if(n===null)throw Error(t(310));Ye=n,n={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},Qe===null?Ge.memoizedState=Qe=n:Qe=Qe.next=n}return Qe}function yi(n,i){return typeof i=="function"?i(n):i}function ba(n){var i=kt(),u=i.queue;if(u===null)throw Error(t(311));u.lastRenderedReducer=n;var d=Ye,m=d.baseQueue,y=u.pending;if(y!==null){if(m!==null){var A=m.next;m.next=y.next,y.next=A}d.baseQueue=m=y,u.pending=null}if(m!==null){y=m.next,d=d.baseState;var I=A=null,w=null,B=y;do{var X=B.lane;if((Wn&X)===X)w!==null&&(w=w.next={lane:0,action:B.action,hasEagerState:B.hasEagerState,eagerState:B.eagerState,next:null}),d=B.hasEagerState?B.eagerState:n(d,B.action);else{var J={lane:X,action:B.action,hasEagerState:B.hasEagerState,eagerState:B.eagerState,next:null};w===null?(I=w=J,A=d):w=w.next=J,Ge.lanes|=X,jn|=X}B=B.next}while(B!==null&&B!==y);w===null?A=d:w.next=I,Ut(d,i.memoizedState)||(pt=!0),i.memoizedState=d,i.baseState=A,i.baseQueue=w,u.lastRenderedState=d}if(n=u.interleaved,n!==null){m=n;do y=m.lane,Ge.lanes|=y,jn|=y,m=m.next;while(m!==n)}else m===null&&(u.lanes=0);return[i.memoizedState,u.dispatch]}function Oa(n){var i=kt(),u=i.queue;if(u===null)throw Error(t(311));u.lastRenderedReducer=n;var d=u.dispatch,m=u.pending,y=i.memoizedState;if(m!==null){u.pending=null;var A=m=m.next;do y=n(y,A.action),A=A.next;while(A!==m);Ut(y,i.memoizedState)||(pt=!0),i.memoizedState=y,i.baseQueue===null&&(i.baseState=y),u.lastRenderedState=y}return[y,d]}function sf(){}function of(n,i){var u=Ge,d=kt(),m=i(),y=!Ut(d.memoizedState,m);if(y&&(d.memoizedState=m,pt=!0),d=d.queue,Na(uf.bind(null,u,d,n),[n]),d.getSnapshot!==i||y||Qe!==null&&Qe.memoizedState.tag&1){if(u.flags|=2048,Ei(9,lf.bind(null,u,d,m,i),void 0,null),Je===null)throw Error(t(349));Wn&30||af(u,i,m)}return m}function af(n,i,u){n.flags|=16384,n={getSnapshot:i,value:u},i=Ge.updateQueue,i===null?(i={lastEffect:null,stores:null},Ge.updateQueue=i,i.stores=[n]):(u=i.stores,u===null?i.stores=[n]:u.push(n))}function lf(n,i,u,d){i.value=u,i.getSnapshot=d,cf(i)&&ff(n)}function uf(n,i,u){return u(function(){cf(i)&&ff(n)})}function cf(n){var i=n.getSnapshot;n=n.value;try{var u=i();return!Ut(n,u)}catch{return!0}}function ff(n){var i=cn(n,1);i!==null&&Vt(i,n,1,-1)}function df(n){var i=Xt();return typeof n=="function"&&(n=n()),i.memoizedState=i.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yi,lastRenderedState:n},i.queue=n,n=n.dispatch=ip.bind(null,Ge,n),[i.memoizedState,n]}function Ei(n,i,u,d){return n={tag:n,create:i,destroy:u,deps:d,next:null},i=Ge.updateQueue,i===null?(i={lastEffect:null,stores:null},Ge.updateQueue=i,i.lastEffect=n.next=n):(u=i.lastEffect,u===null?i.lastEffect=n.next=n:(d=u.next,u.next=n,n.next=d,i.lastEffect=n)),n}function hf(){return kt().memoizedState}function ys(n,i,u,d){var m=Xt();Ge.flags|=n,m.memoizedState=Ei(1|i,u,void 0,d===void 0?null:d)}function Es(n,i,u,d){var m=kt();d=d===void 0?null:d;var y=void 0;if(Ye!==null){var A=Ye.memoizedState;if(y=A.destroy,d!==null&&_a(d,A.deps)){m.memoizedState=Ei(i,u,y,d);return}}Ge.flags|=n,m.memoizedState=Ei(1|i,u,y,d)}function gf(n,i){return ys(8390656,8,n,i)}function Na(n,i){return Es(2048,8,n,i)}function mf(n,i){return Es(4,2,n,i)}function pf(n,i){return Es(4,4,n,i)}function yf(n,i){if(typeof i=="function")return n=n(),i(n),function(){i(null)};if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function Ef(n,i,u){return u=u!=null?u.concat([n]):null,Es(4,4,yf.bind(null,i,n),u)}function Ma(){}function xf(n,i){var u=kt();i=i===void 0?null:i;var d=u.memoizedState;return d!==null&&i!==null&&_a(i,d[1])?d[0]:(u.memoizedState=[n,i],n)}function Tf(n,i){var u=kt();i=i===void 0?null:i;var d=u.memoizedState;return d!==null&&i!==null&&_a(i,d[1])?d[0]:(n=n(),u.memoizedState=[n,i],n)}function Sf(n,i,u){return Wn&21?(Ut(u,i)||(u=Xu(),Ge.lanes|=u,jn|=u,n.baseState=!0),i):(n.baseState&&(n.baseState=!1,pt=!0),n.memoizedState=u)}function np(n,i){var u=Pe;Pe=u!==0&&4>u?u:4,n(!0);var d=ka.transition;ka.transition={};try{n(!1),i()}finally{Pe=u,ka.transition=d}}function vf(){return kt().memoizedState}function rp(n,i,u){var d=Fn(n);if(u={lane:d,action:u,hasEagerState:!1,eagerState:null,next:null},Lf(n))Af(i,u);else if(u=Zc(n,i,u,d),u!==null){var m=ht();Vt(u,n,d,m),Rf(u,i,d)}}function ip(n,i,u){var d=Fn(n),m={lane:d,action:u,hasEagerState:!1,eagerState:null,next:null};if(Lf(n))Af(i,m);else{var y=n.alternate;if(n.lanes===0&&(y===null||y.lanes===0)&&(y=i.lastRenderedReducer,y!==null))try{var A=i.lastRenderedState,I=y(A,u);if(m.hasEagerState=!0,m.eagerState=I,Ut(I,A)){var w=i.interleaved;w===null?(m.next=m,Aa(i)):(m.next=w.next,w.next=m),i.interleaved=m;return}}catch{}finally{}u=Zc(n,i,m,d),u!==null&&(m=ht(),Vt(u,n,d,m),Rf(u,i,d))}}function Lf(n){var i=n.alternate;return n===Ge||i!==null&&i===Ge}function Af(n,i){mi=ps=!0;var u=n.pending;u===null?i.next=i:(i.next=u.next,u.next=i),n.pending=i}function Rf(n,i,u){if(u&4194240){var d=i.lanes;d&=n.pendingLanes,u|=d,i.lanes=u,Bo(n,u)}}var xs={readContext:Dt,useCallback:lt,useContext:lt,useEffect:lt,useImperativeHandle:lt,useInsertionEffect:lt,useLayoutEffect:lt,useMemo:lt,useReducer:lt,useRef:lt,useState:lt,useDebugValue:lt,useDeferredValue:lt,useTransition:lt,useMutableSource:lt,useSyncExternalStore:lt,useId:lt,unstable_isNewReconciler:!1},sp={readContext:Dt,useCallback:function(n,i){return Xt().memoizedState=[n,i===void 0?null:i],n},useContext:Dt,useEffect:gf,useImperativeHandle:function(n,i,u){return u=u!=null?u.concat([n]):null,ys(4194308,4,yf.bind(null,i,n),u)},useLayoutEffect:function(n,i){return ys(4194308,4,n,i)},useInsertionEffect:function(n,i){return ys(4,2,n,i)},useMemo:function(n,i){var u=Xt();return i=i===void 0?null:i,n=n(),u.memoizedState=[n,i],n},useReducer:function(n,i,u){var d=Xt();return i=u!==void 0?u(i):i,d.memoizedState=d.baseState=i,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:i},d.queue=n,n=n.dispatch=rp.bind(null,Ge,n),[d.memoizedState,n]},useRef:function(n){var i=Xt();return n={current:n},i.memoizedState=n},useState:df,useDebugValue:Ma,useDeferredValue:function(n){return Xt().memoizedState=n},useTransition:function(){var n=df(!1),i=n[0];return n=np.bind(null,n[1]),Xt().memoizedState=n,[i,n]},useMutableSource:function(){},useSyncExternalStore:function(n,i,u){var d=Ge,m=Xt();if(Be){if(u===void 0)throw Error(t(407));u=u()}else{if(u=i(),Je===null)throw Error(t(349));Wn&30||af(d,i,u)}m.memoizedState=u;var y={value:u,getSnapshot:i};return m.queue=y,gf(uf.bind(null,d,y,n),[n]),d.flags|=2048,Ei(9,lf.bind(null,d,y,u,i),void 0,null),u},useId:function(){var n=Xt(),i=Je.identifierPrefix;if(Be){var u=un,d=ln;u=(d&~(1<<32-Mt(d)-1)).toString(32)+u,i=":"+i+"R"+u,u=pi++,0<u&&(i+="H"+u.toString(32)),i+=":"}else u=tp++,i=":"+i+"r"+u.toString(32)+":";return n.memoizedState=i},unstable_isNewReconciler:!1},op={readContext:Dt,useCallback:xf,useContext:Dt,useEffect:Na,useImperativeHandle:Ef,useInsertionEffect:mf,useLayoutEffect:pf,useMemo:Tf,useReducer:ba,useRef:hf,useState:function(){return ba(yi)},useDebugValue:Ma,useDeferredValue:function(n){var i=kt();return Sf(i,Ye.memoizedState,n)},useTransition:function(){var n=ba(yi)[0],i=kt().memoizedState;return[n,i]},useMutableSource:sf,useSyncExternalStore:of,useId:vf,unstable_isNewReconciler:!1},ap={readContext:Dt,useCallback:xf,useContext:Dt,useEffect:Na,useImperativeHandle:Ef,useInsertionEffect:mf,useLayoutEffect:pf,useMemo:Tf,useReducer:Oa,useRef:hf,useState:function(){return Oa(yi)},useDebugValue:Ma,useDeferredValue:function(n){var i=kt();return Ye===null?i.memoizedState=n:Sf(i,Ye.memoizedState,n)},useTransition:function(){var n=Oa(yi)[0],i=kt().memoizedState;return[n,i]},useMutableSource:sf,useSyncExternalStore:of,useId:vf,unstable_isNewReconciler:!1};function $t(n,i){if(n&&n.defaultProps){i=K({},i),n=n.defaultProps;for(var u in n)i[u]===void 0&&(i[u]=n[u]);return i}return i}function Ua(n,i,u,d){i=n.memoizedState,u=u(d,i),u=u==null?i:K({},i,u),n.memoizedState=u,n.lanes===0&&(n.updateQueue.baseState=u)}var Ts={isMounted:function(n){return(n=n._reactInternals)?Bn(n)===n:!1},enqueueSetState:function(n,i,u){n=n._reactInternals;var d=ht(),m=Fn(n),y=fn(d,m);y.payload=i,u!=null&&(y.callback=u),i=Dn(n,y,m),i!==null&&(Vt(i,n,m,d),ds(i,n,m))},enqueueReplaceState:function(n,i,u){n=n._reactInternals;var d=ht(),m=Fn(n),y=fn(d,m);y.tag=1,y.payload=i,u!=null&&(y.callback=u),i=Dn(n,y,m),i!==null&&(Vt(i,n,m,d),ds(i,n,m))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var u=ht(),d=Fn(n),m=fn(u,d);m.tag=2,i!=null&&(m.callback=i),i=Dn(n,m,d),i!==null&&(Vt(i,n,d,u),ds(i,n,d))}};function If(n,i,u,d,m,y,A){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,y,A):i.prototype&&i.prototype.isPureReactComponent?!ii(u,d)||!ii(m,y):!0}function Cf(n,i,u){var d=!1,m=In,y=i.contextType;return typeof y=="object"&&y!==null?y=Dt(y):(m=mt(i)?Gn:at.current,d=i.contextTypes,y=(d=d!=null)?mr(n,m):In),i=new i(u,y),n.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ts,n.stateNode=i,i._reactInternals=n,d&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=m,n.__reactInternalMemoizedMaskedChildContext=y),i}function wf(n,i,u,d){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(u,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(u,d),i.state!==n&&Ts.enqueueReplaceState(i,i.state,null)}function Ba(n,i,u,d){var m=n.stateNode;m.props=u,m.state=n.memoizedState,m.refs={},Ra(n);var y=i.contextType;typeof y=="object"&&y!==null?m.context=Dt(y):(y=mt(i)?Gn:at.current,m.context=mr(n,y)),m.state=n.memoizedState,y=i.getDerivedStateFromProps,typeof y=="function"&&(Ua(n,i,y,u),m.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(i=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),i!==m.state&&Ts.enqueueReplaceState(m,m.state,null),hs(n,u,m,d),m.state=n.memoizedState),typeof m.componentDidMount=="function"&&(n.flags|=4194308)}function Lr(n,i){try{var u="",d=i;do u+=xe(d),d=d.return;while(d);var m=u}catch(y){m=`
Error generating stack: `+y.message+`
`+y.stack}return{value:n,source:i,stack:m,digest:null}}function $a(n,i,u){return{value:n,source:null,stack:u??null,digest:i??null}}function Ga(n,i){try{console.error(i.value)}catch(u){setTimeout(function(){throw u})}}var lp=typeof WeakMap=="function"?WeakMap:Map;function Df(n,i,u){u=fn(-1,u),u.tag=3,u.payload={element:null};var d=i.value;return u.callback=function(){Cs||(Cs=!0,nl=d),Ga(n,i)},u}function kf(n,i,u){u=fn(-1,u),u.tag=3;var d=n.type.getDerivedStateFromError;if(typeof d=="function"){var m=i.value;u.payload=function(){return d(m)},u.callback=function(){Ga(n,i)}}var y=n.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(u.callback=function(){Ga(n,i),typeof d!="function"&&(_n===null?_n=new Set([this]):_n.add(this));var A=i.stack;this.componentDidCatch(i.value,{componentStack:A!==null?A:""})}),u}function _f(n,i,u){var d=n.pingCache;if(d===null){d=n.pingCache=new lp;var m=new Set;d.set(i,m)}else m=d.get(i),m===void 0&&(m=new Set,d.set(i,m));m.has(u)||(m.add(u),n=vp.bind(null,n,i,u),i.then(n,n))}function Pf(n){do{var i;if((i=n.tag===13)&&(i=n.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return n;n=n.return}while(n!==null);return null}function Ff(n,i,u,d,m){return n.mode&1?(n.flags|=65536,n.lanes=m,n):(n===i?n.flags|=65536:(n.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(i=fn(-1,1),i.tag=2,Dn(u,i,1))),u.lanes|=1),n)}var up=M.ReactCurrentOwner,pt=!1;function dt(n,i,u,d){i.child=n===null?Jc(i,null,u,d):xr(i,n.child,u,d)}function bf(n,i,u,d,m){u=u.render;var y=i.ref;return Sr(i,m),d=Pa(n,i,u,d,y,m),u=Fa(),n!==null&&!pt?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~m,dn(n,i,m)):(Be&&u&&ma(i),i.flags|=1,dt(n,i,d,m),i.child)}function Of(n,i,u,d,m){if(n===null){var y=u.type;return typeof y=="function"&&!ul(y)&&y.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(i.tag=15,i.type=y,Nf(n,i,y,d,m)):(n=Fs(u.type,null,d,i,i.mode,m),n.ref=i.ref,n.return=i,i.child=n)}if(y=n.child,!(n.lanes&m)){var A=y.memoizedProps;if(u=u.compare,u=u!==null?u:ii,u(A,d)&&n.ref===i.ref)return dn(n,i,m)}return i.flags|=1,n=On(y,d),n.ref=i.ref,n.return=i,i.child=n}function Nf(n,i,u,d,m){if(n!==null){var y=n.memoizedProps;if(ii(y,d)&&n.ref===i.ref)if(pt=!1,i.pendingProps=d=y,(n.lanes&m)!==0)n.flags&131072&&(pt=!0);else return i.lanes=n.lanes,dn(n,i,m)}return Ka(n,i,u,d,m)}function Mf(n,i,u){var d=i.pendingProps,m=d.children,y=n!==null?n.memoizedState:null;if(d.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},Oe(Rr,It),It|=u;else{if(!(u&1073741824))return n=y!==null?y.baseLanes|u:u,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:n,cachePool:null,transitions:null},i.updateQueue=null,Oe(Rr,It),It|=n,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=y!==null?y.baseLanes:u,Oe(Rr,It),It|=d}else y!==null?(d=y.baseLanes|u,i.memoizedState=null):d=u,Oe(Rr,It),It|=d;return dt(n,i,m,u),i.child}function Uf(n,i){var u=i.ref;(n===null&&u!==null||n!==null&&n.ref!==u)&&(i.flags|=512,i.flags|=2097152)}function Ka(n,i,u,d,m){var y=mt(u)?Gn:at.current;return y=mr(i,y),Sr(i,m),u=Pa(n,i,u,d,y,m),d=Fa(),n!==null&&!pt?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~m,dn(n,i,m)):(Be&&d&&ma(i),i.flags|=1,dt(n,i,u,m),i.child)}function Bf(n,i,u,d,m){if(mt(u)){var y=!0;is(i)}else y=!1;if(Sr(i,m),i.stateNode===null)vs(n,i),Cf(i,u,d),Ba(i,u,d,m),d=!0;else if(n===null){var A=i.stateNode,I=i.memoizedProps;A.props=I;var w=A.context,B=u.contextType;typeof B=="object"&&B!==null?B=Dt(B):(B=mt(u)?Gn:at.current,B=mr(i,B));var X=u.getDerivedStateFromProps,J=typeof X=="function"||typeof A.getSnapshotBeforeUpdate=="function";J||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(I!==d||w!==B)&&wf(i,A,d,B),wn=!1;var Y=i.memoizedState;A.state=Y,hs(i,d,A,m),w=i.memoizedState,I!==d||Y!==w||gt.current||wn?(typeof X=="function"&&(Ua(i,u,X,d),w=i.memoizedState),(I=wn||If(i,u,I,d,Y,w,B))?(J||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount()),typeof A.componentDidMount=="function"&&(i.flags|=4194308)):(typeof A.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=w),A.props=d,A.state=w,A.context=B,d=I):(typeof A.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{A=i.stateNode,ef(n,i),I=i.memoizedProps,B=i.type===i.elementType?I:$t(i.type,I),A.props=B,J=i.pendingProps,Y=A.context,w=u.contextType,typeof w=="object"&&w!==null?w=Dt(w):(w=mt(u)?Gn:at.current,w=mr(i,w));var ne=u.getDerivedStateFromProps;(X=typeof ne=="function"||typeof A.getSnapshotBeforeUpdate=="function")||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(I!==J||Y!==w)&&wf(i,A,d,w),wn=!1,Y=i.memoizedState,A.state=Y,hs(i,d,A,m);var ae=i.memoizedState;I!==J||Y!==ae||gt.current||wn?(typeof ne=="function"&&(Ua(i,u,ne,d),ae=i.memoizedState),(B=wn||If(i,u,B,d,Y,ae,w)||!1)?(X||typeof A.UNSAFE_componentWillUpdate!="function"&&typeof A.componentWillUpdate!="function"||(typeof A.componentWillUpdate=="function"&&A.componentWillUpdate(d,ae,w),typeof A.UNSAFE_componentWillUpdate=="function"&&A.UNSAFE_componentWillUpdate(d,ae,w)),typeof A.componentDidUpdate=="function"&&(i.flags|=4),typeof A.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof A.componentDidUpdate!="function"||I===n.memoizedProps&&Y===n.memoizedState||(i.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||I===n.memoizedProps&&Y===n.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=ae),A.props=d,A.state=ae,A.context=w,d=B):(typeof A.componentDidUpdate!="function"||I===n.memoizedProps&&Y===n.memoizedState||(i.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||I===n.memoizedProps&&Y===n.memoizedState||(i.flags|=1024),d=!1)}return Va(n,i,u,d,y,m)}function Va(n,i,u,d,m,y){Uf(n,i);var A=(i.flags&128)!==0;if(!d&&!A)return m&&Vc(i,u,!1),dn(n,i,y);d=i.stateNode,up.current=i;var I=A&&typeof u.getDerivedStateFromError!="function"?null:d.render();return i.flags|=1,n!==null&&A?(i.child=xr(i,n.child,null,y),i.child=xr(i,null,I,y)):dt(n,i,I,y),i.memoizedState=d.state,m&&Vc(i,u,!0),i.child}function $f(n){var i=n.stateNode;i.pendingContext?Gc(n,i.pendingContext,i.pendingContext!==i.context):i.context&&Gc(n,i.context,!1),Ia(n,i.containerInfo)}function Gf(n,i,u,d,m){return Er(),xa(m),i.flags|=256,dt(n,i,u,d),i.child}var Ha={dehydrated:null,treeContext:null,retryLane:0};function za(n){return{baseLanes:n,cachePool:null,transitions:null}}function Kf(n,i,u){var d=i.pendingProps,m=$e.current,y=!1,A=(i.flags&128)!==0,I;if((I=A)||(I=n!==null&&n.memoizedState===null?!1:(m&2)!==0),I?(y=!0,i.flags&=-129):(n===null||n.memoizedState!==null)&&(m|=1),Oe($e,m&1),n===null)return Ea(i),n=i.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(i.mode&1?n.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(A=d.children,n=d.fallback,y?(d=i.mode,y=i.child,A={mode:"hidden",children:A},!(d&1)&&y!==null?(y.childLanes=0,y.pendingProps=A):y=bs(A,d,0,null),n=Qn(n,d,u,null),y.return=i,n.return=i,y.sibling=n,i.child=y,i.child.memoizedState=za(u),i.memoizedState=Ha,n):Wa(i,A));if(m=n.memoizedState,m!==null&&(I=m.dehydrated,I!==null))return cp(n,i,A,d,I,m,u);if(y){y=d.fallback,A=i.mode,m=n.child,I=m.sibling;var w={mode:"hidden",children:d.children};return!(A&1)&&i.child!==m?(d=i.child,d.childLanes=0,d.pendingProps=w,i.deletions=null):(d=On(m,w),d.subtreeFlags=m.subtreeFlags&14680064),I!==null?y=On(I,y):(y=Qn(y,A,u,null),y.flags|=2),y.return=i,d.return=i,d.sibling=y,i.child=d,d=y,y=i.child,A=n.child.memoizedState,A=A===null?za(u):{baseLanes:A.baseLanes|u,cachePool:null,transitions:A.transitions},y.memoizedState=A,y.childLanes=n.childLanes&~u,i.memoizedState=Ha,d}return y=n.child,n=y.sibling,d=On(y,{mode:"visible",children:d.children}),!(i.mode&1)&&(d.lanes=u),d.return=i,d.sibling=null,n!==null&&(u=i.deletions,u===null?(i.deletions=[n],i.flags|=16):u.push(n)),i.child=d,i.memoizedState=null,d}function Wa(n,i){return i=bs({mode:"visible",children:i},n.mode,0,null),i.return=n,n.child=i}function Ss(n,i,u,d){return d!==null&&xa(d),xr(i,n.child,null,u),n=Wa(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function cp(n,i,u,d,m,y,A){if(u)return i.flags&256?(i.flags&=-257,d=$a(Error(t(422))),Ss(n,i,A,d)):i.memoizedState!==null?(i.child=n.child,i.flags|=128,null):(y=d.fallback,m=i.mode,d=bs({mode:"visible",children:d.children},m,0,null),y=Qn(y,m,A,null),y.flags|=2,d.return=i,y.return=i,d.sibling=y,i.child=d,i.mode&1&&xr(i,n.child,null,A),i.child.memoizedState=za(A),i.memoizedState=Ha,y);if(!(i.mode&1))return Ss(n,i,A,null);if(m.data==="$!"){if(d=m.nextSibling&&m.nextSibling.dataset,d)var I=d.dgst;return d=I,y=Error(t(419)),d=$a(y,d,void 0),Ss(n,i,A,d)}if(I=(A&n.childLanes)!==0,pt||I){if(d=Je,d!==null){switch(A&-A){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(d.suspendedLanes|A)?0:m,m!==0&&m!==y.retryLane&&(y.retryLane=m,cn(n,m),Vt(d,n,m,-1))}return ll(),d=$a(Error(t(421))),Ss(n,i,A,d)}return m.data==="$?"?(i.flags|=128,i.child=n.child,i=Lp.bind(null,n),m._reactRetry=i,null):(n=y.treeContext,Rt=An(m.nextSibling),At=i,Be=!0,Bt=null,n!==null&&(Ct[wt++]=ln,Ct[wt++]=un,Ct[wt++]=Kn,ln=n.id,un=n.overflow,Kn=i),i=Wa(i,d.children),i.flags|=4096,i)}function Vf(n,i,u){n.lanes|=i;var d=n.alternate;d!==null&&(d.lanes|=i),La(n.return,i,u)}function ja(n,i,u,d,m){var y=n.memoizedState;y===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:u,tailMode:m}:(y.isBackwards=i,y.rendering=null,y.renderingStartTime=0,y.last=d,y.tail=u,y.tailMode=m)}function Hf(n,i,u){var d=i.pendingProps,m=d.revealOrder,y=d.tail;if(dt(n,i,d.children,u),d=$e.current,d&2)d=d&1|2,i.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Vf(n,u,i);else if(n.tag===19)Vf(n,u,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}d&=1}if(Oe($e,d),!(i.mode&1))i.memoizedState=null;else switch(m){case"forwards":for(u=i.child,m=null;u!==null;)n=u.alternate,n!==null&&gs(n)===null&&(m=u),u=u.sibling;u=m,u===null?(m=i.child,i.child=null):(m=u.sibling,u.sibling=null),ja(i,!1,m,u,y);break;case"backwards":for(u=null,m=i.child,i.child=null;m!==null;){if(n=m.alternate,n!==null&&gs(n)===null){i.child=m;break}n=m.sibling,m.sibling=u,u=m,m=n}ja(i,!0,u,null,y);break;case"together":ja(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function vs(n,i){!(i.mode&1)&&n!==null&&(n.alternate=null,i.alternate=null,i.flags|=2)}function dn(n,i,u){if(n!==null&&(i.dependencies=n.dependencies),jn|=i.lanes,!(u&i.childLanes))return null;if(n!==null&&i.child!==n.child)throw Error(t(153));if(i.child!==null){for(n=i.child,u=On(n,n.pendingProps),i.child=u,u.return=i;n.sibling!==null;)n=n.sibling,u=u.sibling=On(n,n.pendingProps),u.return=i;u.sibling=null}return i.child}function fp(n,i,u){switch(i.tag){case 3:$f(i),Er();break;case 5:rf(i);break;case 1:mt(i.type)&&is(i);break;case 4:Ia(i,i.stateNode.containerInfo);break;case 10:var d=i.type._context,m=i.memoizedProps.value;Oe(cs,d._currentValue),d._currentValue=m;break;case 13:if(d=i.memoizedState,d!==null)return d.dehydrated!==null?(Oe($e,$e.current&1),i.flags|=128,null):u&i.child.childLanes?Kf(n,i,u):(Oe($e,$e.current&1),n=dn(n,i,u),n!==null?n.sibling:null);Oe($e,$e.current&1);break;case 19:if(d=(u&i.childLanes)!==0,n.flags&128){if(d)return Hf(n,i,u);i.flags|=128}if(m=i.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),Oe($e,$e.current),d)break;return null;case 22:case 23:return i.lanes=0,Mf(n,i,u)}return dn(n,i,u)}var zf,Ya,Wf,jf;zf=function(n,i){for(var u=i.child;u!==null;){if(u.tag===5||u.tag===6)n.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===i)break;for(;u.sibling===null;){if(u.return===null||u.return===i)return;u=u.return}u.sibling.return=u.return,u=u.sibling}},Ya=function(){},Wf=function(n,i,u,d){var m=n.memoizedProps;if(m!==d){n=i.stateNode,zn(qt.current);var y=null;switch(u){case"input":m=Lo(n,m),d=Lo(n,d),y=[];break;case"select":m=K({},m,{value:void 0}),d=K({},d,{value:void 0}),y=[];break;case"textarea":m=Io(n,m),d=Io(n,d),y=[];break;default:typeof m.onClick!="function"&&typeof d.onClick=="function"&&(n.onclick=ts)}wo(u,d);var A;u=null;for(B in m)if(!d.hasOwnProperty(B)&&m.hasOwnProperty(B)&&m[B]!=null)if(B==="style"){var I=m[B];for(A in I)I.hasOwnProperty(A)&&(u||(u={}),u[A]="")}else B!=="dangerouslySetInnerHTML"&&B!=="children"&&B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(s.hasOwnProperty(B)?y||(y=[]):(y=y||[]).push(B,null));for(B in d){var w=d[B];if(I=m!=null?m[B]:void 0,d.hasOwnProperty(B)&&w!==I&&(w!=null||I!=null))if(B==="style")if(I){for(A in I)!I.hasOwnProperty(A)||w&&w.hasOwnProperty(A)||(u||(u={}),u[A]="");for(A in w)w.hasOwnProperty(A)&&I[A]!==w[A]&&(u||(u={}),u[A]=w[A])}else u||(y||(y=[]),y.push(B,u)),u=w;else B==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,I=I?I.__html:void 0,w!=null&&I!==w&&(y=y||[]).push(B,w)):B==="children"?typeof w!="string"&&typeof w!="number"||(y=y||[]).push(B,""+w):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&(s.hasOwnProperty(B)?(w!=null&&B==="onScroll"&&Me("scroll",n),y||I===w||(y=[])):(y=y||[]).push(B,w))}u&&(y=y||[]).push("style",u);var B=y;(i.updateQueue=B)&&(i.flags|=4)}},jf=function(n,i,u,d){u!==d&&(i.flags|=4)};function xi(n,i){if(!Be)switch(n.tailMode){case"hidden":i=n.tail;for(var u=null;i!==null;)i.alternate!==null&&(u=i),i=i.sibling;u===null?n.tail=null:u.sibling=null;break;case"collapsed":u=n.tail;for(var d=null;u!==null;)u.alternate!==null&&(d=u),u=u.sibling;d===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function ut(n){var i=n.alternate!==null&&n.alternate.child===n.child,u=0,d=0;if(i)for(var m=n.child;m!==null;)u|=m.lanes|m.childLanes,d|=m.subtreeFlags&14680064,d|=m.flags&14680064,m.return=n,m=m.sibling;else for(m=n.child;m!==null;)u|=m.lanes|m.childLanes,d|=m.subtreeFlags,d|=m.flags,m.return=n,m=m.sibling;return n.subtreeFlags|=d,n.childLanes=u,i}function dp(n,i,u){var d=i.pendingProps;switch(pa(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ut(i),null;case 1:return mt(i.type)&&rs(),ut(i),null;case 3:return d=i.stateNode,vr(),Ue(gt),Ue(at),Da(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(n===null||n.child===null)&&(ls(i)?i.flags|=4:n===null||n.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Bt!==null&&(sl(Bt),Bt=null))),Ya(n,i),ut(i),null;case 5:Ca(i);var m=zn(gi.current);if(u=i.type,n!==null&&i.stateNode!=null)Wf(n,i,u,d,m),n.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!d){if(i.stateNode===null)throw Error(t(166));return ut(i),null}if(n=zn(qt.current),ls(i)){d=i.stateNode,u=i.type;var y=i.memoizedProps;switch(d[Yt]=i,d[ui]=y,n=(i.mode&1)!==0,u){case"dialog":Me("cancel",d),Me("close",d);break;case"iframe":case"object":case"embed":Me("load",d);break;case"video":case"audio":for(m=0;m<oi.length;m++)Me(oi[m],d);break;case"source":Me("error",d);break;case"img":case"image":case"link":Me("error",d),Me("load",d);break;case"details":Me("toggle",d);break;case"input":Iu(d,y),Me("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!y.multiple},Me("invalid",d);break;case"textarea":Du(d,y),Me("invalid",d)}wo(u,y),m=null;for(var A in y)if(y.hasOwnProperty(A)){var I=y[A];A==="children"?typeof I=="string"?d.textContent!==I&&(y.suppressHydrationWarning!==!0&&es(d.textContent,I,n),m=["children",I]):typeof I=="number"&&d.textContent!==""+I&&(y.suppressHydrationWarning!==!0&&es(d.textContent,I,n),m=["children",""+I]):s.hasOwnProperty(A)&&I!=null&&A==="onScroll"&&Me("scroll",d)}switch(u){case"input":_i(d),wu(d,y,!0);break;case"textarea":_i(d),_u(d);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(d.onclick=ts)}d=m,i.updateQueue=d,d!==null&&(i.flags|=4)}else{A=m.nodeType===9?m:m.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Pu(u)),n==="http://www.w3.org/1999/xhtml"?u==="script"?(n=A.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof d.is=="string"?n=A.createElement(u,{is:d.is}):(n=A.createElement(u),u==="select"&&(A=n,d.multiple?A.multiple=!0:d.size&&(A.size=d.size))):n=A.createElementNS(n,u),n[Yt]=i,n[ui]=d,zf(n,i,!1,!1),i.stateNode=n;e:{switch(A=Do(u,d),u){case"dialog":Me("cancel",n),Me("close",n),m=d;break;case"iframe":case"object":case"embed":Me("load",n),m=d;break;case"video":case"audio":for(m=0;m<oi.length;m++)Me(oi[m],n);m=d;break;case"source":Me("error",n),m=d;break;case"img":case"image":case"link":Me("error",n),Me("load",n),m=d;break;case"details":Me("toggle",n),m=d;break;case"input":Iu(n,d),m=Lo(n,d),Me("invalid",n);break;case"option":m=d;break;case"select":n._wrapperState={wasMultiple:!!d.multiple},m=K({},d,{value:void 0}),Me("invalid",n);break;case"textarea":Du(n,d),m=Io(n,d),Me("invalid",n);break;default:m=d}wo(u,m),I=m;for(y in I)if(I.hasOwnProperty(y)){var w=I[y];y==="style"?Ou(n,w):y==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&Fu(n,w)):y==="children"?typeof w=="string"?(u!=="textarea"||w!=="")&&Gr(n,w):typeof w=="number"&&Gr(n,""+w):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?w!=null&&y==="onScroll"&&Me("scroll",n):w!=null&&C(n,y,w,A))}switch(u){case"input":_i(n),wu(n,d,!1);break;case"textarea":_i(n),_u(n);break;case"option":d.value!=null&&n.setAttribute("value",""+Ce(d.value));break;case"select":n.multiple=!!d.multiple,y=d.value,y!=null?rr(n,!!d.multiple,y,!1):d.defaultValue!=null&&rr(n,!!d.multiple,d.defaultValue,!0);break;default:typeof m.onClick=="function"&&(n.onclick=ts)}switch(u){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return ut(i),null;case 6:if(n&&i.stateNode!=null)jf(n,i,n.memoizedProps,d);else{if(typeof d!="string"&&i.stateNode===null)throw Error(t(166));if(u=zn(gi.current),zn(qt.current),ls(i)){if(d=i.stateNode,u=i.memoizedProps,d[Yt]=i,(y=d.nodeValue!==u)&&(n=At,n!==null))switch(n.tag){case 3:es(d.nodeValue,u,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&es(d.nodeValue,u,(n.mode&1)!==0)}y&&(i.flags|=4)}else d=(u.nodeType===9?u:u.ownerDocument).createTextNode(d),d[Yt]=i,i.stateNode=d}return ut(i),null;case 13:if(Ue($e),d=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Be&&Rt!==null&&i.mode&1&&!(i.flags&128))qc(),Er(),i.flags|=98560,y=!1;else if(y=ls(i),d!==null&&d.dehydrated!==null){if(n===null){if(!y)throw Error(t(318));if(y=i.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(t(317));y[Yt]=i}else Er(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;ut(i),y=!1}else Bt!==null&&(sl(Bt),Bt=null),y=!0;if(!y)return i.flags&65536?i:null}return i.flags&128?(i.lanes=u,i):(d=d!==null,d!==(n!==null&&n.memoizedState!==null)&&d&&(i.child.flags|=8192,i.mode&1&&(n===null||$e.current&1?qe===0&&(qe=3):ll())),i.updateQueue!==null&&(i.flags|=4),ut(i),null);case 4:return vr(),Ya(n,i),n===null&&ai(i.stateNode.containerInfo),ut(i),null;case 10:return va(i.type._context),ut(i),null;case 17:return mt(i.type)&&rs(),ut(i),null;case 19:if(Ue($e),y=i.memoizedState,y===null)return ut(i),null;if(d=(i.flags&128)!==0,A=y.rendering,A===null)if(d)xi(y,!1);else{if(qe!==0||n!==null&&n.flags&128)for(n=i.child;n!==null;){if(A=gs(n),A!==null){for(i.flags|=128,xi(y,!1),d=A.updateQueue,d!==null&&(i.updateQueue=d,i.flags|=4),i.subtreeFlags=0,d=u,u=i.child;u!==null;)y=u,n=d,y.flags&=14680066,A=y.alternate,A===null?(y.childLanes=0,y.lanes=n,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=A.childLanes,y.lanes=A.lanes,y.child=A.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=A.memoizedProps,y.memoizedState=A.memoizedState,y.updateQueue=A.updateQueue,y.type=A.type,n=A.dependencies,y.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),u=u.sibling;return Oe($e,$e.current&1|2),i.child}n=n.sibling}y.tail!==null&&He()>Ir&&(i.flags|=128,d=!0,xi(y,!1),i.lanes=4194304)}else{if(!d)if(n=gs(A),n!==null){if(i.flags|=128,d=!0,u=n.updateQueue,u!==null&&(i.updateQueue=u,i.flags|=4),xi(y,!0),y.tail===null&&y.tailMode==="hidden"&&!A.alternate&&!Be)return ut(i),null}else 2*He()-y.renderingStartTime>Ir&&u!==1073741824&&(i.flags|=128,d=!0,xi(y,!1),i.lanes=4194304);y.isBackwards?(A.sibling=i.child,i.child=A):(u=y.last,u!==null?u.sibling=A:i.child=A,y.last=A)}return y.tail!==null?(i=y.tail,y.rendering=i,y.tail=i.sibling,y.renderingStartTime=He(),i.sibling=null,u=$e.current,Oe($e,d?u&1|2:u&1),i):(ut(i),null);case 22:case 23:return al(),d=i.memoizedState!==null,n!==null&&n.memoizedState!==null!==d&&(i.flags|=8192),d&&i.mode&1?It&1073741824&&(ut(i),i.subtreeFlags&6&&(i.flags|=8192)):ut(i),null;case 24:return null;case 25:return null}throw Error(t(156,i.tag))}function hp(n,i){switch(pa(i),i.tag){case 1:return mt(i.type)&&rs(),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return vr(),Ue(gt),Ue(at),Da(),n=i.flags,n&65536&&!(n&128)?(i.flags=n&-65537|128,i):null;case 5:return Ca(i),null;case 13:if(Ue($e),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(t(340));Er()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return Ue($e),null;case 4:return vr(),null;case 10:return va(i.type._context),null;case 22:case 23:return al(),null;case 24:return null;default:return null}}var Ls=!1,ct=!1,gp=typeof WeakSet=="function"?WeakSet:Set,ie=null;function Ar(n,i){var u=n.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(d){Ve(n,i,d)}else u.current=null}function qa(n,i,u){try{u()}catch(d){Ve(n,i,d)}}var Yf=!1;function mp(n,i){if(aa=Vi,n=Rc(),Zo(n)){if("selectionStart"in n)var u={start:n.selectionStart,end:n.selectionEnd};else e:{u=(u=n.ownerDocument)&&u.defaultView||window;var d=u.getSelection&&u.getSelection();if(d&&d.rangeCount!==0){u=d.anchorNode;var m=d.anchorOffset,y=d.focusNode;d=d.focusOffset;try{u.nodeType,y.nodeType}catch{u=null;break e}var A=0,I=-1,w=-1,B=0,X=0,J=n,Y=null;t:for(;;){for(var ne;J!==u||m!==0&&J.nodeType!==3||(I=A+m),J!==y||d!==0&&J.nodeType!==3||(w=A+d),J.nodeType===3&&(A+=J.nodeValue.length),(ne=J.firstChild)!==null;)Y=J,J=ne;for(;;){if(J===n)break t;if(Y===u&&++B===m&&(I=A),Y===y&&++X===d&&(w=A),(ne=J.nextSibling)!==null)break;J=Y,Y=J.parentNode}J=ne}u=I===-1||w===-1?null:{start:I,end:w}}else u=null}u=u||{start:0,end:0}}else u=null;for(la={focusedElem:n,selectionRange:u},Vi=!1,ie=i;ie!==null;)if(i=ie,n=i.child,(i.subtreeFlags&1028)!==0&&n!==null)n.return=i,ie=n;else for(;ie!==null;){i=ie;try{var ae=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(ae!==null){var le=ae.memoizedProps,ze=ae.memoizedState,b=i.stateNode,P=b.getSnapshotBeforeUpdate(i.elementType===i.type?le:$t(i.type,le),ze);b.__reactInternalSnapshotBeforeUpdate=P}break;case 3:var N=i.stateNode.containerInfo;N.nodeType===1?N.textContent="":N.nodeType===9&&N.documentElement&&N.removeChild(N.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Z){Ve(i,i.return,Z)}if(n=i.sibling,n!==null){n.return=i.return,ie=n;break}ie=i.return}return ae=Yf,Yf=!1,ae}function Ti(n,i,u){var d=i.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var m=d=d.next;do{if((m.tag&n)===n){var y=m.destroy;m.destroy=void 0,y!==void 0&&qa(i,u,y)}m=m.next}while(m!==d)}}function As(n,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var u=i=i.next;do{if((u.tag&n)===n){var d=u.create;u.destroy=d()}u=u.next}while(u!==i)}}function Xa(n){var i=n.ref;if(i!==null){var u=n.stateNode;switch(n.tag){case 5:n=u;break;default:n=u}typeof i=="function"?i(n):i.current=n}}function qf(n){var i=n.alternate;i!==null&&(n.alternate=null,qf(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&(delete i[Yt],delete i[ui],delete i[da],delete i[Qm],delete i[Jm])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Xf(n){return n.tag===5||n.tag===3||n.tag===4}function Qf(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Xf(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Qa(n,i,u){var d=n.tag;if(d===5||d===6)n=n.stateNode,i?u.nodeType===8?u.parentNode.insertBefore(n,i):u.insertBefore(n,i):(u.nodeType===8?(i=u.parentNode,i.insertBefore(n,u)):(i=u,i.appendChild(n)),u=u._reactRootContainer,u!=null||i.onclick!==null||(i.onclick=ts));else if(d!==4&&(n=n.child,n!==null))for(Qa(n,i,u),n=n.sibling;n!==null;)Qa(n,i,u),n=n.sibling}function Ja(n,i,u){var d=n.tag;if(d===5||d===6)n=n.stateNode,i?u.insertBefore(n,i):u.appendChild(n);else if(d!==4&&(n=n.child,n!==null))for(Ja(n,i,u),n=n.sibling;n!==null;)Ja(n,i,u),n=n.sibling}var it=null,Gt=!1;function kn(n,i,u){for(u=u.child;u!==null;)Jf(n,i,u),u=u.sibling}function Jf(n,i,u){if(jt&&typeof jt.onCommitFiberUnmount=="function")try{jt.onCommitFiberUnmount(Mi,u)}catch{}switch(u.tag){case 5:ct||Ar(u,i);case 6:var d=it,m=Gt;it=null,kn(n,i,u),it=d,Gt=m,it!==null&&(Gt?(n=it,u=u.stateNode,n.nodeType===8?n.parentNode.removeChild(u):n.removeChild(u)):it.removeChild(u.stateNode));break;case 18:it!==null&&(Gt?(n=it,u=u.stateNode,n.nodeType===8?fa(n.parentNode,u):n.nodeType===1&&fa(n,u),Jr(n)):fa(it,u.stateNode));break;case 4:d=it,m=Gt,it=u.stateNode.containerInfo,Gt=!0,kn(n,i,u),it=d,Gt=m;break;case 0:case 11:case 14:case 15:if(!ct&&(d=u.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){m=d=d.next;do{var y=m,A=y.destroy;y=y.tag,A!==void 0&&(y&2||y&4)&&qa(u,i,A),m=m.next}while(m!==d)}kn(n,i,u);break;case 1:if(!ct&&(Ar(u,i),d=u.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=u.memoizedProps,d.state=u.memoizedState,d.componentWillUnmount()}catch(I){Ve(u,i,I)}kn(n,i,u);break;case 21:kn(n,i,u);break;case 22:u.mode&1?(ct=(d=ct)||u.memoizedState!==null,kn(n,i,u),ct=d):kn(n,i,u);break;default:kn(n,i,u)}}function Zf(n){var i=n.updateQueue;if(i!==null){n.updateQueue=null;var u=n.stateNode;u===null&&(u=n.stateNode=new gp),i.forEach(function(d){var m=Ap.bind(null,n,d);u.has(d)||(u.add(d),d.then(m,m))})}}function Kt(n,i){var u=i.deletions;if(u!==null)for(var d=0;d<u.length;d++){var m=u[d];try{var y=n,A=i,I=A;e:for(;I!==null;){switch(I.tag){case 5:it=I.stateNode,Gt=!1;break e;case 3:it=I.stateNode.containerInfo,Gt=!0;break e;case 4:it=I.stateNode.containerInfo,Gt=!0;break e}I=I.return}if(it===null)throw Error(t(160));Jf(y,A,m),it=null,Gt=!1;var w=m.alternate;w!==null&&(w.return=null),m.return=null}catch(B){Ve(m,i,B)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)ed(i,n),i=i.sibling}function ed(n,i){var u=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Kt(i,n),Qt(n),d&4){try{Ti(3,n,n.return),As(3,n)}catch(le){Ve(n,n.return,le)}try{Ti(5,n,n.return)}catch(le){Ve(n,n.return,le)}}break;case 1:Kt(i,n),Qt(n),d&512&&u!==null&&Ar(u,u.return);break;case 5:if(Kt(i,n),Qt(n),d&512&&u!==null&&Ar(u,u.return),n.flags&32){var m=n.stateNode;try{Gr(m,"")}catch(le){Ve(n,n.return,le)}}if(d&4&&(m=n.stateNode,m!=null)){var y=n.memoizedProps,A=u!==null?u.memoizedProps:y,I=n.type,w=n.updateQueue;if(n.updateQueue=null,w!==null)try{I==="input"&&y.type==="radio"&&y.name!=null&&Cu(m,y),Do(I,A);var B=Do(I,y);for(A=0;A<w.length;A+=2){var X=w[A],J=w[A+1];X==="style"?Ou(m,J):X==="dangerouslySetInnerHTML"?Fu(m,J):X==="children"?Gr(m,J):C(m,X,J,B)}switch(I){case"input":Ao(m,y);break;case"textarea":ku(m,y);break;case"select":var Y=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!y.multiple;var ne=y.value;ne!=null?rr(m,!!y.multiple,ne,!1):Y!==!!y.multiple&&(y.defaultValue!=null?rr(m,!!y.multiple,y.defaultValue,!0):rr(m,!!y.multiple,y.multiple?[]:"",!1))}m[ui]=y}catch(le){Ve(n,n.return,le)}}break;case 6:if(Kt(i,n),Qt(n),d&4){if(n.stateNode===null)throw Error(t(162));m=n.stateNode,y=n.memoizedProps;try{m.nodeValue=y}catch(le){Ve(n,n.return,le)}}break;case 3:if(Kt(i,n),Qt(n),d&4&&u!==null&&u.memoizedState.isDehydrated)try{Jr(i.containerInfo)}catch(le){Ve(n,n.return,le)}break;case 4:Kt(i,n),Qt(n);break;case 13:Kt(i,n),Qt(n),m=n.child,m.flags&8192&&(y=m.memoizedState!==null,m.stateNode.isHidden=y,!y||m.alternate!==null&&m.alternate.memoizedState!==null||(tl=He())),d&4&&Zf(n);break;case 22:if(X=u!==null&&u.memoizedState!==null,n.mode&1?(ct=(B=ct)||X,Kt(i,n),ct=B):Kt(i,n),Qt(n),d&8192){if(B=n.memoizedState!==null,(n.stateNode.isHidden=B)&&!X&&n.mode&1)for(ie=n,X=n.child;X!==null;){for(J=ie=X;ie!==null;){switch(Y=ie,ne=Y.child,Y.tag){case 0:case 11:case 14:case 15:Ti(4,Y,Y.return);break;case 1:Ar(Y,Y.return);var ae=Y.stateNode;if(typeof ae.componentWillUnmount=="function"){d=Y,u=Y.return;try{i=d,ae.props=i.memoizedProps,ae.state=i.memoizedState,ae.componentWillUnmount()}catch(le){Ve(d,u,le)}}break;case 5:Ar(Y,Y.return);break;case 22:if(Y.memoizedState!==null){rd(J);continue}}ne!==null?(ne.return=Y,ie=ne):rd(J)}X=X.sibling}e:for(X=null,J=n;;){if(J.tag===5){if(X===null){X=J;try{m=J.stateNode,B?(y=m.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(I=J.stateNode,w=J.memoizedProps.style,A=w!=null&&w.hasOwnProperty("display")?w.display:null,I.style.display=bu("display",A))}catch(le){Ve(n,n.return,le)}}}else if(J.tag===6){if(X===null)try{J.stateNode.nodeValue=B?"":J.memoizedProps}catch(le){Ve(n,n.return,le)}}else if((J.tag!==22&&J.tag!==23||J.memoizedState===null||J===n)&&J.child!==null){J.child.return=J,J=J.child;continue}if(J===n)break e;for(;J.sibling===null;){if(J.return===null||J.return===n)break e;X===J&&(X=null),J=J.return}X===J&&(X=null),J.sibling.return=J.return,J=J.sibling}}break;case 19:Kt(i,n),Qt(n),d&4&&Zf(n);break;case 21:break;default:Kt(i,n),Qt(n)}}function Qt(n){var i=n.flags;if(i&2){try{e:{for(var u=n.return;u!==null;){if(Xf(u)){var d=u;break e}u=u.return}throw Error(t(160))}switch(d.tag){case 5:var m=d.stateNode;d.flags&32&&(Gr(m,""),d.flags&=-33);var y=Qf(n);Ja(n,y,m);break;case 3:case 4:var A=d.stateNode.containerInfo,I=Qf(n);Qa(n,I,A);break;default:throw Error(t(161))}}catch(w){Ve(n,n.return,w)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function pp(n,i,u){ie=n,td(n)}function td(n,i,u){for(var d=(n.mode&1)!==0;ie!==null;){var m=ie,y=m.child;if(m.tag===22&&d){var A=m.memoizedState!==null||Ls;if(!A){var I=m.alternate,w=I!==null&&I.memoizedState!==null||ct;I=Ls;var B=ct;if(Ls=A,(ct=w)&&!B)for(ie=m;ie!==null;)A=ie,w=A.child,A.tag===22&&A.memoizedState!==null?id(m):w!==null?(w.return=A,ie=w):id(m);for(;y!==null;)ie=y,td(y),y=y.sibling;ie=m,Ls=I,ct=B}nd(n)}else m.subtreeFlags&8772&&y!==null?(y.return=m,ie=y):nd(n)}}function nd(n){for(;ie!==null;){var i=ie;if(i.flags&8772){var u=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:ct||As(5,i);break;case 1:var d=i.stateNode;if(i.flags&4&&!ct)if(u===null)d.componentDidMount();else{var m=i.elementType===i.type?u.memoizedProps:$t(i.type,u.memoizedProps);d.componentDidUpdate(m,u.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var y=i.updateQueue;y!==null&&nf(i,y,d);break;case 3:var A=i.updateQueue;if(A!==null){if(u=null,i.child!==null)switch(i.child.tag){case 5:u=i.child.stateNode;break;case 1:u=i.child.stateNode}nf(i,A,u)}break;case 5:var I=i.stateNode;if(u===null&&i.flags&4){u=I;var w=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&u.focus();break;case"img":w.src&&(u.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var B=i.alternate;if(B!==null){var X=B.memoizedState;if(X!==null){var J=X.dehydrated;J!==null&&Jr(J)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}ct||i.flags&512&&Xa(i)}catch(Y){Ve(i,i.return,Y)}}if(i===n){ie=null;break}if(u=i.sibling,u!==null){u.return=i.return,ie=u;break}ie=i.return}}function rd(n){for(;ie!==null;){var i=ie;if(i===n){ie=null;break}var u=i.sibling;if(u!==null){u.return=i.return,ie=u;break}ie=i.return}}function id(n){for(;ie!==null;){var i=ie;try{switch(i.tag){case 0:case 11:case 15:var u=i.return;try{As(4,i)}catch(w){Ve(i,u,w)}break;case 1:var d=i.stateNode;if(typeof d.componentDidMount=="function"){var m=i.return;try{d.componentDidMount()}catch(w){Ve(i,m,w)}}var y=i.return;try{Xa(i)}catch(w){Ve(i,y,w)}break;case 5:var A=i.return;try{Xa(i)}catch(w){Ve(i,A,w)}}}catch(w){Ve(i,i.return,w)}if(i===n){ie=null;break}var I=i.sibling;if(I!==null){I.return=i.return,ie=I;break}ie=i.return}}var yp=Math.ceil,Rs=M.ReactCurrentDispatcher,Za=M.ReactCurrentOwner,_t=M.ReactCurrentBatchConfig,De=0,Je=null,We=null,st=0,It=0,Rr=Rn(0),qe=0,Si=null,jn=0,Is=0,el=0,vi=null,yt=null,tl=0,Ir=1/0,hn=null,Cs=!1,nl=null,_n=null,ws=!1,Pn=null,Ds=0,Li=0,rl=null,ks=-1,_s=0;function ht(){return De&6?He():ks!==-1?ks:ks=He()}function Fn(n){return n.mode&1?De&2&&st!==0?st&-st:ep.transition!==null?(_s===0&&(_s=Xu()),_s):(n=Pe,n!==0||(n=window.event,n=n===void 0?16:sc(n.type)),n):1}function Vt(n,i,u,d){if(50<Li)throw Li=0,rl=null,Error(t(185));jr(n,u,d),(!(De&2)||n!==Je)&&(n===Je&&(!(De&2)&&(Is|=u),qe===4&&bn(n,st)),Et(n,d),u===1&&De===0&&!(i.mode&1)&&(Ir=He()+500,ss&&Cn()))}function Et(n,i){var u=n.callbackNode;em(n,i);var d=$i(n,n===Je?st:0);if(d===0)u!==null&&ju(u),n.callbackNode=null,n.callbackPriority=0;else if(i=d&-d,n.callbackPriority!==i){if(u!=null&&ju(u),i===1)n.tag===0?Zm(od.bind(null,n)):Hc(od.bind(null,n)),qm(function(){!(De&6)&&Cn()}),u=null;else{switch(Qu(d)){case 1:u=No;break;case 4:u=Yu;break;case 16:u=Ni;break;case 536870912:u=qu;break;default:u=Ni}u=gd(u,sd.bind(null,n))}n.callbackPriority=i,n.callbackNode=u}}function sd(n,i){if(ks=-1,_s=0,De&6)throw Error(t(327));var u=n.callbackNode;if(Cr()&&n.callbackNode!==u)return null;var d=$i(n,n===Je?st:0);if(d===0)return null;if(d&30||d&n.expiredLanes||i)i=Ps(n,d);else{i=d;var m=De;De|=2;var y=ld();(Je!==n||st!==i)&&(hn=null,Ir=He()+500,qn(n,i));do try{Tp();break}catch(I){ad(n,I)}while(!0);Sa(),Rs.current=y,De=m,We!==null?i=0:(Je=null,st=0,i=qe)}if(i!==0){if(i===2&&(m=Mo(n),m!==0&&(d=m,i=il(n,m))),i===1)throw u=Si,qn(n,0),bn(n,d),Et(n,He()),u;if(i===6)bn(n,d);else{if(m=n.current.alternate,!(d&30)&&!Ep(m)&&(i=Ps(n,d),i===2&&(y=Mo(n),y!==0&&(d=y,i=il(n,y))),i===1))throw u=Si,qn(n,0),bn(n,d),Et(n,He()),u;switch(n.finishedWork=m,n.finishedLanes=d,i){case 0:case 1:throw Error(t(345));case 2:Xn(n,yt,hn);break;case 3:if(bn(n,d),(d&130023424)===d&&(i=tl+500-He(),10<i)){if($i(n,0)!==0)break;if(m=n.suspendedLanes,(m&d)!==d){ht(),n.pingedLanes|=n.suspendedLanes&m;break}n.timeoutHandle=ca(Xn.bind(null,n,yt,hn),i);break}Xn(n,yt,hn);break;case 4:if(bn(n,d),(d&4194240)===d)break;for(i=n.eventTimes,m=-1;0<d;){var A=31-Mt(d);y=1<<A,A=i[A],A>m&&(m=A),d&=~y}if(d=m,d=He()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*yp(d/1960))-d,10<d){n.timeoutHandle=ca(Xn.bind(null,n,yt,hn),d);break}Xn(n,yt,hn);break;case 5:Xn(n,yt,hn);break;default:throw Error(t(329))}}}return Et(n,He()),n.callbackNode===u?sd.bind(null,n):null}function il(n,i){var u=vi;return n.current.memoizedState.isDehydrated&&(qn(n,i).flags|=256),n=Ps(n,i),n!==2&&(i=yt,yt=u,i!==null&&sl(i)),n}function sl(n){yt===null?yt=n:yt.push.apply(yt,n)}function Ep(n){for(var i=n;;){if(i.flags&16384){var u=i.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var d=0;d<u.length;d++){var m=u[d],y=m.getSnapshot;m=m.value;try{if(!Ut(y(),m))return!1}catch{return!1}}}if(u=i.child,i.subtreeFlags&16384&&u!==null)u.return=i,i=u;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function bn(n,i){for(i&=~el,i&=~Is,n.suspendedLanes|=i,n.pingedLanes&=~i,n=n.expirationTimes;0<i;){var u=31-Mt(i),d=1<<u;n[u]=-1,i&=~d}}function od(n){if(De&6)throw Error(t(327));Cr();var i=$i(n,0);if(!(i&1))return Et(n,He()),null;var u=Ps(n,i);if(n.tag!==0&&u===2){var d=Mo(n);d!==0&&(i=d,u=il(n,d))}if(u===1)throw u=Si,qn(n,0),bn(n,i),Et(n,He()),u;if(u===6)throw Error(t(345));return n.finishedWork=n.current.alternate,n.finishedLanes=i,Xn(n,yt,hn),Et(n,He()),null}function ol(n,i){var u=De;De|=1;try{return n(i)}finally{De=u,De===0&&(Ir=He()+500,ss&&Cn())}}function Yn(n){Pn!==null&&Pn.tag===0&&!(De&6)&&Cr();var i=De;De|=1;var u=_t.transition,d=Pe;try{if(_t.transition=null,Pe=1,n)return n()}finally{Pe=d,_t.transition=u,De=i,!(De&6)&&Cn()}}function al(){It=Rr.current,Ue(Rr)}function qn(n,i){n.finishedWork=null,n.finishedLanes=0;var u=n.timeoutHandle;if(u!==-1&&(n.timeoutHandle=-1,Ym(u)),We!==null)for(u=We.return;u!==null;){var d=u;switch(pa(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&rs();break;case 3:vr(),Ue(gt),Ue(at),Da();break;case 5:Ca(d);break;case 4:vr();break;case 13:Ue($e);break;case 19:Ue($e);break;case 10:va(d.type._context);break;case 22:case 23:al()}u=u.return}if(Je=n,We=n=On(n.current,null),st=It=i,qe=0,Si=null,el=Is=jn=0,yt=vi=null,Hn!==null){for(i=0;i<Hn.length;i++)if(u=Hn[i],d=u.interleaved,d!==null){u.interleaved=null;var m=d.next,y=u.pending;if(y!==null){var A=y.next;y.next=m,d.next=A}u.pending=d}Hn=null}return n}function ad(n,i){do{var u=We;try{if(Sa(),ms.current=xs,ps){for(var d=Ge.memoizedState;d!==null;){var m=d.queue;m!==null&&(m.pending=null),d=d.next}ps=!1}if(Wn=0,Qe=Ye=Ge=null,mi=!1,pi=0,Za.current=null,u===null||u.return===null){qe=1,Si=i,We=null;break}e:{var y=n,A=u.return,I=u,w=i;if(i=st,I.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var B=w,X=I,J=X.tag;if(!(X.mode&1)&&(J===0||J===11||J===15)){var Y=X.alternate;Y?(X.updateQueue=Y.updateQueue,X.memoizedState=Y.memoizedState,X.lanes=Y.lanes):(X.updateQueue=null,X.memoizedState=null)}var ne=Pf(A);if(ne!==null){ne.flags&=-257,Ff(ne,A,I,y,i),ne.mode&1&&_f(y,B,i),i=ne,w=B;var ae=i.updateQueue;if(ae===null){var le=new Set;le.add(w),i.updateQueue=le}else ae.add(w);break e}else{if(!(i&1)){_f(y,B,i),ll();break e}w=Error(t(426))}}else if(Be&&I.mode&1){var ze=Pf(A);if(ze!==null){!(ze.flags&65536)&&(ze.flags|=256),Ff(ze,A,I,y,i),xa(Lr(w,I));break e}}y=w=Lr(w,I),qe!==4&&(qe=2),vi===null?vi=[y]:vi.push(y),y=A;do{switch(y.tag){case 3:y.flags|=65536,i&=-i,y.lanes|=i;var b=Df(y,w,i);tf(y,b);break e;case 1:I=w;var P=y.type,N=y.stateNode;if(!(y.flags&128)&&(typeof P.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(_n===null||!_n.has(N)))){y.flags|=65536,i&=-i,y.lanes|=i;var Z=kf(y,I,i);tf(y,Z);break e}}y=y.return}while(y!==null)}cd(u)}catch(ue){i=ue,We===u&&u!==null&&(We=u=u.return);continue}break}while(!0)}function ld(){var n=Rs.current;return Rs.current=xs,n===null?xs:n}function ll(){(qe===0||qe===3||qe===2)&&(qe=4),Je===null||!(jn&268435455)&&!(Is&268435455)||bn(Je,st)}function Ps(n,i){var u=De;De|=2;var d=ld();(Je!==n||st!==i)&&(hn=null,qn(n,i));do try{xp();break}catch(m){ad(n,m)}while(!0);if(Sa(),De=u,Rs.current=d,We!==null)throw Error(t(261));return Je=null,st=0,qe}function xp(){for(;We!==null;)ud(We)}function Tp(){for(;We!==null&&!zg();)ud(We)}function ud(n){var i=hd(n.alternate,n,It);n.memoizedProps=n.pendingProps,i===null?cd(n):We=i,Za.current=null}function cd(n){var i=n;do{var u=i.alternate;if(n=i.return,i.flags&32768){if(u=hp(u,i),u!==null){u.flags&=32767,We=u;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{qe=6,We=null;return}}else if(u=dp(u,i,It),u!==null){We=u;return}if(i=i.sibling,i!==null){We=i;return}We=i=n}while(i!==null);qe===0&&(qe=5)}function Xn(n,i,u){var d=Pe,m=_t.transition;try{_t.transition=null,Pe=1,Sp(n,i,u,d)}finally{_t.transition=m,Pe=d}return null}function Sp(n,i,u,d){do Cr();while(Pn!==null);if(De&6)throw Error(t(327));u=n.finishedWork;var m=n.finishedLanes;if(u===null)return null;if(n.finishedWork=null,n.finishedLanes=0,u===n.current)throw Error(t(177));n.callbackNode=null,n.callbackPriority=0;var y=u.lanes|u.childLanes;if(tm(n,y),n===Je&&(We=Je=null,st=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||ws||(ws=!0,gd(Ni,function(){return Cr(),null})),y=(u.flags&15990)!==0,u.subtreeFlags&15990||y){y=_t.transition,_t.transition=null;var A=Pe;Pe=1;var I=De;De|=4,Za.current=null,mp(n,u),ed(u,n),Gm(la),Vi=!!aa,la=aa=null,n.current=u,pp(u),Wg(),De=I,Pe=A,_t.transition=y}else n.current=u;if(ws&&(ws=!1,Pn=n,Ds=m),y=n.pendingLanes,y===0&&(_n=null),qg(u.stateNode),Et(n,He()),i!==null)for(d=n.onRecoverableError,u=0;u<i.length;u++)m=i[u],d(m.value,{componentStack:m.stack,digest:m.digest});if(Cs)throw Cs=!1,n=nl,nl=null,n;return Ds&1&&n.tag!==0&&Cr(),y=n.pendingLanes,y&1?n===rl?Li++:(Li=0,rl=n):Li=0,Cn(),null}function Cr(){if(Pn!==null){var n=Qu(Ds),i=_t.transition,u=Pe;try{if(_t.transition=null,Pe=16>n?16:n,Pn===null)var d=!1;else{if(n=Pn,Pn=null,Ds=0,De&6)throw Error(t(331));var m=De;for(De|=4,ie=n.current;ie!==null;){var y=ie,A=y.child;if(ie.flags&16){var I=y.deletions;if(I!==null){for(var w=0;w<I.length;w++){var B=I[w];for(ie=B;ie!==null;){var X=ie;switch(X.tag){case 0:case 11:case 15:Ti(8,X,y)}var J=X.child;if(J!==null)J.return=X,ie=J;else for(;ie!==null;){X=ie;var Y=X.sibling,ne=X.return;if(qf(X),X===B){ie=null;break}if(Y!==null){Y.return=ne,ie=Y;break}ie=ne}}}var ae=y.alternate;if(ae!==null){var le=ae.child;if(le!==null){ae.child=null;do{var ze=le.sibling;le.sibling=null,le=ze}while(le!==null)}}ie=y}}if(y.subtreeFlags&2064&&A!==null)A.return=y,ie=A;else e:for(;ie!==null;){if(y=ie,y.flags&2048)switch(y.tag){case 0:case 11:case 15:Ti(9,y,y.return)}var b=y.sibling;if(b!==null){b.return=y.return,ie=b;break e}ie=y.return}}var P=n.current;for(ie=P;ie!==null;){A=ie;var N=A.child;if(A.subtreeFlags&2064&&N!==null)N.return=A,ie=N;else e:for(A=P;ie!==null;){if(I=ie,I.flags&2048)try{switch(I.tag){case 0:case 11:case 15:As(9,I)}}catch(ue){Ve(I,I.return,ue)}if(I===A){ie=null;break e}var Z=I.sibling;if(Z!==null){Z.return=I.return,ie=Z;break e}ie=I.return}}if(De=m,Cn(),jt&&typeof jt.onPostCommitFiberRoot=="function")try{jt.onPostCommitFiberRoot(Mi,n)}catch{}d=!0}return d}finally{Pe=u,_t.transition=i}}return!1}function fd(n,i,u){i=Lr(u,i),i=Df(n,i,1),n=Dn(n,i,1),i=ht(),n!==null&&(jr(n,1,i),Et(n,i))}function Ve(n,i,u){if(n.tag===3)fd(n,n,u);else for(;i!==null;){if(i.tag===3){fd(i,n,u);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(_n===null||!_n.has(d))){n=Lr(u,n),n=kf(i,n,1),i=Dn(i,n,1),n=ht(),i!==null&&(jr(i,1,n),Et(i,n));break}}i=i.return}}function vp(n,i,u){var d=n.pingCache;d!==null&&d.delete(i),i=ht(),n.pingedLanes|=n.suspendedLanes&u,Je===n&&(st&u)===u&&(qe===4||qe===3&&(st&130023424)===st&&500>He()-tl?qn(n,0):el|=u),Et(n,i)}function dd(n,i){i===0&&(n.mode&1?(i=Bi,Bi<<=1,!(Bi&130023424)&&(Bi=4194304)):i=1);var u=ht();n=cn(n,i),n!==null&&(jr(n,i,u),Et(n,u))}function Lp(n){var i=n.memoizedState,u=0;i!==null&&(u=i.retryLane),dd(n,u)}function Ap(n,i){var u=0;switch(n.tag){case 13:var d=n.stateNode,m=n.memoizedState;m!==null&&(u=m.retryLane);break;case 19:d=n.stateNode;break;default:throw Error(t(314))}d!==null&&d.delete(i),dd(n,u)}var hd;hd=function(n,i,u){if(n!==null)if(n.memoizedProps!==i.pendingProps||gt.current)pt=!0;else{if(!(n.lanes&u)&&!(i.flags&128))return pt=!1,fp(n,i,u);pt=!!(n.flags&131072)}else pt=!1,Be&&i.flags&1048576&&zc(i,as,i.index);switch(i.lanes=0,i.tag){case 2:var d=i.type;vs(n,i),n=i.pendingProps;var m=mr(i,at.current);Sr(i,u),m=Pa(null,i,d,n,m,u);var y=Fa();return i.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,mt(d)?(y=!0,is(i)):y=!1,i.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,Ra(i),m.updater=Ts,i.stateNode=m,m._reactInternals=i,Ba(i,d,n,u),i=Va(null,i,d,!0,y,u)):(i.tag=0,Be&&y&&ma(i),dt(null,i,m,u),i=i.child),i;case 16:d=i.elementType;e:{switch(vs(n,i),n=i.pendingProps,m=d._init,d=m(d._payload),i.type=d,m=i.tag=Ip(d),n=$t(d,n),m){case 0:i=Ka(null,i,d,n,u);break e;case 1:i=Bf(null,i,d,n,u);break e;case 11:i=bf(null,i,d,n,u);break e;case 14:i=Of(null,i,d,$t(d.type,n),u);break e}throw Error(t(306,d,""))}return i;case 0:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:$t(d,m),Ka(n,i,d,m,u);case 1:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:$t(d,m),Bf(n,i,d,m,u);case 3:e:{if($f(i),n===null)throw Error(t(387));d=i.pendingProps,y=i.memoizedState,m=y.element,ef(n,i),hs(i,d,null,u);var A=i.memoizedState;if(d=A.element,y.isDehydrated)if(y={element:d,isDehydrated:!1,cache:A.cache,pendingSuspenseBoundaries:A.pendingSuspenseBoundaries,transitions:A.transitions},i.updateQueue.baseState=y,i.memoizedState=y,i.flags&256){m=Lr(Error(t(423)),i),i=Gf(n,i,d,u,m);break e}else if(d!==m){m=Lr(Error(t(424)),i),i=Gf(n,i,d,u,m);break e}else for(Rt=An(i.stateNode.containerInfo.firstChild),At=i,Be=!0,Bt=null,u=Jc(i,null,d,u),i.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Er(),d===m){i=dn(n,i,u);break e}dt(n,i,d,u)}i=i.child}return i;case 5:return rf(i),n===null&&Ea(i),d=i.type,m=i.pendingProps,y=n!==null?n.memoizedProps:null,A=m.children,ua(d,m)?A=null:y!==null&&ua(d,y)&&(i.flags|=32),Uf(n,i),dt(n,i,A,u),i.child;case 6:return n===null&&Ea(i),null;case 13:return Kf(n,i,u);case 4:return Ia(i,i.stateNode.containerInfo),d=i.pendingProps,n===null?i.child=xr(i,null,d,u):dt(n,i,d,u),i.child;case 11:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:$t(d,m),bf(n,i,d,m,u);case 7:return dt(n,i,i.pendingProps,u),i.child;case 8:return dt(n,i,i.pendingProps.children,u),i.child;case 12:return dt(n,i,i.pendingProps.children,u),i.child;case 10:e:{if(d=i.type._context,m=i.pendingProps,y=i.memoizedProps,A=m.value,Oe(cs,d._currentValue),d._currentValue=A,y!==null)if(Ut(y.value,A)){if(y.children===m.children&&!gt.current){i=dn(n,i,u);break e}}else for(y=i.child,y!==null&&(y.return=i);y!==null;){var I=y.dependencies;if(I!==null){A=y.child;for(var w=I.firstContext;w!==null;){if(w.context===d){if(y.tag===1){w=fn(-1,u&-u),w.tag=2;var B=y.updateQueue;if(B!==null){B=B.shared;var X=B.pending;X===null?w.next=w:(w.next=X.next,X.next=w),B.pending=w}}y.lanes|=u,w=y.alternate,w!==null&&(w.lanes|=u),La(y.return,u,i),I.lanes|=u;break}w=w.next}}else if(y.tag===10)A=y.type===i.type?null:y.child;else if(y.tag===18){if(A=y.return,A===null)throw Error(t(341));A.lanes|=u,I=A.alternate,I!==null&&(I.lanes|=u),La(A,u,i),A=y.sibling}else A=y.child;if(A!==null)A.return=y;else for(A=y;A!==null;){if(A===i){A=null;break}if(y=A.sibling,y!==null){y.return=A.return,A=y;break}A=A.return}y=A}dt(n,i,m.children,u),i=i.child}return i;case 9:return m=i.type,d=i.pendingProps.children,Sr(i,u),m=Dt(m),d=d(m),i.flags|=1,dt(n,i,d,u),i.child;case 14:return d=i.type,m=$t(d,i.pendingProps),m=$t(d.type,m),Of(n,i,d,m,u);case 15:return Nf(n,i,i.type,i.pendingProps,u);case 17:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:$t(d,m),vs(n,i),i.tag=1,mt(d)?(n=!0,is(i)):n=!1,Sr(i,u),Cf(i,d,m),Ba(i,d,m,u),Va(null,i,d,!0,n,u);case 19:return Hf(n,i,u);case 22:return Mf(n,i,u)}throw Error(t(156,i.tag))};function gd(n,i){return Wu(n,i)}function Rp(n,i,u,d){this.tag=n,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pt(n,i,u,d){return new Rp(n,i,u,d)}function ul(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Ip(n){if(typeof n=="function")return ul(n)?1:0;if(n!=null){if(n=n.$$typeof,n===ge)return 11;if(n===de)return 14}return 2}function On(n,i){var u=n.alternate;return u===null?(u=Pt(n.tag,i,n.key,n.mode),u.elementType=n.elementType,u.type=n.type,u.stateNode=n.stateNode,u.alternate=n,n.alternate=u):(u.pendingProps=i,u.type=n.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=n.flags&14680064,u.childLanes=n.childLanes,u.lanes=n.lanes,u.child=n.child,u.memoizedProps=n.memoizedProps,u.memoizedState=n.memoizedState,u.updateQueue=n.updateQueue,i=n.dependencies,u.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},u.sibling=n.sibling,u.index=n.index,u.ref=n.ref,u}function Fs(n,i,u,d,m,y){var A=2;if(d=n,typeof n=="function")ul(n)&&(A=1);else if(typeof n=="string")A=5;else e:switch(n){case U:return Qn(u.children,m,y,i);case j:A=8,m|=8;break;case ee:return n=Pt(12,u,i,m|2),n.elementType=ee,n.lanes=y,n;case te:return n=Pt(13,u,i,m),n.elementType=te,n.lanes=y,n;case fe:return n=Pt(19,u,i,m),n.elementType=fe,n.lanes=y,n;case he:return bs(u,m,y,i);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case H:A=10;break e;case Q:A=9;break e;case ge:A=11;break e;case de:A=14;break e;case oe:A=16,d=null;break e}throw Error(t(130,n==null?n:typeof n,""))}return i=Pt(A,u,i,m),i.elementType=n,i.type=d,i.lanes=y,i}function Qn(n,i,u,d){return n=Pt(7,n,d,i),n.lanes=u,n}function bs(n,i,u,d){return n=Pt(22,n,d,i),n.elementType=he,n.lanes=u,n.stateNode={isHidden:!1},n}function cl(n,i,u){return n=Pt(6,n,null,i),n.lanes=u,n}function fl(n,i,u){return i=Pt(4,n.children!==null?n.children:[],n.key,i),i.lanes=u,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}function Cp(n,i,u,d,m){this.tag=i,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Uo(0),this.expirationTimes=Uo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Uo(0),this.identifierPrefix=d,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function dl(n,i,u,d,m,y,A,I,w){return n=new Cp(n,i,u,I,w),i===1?(i=1,y===!0&&(i|=8)):i=0,y=Pt(3,null,null,i),n.current=y,y.stateNode=n,y.memoizedState={element:d,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ra(y),n}function wp(n,i,u){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:V,key:d==null?null:""+d,children:n,containerInfo:i,implementation:u}}function md(n){if(!n)return In;n=n._reactInternals;e:{if(Bn(n)!==n||n.tag!==1)throw Error(t(170));var i=n;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(mt(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(t(171))}if(n.tag===1){var u=n.type;if(mt(u))return Kc(n,u,i)}return i}function pd(n,i,u,d,m,y,A,I,w){return n=dl(u,d,!0,n,m,y,A,I,w),n.context=md(null),u=n.current,d=ht(),m=Fn(u),y=fn(d,m),y.callback=i??null,Dn(u,y,m),n.current.lanes=m,jr(n,m,d),Et(n,d),n}function Os(n,i,u,d){var m=i.current,y=ht(),A=Fn(m);return u=md(u),i.context===null?i.context=u:i.pendingContext=u,i=fn(y,A),i.payload={element:n},d=d===void 0?null:d,d!==null&&(i.callback=d),n=Dn(m,i,A),n!==null&&(Vt(n,m,A,y),ds(n,m,A)),A}function Ns(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function yd(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var u=n.retryLane;n.retryLane=u!==0&&u<i?u:i}}function hl(n,i){yd(n,i),(n=n.alternate)&&yd(n,i)}var Ed=typeof reportError=="function"?reportError:function(n){console.error(n)};function gl(n){this._internalRoot=n}Ms.prototype.render=gl.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(t(409));Os(n,i,null,null)},Ms.prototype.unmount=gl.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;Yn(function(){Os(null,n,null,null)}),i[on]=null}};function Ms(n){this._internalRoot=n}Ms.prototype.unstable_scheduleHydration=function(n){if(n){var i=ec();n={blockedOn:null,target:n,priority:i};for(var u=0;u<Sn.length&&i!==0&&i<Sn[u].priority;u++);Sn.splice(u,0,n),u===0&&rc(n)}};function ml(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Us(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function xd(){}function Dp(n,i,u,d,m){if(m){if(typeof d=="function"){var y=d;d=function(){var B=Ns(A);y.call(B)}}var A=pd(i,d,n,0,null,!1,!1,"",xd);return n._reactRootContainer=A,n[on]=A.current,ai(n.nodeType===8?n.parentNode:n),Yn(),A}for(;m=n.lastChild;)n.removeChild(m);if(typeof d=="function"){var I=d;d=function(){var B=Ns(w);I.call(B)}}var w=dl(n,0,!1,null,null,!1,!1,"",xd);return n._reactRootContainer=w,n[on]=w.current,ai(n.nodeType===8?n.parentNode:n),Yn(function(){Os(i,w,u,d)}),w}function Bs(n,i,u,d,m){var y=u._reactRootContainer;if(y){var A=y;if(typeof m=="function"){var I=m;m=function(){var w=Ns(A);I.call(w)}}Os(i,A,n,m)}else A=Dp(u,i,n,m,d);return Ns(A)}Ju=function(n){switch(n.tag){case 3:var i=n.stateNode;if(i.current.memoizedState.isDehydrated){var u=Wr(i.pendingLanes);u!==0&&(Bo(i,u|1),Et(i,He()),!(De&6)&&(Ir=He()+500,Cn()))}break;case 13:Yn(function(){var d=cn(n,1);if(d!==null){var m=ht();Vt(d,n,1,m)}}),hl(n,1)}},$o=function(n){if(n.tag===13){var i=cn(n,134217728);if(i!==null){var u=ht();Vt(i,n,134217728,u)}hl(n,134217728)}},Zu=function(n){if(n.tag===13){var i=Fn(n),u=cn(n,i);if(u!==null){var d=ht();Vt(u,n,i,d)}hl(n,i)}},ec=function(){return Pe},tc=function(n,i){var u=Pe;try{return Pe=n,i()}finally{Pe=u}},Po=function(n,i,u){switch(i){case"input":if(Ao(n,u),i=u.name,u.type==="radio"&&i!=null){for(u=n;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<u.length;i++){var d=u[i];if(d!==n&&d.form===n.form){var m=ns(d);if(!m)throw Error(t(90));Ru(d),Ao(d,m)}}}break;case"textarea":ku(n,u);break;case"select":i=u.value,i!=null&&rr(n,!!u.multiple,i,!1)}},Bu=ol,$u=Yn;var kp={usingClientEntryPoint:!1,Events:[ci,hr,ns,Mu,Uu,ol]},Ai={findFiberByHostInstance:$n,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_p={bundleType:Ai.bundleType,version:Ai.version,rendererPackageName:Ai.rendererPackageName,rendererConfig:Ai.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:M.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Hu(n),n===null?null:n.stateNode},findFiberByHostInstance:Ai.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $s=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$s.isDisabled&&$s.supportsFiber)try{Mi=$s.inject(_p),jt=$s}catch{}}return xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kp,xt.createPortal=function(n,i){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ml(i))throw Error(t(200));return wp(n,i,null,u)},xt.createRoot=function(n,i){if(!ml(n))throw Error(t(299));var u=!1,d="",m=Ed;return i!=null&&(i.unstable_strictMode===!0&&(u=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onRecoverableError!==void 0&&(m=i.onRecoverableError)),i=dl(n,1,!1,null,null,u,!1,d,m),n[on]=i.current,ai(n.nodeType===8?n.parentNode:n),new gl(i)},xt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(t(188)):(n=Object.keys(n).join(","),Error(t(268,n)));return n=Hu(i),n=n===null?null:n.stateNode,n},xt.flushSync=function(n){return Yn(n)},xt.hydrate=function(n,i,u){if(!Us(i))throw Error(t(200));return Bs(null,n,i,!0,u)},xt.hydrateRoot=function(n,i,u){if(!ml(n))throw Error(t(405));var d=u!=null&&u.hydratedSources||null,m=!1,y="",A=Ed;if(u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(y=u.identifierPrefix),u.onRecoverableError!==void 0&&(A=u.onRecoverableError)),i=pd(i,null,n,1,u??null,m,!1,y,A),n[on]=i.current,ai(n),d)for(n=0;n<d.length;n++)u=d[n],m=u._getVersion,m=m(u._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[u,m]:i.mutableSourceEagerHydrationData.push(u,m);return new Ms(i)},xt.render=function(n,i,u){if(!Us(i))throw Error(t(200));return Bs(null,n,i,!1,u)},xt.unmountComponentAtNode=function(n){if(!Us(n))throw Error(t(40));return n._reactRootContainer?(Yn(function(){Bs(null,null,n,!1,function(){n._reactRootContainer=null,n[on]=null})}),!0):!1},xt.unstable_batchedUpdates=ol,xt.unstable_renderSubtreeIntoContainer=function(n,i,u,d){if(!Us(u))throw Error(t(200));if(n==null||n._reactInternals===void 0)throw Error(t(38));return Bs(n,i,u,!1,d)},xt.version="18.3.1-next-f1338f8080-20240426",xt}var Cd;function Bp(){if(Cd)return El.exports;Cd=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(e){console.error(e)}}return l(),El.exports=Up(),El.exports}var wd;function $p(){if(wd)return Gs;wd=1;var l=Bp();return Gs.createRoot=l.createRoot,Gs.hydrateRoot=l.hydrateRoot,Gs}var Gp=$p(),tt=ou();const Hl=l=>{const e=Math.floor(l/60),t=l%60;return`${e}:${t.toFixed(0).padStart(2,"0")}`},Kp=({callback:l})=>{const[e,t]=tt.useState([]),r=async()=>{try{const s=await fetch("/audio-files");if(!s.ok)throw new Error(`Erroron fetch: ${s.statusText}`);const o=await s.json();console.log("Files:",o),t(o)}catch(s){console.error("Error on fetching files:",s)}};return tt.useEffect(()=>{r()},[]),Le.jsx("div",{className:"grid grid-cols-3 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 p-4",children:e.map(s=>Le.jsxs("div",{onClick:()=>l(s),className:"group relative w-full aspect-square overflow-hidden rounded-2xl bg-gray-800",children:[Le.jsx("img",{src:s.image_url,alt:s.title,className:"object-cover w-full h-full transition-transform duration-300 ease-in-out transform group-hover:scale-110"}),Le.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-50 opacity-0 transition-opacity duration-300 group-hover:opacity-100 flex flex-col justify-between p-4",children:[Le.jsx("div",{className:"flex justify-end",children:Le.jsx("span",{className:"text-white text-lg font-semibold px-2 py-1 rounded-md select-none",children:Hl(s.duration)})}),Le.jsxs("div",{className:"text-white select-none",children:[Le.jsx("h3",{className:"text-xl font-bold",children:s.title}),Le.jsxs("p",{className:"text-sm text-gray-300",children:[s.album," • ",s.artist]})]})]})]},s.id))})};function Vp(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Dh={exports:{}};(function(l,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(f,h,g){if(g=g||{},f=f.trim(),h=h.trim(),!h){if(!g.alwaysNormalize)return f;var p=c.parseURL(f);if(!p)throw new Error("Error trying to parse base URL.");return p.path=c.normalizePath(p.path),c.buildURLFromParts(p)}var E=c.parseURL(h);if(!E)throw new Error("Error trying to parse relative URL.");if(E.scheme)return g.alwaysNormalize?(E.path=c.normalizePath(E.path),c.buildURLFromParts(E)):h;var T=c.parseURL(f);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var x=s.exec(T.path);T.netLoc=x[1],T.path=x[2]}T.netLoc&&!T.path&&(T.path="/");var S={scheme:T.scheme,netLoc:E.netLoc,path:null,params:E.params,query:E.query,fragment:E.fragment};if(!E.netLoc&&(S.netLoc=T.netLoc,E.path[0]!=="/"))if(!E.path)S.path=T.path,E.params||(S.params=T.params,E.query||(S.query=T.query));else{var v=T.path,R=v.substring(0,v.lastIndexOf("/")+1)+E.path;S.path=c.normalizePath(R)}return S.path===null&&(S.path=g.alwaysNormalize?c.normalizePath(E.path):E.path),c.buildURLFromParts(S)},parseURL:function(f){var h=r.exec(f);return h?{scheme:h[1]||"",netLoc:h[2]||"",path:h[3]||"",params:h[4]||"",query:h[5]||"",fragment:h[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(o,"");f.length!==(f=f.replace(a,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};l.exports=c})()})(Dh);var au=Dh.exports;function Dd(l,e){var t=Object.keys(l);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(l);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),t.push.apply(t,r)}return t}function rt(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Dd(Object(t),!0).forEach(function(r){Wp(l,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(t)):Dd(Object(t)).forEach(function(r){Object.defineProperty(l,r,Object.getOwnPropertyDescriptor(t,r))})}return l}function Hp(l,e){if(typeof l!="object"||!l)return l;var t=l[Symbol.toPrimitive];if(t!==void 0){var r=t.call(l,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(l)}function zp(l){var e=Hp(l,"string");return typeof e=="symbol"?e:String(e)}function Wp(l,e,t){return e=zp(e),e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}function je(){return je=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(l[r]=t[r])}return l},je.apply(this,arguments)}const se=Number.isFinite||function(l){return typeof l=="number"&&isFinite(l)},jp=Number.isSafeInteger||function(l){return typeof l=="number"&&Math.abs(l)<=Yp},Yp=Number.MAX_SAFE_INTEGER||9007199254740991;let L=function(l){return l.MEDIA_ATTACHING="hlsMediaAttaching",l.MEDIA_ATTACHED="hlsMediaAttached",l.MEDIA_DETACHING="hlsMediaDetaching",l.MEDIA_DETACHED="hlsMediaDetached",l.BUFFER_RESET="hlsBufferReset",l.BUFFER_CODECS="hlsBufferCodecs",l.BUFFER_CREATED="hlsBufferCreated",l.BUFFER_APPENDING="hlsBufferAppending",l.BUFFER_APPENDED="hlsBufferAppended",l.BUFFER_EOS="hlsBufferEos",l.BUFFER_FLUSHING="hlsBufferFlushing",l.BUFFER_FLUSHED="hlsBufferFlushed",l.MANIFEST_LOADING="hlsManifestLoading",l.MANIFEST_LOADED="hlsManifestLoaded",l.MANIFEST_PARSED="hlsManifestParsed",l.LEVEL_SWITCHING="hlsLevelSwitching",l.LEVEL_SWITCHED="hlsLevelSwitched",l.LEVEL_LOADING="hlsLevelLoading",l.LEVEL_LOADED="hlsLevelLoaded",l.LEVEL_UPDATED="hlsLevelUpdated",l.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",l.LEVELS_UPDATED="hlsLevelsUpdated",l.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",l.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",l.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",l.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",l.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",l.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",l.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",l.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",l.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",l.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",l.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",l.CUES_PARSED="hlsCuesParsed",l.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",l.INIT_PTS_FOUND="hlsInitPtsFound",l.FRAG_LOADING="hlsFragLoading",l.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",l.FRAG_LOADED="hlsFragLoaded",l.FRAG_DECRYPTED="hlsFragDecrypted",l.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",l.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",l.FRAG_PARSING_METADATA="hlsFragParsingMetadata",l.FRAG_PARSED="hlsFragParsed",l.FRAG_BUFFERED="hlsFragBuffered",l.FRAG_CHANGED="hlsFragChanged",l.FPS_DROP="hlsFpsDrop",l.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",l.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",l.ERROR="hlsError",l.DESTROYING="hlsDestroying",l.KEY_LOADING="hlsKeyLoading",l.KEY_LOADED="hlsKeyLoaded",l.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",l.BACK_BUFFER_REACHED="hlsBackBufferReached",l.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",l}({}),Se=function(l){return l.NETWORK_ERROR="networkError",l.MEDIA_ERROR="mediaError",l.KEY_SYSTEM_ERROR="keySystemError",l.MUX_ERROR="muxError",l.OTHER_ERROR="otherError",l}({}),G=function(l){return l.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",l.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",l.KEY_SYSTEM_NO_SESSION="keySystemNoSession",l.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",l.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",l.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",l.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",l.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",l.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",l.MANIFEST_LOAD_ERROR="manifestLoadError",l.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",l.MANIFEST_PARSING_ERROR="manifestParsingError",l.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",l.LEVEL_EMPTY_ERROR="levelEmptyError",l.LEVEL_LOAD_ERROR="levelLoadError",l.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",l.LEVEL_PARSING_ERROR="levelParsingError",l.LEVEL_SWITCH_ERROR="levelSwitchError",l.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",l.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",l.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",l.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",l.FRAG_LOAD_ERROR="fragLoadError",l.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",l.FRAG_DECRYPT_ERROR="fragDecryptError",l.FRAG_PARSING_ERROR="fragParsingError",l.FRAG_GAP="fragGap",l.REMUX_ALLOC_ERROR="remuxAllocError",l.KEY_LOAD_ERROR="keyLoadError",l.KEY_LOAD_TIMEOUT="keyLoadTimeOut",l.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",l.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",l.BUFFER_APPEND_ERROR="bufferAppendError",l.BUFFER_APPENDING_ERROR="bufferAppendingError",l.BUFFER_STALLED_ERROR="bufferStalledError",l.BUFFER_FULL_ERROR="bufferFullError",l.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",l.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",l.INTERNAL_EXCEPTION="internalException",l.INTERNAL_ABORTED="aborted",l.UNKNOWN="unknown",l}({});const Zn=function(){},zl={trace:Zn,debug:Zn,log:Zn,warn:Zn,info:Zn,error:Zn};let Ci=zl;function qp(l){const e=self.console[l];return e?e.bind(self.console,`[${l}] >`):Zn}function Xp(l,...e){e.forEach(function(t){Ci[t]=l[t]?l[t].bind(l):qp(t)})}function Qp(l,e){if(typeof console=="object"&&l===!0||typeof l=="object"){Xp(l,"debug","log","info","warn","error");try{Ci.log(`Debug logs enabled for "${e}" in hls.js version 1.5.19`)}catch{Ci=zl}}else Ci=zl}const F=Ci,Jp=/^(\d+)x(\d+)$/,kd=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ke{constructor(e){typeof e=="string"&&(e=Ke.parseAttrList(e)),je(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)r[s]=parseInt(t.slice(s*2,s*2+2),16);return r}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Jp.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={},s='"';for(kd.lastIndex=0;(t=kd.exec(e))!==null;){let o=t[2];o.indexOf(s)===0&&o.lastIndexOf(s)===o.length-1&&(o=o.slice(1,-1));const a=t[1].trim();r[a]=o}return r}}function Zp(l){return l!=="ID"&&l!=="CLASS"&&l!=="START-DATE"&&l!=="DURATION"&&l!=="END-DATE"&&l!=="END-ON-NEXT"}function e0(l){return l==="SCTE35-OUT"||l==="SCTE35-IN"}class kh{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const s in r)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s]!==r[s]){F.warn(`DATERANGE tag attribute: "${s}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=s;break}e=je(new Ke({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=new Date(this.attr["END-DATE"]);se(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(se(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&se(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class So{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Fe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class _h{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Fe.AUDIO]:null,[Fe.VIDEO]:null,[Fe.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2);let s;r.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=au.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Sl extends _h{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new So,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!se(this.programDateTime))return null;const e=se(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,s,o,a=!1){const{elementaryStreams:c}=this,f=c[e];if(!f){c[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:o,partial:a};return}f.startPTS=Math.min(f.startPTS,t),f.endPTS=Math.max(f.endPTS,r),f.startDTS=Math.min(f.startDTS,s),f.endDTS=Math.max(f.endDTS,o)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Fe.AUDIO]=null,e[Fe.VIDEO]=null,e[Fe.AUDIOVIDEO]=null}}class t0 extends _h{constructor(e,t,r,s,o){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new So,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,o),o&&(this.fragOffset=o.fragOffset+o.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const n0=10;class r0{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?se(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||n0}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function lu(l){return Uint8Array.from(atob(l),e=>e.charCodeAt(0))}function i0(l){const e=Wl(l).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function s0(l){const e=function(r,s,o){const a=r[s];r[s]=r[o],r[o]=a};e(l,0,3),e(l,1,2),e(l,4,5),e(l,6,7)}function o0(l){const e=l.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),s=r[r.length-1].split(",");if(s.length===2){const o=s[0]==="base64",a=s[1];o?(r.splice(-1,1),t=lu(a)):t=i0(a)}}return t}function Wl(l){return Uint8Array.from(unescape(encodeURIComponent(l)),e=>e.charCodeAt(0))}const Nr=typeof self<"u"?self:void 0;var _e={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},St={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function vl(l){switch(l){case St.FAIRPLAY:return _e.FAIRPLAY;case St.PLAYREADY:return _e.PLAYREADY;case St.WIDEVINE:return _e.WIDEVINE;case St.CLEARKEY:return _e.CLEARKEY}}var Ks={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",FAIRPLAY:"94ce86fb07ff4f43adb893d2fa968ca2",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Ll(l){if(l===Ks.WIDEVINE)return _e.WIDEVINE;if(l===Ks.PLAYREADY)return _e.PLAYREADY;if(l===Ks.CENC||l===Ks.CLEARKEY)return _e.CLEARKEY}function Al(l){switch(l){case _e.FAIRPLAY:return St.FAIRPLAY;case _e.PLAYREADY:return St.PLAYREADY;case _e.WIDEVINE:return St.WIDEVINE;case _e.CLEARKEY:return St.CLEARKEY}}function Vs(l){const{drmSystems:e,widevineLicenseUrl:t}=l,r=e?[_e.FAIRPLAY,_e.WIDEVINE,_e.PLAYREADY,_e.CLEARKEY].filter(s=>!!e[s]):[];return!r[_e.WIDEVINE]&&t&&r.push(_e.WIDEVINE),r}const Ph=function(l){return Nr!=null&&(l=Nr.navigator)!=null&&l.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function a0(l,e,t,r){let s;switch(l){case _e.FAIRPLAY:s=["cenc","sinf"];break;case _e.WIDEVINE:case _e.PLAYREADY:s=["cenc"];break;case _e.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${l}`)}return l0(s,e,t,r)}function l0(l,e,t,r){return[{initDataTypes:l,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(o=>({contentType:`audio/mp4; codecs="${o}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(o=>({contentType:`video/mp4; codecs="${o}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function Fh(l){const e=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(a){const c=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(c){const f=lu(c).subarray(0,16);return s0(f),f}}return null}function tr(l,e,t){return Uint8Array.prototype.slice?l.slice(e,t):new Uint8Array(Array.prototype.slice.call(l,e,t))}const uu=(l,e)=>e+10<=l.length&&l[e]===73&&l[e+1]===68&&l[e+2]===51&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128,bh=(l,e)=>e+10<=l.length&&l[e]===51&&l[e+1]===68&&l[e+2]===73&&l[e+3]<255&&l[e+4]<255&&l[e+6]<128&&l[e+7]<128&&l[e+8]<128&&l[e+9]<128,wi=(l,e)=>{const t=e;let r=0;for(;uu(l,e);){r+=10;const s=vo(l,e+6);r+=s,bh(l,e+10)&&(r+=10),e+=r}if(r>0)return l.subarray(t,t+r)},vo=(l,e)=>{let t=0;return t=(l[e]&127)<<21,t|=(l[e+1]&127)<<14,t|=(l[e+2]&127)<<7,t|=l[e+3]&127,t},u0=(l,e)=>uu(l,e)&&vo(l,e+6)+10<=l.length-e,cu=l=>{const e=Nh(l);for(let t=0;t<e.length;t++){const r=e[t];if(Oh(r))return m0(r)}},Oh=l=>l&&l.key==="PRIV"&&l.info==="com.apple.streaming.transportStreamTimestamp",c0=l=>{const e=String.fromCharCode(l[0],l[1],l[2],l[3]),t=vo(l,4),r=10;return{type:e,size:t,data:l.subarray(r,r+t)}},Nh=l=>{let e=0;const t=[];for(;uu(l,e);){const r=vo(l,e+6);e+=10;const s=e+r;for(;e+8<s;){const o=c0(l.subarray(e)),a=f0(o);a&&t.push(a),e+=o.size+10}bh(l,e)&&(e+=10)}return t},f0=l=>l.type==="PRIV"?d0(l):l.type[0]==="W"?g0(l):h0(l),d0=l=>{if(l.size<2)return;const e=rn(l.data,!0),t=new Uint8Array(l.data.subarray(e.length+1));return{key:l.type,info:e,data:t.buffer}},h0=l=>{if(l.size<2)return;if(l.type==="TXXX"){let t=1;const r=rn(l.data.subarray(t),!0);t+=r.length+1;const s=rn(l.data.subarray(t));return{key:l.type,info:r,data:s}}const e=rn(l.data.subarray(1));return{key:l.type,data:e}},g0=l=>{if(l.type==="WXXX"){if(l.size<2)return;let t=1;const r=rn(l.data.subarray(t),!0);t+=r.length+1;const s=rn(l.data.subarray(t));return{key:l.type,info:r,data:s}}const e=rn(l.data);return{key:l.type,data:e}},m0=l=>{if(l.data.byteLength===8){const e=new Uint8Array(l.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}},rn=(l,e=!1)=>{const t=p0();if(t){const h=t.decode(l);if(e){const g=h.indexOf("\0");return g!==-1?h.substring(0,g):h}return h.replace(/\0/g,"")}const r=l.length;let s,o,a,c="",f=0;for(;f<r;){if(s=l[f++],s===0&&e)return c;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(s);break;case 12:case 13:o=l[f++],c+=String.fromCharCode((s&31)<<6|o&63);break;case 14:o=l[f++],a=l[f++],c+=String.fromCharCode((s&15)<<12|(o&63)<<6|(a&63)<<0);break}}return c};let Rl;function p0(){if(!navigator.userAgent.includes("PlayStation 4"))return!Rl&&typeof self.TextDecoder<"u"&&(Rl=new self.TextDecoder("utf-8")),Rl}const Zt={hexDump:function(l){let e="";for(let t=0;t<l.length;t++){let r=l[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}},uo=Math.pow(2,32)-1,y0=[].push,Mh={video:1,audio:2,id3:3,text:4};function Xe(l){return String.fromCharCode.apply(null,l)}function Uh(l,e){const t=l[e]<<8|l[e+1];return t<0?65536+t:t}function ye(l,e){const t=Bh(l,e);return t<0?4294967296+t:t}function _d(l,e){let t=ye(l,e);return t*=Math.pow(2,32),t+=ye(l,e+4),t}function Bh(l,e){return l[e]<<24|l[e+1]<<16|l[e+2]<<8|l[e+3]}function Il(l,e,t){l[e]=t>>24,l[e+1]=t>>16&255,l[e+2]=t>>8&255,l[e+3]=t&255}function E0(l){const e=l.byteLength;for(let t=0;t<e;){const r=ye(l,t);if(r>8&&l[t+4]===109&&l[t+5]===111&&l[t+6]===111&&l[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Ae(l,e){const t=[];if(!e.length)return t;const r=l.byteLength;for(let s=0;s<r;){const o=ye(l,s),a=Xe(l.subarray(s+4,s+8)),c=o>1?s+o:r;if(a===e[0])if(e.length===1)t.push(l.subarray(s+8,c));else{const f=Ae(l.subarray(s+8,c),e.slice(1));f.length&&y0.apply(t,f)}s=c}return t}function x0(l){const e=[],t=l[0];let r=8;const s=ye(l,r);r+=4;let o=0,a=0;t===0?(o=ye(l,r),a=ye(l,r+4),r+=8):(o=_d(l,r),a=_d(l,r+8),r+=16),r+=2;let c=l.length+a;const f=Uh(l,r);r+=2;for(let h=0;h<f;h++){let g=r;const p=ye(l,g);g+=4;const E=p&2147483647;if((p&2147483648)>>>31===1)return F.warn("SIDX has hierarchical references (not supported)"),null;const x=ye(l,g);g+=4,e.push({referenceSize:E,subsegmentDuration:x,info:{duration:x/s,start:c,end:c+E-1}}),c+=E,g+=4,r=g}return{earliestPresentationTime:o,timescale:s,version:t,referencesCount:f,references:e}}function $h(l){const e=[],t=Ae(l,["moov","trak"]);for(let s=0;s<t.length;s++){const o=t[s],a=Ae(o,["tkhd"])[0];if(a){let c=a[0];const f=ye(a,c===0?12:20),h=Ae(o,["mdia","mdhd"])[0];if(h){c=h[0];const g=ye(h,c===0?12:20),p=Ae(o,["mdia","hdlr"])[0];if(p){const E=Xe(p.subarray(8,12)),T={soun:Fe.AUDIO,vide:Fe.VIDEO}[E];if(T){const x=Ae(o,["mdia","minf","stbl","stsd"])[0],S=T0(x);e[f]={timescale:g,type:T},e[T]=rt({timescale:g,id:f},S)}}}}}return Ae(l,["moov","mvex","trex"]).forEach(s=>{const o=ye(s,4),a=e[o];a&&(a.default={duration:ye(s,12),flags:ye(s,20)})}),e}function T0(l){const e=l.subarray(8),t=e.subarray(86),r=Xe(e.subarray(4,8));let s=r;const o=r==="enca"||r==="encv";if(o){const c=Ae(e,[r])[0].subarray(r==="enca"?28:78);Ae(c,["sinf"]).forEach(h=>{const g=Ae(h,["schm"])[0];if(g){const p=Xe(g.subarray(4,8));if(p==="cbcs"||p==="cenc"){const E=Ae(h,["frma"])[0];E&&(s=Xe(E))}}})}switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const a=Ae(t,["avcC"])[0];s+="."+Hs(a[1])+Hs(a[2])+Hs(a[3]);break}case"mp4a":{const a=Ae(e,[r])[0],c=Ae(a.subarray(28),["esds"])[0];if(c&&c.length>12){let f=4;if(c[f++]!==3)break;f=Cl(c,f),f+=2;const h=c[f++];if(h&128&&(f+=2),h&64&&(f+=c[f++]),c[f++]!==4)break;f=Cl(c,f);const g=c[f++];if(g===64)s+="."+Hs(g);else break;if(f+=12,c[f++]!==5)break;f=Cl(c,f);const p=c[f++];let E=(p&248)>>3;E===31&&(E+=1+((p&7)<<3)+((c[f]&224)>>5)),s+="."+E}break}case"hvc1":case"hev1":{const a=Ae(t,["hvcC"])[0],c=a[1],f=["","A","B","C"][c>>6],h=c&31,g=ye(a,2),p=(c&32)>>5?"H":"L",E=a[12],T=a.subarray(6,12);s+="."+f+h,s+="."+g.toString(16).toUpperCase(),s+="."+p+E;let x="";for(let S=T.length;S--;){const v=T[S];(v||x)&&(x="."+v.toString(16).toUpperCase()+x)}s+=x;break}case"dvh1":case"dvhe":{const a=Ae(t,["dvcC"])[0],c=a[2]>>1&127,f=a[2]<<5&32|a[3]>>3&31;s+="."+Jt(c)+"."+Jt(f);break}case"vp09":{const a=Ae(t,["vpcC"])[0],c=a[4],f=a[5],h=a[6]>>4&15;s+="."+Jt(c)+"."+Jt(f)+"."+Jt(h);break}case"av01":{const a=Ae(t,["av1C"])[0],c=a[1]>>>5,f=a[1]&31,h=a[2]>>>7?"H":"M",g=(a[2]&64)>>6,p=(a[2]&32)>>5,E=c===2&&g?p?12:10:g?10:8,T=(a[2]&16)>>4,x=(a[2]&8)>>3,S=(a[2]&4)>>2,v=a[2]&3;s+="."+c+"."+Jt(f)+h+"."+Jt(E)+"."+T+"."+x+S+v+"."+Jt(1)+"."+Jt(1)+"."+Jt(1)+"."+0;break}}return{codec:s,encrypted:o}}function Cl(l,e){const t=e+5;for(;l[e++]&128&&e<t;);return e}function Hs(l){return("0"+l.toString(16).toUpperCase()).slice(-2)}function Jt(l){return(l<10?"0":"")+l}function S0(l,e){if(!l||!e)return l;const t=e.keyId;return t&&e.isCommonEncryption&&Ae(l,["moov","trak"]).forEach(s=>{const a=Ae(s,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=Ae(a,["enca"]);const f=c.length>0;f||(c=Ae(a,["encv"])),c.forEach(h=>{const g=f?h.subarray(28):h.subarray(78);Ae(g,["sinf"]).forEach(E=>{const T=Gh(E);if(T){const x=T.subarray(8,24);x.some(S=>S!==0)||(F.log(`[eme] Patching keyId in 'enc${f?"a":"v"}>sinf>>tenc' box: ${Zt.hexDump(x)} -> ${Zt.hexDump(t)}`),T.set(t,8))}})})}),l}function Gh(l){const e=Ae(l,["schm"])[0];if(e){const t=Xe(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Ae(l,["schi","tenc"])[0]}return null}function v0(l,e){return Ae(e,["moof","traf"]).reduce((t,r)=>{const s=Ae(r,["tfdt"])[0],o=s[0],a=Ae(r,["tfhd"]).reduce((c,f)=>{const h=ye(f,4),g=l[h];if(g){let p=ye(s,4);if(o===1){if(p===uo)return F.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),c;p*=uo+1,p+=ye(s,8)}const E=g.timescale||9e4,T=p/E;if(se(T)&&(c===null||T<c))return T}return c},null);return a!==null&&se(a)&&(t===null||a<t)?a:t},null)}function L0(l,e){let t=0,r=0,s=0;const o=Ae(l,["moof","traf"]);for(let a=0;a<o.length;a++){const c=o[a],f=Ae(c,["tfhd"])[0],h=ye(f,4),g=e[h];if(!g)continue;const p=g.default,E=ye(f,0)|(p==null?void 0:p.flags);let T=p==null?void 0:p.duration;E&8&&(E&2?T=ye(f,12):T=ye(f,8));const x=g.timescale||9e4,S=Ae(c,["trun"]);for(let v=0;v<S.length;v++){if(t=A0(S[v]),!t&&T){const R=ye(S[v],4);t=T*R}g.type===Fe.VIDEO?r+=t/x:g.type===Fe.AUDIO&&(s+=t/x)}}if(r===0&&s===0){let a=1/0,c=0,f=0;const h=Ae(l,["sidx"]);for(let g=0;g<h.length;g++){const p=x0(h[g]);if(p!=null&&p.references){a=Math.min(a,p.earliestPresentationTime/p.timescale);const E=p.references.reduce((T,x)=>T+x.info.duration||0,0);c=Math.max(c,E+p.earliestPresentationTime/p.timescale),f=c-a}}if(f&&se(f))return f}return r||s}function A0(l){const e=ye(l,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let r=0;const s=ye(l,4);for(let o=0;o<s;o++){if(e&256){const a=ye(l,t);r+=a,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return r}function R0(l,e,t){Ae(e,["moof","traf"]).forEach(r=>{Ae(r,["tfhd"]).forEach(s=>{const o=ye(s,4),a=l[o];if(!a)return;const c=a.timescale||9e4;Ae(r,["tfdt"]).forEach(f=>{const h=f[0],g=t*c;if(g){let p=ye(f,4);if(h===0)p-=g,p=Math.max(p,0),Il(f,4,p);else{p*=Math.pow(2,32),p+=ye(f,8),p-=g,p=Math.max(p,0);const E=Math.floor(p/(uo+1)),T=Math.floor(p%(uo+1));Il(f,4,E),Il(f,8,T)}}})})})}function I0(l){const e={valid:null,remainder:null},t=Ae(l,["moof"]);if(t.length<2)return e.remainder=l,e;const r=t[t.length-1];return e.valid=tr(l,0,r.byteOffset-8),e.remainder=tr(l,r.byteOffset-8),e}function Nt(l,e){const t=new Uint8Array(l.length+e.length);return t.set(l),t.set(e,l.length),t}function Pd(l,e){const t=[],r=e.samples,s=e.timescale,o=e.id;let a=!1;return Ae(r,["moof"]).map(f=>{const h=f.byteOffset-8;Ae(f,["traf"]).map(p=>{const E=Ae(p,["tfdt"]).map(T=>{const x=T[0];let S=ye(T,4);return x===1&&(S*=Math.pow(2,32),S+=ye(T,8)),S/s})[0];return E!==void 0&&(l=E),Ae(p,["tfhd"]).map(T=>{const x=ye(T,4),S=ye(T,0)&16777215,v=(S&1)!==0,R=(S&2)!==0,k=(S&8)!==0;let C=0;const M=(S&16)!==0;let _=0;const V=(S&32)!==0;let U=8;x===o&&(v&&(U+=8),R&&(U+=4),k&&(C=ye(T,U),U+=4),M&&(_=ye(T,U),U+=4),V&&(U+=4),e.type==="video"&&(a=C0(e.codec)),Ae(p,["trun"]).map(j=>{const ee=j[0],H=ye(j,0)&16777215,Q=(H&1)!==0;let ge=0;const te=(H&4)!==0,fe=(H&256)!==0;let de=0;const oe=(H&512)!==0;let he=0;const q=(H&1024)!==0,z=(H&2048)!==0;let K=0;const D=ye(j,4);let $=8;Q&&(ge=ye(j,$),$+=4),te&&($+=4);let re=ge+h;for(let ce=0;ce<D;ce++){if(fe?(de=ye(j,$),$+=4):de=C,oe?(he=ye(j,$),$+=4):he=_,q&&($+=4),z&&(ee===0?K=ye(j,$):K=Bh(j,$),$+=4),e.type===Fe.VIDEO){let xe=0;for(;xe<he;){const Te=ye(r,re);if(re+=4,w0(a,r[re])){const Re=r.subarray(re,re+Te);Kh(Re,a?2:1,l+K/s,t)}re+=Te,xe+=Te+4}}l+=de/s}}))})})}),t}function C0(l){if(!l)return!1;const e=l.indexOf("."),t=e<0?l:l.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function w0(l,e){if(l){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Kh(l,e,t,r){const s=Vh(l);let o=0;o+=e;let a=0,c=0,f=0;for(;o<s.length;){a=0;do{if(o>=s.length)break;f=s[o++],a+=f}while(f===255);c=0;do{if(o>=s.length)break;f=s[o++],c+=f}while(f===255);const h=s.length-o;let g=o;if(c<h)o+=c;else if(c>h){F.error(`Malformed SEI payload. ${c} is too small, only ${h} bytes left to parse.`);break}if(a===4){if(s[g++]===181){const E=Uh(s,g);if(g+=2,E===49){const T=ye(s,g);if(g+=4,T===1195456820){const x=s[g++];if(x===3){const S=s[g++],v=31&S,R=64&S,k=R?2+v*3:0,C=new Uint8Array(k);if(R){C[0]=S;for(let M=1;M<k;M++)C[M]=s[g++]}r.push({type:x,payloadType:a,pts:t,bytes:C})}}}}}else if(a===5&&c>16){const p=[];for(let x=0;x<16;x++){const S=s[g++].toString(16);p.push(S.length==1?"0"+S:S),(x===3||x===5||x===7||x===9)&&p.push("-")}const E=c-16,T=new Uint8Array(E);for(let x=0;x<E;x++)T[x]=s[g++];r.push({payloadType:a,pts:t,uuid:p.join(""),userData:rn(T),userDataBytes:T})}}}function Vh(l){const e=l.byteLength,t=[];let r=1;for(;r<e-2;)l[r]===0&&l[r+1]===0&&l[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return l;const s=e-t.length,o=new Uint8Array(s);let a=0;for(r=0;r<s;a++,r++)a===t[0]&&(a++,t.shift()),o[r]=l[a];return o}function D0(l){const e=l[0];let t="",r="",s=0,o=0,a=0,c=0,f=0,h=0;if(e===0){for(;Xe(l.subarray(h,h+1))!=="\0";)t+=Xe(l.subarray(h,h+1)),h+=1;for(t+=Xe(l.subarray(h,h+1)),h+=1;Xe(l.subarray(h,h+1))!=="\0";)r+=Xe(l.subarray(h,h+1)),h+=1;r+=Xe(l.subarray(h,h+1)),h+=1,s=ye(l,12),o=ye(l,16),c=ye(l,20),f=ye(l,24),h=28}else if(e===1){h+=4,s=ye(l,h),h+=4;const p=ye(l,h);h+=4;const E=ye(l,h);for(h+=4,a=2**32*p+E,jp(a)||(a=Number.MAX_SAFE_INTEGER,F.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=ye(l,h),h+=4,f=ye(l,h),h+=4;Xe(l.subarray(h,h+1))!=="\0";)t+=Xe(l.subarray(h,h+1)),h+=1;for(t+=Xe(l.subarray(h,h+1)),h+=1;Xe(l.subarray(h,h+1))!=="\0";)r+=Xe(l.subarray(h,h+1)),h+=1;r+=Xe(l.subarray(h,h+1)),h+=1}const g=l.subarray(h,l.byteLength);return{schemeIdUri:t,value:r,timeScale:s,presentationTime:a,presentationTimeDelta:o,eventDuration:c,id:f,payload:g}}function k0(l,...e){const t=e.length;let r=8,s=t;for(;s--;)r+=e[s].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(l,4),s=0,r=8;s<t;s++)o.set(e[s],r),r+=e[s].byteLength;return o}function _0(l,e,t){if(l.byteLength!==16)throw new RangeError("Invalid system id");let r,s;r=0,s=new Uint8Array;let o;r>0?(o=new Uint8Array(4),e.length>0&&new DataView(o.buffer).setUint32(0,e.length,!1)):o=new Uint8Array;const a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),k0([112,115,115,104],new Uint8Array([r,0,0,0]),l,o,s,a,t||new Uint8Array)}function P0(l){const e=[];if(l instanceof ArrayBuffer){const t=l.byteLength;let r=0;for(;r+32<t;){const s=new DataView(l,r),o=F0(s);e.push(o),r+=o.size}}return e}function F0(l){const e=l.getUint32(0),t=l.byteOffset,r=l.byteLength;if(r<e)return{offset:t,size:r};if(l.getUint32(4)!==1886614376)return{offset:t,size:e};const o=l.getUint32(8)>>>24;if(o!==0&&o!==1)return{offset:t,size:e};const a=l.buffer,c=Zt.hexDump(new Uint8Array(a,t+12,16)),f=l.getUint32(28);let h=null,g=null;if(o===0){if(e-32<f||f<22)return{offset:t,size:e};g=new Uint8Array(a,t+32,f)}else if(o===1){if(!f||r<t+32+f*16+16)return{offset:t,size:e};h=[];for(let p=0;p<f;p++)h.push(new Uint8Array(a,t+32+p*16,16))}return{version:o,systemId:c,kids:h,data:g,offset:t,size:e}}let zs={};class Di{static clearKeyUriToKeyIdMap(){zs={}}constructor(e,t,r,s=[1],o=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=o,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case St.FAIRPLAY:case St.WIDEVINE:case St.PLAYREADY:case St.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&F.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=b0(e);return new Di(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=o0(this.uri);if(t)switch(this.keyFormat){case St.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case St.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=_0(r,null,t),this.keyId=Fh(t);break}default:{let r=t.subarray(0,16);if(r.length!==16){const s=new Uint8Array(16);s.set(r,16-r.length),r=s}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=zs[this.uri];if(!r){const s=Object.keys(zs).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,s),zs[this.uri]=r}this.keyId=r}return this}}function b0(l){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=l>>8*(15-t)&255;return e}const Hh=/\{\$([a-zA-Z0-9-_]+)\}/g;function Fd(l){return Hh.test(l)}function Tt(l,e,t){if(l.variableList!==null||l.hasVariableRefs)for(let r=t.length;r--;){const s=t[r],o=e[s];o&&(e[s]=jl(l,o))}}function jl(l,e){if(l.variableList!==null||l.hasVariableRefs){const t=l.variableList;return e.replace(Hh,r=>{const s=r.substring(2,r.length-1),o=t==null?void 0:t[s];return o===void 0?(l.playlistParsingError||(l.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),r):o})}return e}function bd(l,e,t){let r=l.variableList;r||(l.variableList=r={});let s,o;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(s))o=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,o=e.VALUE;s in r?l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):r[s]=o||""}function O0(l,e,t){const r=e.IMPORT;if(t&&r in t){let s=l.variableList;s||(l.variableList=s={}),s[r]=t[r]}else l.playlistParsingError||(l.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function nr(l=!0){return typeof self>"u"?void 0:(l||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function N0(l){return typeof self<"u"&&l===self.ManagedMediaSource}const co={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function M0(l,e){const t=co[e];return!!t&&!!t[l.slice(0,4)]}function wl(l,e,t=!0){return!l.split(",").some(r=>!zh(r,e,t))}function zh(l,e,t=!0){var r;const s=nr(t);return(r=s==null?void 0:s.isTypeSupported(ki(l,e)))!=null?r:!1}function ki(l,e){return`${e}/mp4;codecs="${l}"`}function Od(l){if(l){const e=l.substring(0,4);return co.video[e]}return 2}function fo(l){return l.split(",").reduce((e,t)=>{const r=co.video[t];return r?(r*2+e)/(e?3:2):(co.audio[t]+e)/(e?2:1)},0)}const Dl={};function U0(l,e=!0){if(Dl[l])return Dl[l];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[l];for(let r=0;r<t.length;r++)if(zh(t[r],"audio",e))return Dl[l]=t[r],t[r];return l}const B0=/flac|opus/i;function ho(l,e=!0){return l.replace(B0,t=>U0(t.toLowerCase(),e))}function Nd(l,e){return l&&l!=="mp4a"?l:e&&e.split(",")[0]}function $0(l){const e=l.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");if(r.length>2){let s=r.shift()+".";s+=parseInt(r.shift()).toString(16),s+=("000"+parseInt(r.shift()).toString(16)).slice(-4),e[t]=s}}return e.join(",")}const Md=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Ud=/#EXT-X-MEDIA:(.*)/g,G0=/^#EXT(?:INF|-X-TARGETDURATION):/m,Bd=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),K0=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class tn{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return au.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return G0.test(e)}static parseMasterPlaylist(e,t){const r=Fd(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},o=[];Md.lastIndex=0;let a;for(;(a=Md.exec(e))!=null;)if(a[1]){var c;const h=new Ke(a[1]);Tt(s,h,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const g=jl(s,a[2]),p={attrs:h,bitrate:h.decimalInteger("BANDWIDTH")||h.decimalInteger("AVERAGE-BANDWIDTH"),name:h.NAME,url:tn.resolve(g,t)},E=h.decimalResolution("RESOLUTION");E&&(p.width=E.width,p.height=E.height),V0(h.CODECS,p),(c=p.unknownCodecs)!=null&&c.length||o.push(p),s.levels.push(p)}else if(a[3]){const h=a[3],g=a[4];switch(h){case"SESSION-DATA":{const p=new Ke(g);Tt(s,p,["DATA-ID","LANGUAGE","VALUE","URI"]);const E=p["DATA-ID"];E&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[E]=p);break}case"SESSION-KEY":{const p=$d(g,t,s);p.encrypted&&p.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(p)):F.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const p=new Ke(g);Tt(s,p,["NAME","VALUE","QUERYPARAM"]),bd(s,p,t)}break}case"CONTENT-STEERING":{const p=new Ke(g);Tt(s,p,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={uri:tn.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=Gd(g);break}}}const f=o.length>0&&o.length<s.levels.length;return s.levels=f?o:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,r){let s;const o={},a=r.levels,c={AUDIO:a.map(h=>({id:h.attrs.AUDIO,audioCodec:h.audioCodec})),SUBTITLES:a.map(h=>({id:h.attrs.SUBTITLES,textCodec:h.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for(Ud.lastIndex=0;(s=Ud.exec(e))!==null;){const h=new Ke(s[1]),g=h.TYPE;if(g){const p=c[g],E=o[g]||[];o[g]=E,Tt(r,h,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const T=h.LANGUAGE,x=h["ASSOC-LANGUAGE"],S=h.CHANNELS,v=h.CHARACTERISTICS,R=h["INSTREAM-ID"],k={attrs:h,bitrate:0,id:f++,groupId:h["GROUP-ID"]||"",name:h.NAME||T||"",type:g,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:T,url:h.URI?tn.resolve(h.URI,t):""};if(x&&(k.assocLang=x),S&&(k.channels=S),v&&(k.characteristics=v),R&&(k.instreamId=R),p!=null&&p.length){const C=tn.findGroup(p,k.groupId)||p[0];Kd(k,C,"audioCodec"),Kd(k,C,"textCodec")}E.push(k)}}return o}static parseLevelPlaylist(e,t,r,s,o,a){const c=new r0(t),f=c.fragments;let h=null,g=0,p=0,E=0,T=0,x=null,S=new Sl(s,t),v,R,k,C=-1,M=!1,_=null;for(Bd.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Fd(e);(v=Bd.exec(e))!==null;){M&&(M=!1,S=new Sl(s,t),S.start=E,S.sn=g,S.cc=T,S.level=r,h&&(S.initSegment=h,S.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null,_&&(S.setByteRange(_),_=null)));const ee=v[1];if(ee){S.duration=parseFloat(ee);const H=(" "+v[2]).slice(1);S.title=H||null,S.tagList.push(H?["INF",ee,H]:["INF",ee])}else if(v[3]){if(se(S.duration)){S.start=E,k&&zd(S,k,c),S.sn=g,S.level=r,S.cc=T,f.push(S);const H=(" "+v[3]).slice(1);S.relurl=jl(c,H),Vd(S,x),x=S,E+=S.duration,g++,p=0,M=!0}}else if(v[4]){const H=(" "+v[4]).slice(1);x?S.setByteRange(H,x):S.setByteRange(H)}else if(v[5])S.rawProgramDateTime=(" "+v[5]).slice(1),S.tagList.push(["PROGRAM-DATE-TIME",S.rawProgramDateTime]),C===-1&&(C=f.length);else{if(v=v[0].match(K0),!v){F.warn("No matches on slow regex match for level playlist!");continue}for(R=1;R<v.length&&!(typeof v[R]<"u");R++);const H=(" "+v[R]).slice(1),Q=(" "+v[R+1]).slice(1),ge=v[R+2]?(" "+v[R+2]).slice(1):"";switch(H){case"PLAYLIST-TYPE":c.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":g=c.startSN=parseInt(Q);break;case"SKIP":{const te=new Ke(Q);Tt(c,te,["RECENTLY-REMOVED-DATERANGES"]);const fe=te.decimalInteger("SKIPPED-SEGMENTS");if(se(fe)){c.skippedSegments=fe;for(let oe=fe;oe--;)f.unshift(null);g+=fe}const de=te.enumeratedString("RECENTLY-REMOVED-DATERANGES");de&&(c.recentlyRemovedDateranges=de.split("	"));break}case"TARGETDURATION":c.targetduration=Math.max(parseInt(Q),1);break;case"VERSION":c.version=parseInt(Q);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(Q||ge)&&S.tagList.push(ge?[Q,ge]:[Q]);break;case"DISCONTINUITY":T++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([H]);break;case"BITRATE":S.tagList.push([H,Q]);break;case"DATERANGE":{const te=new Ke(Q);Tt(c,te,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Tt(c,te,te.clientAttrs);const fe=new kh(te,c.dateRanges[te.ID]);fe.isValid||c.skippedSegments?c.dateRanges[fe.id]=fe:F.warn(`Ignoring invalid DATERANGE tag: "${Q}"`),S.tagList.push(["EXT-X-DATERANGE",Q]);break}case"DEFINE":{{const te=new Ke(Q);Tt(c,te,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in te?O0(c,te,a):bd(c,te,t)}break}case"DISCONTINUITY-SEQUENCE":T=parseInt(Q);break;case"KEY":{const te=$d(Q,t,c);if(te.isSupported()){if(te.method==="NONE"){k=void 0;break}k||(k={}),k[te.keyFormat]&&(k=je({},k)),k[te.keyFormat]=te}else F.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${Q}"`);break}case"START":c.startTimeOffset=Gd(Q);break;case"MAP":{const te=new Ke(Q);if(Tt(c,te,["BYTERANGE","URI"]),S.duration){const fe=new Sl(s,t);Hd(fe,te,r,k),h=fe,S.initSegment=h,h.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=h.rawProgramDateTime)}else{const fe=S.byteRangeEndOffset;if(fe){const de=S.byteRangeStartOffset;_=`${fe-de}@${de}`}else _=null;Hd(S,te,r,k),h=S,M=!0}break}case"SERVER-CONTROL":{const te=new Ke(Q);c.canBlockReload=te.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=te.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&te.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=te.optionalFloat("PART-HOLD-BACK",0),c.holdBack=te.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const te=new Ke(Q);c.partTarget=te.decimalFloatingPoint("PART-TARGET");break}case"PART":{let te=c.partList;te||(te=c.partList=[]);const fe=p>0?te[te.length-1]:void 0,de=p++,oe=new Ke(Q);Tt(c,oe,["BYTERANGE","URI"]);const he=new t0(oe,S,t,de,fe);te.push(he),S.duration+=he.duration;break}case"PRELOAD-HINT":{const te=new Ke(Q);Tt(c,te,["URI"]),c.preloadHint=te;break}case"RENDITION-REPORT":{const te=new Ke(Q);Tt(c,te,["URI"]),c.renditionReports=c.renditionReports||[],c.renditionReports.push(te);break}default:F.warn(`line parsed but not handled: ${v}`);break}}}x&&!x.relurl?(f.pop(),E-=x.duration,c.partList&&(c.fragmentHint=x)):c.partList&&(Vd(S,x),S.cc=T,c.fragmentHint=S,k&&zd(S,k,c));const V=f.length,U=f[0],j=f[V-1];if(E+=c.skippedSegments*c.targetduration,E>0&&V&&j){c.averagetargetduration=E/V;const ee=j.sn;c.endSN=ee!=="initSegment"?ee:0,c.live||(j.endList=!0),U&&(c.startCC=U.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(E+=c.fragmentHint.duration),c.totalduration=E,c.endCC=T,C>0&&H0(f,C),c}}function $d(l,e,t){var r,s;const o=new Ke(l);Tt(t,o,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=(r=o.METHOD)!=null?r:"",c=o.URI,f=o.hexadecimalInteger("IV"),h=o.KEYFORMATVERSIONS,g=(s=o.KEYFORMAT)!=null?s:"identity";c&&o.IV&&!f&&F.error(`Invalid IV: ${o.IV}`);const p=c?tn.resolve(c,e):"",E=(h||"1").split("/").map(Number).filter(Number.isFinite);return new Di(a,p,g,E,f)}function Gd(l){const t=new Ke(l).decimalFloatingPoint("TIME-OFFSET");return se(t)?t:null}function V0(l,e){let t=(l||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const s=t.filter(o=>M0(o,r));s.length&&(e[`${r}Codec`]=s.join(","),t=t.filter(o=>s.indexOf(o)===-1))}),e.unknownCodecs=t}function Kd(l,e,t){const r=e[t];r&&(l[t]=r)}function H0(l,e){let t=l[e];for(let r=e;r--;){const s=l[r];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Vd(l,e){l.rawProgramDateTime?l.programDateTime=Date.parse(l.rawProgramDateTime):e!=null&&e.programDateTime&&(l.programDateTime=e.endProgramDateTime),se(l.programDateTime)||(l.programDateTime=null,l.rawProgramDateTime=null)}function Hd(l,e,t,r){l.relurl=e.URI,e.BYTERANGE&&l.setByteRange(e.BYTERANGE),l.level=t,l.sn="initSegment",r&&(l.levelkeys=r),l.initSegment=null}function zd(l,e,t){l.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&r.push(l)}var we={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ee={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Wd(l){const{type:e}=l;switch(e){case we.AUDIO_TRACK:return Ee.AUDIO;case we.SUBTITLE_TRACK:return Ee.SUBTITLE;default:return Ee.MAIN}}function kl(l,e){let t=l.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class z0{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,o=r||s,a=new o(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:we.MANIFEST,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:o,url:a,deliveryDirectives:c}=t;this.load({id:r,level:s,pathwayId:o,responseType:"text",type:we.LEVEL,url:a,deliveryDirectives:c})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:o,deliveryDirectives:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:we.AUDIO_TRACK,url:o,deliveryDirectives:a})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:o,deliveryDirectives:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:we.SUBTITLE_TRACK,url:o,deliveryDirectives:a})}load(e){var t;const r=this.hls.config;let s=this.getInternalLoader(e);if(s){const h=s.context;if(h&&h.url===e.url&&h.level===e.level){F.trace("[playlist-loader]: playlist request ongoing");return}F.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let o;if(e.type===we.MANIFEST?o=r.manifestLoadPolicy.default:o=je({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),se((t=e.deliveryDirectives)==null?void 0:t.part)){let h;if(e.type===we.LEVEL&&e.level!==null?h=this.hls.levels[e.level].details:e.type===we.AUDIO_TRACK&&e.id!==null?h=this.hls.audioTracks[e.id].details:e.type===we.SUBTITLE_TRACK&&e.id!==null&&(h=this.hls.subtitleTracks[e.id].details),h){const g=h.partTarget,p=h.targetduration;if(g&&p){const E=Math.max(g*3,p*.8)*1e3;o=je({},o,{maxTimeToFirstByteMs:Math.min(E,o.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(E,o.maxTimeToFirstByteMs)})}}}const a=o.errorRetry||o.timeoutRetry||{},c={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},f={onSuccess:(h,g,p,E)=>{const T=this.getInternalLoader(p);this.resetInternalLoader(p.type);const x=h.data;if(x.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(h,p,new Error("no EXTM3U delimiter"),E||null,g);return}g.parsing.start=performance.now(),tn.isMediaPlaylist(x)?this.handleTrackOrLevelPlaylist(h,g,p,E||null,T):this.handleMasterPlaylist(h,g,p,E)},onError:(h,g,p,E)=>{this.handleNetworkError(g,p,!1,h,E)},onTimeout:(h,g,p)=>{this.handleNetworkError(g,p,!0,void 0,h)}};s.load(e,c,f)}handleMasterPlaylist(e,t,r,s){const o=this.hls,a=e.data,c=kl(e,r),f=tn.parseMasterPlaylist(a,c);if(f.playlistParsingError){this.handleManifestParsingError(e,r,f.playlistParsingError,s,t);return}const{contentSteering:h,levels:g,sessionData:p,sessionKeys:E,startTimeOffset:T,variableList:x}=f;this.variableList=x;const{AUDIO:S=[],SUBTITLES:v,"CLOSED-CAPTIONS":R}=tn.parseMasterPlaylistMedia(a,c,f);S.length&&!S.some(C=>!C.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(F.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ke({}),bitrate:0,url:""})),o.trigger(L.MANIFEST_LOADED,{levels:g,audioTracks:S,subtitles:v,captions:R,contentSteering:h,url:c,stats:t,networkDetails:s,sessionData:p,sessionKeys:E,startTimeOffset:T,variableList:x})}handleTrackOrLevelPlaylist(e,t,r,s,o){const a=this.hls,{id:c,level:f,type:h}=r,g=kl(e,r),p=0,E=se(f)?f:se(c)?c:0,T=Wd(r),x=tn.parseLevelPlaylist(e.data,g,E,T,p,this.variableList);if(h===we.MANIFEST){const S={attrs:new Ke({}),bitrate:0,details:x,name:"",url:g};a.trigger(L.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:g,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=x,this.handlePlaylistLoaded(x,e,t,r,s,o)}handleManifestParsingError(e,t,r,s,o){this.hls.trigger(L.ERROR,{type:Se.NETWORK_ERROR,details:G.MANIFEST_PARSING_ERROR,fatal:t.type===we.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:o})}handleNetworkError(e,t,r=!1,s,o){let a=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===we.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===we.AUDIO_TRACK||e.type===we.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(a);F.warn(`[playlist-loader]: ${a}`);let f=G.UNKNOWN,h=!1;const g=this.getInternalLoader(e);switch(e.type){case we.MANIFEST:f=r?G.MANIFEST_LOAD_TIMEOUT:G.MANIFEST_LOAD_ERROR,h=!0;break;case we.LEVEL:f=r?G.LEVEL_LOAD_TIMEOUT:G.LEVEL_LOAD_ERROR,h=!1;break;case we.AUDIO_TRACK:f=r?G.AUDIO_TRACK_LOAD_TIMEOUT:G.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case we.SUBTITLE_TRACK:f=r?G.SUBTITLE_TRACK_LOAD_TIMEOUT:G.SUBTITLE_LOAD_ERROR,h=!1;break}g&&this.resetInternalLoader(e.type);const p={type:Se.NETWORK_ERROR,details:f,fatal:h,url:e.url,loader:g,context:e,error:c,networkDetails:t,stats:o};if(s){const E=(t==null?void 0:t.url)||e.url;p.response=rt({url:E,data:void 0},s)}this.hls.trigger(L.ERROR,p)}handlePlaylistLoaded(e,t,r,s,o,a){const c=this.hls,{type:f,level:h,id:g,groupId:p,deliveryDirectives:E}=s,T=kl(t,s),x=Wd(s),S=typeof s.level=="number"&&x===Ee.MAIN?h:void 0;if(!e.fragments.length){const R=new Error("No Segments found in Playlist");c.trigger(L.ERROR,{type:Se.NETWORK_ERROR,details:G.LEVEL_EMPTY_ERROR,fatal:!1,url:T,error:R,reason:R.message,response:t,context:s,level:S,parent:x,networkDetails:o,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const v=e.playlistParsingError;if(v){c.trigger(L.ERROR,{type:Se.NETWORK_ERROR,details:G.LEVEL_PARSING_ERROR,fatal:!1,url:T,error:v,reason:v.message,response:t,context:s,level:S,parent:x,networkDetails:o,stats:r});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),f){case we.MANIFEST:case we.LEVEL:c.trigger(L.LEVEL_LOADED,{details:e,level:S||0,id:g||0,stats:r,networkDetails:o,deliveryDirectives:E});break;case we.AUDIO_TRACK:c.trigger(L.AUDIO_TRACK_LOADED,{details:e,id:g||0,groupId:p||"",stats:r,networkDetails:o,deliveryDirectives:E});break;case we.SUBTITLE_TRACK:c.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,id:g||0,groupId:p||"",stats:r,networkDetails:o,deliveryDirectives:E});break}}}function Wh(l,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=l,e.dispatchEvent(t)}function jh(l,e){const t=l.mode;if(t==="disabled"&&(l.mode="hidden"),l.cues&&!l.cues.getCueById(e.id))try{if(l.addCue(e),!l.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){F.debug(`[texttrack-utils]: ${r}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,l.addCue(s)}catch(s){F.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(l.mode=t)}function Fr(l){const e=l.mode;if(e==="disabled"&&(l.mode="hidden"),l.cues)for(let t=l.cues.length;t--;)l.removeCue(l.cues[t]);e==="disabled"&&(l.mode=e)}function Yl(l,e,t,r){const s=l.mode;if(s==="disabled"&&(l.mode="hidden"),l.cues&&l.cues.length>0){const o=j0(l.cues,e,t);for(let a=0;a<o.length;a++)(!r||r(o[a]))&&l.removeCue(o[a])}s==="disabled"&&(l.mode=s)}function W0(l,e){if(e<l[0].startTime)return 0;const t=l.length-1;if(e>l[t].endTime)return-1;let r=0,s=t;for(;r<=s;){const o=Math.floor((s+r)/2);if(e<l[o].startTime)s=o-1;else if(e>l[o].startTime&&r<t)r=o+1;else return o}return l[r].startTime-e<e-l[s].startTime?r:s}function j0(l,e,t){const r=[],s=W0(l,e);if(s>-1)for(let o=s,a=l.length;o<a;o++){const c=l[o];if(c.startTime>=e&&c.endTime<=t)r.push(c);else if(c.startTime>t)return r}return r}function to(l){const e=[];for(let t=0;t<l.length;t++){const r=l[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(l[t])}return e}var Wt={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const Y0=.25;function ql(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function jd(l,e,t,r,s){let o=new l(e,t,"");try{o.value=r,s&&(o.type=s)}catch{o=new l(e,t,JSON.stringify(s?rt({type:s},r):r))}return o}const Ws=(()=>{const l=ql();try{l&&new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function _l(l,e){return l.getTime()/1e3-e}function q0(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class X0{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Fr(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return Wh(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:s}}}=this;if(!r&&!s)return;const{samples:o}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=ql();if(a)for(let c=0;c<o.length;c++){const f=o[c].type;if(f===Wt.emsg&&!r||!s)continue;const h=Nh(o[c].data);if(h){const g=o[c].pts;let p=g+o[c].duration;p>Ws&&(p=Ws),p-g<=0&&(p=g+Y0);for(let T=0;T<h.length;T++){const x=h[T];if(!Oh(x)){this.updateId3CueEnds(g,f);const S=jd(a,g,p,x,f);S&&this.id3Track.addCue(S)}}}}}updateId3CueEnds(e,t){var r;const s=(r=this.id3Track)==null?void 0:r.cues;if(s)for(let o=s.length;o--;){const a=s[o];a.type===t&&a.startTime<e&&a.endTime===Ws&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:o,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:f}}=a;if(o&&(c||f)){let h;s==="audio"?h=g=>g.type===Wt.audioId3&&f:s==="video"?h=g=>g.type===Wt.emsg&&c:h=g=>g.type===Wt.audioId3&&f||g.type===Wt.emsg&&c,Yl(o,t,r,h)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:s}=this,{dateRanges:o}=t,a=Object.keys(o);if(s){const g=Object.keys(r).filter(p=>!a.includes(p));for(let p=g.length;p--;){const E=g[p];Object.keys(r[E].cues).forEach(T=>{s.removeCue(r[E].cues[T])}),delete r[E]}}const c=t.fragments[t.fragments.length-1];if(a.length===0||!se(c==null?void 0:c.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const f=c.programDateTime/1e3-c.start,h=ql();for(let g=0;g<a.length;g++){const p=a[g],E=o[p],T=_l(E.startDate,f),x=r[p],S=(x==null?void 0:x.cues)||{};let v=(x==null?void 0:x.durationKnown)||!1,R=Ws;const k=E.endDate;if(k)R=_l(k,f),v=!0;else if(E.endOnNext&&!v){const M=a.reduce((_,V)=>{if(V!==E.id){const U=o[V];if(U.class===E.class&&U.startDate>E.startDate&&(!_||E.startDate<_.startDate))return U}return _},null);M&&(R=_l(M.startDate,f),v=!0)}const C=Object.keys(E.attr);for(let M=0;M<C.length;M++){const _=C[M];if(!Zp(_))continue;const V=S[_];if(V)v&&!x.durationKnown&&(V.endTime=R);else if(h){let U=E.attr[_];e0(_)&&(U=q0(U));const j=jd(h,T,R,{key:_,data:U},Wt.dateRange);j&&(j.id=p,this.id3Track.addCue(j),S[_]=j)}}r[p]={cues:S,dateRange:E,durationKnown:v}}}}class Q0{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:o,liveSyncDurationCount:a,lowLatencyMode:c}=this.config,f=this.hls.userConfig;let h=c&&r||t;(f.liveSyncDuration||f.liveSyncDurationCount||h===0)&&(h=o!==void 0?o:a*s);const g=s;return h+Math.min(this.stallCount*1,g)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;const s=r.edge,o=e-t-this.edgeStalled,a=s-r.totalduration,c=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,o),c)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(L.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===G.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&F.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:o}=this.config;if(!s||o===1||!t.live)return;const a=this.targetLatency;if(a===null)return;const c=r-a,f=Math.min(this.maxLatency,a+t.targetduration);if(c<f&&c>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,o)),p=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20;e.playbackRate=Math.min(g,Math.max(1,p))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const Xl=["NONE","TYPE-0","TYPE-1",null];function J0(l){return Xl.indexOf(l)>-1}const go=["SDR","PQ","HLG"];function Z0(l){return!!l&&go.indexOf(l)>-1}var no={No:"",Yes:"YES",v2:"v2"};function Yd(l){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=l,s=r<e/2;return e&&s?t?no.v2:no.Yes:no.No}class qd{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Mr{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Xd(this._audioGroups,e)}hasSubtitleGroup(e){return Xd(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Xd(l,e){return!e||!l?!1:l.indexOf(e)!==-1}function Pl(l,e){const t=e.startPTS;if(se(t)){let r=0,s;e.sn>l.sn?(r=t-l.start,s=l):(r=l.start-t,s=e),s.duration!==r&&(s.duration=r)}else e.sn>l.sn?l.cc===e.cc&&l.minEndPTS?e.start=l.start+(l.minEndPTS-l.start):e.start=l.start+l.duration:e.start=Math.max(l.start-e.duration,0)}function Yh(l,e,t,r,s,o){r-t<=0&&(F.warn("Fragment should have a positive duration",e),r=t+e.duration,o=s+e.duration);let c=t,f=r;const h=e.startPTS,g=e.endPTS;if(se(h)){const v=Math.abs(h-t);se(e.deltaPTS)?e.deltaPTS=Math.max(v,e.deltaPTS):e.deltaPTS=v,c=Math.max(t,h),t=Math.min(t,h),s=Math.min(s,e.startDTS),f=Math.min(r,g),r=Math.max(r,g),o=Math.max(o,e.endDTS)}const p=t-e.start;e.start!==0&&(e.start=t),e.duration=r-e.start,e.startPTS=t,e.maxStartPTS=c,e.startDTS=s,e.endPTS=r,e.minEndPTS=f,e.endDTS=o;const E=e.sn;if(!l||E<l.startSN||E>l.endSN)return 0;let T;const x=E-l.startSN,S=l.fragments;for(S[x]=e,T=x;T>0;T--)Pl(S[T],S[T-1]);for(T=x;T<S.length-1;T++)Pl(S[T],S[T+1]);return l.fragmentHint&&Pl(S[S.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,p}function ey(l,e){let t=null;const r=l.fragments;for(let c=r.length-1;c>=0;c--){const f=r[c].initSegment;if(f){t=f;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;let s;ry(l,e,(c,f,h,g)=>{if(e.skippedSegments&&f.cc!==c.cc){const p=c.cc-f.cc;for(let E=h;E<g.length;E++)g[E].cc+=p}se(c.startPTS)&&se(c.endPTS)&&(f.start=f.startPTS=c.startPTS,f.startDTS=c.startDTS,f.maxStartPTS=c.maxStartPTS,f.endPTS=c.endPTS,f.endDTS=c.endDTS,f.minEndPTS=c.minEndPTS,f.duration=c.endPTS-c.startPTS,f.duration&&(s=f),e.PTSKnown=e.alignedSliding=!0),f.elementaryStreams=c.elementaryStreams,f.loader=c.loader,f.stats=c.stats,c.initSegment&&(f.initSegment=c.initSegment,t=c.initSegment)});const o=e.fragments;if(t&&(e.fragmentHint?o.concat(e.fragmentHint):o).forEach(f=>{var h;f&&(!f.initSegment||f.initSegment.relurl===((h=t)==null?void 0:h.relurl))&&(f.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(c=>!c),e.deltaUpdateFailed){F.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)o.shift();e.startSN=o[0].sn}else e.canSkipDateRanges&&(e.dateRanges=ty(l.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));e.startCC=e.fragments[0].cc,e.endCC=o[o.length-1].cc}ny(l.partList,e.partList,(c,f)=>{f.elementaryStreams=c.elementaryStreams,f.stats=c.stats}),s?Yh(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):qh(l,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=l.driftStartTime,e.driftStart=l.driftStart;const a=e.advancedDateTime;if(e.advanced&&a){const c=e.edge;e.driftStart||(e.driftStartTime=a,e.driftStart=c),e.driftEndTime=a,e.driftEnd=c}else e.driftEndTime=l.driftEndTime,e.driftEnd=l.driftEnd,e.advancedDateTime=l.advancedDateTime}function ty(l,e,t){const r=je({},l);return t&&t.forEach(s=>{delete r[s]}),Object.keys(e).forEach(s=>{const o=new kh(e[s].attr,r[s]);o.isValid?r[s]=o:F.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[s].attr)}"`)}),r}function ny(l,e,t){if(l&&e){let r=0;for(let s=0,o=l.length;s<=o;s++){const a=l[s],c=e[s+r];a&&c&&a.index===c.index&&a.fragment.sn===c.fragment.sn?t(a,c):r--}}}function ry(l,e,t){const r=e.skippedSegments,s=Math.max(l.startSN,e.startSN)-e.startSN,o=(l.fragmentHint?1:0)+(r?e.endSN:Math.min(l.endSN,e.endSN))-e.startSN,a=e.startSN-l.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments;for(let h=s;h<=o;h++){const g=f[a+h];let p=c[h];r&&!p&&h<r&&(p=e.fragments[h]=g),g&&p&&t(g,p,h,c)}}function qh(l,e){const t=e.startSN+e.skippedSegments-l.startSN,r=l.fragments;t<0||t>=r.length||Ql(e,r[t].start)}function Ql(l,e){if(e){const t=l.fragments;for(let r=l.skippedSegments;r<t.length;r++)t[r].start+=e;l.fragmentHint&&(l.fragmentHint.start+=e)}}function iy(l,e=1/0){let t=1e3*l.targetduration;if(l.updated){const r=l.fragments;if(r.length&&t*4>e){const o=r[r.length-1].duration*1e3;o<t&&(t=o)}}else t/=2;return Math.round(t)}function sy(l,e,t){if(!(l!=null&&l.details))return null;const r=l.details;let s=r.fragments[e-r.startSN];return s||(s=r.fragmentHint,s&&s.sn===e)?s:e<r.startSN&&t&&t.sn===e?t:null}function Qd(l,e,t){var r;return l!=null&&l.details?Xh((r=l.details)==null?void 0:r.partList,e,t):null}function Xh(l,e,t){if(l)for(let r=l.length;r--;){const s=l[r];if(s.index===t&&s.fragment.sn===e)return s}return null}function Qh(l){l.forEach((e,t)=>{const{details:r}=e;r!=null&&r.fragments&&r.fragments.forEach(s=>{s.level=t})})}function mo(l){switch(l.details){case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_TIMEOUT:case G.LEVEL_LOAD_TIMEOUT:case G.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Jd(l,e){const t=mo(e);return l.default[`${t?"timeout":"error"}Retry`]}function fu(l,e){const t=l.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*l.retryDelayMs,l.maxRetryDelayMs)}function Zd(l){return rt(rt({},l),{errorRetry:null,timeoutRetry:null})}function po(l,e,t,r){if(!l)return!1;const s=r==null?void 0:r.code,o=e<l.maxNumRetry&&(oy(s)||!!t);return l.shouldRetry?l.shouldRetry(l,e,t,r,o):o}function oy(l){return l===0&&navigator.onLine===!1||!!l&&(l<400||l>499)}const Jh={search:function(l,e){let t=0,r=l.length-1,s=null,o=null;for(;t<=r;){s=(t+r)/2|0,o=l[s];const a=e(o);if(a>0)t=s+1;else if(a<0)r=s-1;else return o}return null}};function ay(l,e,t){if(e===null||!Array.isArray(l)||!l.length||!se(e))return null;const r=l[0].programDateTime;if(e<(r||0))return null;const s=l[l.length-1].endProgramDateTime;if(e>=(s||0))return null;t=t||0;for(let o=0;o<l.length;++o){const a=l[o];if(uy(e,t,a))return a}return null}function yo(l,e,t=0,r=0,s=.005){let o=null;if(l){o=e[l.sn-e[0].sn+1]||null;const c=l.endDTS-t;c>0&&c<15e-7&&(t+=15e-7)}else t===0&&e[0].start===0&&(o=e[0]);if(o&&((!l||l.level===o.level)&&Jl(t,r,o)===0||ly(o,l,Math.min(s,r))))return o;const a=Jh.search(e,Jl.bind(null,t,r));return a&&(a!==l||!o)?a:o}function ly(l,e,t){if(e&&e.start===0&&e.level<l.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((s,o)=>(o[0]==="INF"&&(s+=parseFloat(o[1])),s),t);return l.start<=r}return!1}function Jl(l=0,e=0,t){if(t.start<=l&&t.start+t.duration>l)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=l?1:t.start-r>l&&t.start?-1:0}function uy(l,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>l}function cy(l,e){return Jh.search(l,t=>t.cc<e?1:t.cc>e?-1:0)}var ot={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Ht={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class fy{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=F.log.bind(F,"[info]:"),this.warn=F.warn.bind(F,"[warning]:"),this.error=F.error.bind(F,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Ee.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,s;if(t.fatal)return;const o=this.hls,a=t.context;switch(t.details){case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case G.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction={action:ot.DoNothing,flags:Ht.None};return}case G.FRAG_GAP:case G.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ot.SendAlternateToPenaltyBox;return}case G.LEVEL_EMPTY_ERROR:case G.LEVEL_PARSING_ERROR:{var c,f;const h=t.parent===Ee.MAIN?t.level:o.loadLevel;t.details===G.LEVEL_EMPTY_ERROR&&((c=t.context)!=null&&(f=c.levelDetails)!=null&&f.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case G.LEVEL_LOAD_ERROR:case G.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case G.AUDIO_TRACK_LOAD_ERROR:case G.AUDIO_TRACK_LOAD_TIMEOUT:case G.SUBTITLE_LOAD_ERROR:case G.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const h=o.levels[o.loadLevel];if(h&&(a.type===we.AUDIO_TRACK&&h.hasAudioGroup(a.groupId)||a.type===we.SUBTITLE_TRACK&&h.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.loadLevel),t.errorAction.action=ot.SendAlternateToPenaltyBox,t.errorAction.flags=Ht.MoveAllAlternatesMatchingHost;return}}return;case G.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const h=o.levels[o.loadLevel],g=h==null?void 0:h.attrs["HDCP-LEVEL"];g?t.errorAction={action:ot.SendAlternateToPenaltyBox,flags:Ht.MoveAllAlternatesMatchingHDCP,hdcpLevel:g}:this.keySystemError(t)}return;case G.BUFFER_ADD_CODEC_ERROR:case G.REMUX_ALLOC_ERROR:case G.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,(s=t.level)!=null?s:o.loadLevel);return;case G.INTERNAL_EXCEPTION:case G.BUFFER_APPENDING_ERROR:case G.BUFFER_FULL_ERROR:case G.LEVEL_SWITCH_ERROR:case G.BUFFER_STALLED_ERROR:case G.BUFFER_SEEK_OVER_HOLE:case G.BUFFER_NUDGE_ON_STALL:t.errorAction={action:ot.DoNothing,flags:Ht.None};return}t.type===Se.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,s=Jd(r.config.playlistLoadPolicy,e),o=this.playlistError++;if(po(s,o,mo(e),e.response))return{action:ot.RetryRequest,flags:Ht.None,retryConfig:s,retryCount:o};const c=this.getLevelSwitchAction(e,t);return s&&(c.retryConfig=s,c.retryCount=o),c}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:o,keyLoadPolicy:a}=t.config,c=Jd(e.details.startsWith("key")?a:o,e),f=t.levels.reduce((g,p)=>g+p.fragmentError,0);if(s&&(e.details!==G.FRAG_GAP&&s.fragmentError++,po(c,f,mo(e),e.response)))return{action:ot.RetryRequest,flags:Ht.None,retryConfig:c,retryCount:f};const h=this.getLevelSwitchAction(e,r);return c&&(h.retryConfig=c,h.retryCount=f),h}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var o,a;const h=e.details;s.loadError++,h===G.BUFFER_APPEND_ERROR&&s.fragmentError++;let g=-1;const{levels:p,loadLevel:E,minAutoLevel:T,maxAutoLevel:x}=r;r.autoLevelEnabled||(r.loadLevel=-1);const S=(o=e.frag)==null?void 0:o.type,R=(S===Ee.AUDIO&&h===G.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(h===G.BUFFER_ADD_CODEC_ERROR||h===G.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:V})=>s.audioCodec!==V),C=e.sourceBufferName==="video"&&(h===G.BUFFER_ADD_CODEC_ERROR||h===G.BUFFER_APPEND_ERROR)&&p.some(({codecSet:V,audioCodec:U})=>s.codecSet!==V&&s.audioCodec===U),{type:M,groupId:_}=(a=e.context)!=null?a:{};for(let V=p.length;V--;){const U=(V+E)%p.length;if(U!==E&&U>=T&&U<=x&&p[U].loadError===0){var c,f;const j=p[U];if(h===G.FRAG_GAP&&S===Ee.MAIN&&e.frag){const ee=p[U].details;if(ee){const H=yo(e.frag,ee.fragments,e.frag.start);if(H!=null&&H.gap)continue}}else{if(M===we.AUDIO_TRACK&&j.hasAudioGroup(_)||M===we.SUBTITLE_TRACK&&j.hasSubtitleGroup(_))continue;if(S===Ee.AUDIO&&(c=s.audioGroups)!=null&&c.some(ee=>j.hasAudioGroup(ee))||S===Ee.SUBTITLE&&(f=s.subtitleGroups)!=null&&f.some(ee=>j.hasSubtitleGroup(ee))||R&&s.audioCodec===j.audioCodec||!R&&s.audioCodec!==j.audioCodec||C&&s.codecSet===j.codecSet)continue}g=U;break}}if(g>-1&&r.loadLevel!==g)return e.levelRetry=!0,this.playlistError=0,{action:ot.SendAlternateToPenaltyBox,flags:Ht.None,nextAutoLevel:g}}return{action:ot.SendAlternateToPenaltyBox,flags:Ht.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case ot.DoNothing:break;case ot.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==G.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s,hdcpLevel:o,nextAutoLevel:a}=r;switch(s){case Ht.None:this.switchLevel(e,a);break;case Ht.MoveAllAlternatesMatchingHDCP:o&&(t.maxHdcpLevel=Xl[Xl.indexOf(o)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,a)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class du{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=F.log.bind(F,`${t}:`),this.warn=F.warn.bind(F,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=t==null?void 0:t.renditionReports;if(s){let o=-1;for(let a=0;a<s.length;a++){const c=s[a];let f;try{f=new self.URL(c.URI,t.url).href}catch(h){F.warn(`Could not construct new URL for Rendition Report: ${h}`),f=c.URI||""}if(f===e){o=a;break}else f===e.substring(0,f.length)&&(o=a)}if(o!==-1){const a=s[o],c=parseInt(a["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let f=parseInt(a["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const g=Math.min(t.age-t.partTarget,t.targetduration);f>=0&&g>t.partTarget&&(f+=1)}const h=r&&Yd(r);return new qd(c,f>=0?f:void 0,h)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:s,stats:o}=t,a=self.performance.now(),c=o.loading.first?Math.max(0,a-o.loading.first):0;if(s.advancedDateTime=Date.now()-c,s.live||r!=null&&r.live){if(s.reloaded(r),r&&this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),r&&s.fragments.length>0&&ey(r,s),!this.canLoad||!s.live)return;let f,h,g;if(s.canBlockReload&&s.endSN&&s.advanced){const v=this.hls.config.lowLatencyMode,R=s.lastPartSn,k=s.endSN,C=s.lastPartIndex,M=C!==-1,_=R===k,V=v?0:C;M?(h=_?k+1:R,g=_?V:C+1):h=k+1;const U=s.age,j=U+s.ageHeader;let ee=Math.min(j-s.partTarget,s.targetduration*1.5);if(ee>0){if(r&&ee>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${ee} with playlist age: ${s.age}`),ee=0;else{const H=Math.floor(ee/s.targetduration);if(h+=H,g!==void 0){const Q=Math.round(ee%s.targetduration/s.partTarget);g+=Q}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${U.toFixed(2)}s goal: ${ee} skip sn ${H} to part ${g}`)}s.tuneInGoal=ee}if(f=this.getDeliveryDirectives(s,t.deliveryDirectives,h,g),v||!_){this.loadPlaylist(f);return}}else(s.canBlockReload||s.canSkipUntil)&&(f=this.getDeliveryDirectives(s,t.deliveryDirectives,h,g));const p=this.hls.mainForwardBufferInfo,E=p?p.end-p.len:0,T=(s.edge-E)*1e3,x=iy(s,T);s.updated&&a>this.requestScheduled+x&&(this.requestScheduled=o.loading.start),h!==void 0&&s.canBlockReload?this.requestScheduled=o.loading.first+x-(s.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+x<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=x);let S=this.requestScheduled-a;S=Math.max(0,S),this.log(`reload live playlist ${e} in ${Math.round(S)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(f),S)}else this.clearTimer()}getDeliveryDirectives(e,t,r,s){let o=Yd(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,o=no.No),new qd(r,s,o)}checkRetry(e){const t=e.details,r=mo(e),s=e.errorAction,{action:o,retryCount:a=0,retryConfig:c}=s||{},f=!!s&&!!c&&(o===ot.RetryRequest||!s.resolved&&o===ot.SendAlternateToPenaltyBox);if(f){var h;if(this.requestScheduled=-1,a>=c.maxNumRetry)return!1;if(r&&(h=e.context)!=null&&h.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const g=fu(c,a);this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${a+1}/${c.maxNumRetry} after "${t}" in ${g}ms`)}e.levelRetry=!0,s.resolved=!0}return f}}class wr{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class dy{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new wr(e),this.fast_=new wr(t),this.defaultTTFB_=s,this.ttfb_=new wr(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:o}=this;r.halfLife!==e&&(this.slow_=new wr(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new wr(t,s.getEstimate(),s.getTotalWeight())),o.halfLife!==e&&(this.ttfb_=new wr(e,o.getEstimate(),o.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,s=e/1e3,o=r/s;this.fast_.sample(s,o),this.slow_.sample(s,o)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const Zh={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},eh={};function hy(l,e,t,r,s,o){const a=l.audioCodec?l.audioGroups:null,c=o==null?void 0:o.audioCodec,f=o==null?void 0:o.channels,h=f?parseInt(f):c?1/0:2;let g=null;if(a!=null&&a.length)try{a.length===1&&a[0]?g=e.groups[a[0]].channels:g=a.reduce((p,E)=>{if(E){const T=e.groups[E];if(!T)throw new Error(`Audio track group ${E} not found`);Object.keys(T.channels).forEach(x=>{p[x]=(p[x]||0)+T.channels[x]})}return p},{2:0})}catch{return!0}return l.videoCodec!==void 0&&(l.width>1920&&l.height>1088||l.height>1920&&l.width>1088||l.frameRate>Math.max(r,30)||l.videoRange!=="SDR"&&l.videoRange!==t||l.bitrate>Math.max(s,8e6))||!!g&&se(h)&&Object.keys(g).some(p=>parseInt(p)>h)}function gy(l,e,t){const r=l.videoCodec,s=l.audioCodec;if(!r||!s||!t)return Promise.resolve(Zh);const o={width:l.width,height:l.height,bitrate:Math.ceil(Math.max(l.bitrate*.9,l.averageBitrate)),framerate:l.frameRate||30},a=l.videoRange;a!=="SDR"&&(o.transferFunction=a.toLowerCase());const c=r.split(",").map(f=>({type:"media-source",video:rt(rt({},o),{},{contentType:ki(f,"video")})}));return s&&l.audioGroups&&l.audioGroups.forEach(f=>{var h;f&&((h=e.groups[f])==null||h.tracks.forEach(g=>{if(g.groupId===f){const p=g.channels||"",E=parseFloat(p);se(E)&&E>2&&c.push.apply(c,s.split(",").map(T=>({type:"media-source",audio:{contentType:ki(T,"audio"),channels:""+E}})))}}))}),Promise.all(c.map(f=>{const h=my(f);return eh[h]||(eh[h]=t.decodingInfo(f))})).then(f=>({supported:!f.some(h=>!h.supported),configurations:c,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:c,decodingInfoResults:[],error:f}))}function my(l){const{audio:e,video:t}=l,r=t||e;if(r){const s=r.contentType.split('"')[1];if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${s}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${s}`}return""}function py(){if(typeof matchMedia=="function"){const l=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(l.media!==e.media)return l.matches===!0}return!1}function yy(l,e){let t=!1,r=[];return l&&(t=l!=="SDR",r=[l]),e&&(r=e.allowedVideoRanges||go.slice(0),t=e.preferHDR!==void 0?e.preferHDR:py(),t?r=r.filter(s=>s!=="SDR"):r=["SDR"]),{preferHDR:t,allowedVideoRanges:r}}function Ey(l,e,t,r,s){const o=Object.keys(l),a=r==null?void 0:r.channels,c=r==null?void 0:r.audioCodec,f=a&&parseInt(a)===2;let h=!0,g=!1,p=1/0,E=1/0,T=1/0,x=0,S=[];const{preferHDR:v,allowedVideoRanges:R}=yy(e,s);for(let _=o.length;_--;){const V=l[o[_]];h=V.channels[2]>0,p=Math.min(p,V.minHeight),E=Math.min(E,V.minFramerate),T=Math.min(T,V.minBitrate);const U=R.filter(j=>V.videoRanges[j]>0);U.length>0&&(g=!0,S=U)}p=se(p)?p:0,E=se(E)?E:0;const k=Math.max(1080,p),C=Math.max(30,E);return T=se(T)?T:t,t=Math.max(T,t),g||(e=void 0,S=[]),{codecSet:o.reduce((_,V)=>{const U=l[V];if(V===_)return _;if(U.minBitrate>t)return gn(V,`min bitrate of ${U.minBitrate} > current estimate of ${t}`),_;if(!U.hasDefaultAudio)return gn(V,"no renditions with default or auto-select sound found"),_;if(c&&V.indexOf(c.substring(0,4))%5!==0)return gn(V,`audio codec preference "${c}" not found`),_;if(a&&!f){if(!U.channels[a])return gn(V,`no renditions with ${a} channel sound found (channels options: ${Object.keys(U.channels)})`),_}else if((!c||f)&&h&&U.channels[2]===0)return gn(V,"no renditions with stereo sound found"),_;return U.minHeight>k?(gn(V,`min resolution of ${U.minHeight} > maximum of ${k}`),_):U.minFramerate>C?(gn(V,`min framerate of ${U.minFramerate} > maximum of ${C}`),_):S.some(j=>U.videoRanges[j]>0)?U.maxScore<x?(gn(V,`max score of ${U.maxScore} < selected max of ${x}`),_):_&&(fo(V)>=fo(_)||U.fragmentError>l[_].fragmentError)?_:(x=U.maxScore,V):(gn(V,`no variants with VIDEO-RANGE of ${JSON.stringify(S)} found`),_)},void 0),videoRanges:S,preferHDR:v,minFramerate:E,minBitrate:T}}function gn(l,e){F.log(`[abr] start candidates with "${l}" ignored because ${e}`)}function xy(l){return l.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Ty(l,e,t,r){return l.slice(t,r+1).reduce((s,o)=>{if(!o.codecSet)return s;const a=o.audioGroups;let c=s[o.codecSet];c||(s[o.codecSet]=c={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),c.minBitrate=Math.min(c.minBitrate,o.bitrate);const f=Math.min(o.height,o.width);return c.minHeight=Math.min(c.minHeight,f),c.minFramerate=Math.min(c.minFramerate,o.frameRate),c.maxScore=Math.max(c.maxScore,o.score),c.fragmentError+=o.fragmentError,c.videoRanges[o.videoRange]=(c.videoRanges[o.videoRange]||0)+1,a&&a.forEach(h=>{if(!h)return;const g=e.groups[h];g&&(c.hasDefaultAudio=c.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(p=>{c.channels[p]=(c.channels[p]||0)+g.channels[p]}))}),s},{})}function nn(l,e,t){if("attrs"in l){const r=e.indexOf(l);if(r!==-1)return r}for(let r=0;r<e.length;r++){const s=e[r];if(br(l,s,t))return r}return-1}function br(l,e,t){const{groupId:r,name:s,lang:o,assocLang:a,characteristics:c,default:f}=l,h=l.forced;return(r===void 0||e.groupId===r)&&(s===void 0||e.name===s)&&(o===void 0||e.lang===o)&&(o===void 0||e.assocLang===a)&&(f===void 0||e.default===f)&&(h===void 0||e.forced===h)&&(c===void 0||Sy(c,e.characteristics))&&(t===void 0||t(l,e))}function Sy(l,e=""){const t=l.split(","),r=e.split(",");return t.length===r.length&&!t.some(s=>r.indexOf(s)===-1)}function Dr(l,e){const{audioCodec:t,channels:r}=l;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function vy(l,e,t,r,s){const o=e[r],c=e.reduce((E,T,x)=>{const S=T.uri;return(E[S]||(E[S]=[])).push(x),E},{})[o.uri];c.length>1&&(r=Math.max.apply(Math,c));const f=o.videoRange,h=o.frameRate,g=o.codecSet.substring(0,4),p=th(e,r,E=>{if(E.videoRange!==f||E.frameRate!==h||E.codecSet.substring(0,4)!==g)return!1;const T=E.audioGroups,x=t.filter(S=>!T||T.indexOf(S.groupId)!==-1);return nn(l,x,s)>-1});return p>-1?p:th(e,r,E=>{const T=E.audioGroups,x=t.filter(S=>!T||T.indexOf(S.groupId)!==-1);return nn(l,x,s)>-1})}function th(l,e,t){for(let r=e;r>-1;r--)if(t(l[r]))return r;for(let r=e+1;r<l.length;r++)if(t(l[r]))return r;return-1}class Ly{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:r,hls:s}=this,{autoLevelEnabled:o,media:a}=s;if(!t||!a)return;const c=performance.now(),f=r?r.stats:t.stats,h=r?r.duration:t.duration,g=c-f.loading.start,p=s.minAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||t.level<=p){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o||a.paused||!a.playbackRate||!a.readyState)return;const E=s.mainForwardBufferInfo;if(E===null)return;const T=this.bwEstimator.getEstimateTTFB(),x=Math.abs(a.playbackRate);if(g<=Math.max(T,1e3*(h/(x*2))))return;const S=E.len/x,v=f.loading.first?f.loading.first-f.loading.start:-1,R=f.loaded&&v>-1,k=this.getBwEstimate(),C=s.levels,M=C[t.level],_=f.total||Math.max(f.loaded,Math.round(h*M.averageBitrate/8));let V=R?g-v:g;V<1&&R&&(V=Math.min(g,f.loaded*8/k));const U=R?f.loaded*1e3/V:0,j=U?(_-f.loaded)/U:_*8/k+T/1e3;if(j<=S)return;const ee=U?U*8:k;let H=Number.POSITIVE_INFINITY,Q;for(Q=t.level-1;Q>p;Q--){const te=C[Q].maxBitrate;if(H=this.getTimeToLoadFrag(T/1e3,ee,h*te,!C[Q].details),H<S)break}if(H>=j||H>h*10)return;s.nextLoadLevel=s.nextAutoLevel=Q,R?this.bwEstimator.sample(g-Math.min(T,v),f.loaded):this.bwEstimator.sampleTTFB(g);const ge=C[Q].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>ge&&this.resetEstimator(ge),this.clearTimer(),F.warn(`[abr] Fragment ${t.sn}${r?" part "+r.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${S.toFixed(3)} s
      Estimated load time for current fragment: ${j.toFixed(3)} s
      Estimated load time for down switch fragment: ${H.toFixed(3)} s
      TTFB estimate: ${v|0} ms
      Current BW estimate: ${se(k)?k|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${Q} @ ${ge|0} bps`),s.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:r,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(F.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new dy(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var s;this.fragCurrent=r,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case G.BUFFER_ADD_CODEC_ERROR:case G.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case G.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:s,partCurrent:o}=this;if(r&&s&&r.sn===s.sn&&r.level===s.level){const a=performance.now(),c=o?o.stats:r.stats,f=a-c.loading.start,h=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&h>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(p,h),c.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(e,t,r,s){const o=e+r/t,a=s?this.lastLevelLoadSec:0;return o+a}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,o=s.end-s.start;se(o)&&(this.lastLevelLoadSec=o/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===Ee.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const o=r?r.duration:t.duration,a=this.hls.levels[t.level],c=(a.loaded?a.loaded.bytes:0)+s.loaded,f=(a.loaded?a.loaded.duration:0)+o;a.loaded={bytes:c,duration:f},a.realBitrate=Math.round(8*c/f)}if(t.bitrateTest){const o={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,o),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,o=s!=null&&s.stats.loaded?s.stats:r.stats;if(o.aborted||this.ignoreFragment(r))return;const a=o.parsing.end-o.loading.start-Math.min(o.loading.first-o.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,o.loaded),o.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ee.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,o=this.findBestLevel(r,t,e,0,s,1,1);if(o>-1)return o;const a=this.hls.firstLevel,c=Math.min(Math.max(a,t),e);return F.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const o=r&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,o)&&a[e].loadError<=a[o].loadError)return e}return this._nextAutoLevel=o,this.nextAutoLevelKey=this.getAutoLevelKey(),o}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:s,config:o,minAutoLevel:a}=r,c=t?t.duration:e?e.duration:0,f=this.getBwEstimate(),h=this.getStarvationDelay();let g=o.abrBandWidthFactor,p=o.abrBandWidthUpFactor;if(h){const v=this.findBestLevel(f,a,s,h,0,g,p);if(v>=0)return v}let E=c?Math.min(c,o.maxStarvationDelay):o.maxStarvationDelay;if(!h){const v=this.bitrateTestDelay;v&&(E=(c?Math.min(c,o.maxLoadingDelay):o.maxLoadingDelay)-v,F.info(`[abr] bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*E)} ms`),g=p=1)}const T=this.findBestLevel(f,a,s,h,E,g,p);if(F.info(`[abr] ${h?"rebuffering expected":"buffer is empty"}, optimal quality level ${T}`),T>-1)return T;const x=r.levels[a],S=r.levels[r.loadLevel];return(x==null?void 0:x.bitrate)<(S==null?void 0:S.bitrate)?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,o,a,c){var f;const h=s+o,g=this.lastLoadedFragLevel,p=g===-1?this.hls.firstLevel:g,{fragCurrent:E,partCurrent:T}=this,{levels:x,allAudioTracks:S,loadLevel:v,config:R}=this.hls;if(x.length===1)return 0;const k=x[p],C=!!(k!=null&&(f=k.details)!=null&&f.live),M=v===-1||g===-1;let _,V="SDR",U=(k==null?void 0:k.frameRate)||0;const{audioPreference:j,videoPreference:ee}=R,H=this.audioTracksByGroup||(this.audioTracksByGroup=xy(S));if(M){if(this.firstSelection!==-1)return this.firstSelection;const de=this.codecTiers||(this.codecTiers=Ty(x,H,t,r)),oe=Ey(de,V,e,j,ee),{codecSet:he,videoRanges:q,minFramerate:z,minBitrate:K,preferHDR:D}=oe;_=he,V=D?q[q.length-1]:q[0],U=z,e=Math.max(e,K),F.log(`[abr] picked start tier ${JSON.stringify(oe)}`)}else _=k==null?void 0:k.codecSet,V=k==null?void 0:k.videoRange;const Q=T?T.duration:E?E.duration:0,ge=this.bwEstimator.getEstimateTTFB()/1e3,te=[];for(let de=r;de>=t;de--){var fe;const oe=x[de],he=de>p;if(!oe)continue;if(R.useMediaCapabilities&&!oe.supportedResult&&!oe.supportedPromise){const ce=navigator.mediaCapabilities;typeof(ce==null?void 0:ce.decodingInfo)=="function"&&hy(oe,H,V,U,e,j)?(oe.supportedPromise=gy(oe,H,ce),oe.supportedPromise.then(xe=>{if(!this.hls)return;oe.supportedResult=xe;const Te=this.hls.levels,Re=Te.indexOf(oe);xe.error?F.warn(`[abr] MediaCapabilities decodingInfo error: "${xe.error}" for level ${Re} ${JSON.stringify(xe)}`):xe.supported||(F.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${Re} ${JSON.stringify(xe)}`),Re>-1&&Te.length>1&&(F.log(`[abr] Removing unsupported level ${Re}`),this.hls.removeLevel(Re)))})):oe.supportedResult=Zh}if(_&&oe.codecSet!==_||V&&oe.videoRange!==V||he&&U>oe.frameRate||!he&&U>0&&U<oe.frameRate||oe.supportedResult&&!((fe=oe.supportedResult.decodingInfoResults)!=null&&fe[0].smooth)){te.push(de);continue}const q=oe.details,z=(T?q==null?void 0:q.partTarget:q==null?void 0:q.averagetargetduration)||Q;let K;he?K=c*e:K=a*e;const D=Q&&s>=Q*2&&o===0?x[de].averageBitrate:x[de].maxBitrate,$=this.getTimeToLoadFrag(ge,K,D*z,q===void 0);if(K>=D&&(de===g||oe.loadError===0&&oe.fragmentError===0)&&($<=ge||!se($)||C&&!this.bitrateTestDelay||$<h)){const ce=this.forcedAutoLevel;return de!==v&&(ce===-1||ce!==v)&&(te.length&&F.trace(`[abr] Skipped level(s) ${te.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${x[te[0]].codecs}" ${x[te[0]].videoRange}; not compatible with "${k.codecs}" ${V}`),F.info(`[abr] switch candidate:${p}->${de} adjustedbw(${Math.round(K)})-bitrate=${Math.round(K-D)} ttfb:${ge.toFixed(1)} avgDuration:${z.toFixed(1)} maxFetchDuration:${h.toFixed(1)} fetchDuration:${$.toFixed(1)} firstSelection:${M} codecSet:${_} videoRange:${V} hls.loadLevel:${v}`)),M&&(this.firstSelection=de),de}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls,s=Math.min(Math.max(e,r),t);this._nextAutoLevel!==s&&(this.nextAutoLevelKey="",this._nextAutoLevel=s)}}class Ay{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var nt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Ry{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let s=r.length;s--;){const o=r[s];if(!o)break;const a=o.end;if(o.start<=e&&a!==null&&e<=a)return o}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,s=Object.keys(r);for(let o=s.length;o--;){const a=r[s[o]];if((a==null?void 0:a.body.type)===t&&a.buffered){const c=a.body;if(c.start<=e&&e<=c.end)return c}}return null}detectEvictedFragments(e,t,r,s){this.timeRanges&&(this.timeRanges[e]=t);const o=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const c=this.fragments[a];if(!c||o>=c.body.sn)return;if(!c.buffered&&!c.loaded){c.body.type===r&&this.removeFragment(c.body);return}const f=c.range[e];f&&f.time.some(h=>{const g=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return g&&this.removeFragment(c.body),g})})}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:s}=e;if(!t||r.sn==="initSegment")return;const o=kr(r),a=this.fragments[o];if(!a||a.buffered&&r.gap)return;const c=!r.relurl;Object.keys(t).forEach(f=>{const h=r.elementaryStreams[f];if(!h)return;const g=t[f],p=c||h.partial===!0;a.range[f]=this.getBufferedTimes(r,s,p,g)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=r.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),js(a)||this.removeParts(r.sn-1,r.type)):this.removeFragment(a.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(s=>s.fragment.sn>=e))}fragBuffered(e,t){const r=kr(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,s.buffered=!0)}getBufferedTimes(e,t,r,s){const o={time:[],partial:r},a=e.start,c=e.end,f=e.minEndPTS||c,h=e.maxStartPTS||a;for(let g=0;g<s.length;g++){const p=s.start(g)-this.bufferPadding,E=s.end(g)+this.bufferPadding;if(h>=p&&f<=E){o.time.push({startPTS:Math.max(a,s.start(g)),endPTS:Math.min(c,s.end(g))});break}else if(a<E&&c>p){const T=Math.max(a,s.start(g)),x=Math.min(c,s.end(g));x>T&&(o.partial=!0,o.time.push({startPTS:T,endPTS:x}))}else if(c<=p)break}return o}getPartialFragment(e){let t=null,r,s,o,a=0;const{bufferPadding:c,fragments:f}=this;return Object.keys(f).forEach(h=>{const g=f[h];g&&js(g)&&(s=g.body.start-c,o=g.body.end+c,e>=s&&e<=o&&(r=Math.min(e-s,o-e),a<=r&&(t=g.body,a=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||js(t))}getState(e){const t=kr(e),r=this.fragments[t];return r?r.buffered?js(r)?nt.PARTIAL:nt.OK:nt.APPENDING:nt.NOT_LOADED}isTimeBuffered(e,t,r){let s,o;for(let a=0;a<r.length;a++){if(s=r.start(a)-this.bufferPadding,o=r.end(a)+this.bufferPadding,e>=s&&t<=o)return!0;if(t<=s)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:s}=t;if(r.sn==="initSegment"||r.bitrateTest)return;const o=s?null:t,a=kr(r);this.fragments[a]={body:r,appendedPTS:null,loaded:o,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:o}=t;if(r.sn==="initSegment")return;const a=r.type;if(s){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(s)}this.timeRanges=o,Object.keys(o).forEach(c=>{const f=o[c];this.detectEvictedFragments(c,f,a,s)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=kr(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,s,o){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const c=this.fragments[a];if(!c)return;const f=c.body;f.type!==r||s&&!f.gap||f.start<t&&f.end>e&&(c.buffered||o)&&this.removeFragment(f)})}removeFragment(e){const t=kr(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const s=e.sn;this.activePartLists[e.type]=r.filter(o=>o.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function js(l){var e,t,r;return l.buffered&&(l.body.gap||((e=l.range.video)==null?void 0:e.partial)||((t=l.range.audio)==null?void 0:t.partial)||((r=l.range.audiovideo)==null?void 0:r.partial))}function kr(l){return`${l.type}_${l.level}_${l.sn}`}const Iy={length:0,start:()=>0,end:()=>0};class Ne{static isBuffered(e,t){try{if(e){const r=Ne.getBuffered(e);for(let s=0;s<r.length;s++)if(t>=r.start(s)&&t<=r.end(s))return!0}}catch{}return!1}static bufferInfo(e,t,r){try{if(e){const s=Ne.getBuffered(e),o=[];let a;for(a=0;a<s.length;a++)o.push({start:s.start(a),end:s.end(a)});return this.bufferedInfo(o,t,r)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort(function(h,g){const p=h.start-g.start;return p||g.end-h.end});let s=[];if(r)for(let h=0;h<e.length;h++){const g=s.length;if(g){const p=s[g-1].end;e[h].start-p<r?e[h].end>p&&(s[g-1].end=e[h].end):s.push(e[h])}else s.push(e[h])}else s=e;let o=0,a,c=t,f=t;for(let h=0;h<s.length;h++){const g=s[h].start,p=s[h].end;if(t+r>=g&&t<p)c=g,f=p,o=f-t;else if(t+r<g){a=g;break}}return{len:o,start:c||0,end:f||0,nextStart:a}}static getBuffered(e){try{return e.buffered}catch(t){return F.log("failed to get media.buffered",t),Iy}}}class hu{constructor(e,t,r,s=0,o=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ys(),this.buffering={audio:Ys(),video:Ys(),audiovideo:Ys()},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=o,this.partial=a}}function Ys(){return{start:0,executeStart:0,executeEnd:0,end:0}}function ro(l,e){for(let r=0,s=l.length;r<s;r++){var t;if(((t=l[r])==null?void 0:t.cc)===e)return l[r]}return null}function Cy(l,e,t){return!!(e&&(t.endCC>t.startCC||l&&l.cc<t.startCC))}function wy(l,e){const t=l.fragments,r=e.fragments;if(!r.length||!t.length){F.log("No fragments to align");return}const s=ro(t,r[0].cc);if(!s||s&&!s.startPTS){F.log("No frag in previous level to align on");return}return s}function nh(l,e){if(l){const t=l.start+e;l.start=l.startPTS=t,l.endPTS=t+l.duration}}function eg(l,e){const t=e.fragments;for(let r=0,s=t.length;r<s;r++)nh(t[r],l);e.fragmentHint&&nh(e.fragmentHint,l),e.alignedSliding=!0}function Dy(l,e,t){e&&(ky(l,t,e),!t.alignedSliding&&e&&Eo(t,e),!t.alignedSliding&&e&&!t.skippedSegments&&qh(e,t))}function ky(l,e,t){if(Cy(l,t,e)){const r=wy(t,e);r&&se(r.start)&&(F.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),eg(r.start,e))}}function Eo(l,e){if(!l.hasProgramDateTime||!e.hasProgramDateTime)return;const t=l.fragments,r=e.fragments;if(!t.length||!r.length)return;let s,o;const a=Math.min(e.endCC,l.endCC);e.startCC<a&&l.startCC<a&&(s=ro(r,a),o=ro(t,a)),(!s||!o)&&(s=r[Math.floor(r.length/2)],o=ro(t,s.cc)||t[Math.floor(t.length/2)]);const c=s.programDateTime,f=o.programDateTime;if(!c||!f)return;const h=(f-c)/1e3-(o.start-s.start);eg(h,l)}const rh=Math.pow(2,17);class _y{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new pn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,o=s.fLoader,a=s.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(T=>T[0]==="GAP")){f(sh(e));return}else e.gap=!1;const h=this.loader=e.loader=o?new o(s):new a(s),g=ih(e),p=Zd(s.fragLoadPolicy.default),E={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:rh};e.stats=h.stats,h.load(g,E,{onSuccess:(T,x,S,v)=>{this.resetLoader(e,h);let R=T.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(R.slice(0,16)),R=R.slice(16)),c({frag:e,part:null,payload:R,networkDetails:v})},onError:(T,x,S,v)=>{this.resetLoader(e,h),f(new pn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:rt({url:r,data:void 0},T),error:new Error(`HTTP Error ${T.code} ${T.text}`),networkDetails:S,stats:v}))},onAbort:(T,x,S)=>{this.resetLoader(e,h),f(new pn({type:Se.NETWORK_ERROR,details:G.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:T}))},onTimeout:(T,x,S)=>{this.resetLoader(e,h),f(new pn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${E.timeout}ms`),networkDetails:S,stats:T}))},onProgress:(T,x,S,v)=>{t&&t({frag:e,part:null,payload:S,networkDetails:v})}})})}loadPart(e,t,r){this.abort();const s=this.config,o=s.fLoader,a=s.loader;return new Promise((c,f)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){f(sh(e,t));return}const h=this.loader=e.loader=o?new o(s):new a(s),g=ih(e,t),p=Zd(s.fragLoadPolicy.default),E={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:rh};t.stats=h.stats,h.load(g,E,{onSuccess:(T,x,S,v)=>{this.resetLoader(e,h),this.updateStatsFromPart(e,t);const R={frag:e,part:t,payload:T.data,networkDetails:v};r(R),c(R)},onError:(T,x,S,v)=>{this.resetLoader(e,h),f(new pn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:rt({url:g.url,data:void 0},T),error:new Error(`HTTP Error ${T.code} ${T.text}`),networkDetails:S,stats:v}))},onAbort:(T,x,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,h),f(new pn({type:Se.NETWORK_ERROR,details:G.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:T}))},onTimeout:(T,x,S)=>{this.resetLoader(e,h),f(new pn({type:Se.NETWORK_ERROR,details:G.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${E.timeout}ms`),networkDetails:S,stats:T}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,o=s.total;if(r.loaded+=s.loaded,o){const f=Math.round(e.duration/t.duration),h=Math.min(Math.round(r.loaded/o),f),p=(f-h)*Math.round(r.loaded/h);r.total=r.loaded+p}else r.total=Math.max(r.loaded,r.total);const a=r.loading,c=s.loading;a.start?a.first+=c.first-c.start:(a.start=c.start,a.first=c.first),a.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function ih(l,e=null){const t=e||l,r={frag:l,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,o=t.byteRangeEndOffset;if(se(s)&&se(o)){var a;let c=s,f=o;if(l.sn==="initSegment"&&((a=l.decryptdata)==null?void 0:a.method)==="AES-128"){const h=o-s;h%16&&(f=o+(16-h%16)),s!==0&&(r.resetIV=!0,c=s-16)}r.rangeStart=c,r.rangeEnd=f}return r}function sh(l,e){const t=new Error(`GAP ${l.gap?"tag":"attribute"} found`),r={type:Se.MEDIA_ERROR,details:G.FRAG_GAP,fatal:!1,frag:l,error:t,networkDetails:null};return e&&(r.part=e),(e||l).stats.aborted=!0,new pn(r)}class pn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Py{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class Fy{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function by(l){const e=l.byteLength,t=e&&new DataView(l.buffer).getUint8(e-1);return t?tr(l,0,e-t):l}class Oy{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let s=0;s<4;s++)r[s]=t.getUint32(s*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],o=r[1],a=r[2],c=r[3],f=this.invSubMix,h=f[0],g=f[1],p=f[2],E=f[3],T=new Uint32Array(256);let x=0,S=0,v=0;for(v=0;v<256;v++)v<128?T[v]=v<<1:T[v]=v<<1^283;for(v=0;v<256;v++){let R=S^S<<1^S<<2^S<<3^S<<4;R=R>>>8^R&255^99,e[x]=R,t[R]=x;const k=T[x],C=T[k],M=T[C];let _=T[R]*257^R*16843008;s[x]=_<<24|_>>>8,o[x]=_<<16|_>>>16,a[x]=_<<8|_>>>24,c[x]=_,_=M*16843009^C*65537^k*257^x*16843008,h[R]=_<<24|_>>>8,g[R]=_<<16|_>>>16,p[R]=_<<8|_>>>24,E[R]=_,x?(x=k^T[T[T[M^k]]],S^=T[T[S]]):x=S=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const o=this.keySize=t.length;if(o!==4&&o!==6&&o!==8)throw new Error("Invalid aes key size="+o);const a=this.ksRows=(o+6+1)*4;let c,f;const h=this.keySchedule=new Uint32Array(a),g=this.invKeySchedule=new Uint32Array(a),p=this.sBox,E=this.rcon,T=this.invSubMix,x=T[0],S=T[1],v=T[2],R=T[3];let k,C;for(c=0;c<a;c++){if(c<o){k=h[c]=t[c];continue}C=k,c%o===0?(C=C<<8|C>>>24,C=p[C>>>24]<<24|p[C>>>16&255]<<16|p[C>>>8&255]<<8|p[C&255],C^=E[c/o|0]<<24):o>6&&c%o===4&&(C=p[C>>>24]<<24|p[C>>>16&255]<<16|p[C>>>8&255]<<8|p[C&255]),h[c]=k=(h[c-o]^C)>>>0}for(f=0;f<a;f++)c=a-f,f&3?C=h[c]:C=h[c-4],f<4||c<=4?g[f]=C:g[f]=x[p[C>>>24]]^S[p[C>>>16&255]]^v[p[C>>>8&255]]^R[p[C&255]],g[f]=g[f]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,o=this.invKeySchedule,a=this.invSBox,c=this.invSubMix,f=c[0],h=c[1],g=c[2],p=c[3],E=this.uint8ArrayToUint32Array_(r);let T=E[0],x=E[1],S=E[2],v=E[3];const R=new Int32Array(e),k=new Int32Array(R.length);let C,M,_,V,U,j,ee,H,Q,ge,te,fe,de,oe;const he=this.networkToHostOrderSwap;for(;t<R.length;){for(Q=he(R[t]),ge=he(R[t+1]),te=he(R[t+2]),fe=he(R[t+3]),U=Q^o[0],j=fe^o[1],ee=te^o[2],H=ge^o[3],de=4,oe=1;oe<s;oe++)C=f[U>>>24]^h[j>>16&255]^g[ee>>8&255]^p[H&255]^o[de],M=f[j>>>24]^h[ee>>16&255]^g[H>>8&255]^p[U&255]^o[de+1],_=f[ee>>>24]^h[H>>16&255]^g[U>>8&255]^p[j&255]^o[de+2],V=f[H>>>24]^h[U>>16&255]^g[j>>8&255]^p[ee&255]^o[de+3],U=C,j=M,ee=_,H=V,de=de+4;C=a[U>>>24]<<24^a[j>>16&255]<<16^a[ee>>8&255]<<8^a[H&255]^o[de],M=a[j>>>24]<<24^a[ee>>16&255]<<16^a[H>>8&255]<<8^a[U&255]^o[de+1],_=a[ee>>>24]<<24^a[H>>16&255]<<16^a[U>>8&255]<<8^a[j&255]^o[de+2],V=a[H>>>24]<<24^a[U>>16&255]<<16^a[j>>8&255]<<8^a[ee&255]^o[de+3],k[t]=he(C^T),k[t+1]=he(V^x),k[t+2]=he(_^S),k[t+3]=he(M^v),T=Q,x=ge,S=te,v=fe,t=t+4}return k.buffer}}const Ny=16;class gu{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?by(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise((s,o)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const a=this.flush();a?s(a.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:s,currentResult:o,remainderData:a}=this;this.logOnce("JS AES decrypt"),a&&(e=Nt(a,e),this.remainderData=null);const c=this.getValidChunk(e);if(!c.length)return null;s&&(r=s);let f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new Oy),f.expandKey(t);const h=o;return this.currentResult=f.decrypt(c.buffer,0,r),this.currentIV=tr(c,-16).buffer,h||null}webCryptoDecrypt(e,t,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r));this.key=t,this.fastAesKey=new Fy(this.subtle,t)}return this.fastAesKey.expandKey().then(s=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Py(this.subtle,new Uint8Array(r)).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(F.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,r)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const s=this.flush();if(s)return s.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%Ny;return r!==e.length&&(t=tr(e,0,r),this.remainderData=tr(e,r)),t}logOnce(e){this.logEnabled&&(F.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const My={toString:function(l){let e="";const t=l.length;for(let r=0;r<t;r++)e+=`[${l.start(r).toFixed(3)}-${l.end(r).toFixed(3)}]`;return e}},W={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class mu extends Ay{constructor(e,t,r,s,o){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=W.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=o,this.logPrefix=s,this.log=F.log.bind(F,`${s}:`),this.warn=F.warn.bind(F,`${s}:`),this.hls=e,this.fragmentLoader=new _y(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new gu(e.config),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=W.STOPPED}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(r!=null&&r.length){const o=r[r.length-1];return Ne.isBuffered(this.media,o.start+o.duration/2)}const s=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(s)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const s=this.config;this.levels&&s.autoStartLoad&&this.state===W.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:s,state:o}=this,a=r?r.currentTime:0,c=Ne.bufferInfo(s||r,a,e.maxBufferHole);if(this.log(`media seeking to ${se(a)?a.toFixed(3):a}, state: ${o}`),this.state===W.ENDED)this.resetLoadingState();else if(t){const f=e.maxFragLookUpTolerance,h=t.start-f,g=t.start+t.duration+f;if(!c.len||g<c.start||h>c.end){const p=a>g;(a<h||p)&&(p&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),!this.loadedmetadata&&!c.len&&(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=W.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const s=o=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${o.part?" p: "+o.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(o)};this._doFragLoad(e,t,r,s).then(o=>{if(!o)return;const a=this.state;if(this.fragContextChanged(e)){(a===W.FRAG_LOADING||!this.fragCurrent&&a===W.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=W.IDLE);return}"payload"in o&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(L.FRAG_LOADED,o)),this._handleFragmentLoadComplete(o)}).catch(o=>{this.state===W.STOPPED||this.state===W.ERROR||(this.warn(`Frag error: ${(o==null?void 0:o.message)||o}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===nt.APPENDING){const o=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,o),c=Math.max(e.duration,a?a.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?e.sn-f.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===nt.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(L.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:s}=this,{payload:o}=r,a=e.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&a.method==="AES-128"){const c=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer).catch(f=>{throw s.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:e}),f}).then(f=>{const h=self.performance.now();return s.trigger(L.FRAG_DECRYPTED,{frag:e,payload:f,stats:{tstart:c,tdecrypt:h}}),r.payload=f,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===W.STOPPED||this.state===W.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state=W.IDLE,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var r,s,o,a;const c=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===Ee.MAIN?"level":"track"} ${e.level} (frag:[${((r=e.startPTS)!=null?r:NaN).toFixed(3)}-${((s=e.endPTS)!=null?s:NaN).toFixed(3)}] > buffer:${c?My.toString(Ne.getBuffered(c)):"(detached)"})`),e.sn!=="initSegment"){var f;if(e.type!==Ee.SUBTITLE){const g=e.elementaryStreams;if(!Object.keys(g).some(p=>!!g[p])){this.state=W.IDLE;return}}const h=(f=this.levels)==null?void 0:f[e.level];h!=null&&h.fragmentError&&(this.log(`Resetting level fragment error count of ${h.fragmentError} on frag buffered`),h.fragmentError=0)}this.state=W.IDLE,c&&(!this.loadedmetadata&&e.type==Ee.MAIN&&c.buffered.length&&((o=this.fragCurrent)==null?void 0:o.sn)===((a=this.fragPrevious)==null?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:o}=e,a=!o||o.length===0||o.some(f=>!f),c=new hu(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var o;const a=t==null?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let c=null;if(e.encrypted&&!((o=e.decryptdata)!=null&&o.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=W.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(g=>{if(!this.fragContextChanged(g.frag))return this.hls.trigger(L.KEY_LOADED,g),this.state===W.KEY_LOADING&&(this.state=W.IDLE),g}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(c=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const g=a.partList;if(g&&s){r>e.end&&a.fragmentHint&&(e=a.fragmentHint);const p=this.getNextPart(g,e,r);if(p>-1){const E=g[p];this.log(`Loading part sn: ${e.sn} p: ${E.index} cc: ${e.cc} of playlist [${a.startSN}-${a.endSN}] parts [0-${p}-${g.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=E.start+E.duration,this.state=W.FRAG_LOADING;let T;return c?T=c.then(x=>!x||this.fragContextChanged(x.frag)?null:this.doFragPartsLoad(e,E,t,s)).catch(x=>this.handleFragLoadError(x)):T=this.doFragPartsLoad(e,E,t,s).catch(x=>this.handleFragLoadError(x)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:E,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):T}else if(!e.url||this.loadedEndOfParts(g,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${a?"of ["+a.startSN+"-"+a.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),se(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=W.FRAG_LOADING;const f=this.config.progressive;let h;return f&&c?h=c.then(g=>!g||this.fragContextChanged(g==null?void 0:g.frag)?null:this.fragmentLoader.load(e,s)).catch(g=>this.handleFragLoadError(g)):h=Promise.all([this.fragmentLoader.load(e,f?s:void 0),c]).then(([g])=>(!f&&g&&s&&s(g),g)).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,r,s){return new Promise((o,a)=>{var c;const f=[],h=(c=r.details)==null?void 0:c.partList,g=p=>{this.fragmentLoader.loadPart(e,p,s).then(E=>{f[p.index]=E;const T=E.part;this.hls.trigger(L.FRAG_LOADED,E);const x=Qd(r,e.sn,p.index+1)||Xh(h,e.sn,p.index+1);if(x)g(x);else return o({frag:e,part:T,partsLoaded:f})}).catch(a)};g(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===G.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:Se.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==W.PARSING){!this.fragCurrent&&this.state!==W.STOPPED&&this.state!==W.ERROR&&(this.state=W.IDLE);return}const{frag:r,part:s,level:o}=t,a=self.performance.now();r.stats.parsing.end=a,s&&(s.stats.parsing.end=a),this.updateLevelTiming(r,s,o,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:o,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${o} of level ${s}. The current chunk will not be buffered.`),null;const c=t[s],f=a>-1?Qd(c,o,a):null,h=f?f.fragment:sy(c,o,r);return h?(r&&r!==h&&(h.stats=r.stats),{frag:h,part:f,level:c}):null}bufferFragmentData(e,t,r,s,o){var a;if(!e||this.state!==W.PARSING)return;const{data1:c,data2:f}=e;let h=c;if(c&&f&&(h=Nt(c,f)),!((a=h)!=null&&a.length))return;const g={type:e.type,frag:t,part:r,chunkMeta:s,parent:t.type,data:h};if(this.hls.trigger(L.BUFFER_APPENDING,g),e.dropped&&e.independent&&!r){if(o)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ne.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,s=Ne.bufferInfo(t,r,0),o=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,o*.25),c=Math.max(Math.min(e.start-a,s.end-a),r+a);e.start-c>a&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return se(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:s}}=this,o=Ne.bufferInfo(e,t,s);if(o.len===0&&o.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&o.nextStart<a.end)return Ne.bufferInfo(e,t,Math.max(o.nextStart,s))}return o}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),o=Math.max(e-t*3,r.maxMaxBufferLength/2,s);return o>=s?(r.maxMaxBufferLength=o,this.warn(`Reduce max buffer length to ${o}s`),!0):!1}getAppendedFrag(e,t=Ee.MAIN){const r=this.fragmentTracker.getAppendedFrag(e,Ee.MAIN);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:o}=this,a=r[0].start;let c;if(t.live){const f=o.initialLiveManifestSize;if(s<f)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${f})`),null;(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a)&&(c=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=c?this.hls.liveSyncPosition||c.start:e)}else e<=a&&(c=r[0]);if(!c){const f=o.lowLatencyMode?t.partEnd:t.fragmentEnd;c=this.getFragmentAtPosition(e,f,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===nt.OK||r===nt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,o){const a=e.gap,c=this.getNextFragment(this.nextLoadPosition,t);if(c===null)return c;if(e=c,a&&e&&!e.gap&&r.nextStart){const f=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s);if(f!==null&&r.len+f.len>=o)return this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let s=-1,o=!1,a=!0;for(let c=0,f=e.length;c<f;c++){const h=e[c];if(a=a&&!h.independent,s>-1&&r<h.start)break;const g=h.loaded;g?s=-1:(o||h.independent||a)&&h.fragment===t&&(s=c),o=g}return s}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=ay(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const o=r.sn+1;if(o>=e.startSN&&o<=e.endSN){const a=t[o-e.startSN];r.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=cy(t,r.cc),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const o=this.hls.liveSyncPosition;o!==null&&(s=this.getFragmentAtPosition(o,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:o}=this,{fragments:a,endSN:c}=r;const{fragmentHint:f}=r,{maxFragLookUpTolerance:h}=s,g=r.partList,p=!!(s.lowLatencyMode&&g!=null&&g.length&&f);p&&f&&!this.bitrateTest&&(a=a.concat(f),c=f.sn);let E;if(e<t){const T=e>t-h?0:h;E=yo(o,a,e,T)}else E=a[a.length-1];if(E){const T=E.sn-r.startSN,x=this.fragmentTracker.getState(E);if((x===nt.OK||x===nt.PARTIAL&&E.gap)&&(o=E),o&&E.sn===o.sn&&(!p||g[0].fragment.sn>E.sn)&&o&&E.level===o.level){const v=a[T+1];E.sn<c&&this.fragmentTracker.getState(v)!==nt.OK?E=v:E=null}}return E}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,o=r.currentTime,a=e.fragments[0].start,c=e.edge,f=o>=a-t.maxFragLookUpTolerance&&o<=c;if(s!==null&&r.duration>s&&(o<s||!f)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!f&&r.readyState<4||o<c-h)&&(this.loadedmetadata||(this.nextLoadPosition=s),r.readyState&&(this.warn(`Playback: ${o.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${s.toFixed(3)}`),r.currentTime=s))}}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const o=e.fragments[0].start,a=!t,c=e.alignedSliding&&se(o);if(a||!c&&!o){const{fragPrevious:f}=this;Dy(f,r,e);const h=e.fragments[0].start;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${f?f.sn:"na"} fragments: ${s}`),h}return o}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),r===-1||this.lastCurrentTime===-1){const s=this.startTimeOffset!==null,o=s?this.startTimeOffset:e.startTimeOffset;o!==null&&se(o)?(r=t+o,o<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${o} found in ${s?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==W.FRAG_LOADING_WAITING_RETRY)&&(this.state=W.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const g=this.getCurrentContext(t.chunkMeta);g&&(t.frag=g.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var s;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(s=this.fragCurrent)==null?void 0:s.url}`);return}const o=t.details===G.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);const a=t.errorAction,{action:c,retryCount:f=0,retryConfig:h}=a||{};if(a&&c===ot.RetryRequest&&h){this.resetStartWhenNotLoaded(this.levelLastLoaded);const g=fu(h,f);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${f+1}/${h.maxNumRetry} in ${g}ms`),a.resolved=!0,this.retryDate=self.performance.now()+g,this.state=W.FRAG_LOADING_WAITING_RETRY}else if(h&&a)if(this.resetFragmentErrors(e),f<h.maxNumRetry)!o&&c!==ot.RemoveAlternatePermanently&&(a.resolved=!0);else{F.warn(`${t.details} reached or exceeded max retry (${f})`);return}else(a==null?void 0:a.action)===ot.SendAlternateToPenaltyBox?this.state=W.WAITING_LEVEL:this.state=W.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===W.PARSING||this.state===W.PARSED){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),o=s&&s.len>.5;o&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const a=!o;return a&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Ee.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==W.STOPPED&&(this.state=W.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const s=Ne.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===W.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=W.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){var o;const a=r.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((f,h)=>{const g=e.elementaryStreams[h];if(g){const p=g.endPTS-g.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${h} duration reliably (${p})`),f||!1;const E=s?0:Yh(a,e,g.startPTS,g.endPTS,g.startDTS,g.endDTS);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:a,level:r,drift:E,type:h,frag:e,start:g.startPTS,end:g.endPTS}),!0}return f},!1)&&((o=this.transmuxer)==null?void 0:o.error)===null){const f=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(r.fragmentError===0&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(f.message),this.hls.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,error:f,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=W.PARSED,this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class tg{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=Uy(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function Uy(l,e){const t=new Uint8Array(e);let r=0;for(let s=0;s<l.length;s++){const o=l[s];t.set(o,r),r+=o.length}return t}function By(){return typeof __HLS_WORKER_BUNDLE__=="function"}function $y(){const l=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(l);return{worker:new self.Worker(e),objectURL:e}}function Gy(l){const e=new self.URL(l,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function en(l="",e=9e4){return{type:l,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class pu{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Nt(this.cachedData,e),this.cachedData=null);let r=wi(e,0),s=r?r.length:0,o;const a=this._audioTrack,c=this._id3Track,f=r?cu(r):void 0,h=e.length;for((this.basePTS===null||this.frameIndex===0&&se(f))&&(this.basePTS=Ky(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Wt.audioId3,duration:Number.POSITIVE_INFINITY});s<h;){if(this.canParse(e,s)){const g=this.appendFrame(a,e,s);g?(this.frameIndex++,this.lastPTS=g.sample.pts,s+=g.length,o=s):s=h}else u0(e,s)?(r=wi(e,s),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Wt.audioId3,duration:Number.POSITIVE_INFINITY}),s+=r.length,o=s):s++;if(s===h&&o!==h){const g=tr(e,o);this.cachedData?this.cachedData=Nt(this.cachedData,g):this.cachedData=g}}return{audioTrack:a,videoTrack:en(),id3Track:c,textTrack:en()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:en(),id3Track:this._id3Track,textTrack:en()}}destroy(){}}const Ky=(l,e,t)=>{if(se(l))return l*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};function Vy(l,e,t,r){let s,o,a,c;const f=navigator.userAgent.toLowerCase(),h=r,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((e[t+2]&192)>>>6)+1;const p=(e[t+2]&60)>>>2;if(p>g.length-1){const E=new Error(`invalid ADTS sampling index:${p}`);l.emit(L.ERROR,L.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message});return}return a=(e[t+2]&1)<<2,a|=(e[t+3]&192)>>>6,F.log(`manifest codec:${r}, ADTS type:${s}, samplingIndex:${p}`),/firefox/i.test(f)?p>=6?(s=5,c=new Array(4),o=p-3):(s=2,c=new Array(2),o=p):f.indexOf("android")!==-1?(s=2,c=new Array(2),o=p):(s=5,c=new Array(4),r&&(r.indexOf("mp4a.40.29")!==-1||r.indexOf("mp4a.40.5")!==-1)||!r&&p>=6?o=p-3:((r&&r.indexOf("mp4a.40.2")!==-1&&(p>=6&&a===1||/vivaldi/i.test(f))||!r&&a===1)&&(s=2,c=new Array(2)),o=p)),c[0]=s<<3,c[0]|=(p&14)>>1,c[1]|=(p&1)<<7,c[1]|=a<<3,s===5&&(c[1]|=(o&14)>>1,c[2]=(o&1)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:g[p],channelCount:a,codec:"mp4a.40."+s,manifestCodec:h}}function ng(l,e){return l[e]===255&&(l[e+1]&246)===240}function rg(l,e){return l[e+1]&1?7:9}function yu(l,e){return(l[e+3]&3)<<11|l[e+4]<<3|(l[e+5]&224)>>>5}function Hy(l,e){return e+5<l.length}function xo(l,e){return e+1<l.length&&ng(l,e)}function zy(l,e){return Hy(l,e)&&ng(l,e)&&yu(l,e)<=l.length-e}function Wy(l,e){if(xo(l,e)){const t=rg(l,e);if(e+t>=l.length)return!1;const r=yu(l,e);if(r<=t)return!1;const s=e+r;return s===l.length||xo(l,s)}return!1}function ig(l,e,t,r,s){if(!l.samplerate){const o=Vy(e,t,r,s);if(!o)return;l.config=o.config,l.samplerate=o.samplerate,l.channelCount=o.channelCount,l.codec=o.codec,l.manifestCodec=o.manifestCodec,F.log(`parsed codec:${l.codec}, rate:${o.samplerate}, channels:${o.channelCount}`)}}function sg(l){return 1024*9e4/l}function jy(l,e){const t=rg(l,e);if(e+t<=l.length){const r=yu(l,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function og(l,e,t,r,s){const o=sg(l.samplerate),a=r+s*o,c=jy(e,t);let f;if(c){const{frameLength:p,headerLength:E}=c,T=E+p,x=Math.max(0,t+T-e.length);x?(f=new Uint8Array(T-E),f.set(e.subarray(t+E,e.length),0)):f=e.subarray(t+E,t+T);const S={unit:f,pts:a};return x||l.samples.push(S),{sample:S,length:T,missing:x}}const h=e.length-t;return f=new Uint8Array(h),f.set(e.subarray(t,e.length),0),{sample:{unit:f,pts:a},length:h,missing:-1}}let qs=null;const Yy=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],qy=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Xy=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Qy=[0,1,1,4];function ag(l,e,t,r,s){if(t+24>e.length)return;const o=lg(e,t);if(o&&t+o.frameLength<=e.length){const a=o.samplesPerFrame*9e4/o.sampleRate,c=r+s*a,f={unit:e.subarray(t,t+o.frameLength),pts:c,dts:c};return l.config=[],l.channelCount=o.channelCount,l.samplerate=o.sampleRate,l.samples.push(f),{sample:f,length:o.frameLength,missing:0}}}function lg(l,e){const t=l[e+1]>>3&3,r=l[e+1]>>1&3,s=l[e+2]>>4&15,o=l[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&o!==3){const a=l[e+2]>>1&1,c=l[e+3]>>6,f=t===3?3-r:r===3?3:4,h=Yy[f*14+s-1]*1e3,p=qy[(t===3?0:t===2?1:2)*3+o],E=c===3?1:2,T=Xy[t][r],x=Qy[r],S=T*8*x,v=Math.floor(T*h/p+a)*x;if(qs===null){const C=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);qs=C?parseInt(C[1]):0}return!!qs&&qs<=87&&r===2&&h>=224e3&&c===0&&(l[e+3]=l[e+3]|128),{sampleRate:p,channelCount:E,frameLength:v,samplesPerFrame:S}}}function Eu(l,e){return l[e]===255&&(l[e+1]&224)===224&&(l[e+1]&6)!==0}function ug(l,e){return e+1<l.length&&Eu(l,e)}function Jy(l,e){return Eu(l,e)&&4<=l.length-e}function cg(l,e){if(e+1<l.length&&Eu(l,e)){const r=lg(l,e);let s=4;r!=null&&r.frameLength&&(s=r.frameLength);const o=e+s;return o===l.length||ug(l,o)}return!1}class Zy extends pu{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=wi(e,0);let r=(t==null?void 0:t.length)||0;if(cg(e,r))return!1;for(let s=e.length;r<s;r++)if(Wy(e,r))return F.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return zy(e,t)}appendFrame(e,t,r){ig(e,this.observer,t,r,e.manifestCodec);const s=og(e,t,r,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const eE=/\/emsg[-/]ID3/i;class tE{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const o=this.videoTrack=en("video",1),a=this.audioTrack=en("audio",1),c=this.txtTrack=en("text",1);if(this.id3Track=en("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const f=$h(e);if(f.video){const{id:h,timescale:g,codec:p}=f.video;o.id=h,o.timescale=c.timescale=g,o.codec=p}if(f.audio){const{id:h,timescale:g,codec:p}=f.audio;a.id=h,a.timescale=g,a.codec=p}c.id=Mh.text,o.sampleDuration=0,o.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return E0(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,o=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Nt(this.remainderData,e));const c=I0(r);this.remainderData=c.remainder,s.samples=c.valid||new Uint8Array}else s.samples=r;const a=this.extractID3Track(s,t);return o.samples=Pd(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=Pd(e,t),{videoTrack:t,audioTrack:en(),id3Track:s,textTrack:en()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=Ae(e.samples,["emsg"]);s&&s.forEach(o=>{const a=D0(o);if(eE.test(a.schemeIdUri)){const c=se(a.presentationTime)?a.presentationTime/a.timeScale:t+a.presentationTimeDelta/a.timeScale;let f=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const h=a.payload;r.samples.push({data:h,len:h.byteLength,dts:c,pts:c,type:Wt.emsg,duration:f})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const fg=(l,e)=>{let t=0,r=5;e+=r;const s=new Uint32Array(1),o=new Uint32Array(1),a=new Uint8Array(1);for(;r>0;){a[0]=l[e];const c=Math.min(r,8),f=8-c;o[0]=4278190080>>>24+f<<f,s[0]=(a[0]&o[0])>>f,t=t?t<<c|s[0]:s[0],e+=1,r-=c}return t};class nE extends pu{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=dg(e,t,r,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=wi(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&cu(t)!==void 0&&fg(e,r)<16}}function dg(l,e,t,r,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const o=e[t+4]>>6;if(o>=3)return-1;const c=[48e3,44100,32e3][o],f=e[t+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+o]*2;if(t+g>e.length)return-1;const p=e[t+6]>>5;let E=0;p===2?E+=2:(p&1&&p!==1&&(E+=2),p&4&&(E+=2));const T=(e[t+6]<<8|e[t+7])>>12-E&1,S=[2,1,2,3,3,4,4,5][p]+T,v=e[t+5]>>3,R=e[t+5]&7,k=new Uint8Array([o<<6|v<<1|R>>2,(R&3)<<6|p<<3|T<<2|f>>4,f<<4&224]),C=1536/c*9e4,M=r+s*C,_=e.subarray(t,t+g);return l.config=k,l.channelCount=S,l.samplerate=c,l.samples.push({unit:_,pts:M}),g}class rE{constructor(){this.VideoSample=null}createVideoSample(e,t,r,s){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:s,length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,s;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const o=r.units;s=o[o.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,s=r.length;if(s){const o=r[s-1];e.pts=o.pts,e.dts=o.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&F.log(e.pts+"/"+e.dts+":"+e.debug)}}class oh{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),o=Math.min(4,t);if(o===0)throw new Error("no bytes available");s.set(e.subarray(r,r+o)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=o*8,this.bytesAvailable-=o}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&F.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,r=8,s;for(let o=0;o<e;o++)r!==0&&(s=this.readEG(),r=(t+s+256)%256),t=r===0?t:r}readSPS(){let e=0,t=0,r=0,s=0,o,a,c;const f=this.readUByte.bind(this),h=this.readBits.bind(this),g=this.readUEG.bind(this),p=this.readBoolean.bind(this),E=this.skipBits.bind(this),T=this.skipEG.bind(this),x=this.skipUEG.bind(this),S=this.skipScalingList.bind(this);f();const v=f();if(h(5),E(3),f(),x(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){const V=g();if(V===3&&E(1),x(),x(),E(1),p())for(a=V!==3?8:12,c=0;c<a;c++)p()&&(c<6?S(16):S(64))}x();const R=g();if(R===0)g();else if(R===1)for(E(1),T(),T(),o=g(),c=0;c<o;c++)T();x(),E(1);const k=g(),C=g(),M=h(1);M===0&&E(1),E(1),p()&&(e=g(),t=g(),r=g(),s=g());let _=[1,1];if(p()&&p())switch(f()){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:{_=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((k+1)*16-e*2-t*2),height:(2-M)*(C+1)*16-(M?2:4)*(r+s),pixelRatio:_}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class iE extends rE{parseAVCPES(e,t,r,s,o){const a=this.parseAVCNALu(e,r.data);let c=this.VideoSample,f,h=!1;r.data=null,c&&a.length&&!e.audFound&&(this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),a.forEach(g=>{var p;switch(g.type){case 1:{let S=!1;f=!0;const v=g.data;if(h&&v.length>4){const R=new oh(v).readSliceType();(R===2||R===4||R===7||R===9)&&(S=!0)}if(S){var E;(E=c)!=null&&E.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),c.frame=!0,c.key=S;break}case 5:f=!0,(p=c)!=null&&p.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),c.key=!0,c.frame=!0;break;case 6:{f=!0,Kh(g.data,1,r.pts,t.samples);break}case 7:{var T,x;f=!0,h=!0;const S=g.data,R=new oh(S).readSPS();if(!e.sps||e.width!==R.width||e.height!==R.height||((T=e.pixelRatio)==null?void 0:T[0])!==R.pixelRatio[0]||((x=e.pixelRatio)==null?void 0:x[1])!==R.pixelRatio[1]){e.width=R.width,e.height=R.height,e.pixelRatio=R.pixelRatio,e.sps=[S],e.duration=o;const k=S.subarray(1,4);let C="avc1.";for(let M=0;M<3;M++){let _=k[M].toString(16);_.length<2&&(_="0"+_),C+=_}e.codec=C}break}case 8:f=!0,e.pps=[g.data];break;case 9:f=!0,e.audFound=!0,c&&this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"");break;case 12:f=!0;break;default:f=!1,c&&(c.debug+="unknown NAL "+g.type+" ");break}c&&f&&c.units.push(g)}),s&&c&&(this.pushAccessUnit(c,e),this.VideoSample=null)}parseAVCNALu(e,t){const r=t.byteLength;let s=e.naluState||0;const o=s,a=[];let c=0,f,h,g,p=-1,E=0;for(s===-1&&(p=0,E=t[0]&31,s=0,c=1);c<r;){if(f=t[c++],!s){s=f?0:1;continue}if(s===1){s=f?0:2;continue}if(!f)s=3;else if(f===1){if(h=c-s-1,p>=0){const T={data:t.subarray(p,h),type:E};a.push(T)}else{const T=this.getLastNalUnit(e.samples);T&&(o&&c<=4-o&&T.state&&(T.data=T.data.subarray(0,T.data.byteLength-o)),h>0&&(T.data=Nt(T.data,t.subarray(0,h)),T.state=0))}c<r?(g=t[c]&31,p=c,E=g,s=0):s=-1}else s=0}if(p>=0&&s>=0){const T={data:t.subarray(p,r),type:E,state:s};a.push(T)}if(a.length===0){const T=this.getLastNalUnit(e.samples);T&&(T.data=Nt(T.data,t))}return e.naluState=s,a}}class sE{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new gu(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const o=s.subarray(16,s.length-s.length%16),a=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(a).then(c=>{const f=new Uint8Array(c);s.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let s=0;for(let o=32;o<e.length-16;o+=160,s+=16)r.set(e.subarray(o,o+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let o=32;o<e.length-16;o+=160,s+=16)e.set(r.subarray(s,s+16),o);return e}decryptAvcSample(e,t,r,s,o){const a=Vh(o.data),c=this.getAvcEncryptedData(a);this.decryptBuffer(c.buffer).then(f=>{o.data=this.getAvcDecryptedUnit(a,f),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)})}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){s();return}const o=e[t].units;for(;!(r>=o.length);r++){const a=o[r];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,r,s,a),!this.decrypter.isSync()))return}}}}const et=188;class Un{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.videoParser=new iE}static probe(e){const t=Un.syncOffset(e);return t>0&&F.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length;let r=Math.min(et*5,t-et)+1,s=0;for(;s<r;){let o=!1,a=-1,c=0;for(let f=s;f<t;f+=et)if(e[f]===71&&(t-f===et||e[f+et]===71)){if(c++,a===-1&&(a=f,a!==0&&(r=Math.min(a+et*99,e.length-et)+1)),o||(o=Zl(e,f)===0),o&&c>1&&(a===0&&c>2||f+et>r))return a}else{if(c)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Mh[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Un.createTrack("video"),this._audioTrack=Un.createTrack("audio",s),this._id3Track=Un.createTrack("id3"),this._txtTrack=Un.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){r||(this.sampleAes=null);let o;const a=this._videoTrack,c=this._audioTrack,f=this._id3Track,h=this._txtTrack;let g=a.pid,p=a.pesData,E=c.pid,T=f.pid,x=c.pesData,S=f.pesData,v=null,R=this.pmtParsed,k=this._pmtId,C=e.length;if(this.remainderData&&(e=Nt(this.remainderData,e),C=e.length,this.remainderData=null),C<et&&!s)return this.remainderData=e,{audioTrack:c,videoTrack:a,id3Track:f,textTrack:h};const M=Math.max(0,Un.syncOffset(e));C-=(C-M)%et,C<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,C,e.buffer.byteLength-C));let _=0;for(let U=M;U<C;U+=et)if(e[U]===71){const j=!!(e[U+1]&64),ee=Zl(e,U),H=(e[U+3]&48)>>4;let Q;if(H>1){if(Q=U+5+e[U+4],Q===U+et)continue}else Q=U+4;switch(ee){case g:j&&(p&&(o=_r(p))&&this.videoParser.parseAVCPES(a,h,o,!1,this._duration),p={data:[],size:0}),p&&(p.data.push(e.subarray(Q,U+et)),p.size+=U+et-Q);break;case E:if(j){if(x&&(o=_r(x)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,o);break;case"mp3":this.parseMPEGPES(c,o);break;case"ac3":this.parseAC3PES(c,o);break}x={data:[],size:0}}x&&(x.data.push(e.subarray(Q,U+et)),x.size+=U+et-Q);break;case T:j&&(S&&(o=_r(S))&&this.parseID3PES(f,o),S={data:[],size:0}),S&&(S.data.push(e.subarray(Q,U+et)),S.size+=U+et-Q);break;case 0:j&&(Q+=e[Q]+1),k=this._pmtId=oE(e,Q);break;case k:{j&&(Q+=e[Q]+1);const ge=aE(e,Q,this.typeSupported,r,this.observer);g=ge.videoPid,g>0&&(a.pid=g,a.segmentCodec=ge.segmentVideoCodec),E=ge.audioPid,E>0&&(c.pid=E,c.segmentCodec=ge.segmentAudioCodec),T=ge.id3Pid,T>0&&(f.pid=T),v!==null&&!R&&(F.warn(`MPEG-TS PMT found at ${U} after unknown PID '${v}'. Backtracking to sync byte @${M} to parse all TS packets.`),v=null,U=M-188),R=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=ee;break}}else _++;_>0&&To(this.observer,new Error(`Found ${_} TS packet/s that do not start with 0x47`)),a.pesData=p,c.pesData=x,f.pesData=S;const V={audioTrack:c,videoTrack:a,id3Track:f,textTrack:h};return s&&this.extractRemainingSamples(V),V}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:o}=e,a=r.pesData,c=t.pesData,f=s.pesData;let h;if(a&&(h=_r(a))?(this.videoParser.parseAVCPES(r,o,h,!0,this._duration),r.pesData=null):r.pesData=a,c&&(h=_r(c))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,h);break;case"mp3":this.parseMPEGPES(t,h);break;case"ac3":this.parseAC3PES(t,h);break}t.pesData=null}else c!=null&&c.size&&F.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;f&&(h=_r(f))?(this.parseID3PES(s,h),s.pesData=null):s.pesData=f}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),o=this.sampleAes=new sE(this.observer,this.config,t);return this.decrypt(s,o)}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:o}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{o.samples?t.decryptAvcSamples(o.samples,0,0,()=>{r(e)}):r(e)}):o.samples&&t.decryptAvcSamples(o.samples,0,0,()=>{r(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let o=t.data;if(s){this.aacOverFlow=null;const p=s.missing,E=s.sample.unit.byteLength;if(p===-1)o=Nt(s.sample.unit,o);else{const T=E-p;s.sample.unit.set(o.subarray(0,p),T),e.samples.push(s.sample),r=s.missing}}let a,c;for(a=r,c=o.length;a<c-1&&!xo(o,a);a++);if(a!==r){let p;const E=a<c-1;if(E?p=`AAC PES did not start with ADTS header,offset:${a}`:p="No ADTS header found in AAC PES",To(this.observer,new Error(p),E),!E)return}ig(e,this.observer,o,a,this.audioCodec);let f;if(t.pts!==void 0)f=t.pts;else if(s){const p=sg(e.samplerate);f=s.sample.pts+p}else{F.warn("[tsdemuxer]: AAC PES unknown PTS");return}let h=0,g;for(;a<c;)if(g=og(e,o,a,f,h),a+=g.length,g.missing){this.aacOverFlow=g;break}else for(h++;a<c-1&&!xo(o,a);a++);}parseMPEGPES(e,t){const r=t.data,s=r.length;let o=0,a=0;const c=t.pts;if(c===void 0){F.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(ug(r,a)){const f=ag(e,r,a,c,o);if(f)a+=f.length,o++;else break}else a++}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(s===void 0){F.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const o=r.length;let a=0,c=0,f;for(;c<o&&(f=dg(e,r,c,s,a++))>0;)c+=f}}parseID3PES(e,t){if(t.pts===void 0){F.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=je({},t,{type:this._videoTrack?Wt.emsg:Wt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Zl(l,e){return((l[e+1]&31)<<8)+l[e+2]}function oE(l,e){return(l[e+10]&31)<<8|l[e+11]}function aE(l,e,t,r,s){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(l[e+1]&15)<<8|l[e+2],c=e+3+a-4,f=(l[e+10]&15)<<8|l[e+11];for(e+=12+f;e<c;){const h=Zl(l,e),g=(l[e+3]&15)<<8|l[e+4];switch(l[e]){case 207:if(!r){Fl("ADTS AAC");break}case 15:o.audioPid===-1&&(o.audioPid=h);break;case 21:o.id3Pid===-1&&(o.id3Pid=h);break;case 219:if(!r){Fl("H.264");break}case 27:o.videoPid===-1&&(o.videoPid=h,o.segmentVideoCodec="avc");break;case 3:case 4:!t.mpeg&&!t.mp3?F.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=h,o.segmentAudioCodec="mp3");break;case 193:if(!r){Fl("AC-3");break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=h,o.segmentAudioCodec="ac3"):F.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&g>0){let p=e+5,E=g;for(;E>2;){switch(l[p]){case 106:t.ac3!==!0?F.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=h,o.segmentAudioCodec="ac3");break}const x=l[p+1]+2;p+=x,E-=x}}break;case 194:case 135:return To(s,new Error("Unsupported EC-3 in M2TS found")),o;case 36:return To(s,new Error("Unsupported HEVC in M2TS found")),o}e+=g+5}return o}function To(l,e,t){F.warn(`parsing error: ${e.message}`),l.emit(L.ERROR,L.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Fl(l){F.log(`${l} with AES-128-CBC encryption found in unencrypted stream`)}function _r(l){let e=0,t,r,s,o,a;const c=l.data;if(!l||l.size===0)return null;for(;c[0].length<19&&c.length>1;)c[0]=Nt(c[0],c[1]),c.splice(1,1);if(t=c[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(r=(t[4]<<8)+t[5],r&&r>l.size-6)return null;const h=t[7];h&192&&(o=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,h&64?(a=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,o-a>60*9e4&&(F.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),s=t[8];let g=s+9;if(l.size<=g)return null;l.size-=g;const p=new Uint8Array(l.size);for(let E=0,T=c.length;E<T;E++){t=c[E];let x=t.byteLength;if(g)if(g>x){g-=x;continue}else t=t.subarray(g),x-=g,g=0;p.set(t,e),e+=x}return r&&(r-=s+3),{data:p,pts:o,dts:a,len:r}}return null}class lE extends pu{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=wi(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&cu(t)!==void 0&&fg(e,r)<=16)return!1;for(let s=e.length;r<s;r++)if(cg(e,r))return F.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Jy(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return ag(e,t,r,this.basePTS,this.frameIndex)}}class ah{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Mn=Math.pow(2,32)-1;class O{static init(){O.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in O.types)O.types.hasOwnProperty(e)&&(O.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);O.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);O.STTS=O.STSC=O.STCO=o,O.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),O.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),O.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),O.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);O.FTYP=O.box(O.types.ftyp,a,f,a,c),O.DINF=O.box(O.types.dinf,O.box(O.types.dref,s))}static box(e,...t){let r=8,s=t.length;const o=s;for(;s--;)r+=t[s].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=r&255,a.set(e,4),s=0,r=8;s<o;s++)a.set(t[s],r),r+=t[s].byteLength;return a}static hdlr(e){return O.box(O.types.hdlr,O.HDLR_TYPES[e])}static mdat(e){return O.box(O.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(Mn+1)),s=Math.floor(t%(Mn+1));return O.box(O.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return O.box(O.types.mdia,O.mdhd(e.timescale,e.duration),O.hdlr(e.type),O.minf(e))}static mfhd(e){return O.box(O.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?O.box(O.types.minf,O.box(O.types.smhd,O.SMHD),O.DINF,O.stbl(e)):O.box(O.types.minf,O.box(O.types.vmhd,O.VMHD),O.DINF,O.stbl(e))}static moof(e,t,r){return O.box(O.types.moof,O.mfhd(e),O.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=O.trak(e[t]);return O.box.apply(null,[O.types.moov,O.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(O.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=O.trex(e[t]);return O.box.apply(null,[O.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(Mn+1)),s=Math.floor(t%(Mn+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return O.box(O.types.mvhd,o)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,o;for(s=0;s<t.length;s++)o=t[s].flags,r[s+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return O.box(O.types.sdtp,r)}static stbl(e){return O.box(O.types.stbl,O.stsd(e),O.box(O.types.stts,O.STTS),O.box(O.types.stsc,O.STSC),O.box(O.types.stsz,O.STSZ),O.box(O.types.stco,O.STCO))}static avc1(e){let t=[],r=[],s,o,a;for(s=0;s<e.sps.length;s++)o=e.sps[s],a=o.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(o));for(s=0;s<e.pps.length;s++)o=e.pps[s],a=o.byteLength,r.push(a>>>8&255),r.push(a&255),r=r.concat(Array.prototype.slice.call(o));const c=O.box(O.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),f=e.width,h=e.height,g=e.pixelRatio[0],p=e.pixelRatio[1];return O.box(O.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,O.box(O.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),O.box(O.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return O.box(O.types.mp4a,O.audioStsd(e),O.box(O.types.esds,O.esds(e)))}static mp3(e){return O.box(O.types[".mp3"],O.audioStsd(e))}static ac3(e){return O.box(O.types["ac-3"],O.audioStsd(e),O.box(O.types.dac3,e.config))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?O.box(O.types.stsd,O.STSD,O.mp3(e)):e.segmentCodec==="ac3"?O.box(O.types.stsd,O.STSD,O.ac3(e)):O.box(O.types.stsd,O.STSD,O.mp4a(e)):O.box(O.types.stsd,O.STSD,O.avc1(e))}static tkhd(e){const t=e.id,r=e.duration*e.timescale,s=e.width,o=e.height,a=Math.floor(r/(Mn+1)),c=Math.floor(r%(Mn+1));return O.box(O.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,o>>8&255,o&255,0,0]))}static traf(e,t){const r=O.sdtp(e),s=e.id,o=Math.floor(t/(Mn+1)),a=Math.floor(t%(Mn+1));return O.box(O.types.traf,O.box(O.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),O.box(O.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255])),O.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,O.box(O.types.trak,O.tkhd(e),O.mdia(e))}static trex(e){const t=e.id;return O.box(O.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,o=12+16*s,a=new Uint8Array(o);let c,f,h,g,p,E;for(t+=8+o,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<s;c++)f=r[c],h=f.duration,g=f.size,p=f.flags,E=f.cts,a.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,E>>>24&255,E>>>16&255,E>>>8&255,E&255],12+16*c);return O.box(O.types.trun,a)}static initSegment(e){O.types||O.init();const t=O.moov(e);return Nt(O.FTYP,t)}}O.types=void 0;O.HDLR_TYPES=void 0;O.STTS=void 0;O.STSC=void 0;O.STCO=void 0;O.STSZ=void 0;O.VMHD=void 0;O.SMHD=void 0;O.STSD=void 0;O.FTYP=void 0;O.DINF=void 0;const hg=9e4;function xu(l,e,t=1,r=!1){const s=l*e*t;return r?Math.round(s):s}function uE(l,e,t=1,r=!1){return xu(l,e,1/t,r)}function Ii(l,e=!1){return xu(l,1e3,1/hg,e)}function cE(l,e=1){return xu(l,hg,1/e)}const fE=10*1e3,lh=1024,dE=1152,hE=1536;let Pr=null,bl=null;class io{constructor(e,t,r,s=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Pr===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Pr=a?parseInt(a[1]):0}if(bl===null){const o=navigator.userAgent.match(/Safari\/(\d+)/i);bl=o?parseInt(o[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){F.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){F.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){F.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((o,a)=>{let c=a.pts,f=c-o;return f<-4294967296&&(t=!0,c=bt(c,r),f=c-o),f>0?o:c},r);return t&&F.debug("PTS rollover detected"),s}remux(e,t,r,s,o,a,c,f){let h,g,p,E,T,x,S=o,v=o;const R=e.pid>-1,k=t.pid>-1,C=t.samples.length,M=e.samples.length>0,_=c&&C>0||C>1;if((!R||M)&&(!k||_)||this.ISGenerated||c){if(this.ISGenerated){var U,j,ee,H;const fe=this.videoTrackConfig;fe&&(t.width!==fe.width||t.height!==fe.height||((U=t.pixelRatio)==null?void 0:U[0])!==((j=fe.pixelRatio)==null?void 0:j[0])||((ee=t.pixelRatio)==null?void 0:ee[1])!==((H=fe.pixelRatio)==null?void 0:H[1]))&&this.resetInitSegment()}else p=this.generateIS(e,t,o,a);const Q=this.isVideoContiguous;let ge=-1,te;if(_&&(ge=gE(t.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(x=!0,ge>0){F.warn(`[mp4-remuxer]: Dropped ${ge} out of ${C} video samples due to a missing keyframe`);const fe=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(ge),t.dropped+=ge,v+=(t.samples[0].pts-fe)/t.inputTimeScale,te=v}else ge===-1&&(F.warn(`[mp4-remuxer]: No keyframe found out of ${C} video samples`),x=!1);if(this.ISGenerated){if(M&&_){const fe=this.getVideoStartPts(t.samples),oe=(bt(e.samples[0].pts,fe)-fe)/t.inputTimeScale;S+=Math.max(0,oe),v+=Math.max(0,-oe)}if(M){if(e.samplerate||(F.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),p=this.generateIS(e,t,o,a)),g=this.remuxAudio(e,S,this.isAudioContiguous,a,k||_||f===Ee.AUDIO?v:void 0),_){const fe=g?g.endPTS-g.startPTS:0;t.inputTimeScale||(F.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),p=this.generateIS(e,t,o,a)),h=this.remuxVideo(t,v,Q,fe)}}else _&&(h=this.remuxVideo(t,v,Q,0));h&&(h.firstKeyFrame=ge,h.independent=ge!==-1,h.firstKeyFramePTS=te)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(T=gg(r,o,this._initPTS,this._initDTS)),s.samples.length&&(E=mg(s,o,this._initPTS))),{audio:g,video:h,initSegment:p,independent:x,text:E,id3:T}}generateIS(e,t,r,s){const o=e.samples,a=t.samples,c=this.typeSupported,f={},h=this._initPTS;let g=!h||s,p="audio/mp4",E,T,x;if(g&&(E=T=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(p="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}f.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):O.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(x=e.inputTimeScale,!h||x!==h.timescale?E=T=o[0].pts-Math.round(x*r):g=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:O.initSegment([t]),metadata:{width:t.width,height:t.height}},g)if(x=t.inputTimeScale,!h||x!==h.timescale){const S=this.getVideoStartPts(a),v=Math.round(x*r);T=Math.min(T,bt(a[0].dts,S)-v),E=Math.min(E,S-v)}else g=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,g?(this._initPTS={baseTime:E,timescale:x},this._initDTS={baseTime:T,timescale:x}):E=x=void 0,{tracks:f,initPTS:E,timescale:x}}remuxVideo(e,t,r,s){const o=e.inputTimeScale,a=e.samples,c=[],f=a.length,h=this._initPTS;let g=this.nextAvcDts,p=8,E=this.videoSampleDuration,T,x,S=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,R=!1;if(!r||g===null){const z=t*o,K=a[0].pts-bt(a[0].dts,a[0].pts);Pr&&g!==null&&Math.abs(z-K-g)<15e3?r=!0:g=z-K}const k=h.baseTime*o/h.timescale;for(let z=0;z<f;z++){const K=a[z];K.pts=bt(K.pts-k,g),K.dts=bt(K.dts-k,g),K.dts<a[z>0?z-1:z].dts&&(R=!0)}R&&a.sort(function(z,K){const D=z.dts-K.dts,$=z.pts-K.pts;return D||$}),T=a[0].dts,x=a[a.length-1].dts;const C=x-T,M=C?Math.round(C/(f-1)):E||e.inputTimeScale/30;if(r){const z=T-g,K=z>M,D=z<-1;if((K||D)&&(K?F.warn(`AVC: ${Ii(z,!0)} ms (${z}dts) hole between fragments detected at ${t.toFixed(3)}`):F.warn(`AVC: ${Ii(-z,!0)} ms (${z}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!D||g>=a[0].pts||Pr)){T=g;const $=a[0].pts-z;if(K)a[0].dts=T,a[0].pts=$;else for(let re=0;re<a.length&&!(a[re].dts>$);re++)a[re].dts-=z,a[re].pts-=z;F.log(`Video: Initial PTS/DTS adjusted: ${Ii($,!0)}/${Ii(T,!0)}, delta: ${Ii(z,!0)} ms`)}}T=Math.max(0,T);let _=0,V=0,U=T;for(let z=0;z<f;z++){const K=a[z],D=K.units,$=D.length;let re=0;for(let ce=0;ce<$;ce++)re+=D[ce].data.length;V+=re,_+=$,K.length=re,K.dts<U?(K.dts=U,U+=M/4|0||1):U=K.dts,S=Math.min(K.pts,S),v=Math.max(K.pts,v)}x=a[f-1].dts;const j=V+4*_+8;let ee;try{ee=new Uint8Array(j)}catch(z){this.observer.emit(L.ERROR,L.ERROR,{type:Se.MUX_ERROR,details:G.REMUX_ALLOC_ERROR,fatal:!1,error:z,bytes:j,reason:`fail allocating video mdat ${j}`});return}const H=new DataView(ee.buffer);H.setUint32(0,j),ee.set(O.types.mdat,4);let Q=!1,ge=Number.POSITIVE_INFINITY,te=Number.POSITIVE_INFINITY,fe=Number.NEGATIVE_INFINITY,de=Number.NEGATIVE_INFINITY;for(let z=0;z<f;z++){const K=a[z],D=K.units;let $=0;for(let xe=0,Te=D.length;xe<Te;xe++){const Re=D[xe],Ce=Re.data,be=Re.data.byteLength;H.setUint32(p,be),p+=4,ee.set(Ce,p),p+=be,$+=4+be}let re;if(z<f-1)E=a[z+1].dts-K.dts,re=a[z+1].pts-K.pts;else{const xe=this.config,Te=z>0?K.dts-a[z-1].dts:M;if(re=z>0?K.pts-a[z-1].pts:M,xe.stretchShortVideoTrack&&this.nextAudioPts!==null){const Re=Math.floor(xe.maxBufferHole*o),Ce=(s?S+s*o:this.nextAudioPts)-K.pts;Ce>Re?(E=Ce-Te,E<0?E=Te:Q=!0,F.log(`[mp4-remuxer]: It is approximately ${Ce/90} ms to the next segment; using duration ${E/90} ms for the last video frame.`)):E=Te}else E=Te}const ce=Math.round(K.pts-K.dts);ge=Math.min(ge,E),fe=Math.max(fe,E),te=Math.min(te,re),de=Math.max(de,re),c.push(new uh(K.key,E,$,ce))}if(c.length){if(Pr){if(Pr<70){const z=c[0].flags;z.dependsOn=2,z.isNonSync=0}}else if(bl&&de-te<fe-ge&&M/fe<.025&&c[0].cts===0){F.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let z=T;for(let K=0,D=c.length;K<D;K++){const $=z+c[K].duration,re=z+c[K].cts;if(K<D-1){const ce=$+c[K+1].cts;c[K].duration=ce-re}else c[K].duration=K?c[K-1].duration:M;c[K].cts=0,z=$}}}E=Q||!E?M:E,this.nextAvcDts=g=x+E,this.videoSampleDuration=E,this.isVideoContiguous=!0;const q={data1:O.moof(e.sequenceNumber++,T,je({},e,{samples:c})),data2:ee,startPTS:S/o,endPTS:(v+E)/o,startDTS:T/o,endDTS:g/o,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,q}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return dE;case"ac3":return hE;default:return lh}}remuxAudio(e,t,r,s,o){const a=e.inputTimeScale,c=e.samplerate?e.samplerate:a,f=a/c,h=this.getSamplesPerFrame(e),g=h*f,p=this._initPTS,E=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,T=[],x=o!==void 0;let S=e.samples,v=E?0:8,R=this.nextAudioPts||-1;const k=t*a,C=p.baseTime*a/p.timescale;if(this.isAudioContiguous=r=r||S.length&&R>0&&(s&&Math.abs(k-R)<9e3||Math.abs(bt(S[0].pts-C,k)-R)<20*g),S.forEach(function(oe){oe.pts=bt(oe.pts-C,k)}),!r||R<0){if(S=S.filter(oe=>oe.pts>=0),!S.length)return;o===0?R=0:s&&!x?R=Math.max(0,k):R=S[0].pts}if(e.segmentCodec==="aac"){const oe=this.config.maxAudioFramesDrift;for(let he=0,q=R;he<S.length;he++){const z=S[he],K=z.pts,D=K-q,$=Math.abs(1e3*D/a);if(D<=-oe*g&&x)he===0&&(F.warn(`Audio frame @ ${(K/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*D/a)} ms.`),this.nextAudioPts=R=q=K);else if(D>=oe*g&&$<fE&&x){let re=Math.round(D/g);q=K-re*g,q<0&&(re--,q+=g),he===0&&(this.nextAudioPts=R=q),F.warn(`[mp4-remuxer]: Injecting ${re} audio frame @ ${(q/a).toFixed(3)}s due to ${Math.round(1e3*D/a)} ms gap.`);for(let ce=0;ce<re;ce++){const xe=Math.max(q,0);let Te=ah.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);Te||(F.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Te=z.unit.subarray()),S.splice(he,0,{unit:Te,pts:xe}),q+=g,he++}}z.pts=q,q+=g}}let M=null,_=null,V,U=0,j=S.length;for(;j--;)U+=S[j].unit.byteLength;for(let oe=0,he=S.length;oe<he;oe++){const q=S[oe],z=q.unit;let K=q.pts;if(_!==null){const $=T[oe-1];$.duration=Math.round((K-_)/f)}else if(r&&e.segmentCodec==="aac"&&(K=R),M=K,U>0){U+=v;try{V=new Uint8Array(U)}catch($){this.observer.emit(L.ERROR,L.ERROR,{type:Se.MUX_ERROR,details:G.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:U,reason:`fail allocating audio mdat ${U}`});return}E||(new DataView(V.buffer).setUint32(0,U),V.set(O.types.mdat,4))}else return;V.set(z,v);const D=z.byteLength;v+=D,T.push(new uh(!0,h,D,0)),_=K}const ee=T.length;if(!ee)return;const H=T[T.length-1];this.nextAudioPts=R=_+f*H.duration;const Q=E?new Uint8Array(0):O.moof(e.sequenceNumber++,M/f,je({},e,{samples:T}));e.samples=[];const ge=M/a,te=R/a,de={data1:Q,data2:V,startPTS:ge,endPTS:te,startDTS:ge,endDTS:te,type:"audio",hasAudio:!0,hasVideo:!1,nb:ee};return this.isAudioContiguous=!0,de}remuxEmptyAudio(e,t,r,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,c=o/a,f=this.nextAudioPts,h=this._initDTS,g=h.baseTime*9e4/h.timescale,p=(f!==null?f:s.startDTS*o)+g,E=s.endDTS*o+g,T=c*lh,x=Math.ceil((E-p)/T),S=ah.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(F.warn("[mp4-remuxer]: remux empty Audio"),!S){F.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const v=[];for(let R=0;R<x;R++){const k=p+R*T;v.push({unit:S,pts:k,dts:k})}return e.samples=v,this.remuxAudio(e,t,r,!1)}}function bt(l,e){let t;if(e===null)return l;for(e<l?t=-8589934592:t=8589934592;Math.abs(l-e)>4294967296;)l+=t;return l}function gE(l){for(let e=0;e<l.length;e++)if(l[e].key)return e;return-1}function gg(l,e,t,r){const s=l.samples.length;if(!s)return;const o=l.inputTimeScale;for(let c=0;c<s;c++){const f=l.samples[c];f.pts=bt(f.pts-t.baseTime*o/t.timescale,e*o)/o,f.dts=bt(f.dts-r.baseTime*o/r.timescale,e*o)/o}const a=l.samples;return l.samples=[],{samples:a}}function mg(l,e,t){const r=l.samples.length;if(!r)return;const s=l.inputTimeScale;for(let a=0;a<r;a++){const c=l.samples[a];c.pts=bt(c.pts-t.baseTime*s/t.timescale,e*s)/s}l.samples.sort((a,c)=>a.pts-c.pts);const o=l.samples;return l.samples=[],{samples:o}}class uh{constructor(e,t,r,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=s,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class mE{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(S0(e,s)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const s=this.initData=$h(e);s.audio&&(t=ch(s.audio,Fe.AUDIO)),s.video&&(r=ch(s.video,Fe.VIDEO));const o={};s.audio&&s.video?o.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:s.audio?o.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:s.video?o.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:F.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,r,s,o,a){var c,f;let{initPTS:h,lastEndTime:g}=this;const p={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};se(g)||(g=this.lastEndTime=o||0);const E=t.samples;if(!(E!=null&&E.length))return p;const T={initPTS:void 0,timescale:1};let x=this.initData;if((c=x)!=null&&c.length||(this.generateInitSegment(E),x=this.initData),!((f=x)!=null&&f.length))return F.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),p;this.emitInitSegment&&(T.tracks=this.initTracks,this.emitInitSegment=!1);const S=L0(E,x),v=v0(x,E),R=v===null?o:v;(pE(h,R,o,S)||T.timescale!==h.timescale&&a)&&(T.initPTS=R-o,h&&h.timescale===1&&F.warn(`Adjusting initPTS by ${T.initPTS-h.baseTime}`),this.initPTS=h={baseTime:T.initPTS,timescale:1});const k=e?R-h.baseTime/h.timescale:g,C=k+S;R0(x,E,h.baseTime/h.timescale),S>0?this.lastEndTime=C:(F.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const M=!!x.audio,_=!!x.video;let V="";M&&(V+="audio"),_&&(V+="video");const U={data1:E,startPTS:k,startDTS:k,endPTS:C,endDTS:C,type:V,hasAudio:M,hasVideo:_,nb:1,dropped:0};return p.audio=U.type==="audio"?U:void 0,p.video=U.type!=="audio"?U:void 0,p.initSegment=T,p.id3=gg(r,o,h,h),s.samples.length&&(p.text=mg(s,o,h)),p}}function pE(l,e,t,r){if(l===null)return!0;const s=Math.max(r,1),o=e-l.baseTime/l.timescale;return Math.abs(o-t)>s}function ch(l,e){const t=l==null?void 0:l.codec;if(t&&t.length>4)return t;if(e===Fe.AUDIO){if(t==="ec-3"||t==="ac-3"||t==="alac")return t;if(t==="fLaC"||t==="Opus")return ho(t,!1);const r="mp4a.40.5";return F.info(`Parsed audio codec "${t}" or audio object type not handled. Using "${r}"`),r}return F.warn(`Unhandled video codec "${t}"`),t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":"avc1.42e01e"}let yn;try{yn=self.performance.now.bind(self.performance)}catch{F.debug("Unable to use Performance API on this environment"),yn=Nr==null?void 0:Nr.Date.now}const so=[{demux:tE,remux:mE},{demux:Un,remux:io},{demux:Zy,remux:io},{demux:lE,remux:io}];so.splice(2,0,{demux:nE,remux:io});class fh{constructor(e,t,r,s,o){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=s,this.id=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const o=r.transmuxing;o.executeStart=yn();let a=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:f}=this;s&&(this.currentTransmuxState=s);const{contiguous:h,discontinuity:g,trackSwitch:p,accurateTimeOffset:E,timeOffset:T,initSegmentChange:x}=s||c,{audioCodec:S,videoCodec:v,defaultInitPts:R,duration:k,initSegmentData:C}=f,M=yE(a,t);if(M&&M.method==="AES-128"){const j=this.getDecrypter();if(j.isSync()){let ee=j.softwareDecrypt(a,M.key.buffer,M.iv.buffer);if(r.part>-1&&(ee=j.flush()),!ee)return o.executeEnd=yn(),Ol(r);a=new Uint8Array(ee)}else return this.decryptionPromise=j.webCryptoDecrypt(a,M.key.buffer,M.iv.buffer).then(ee=>{const H=this.push(ee,null,r);return this.decryptionPromise=null,H}),this.decryptionPromise}const _=this.needsProbing(g,p);if(_){const j=this.configureTransmuxer(a);if(j)return F.warn(`[transmuxer] ${j.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,fatal:!1,error:j,reason:j.message}),o.executeEnd=yn(),Ol(r)}(g||p||x||_)&&this.resetInitSegment(C,S,v,k,t),(g||x||_)&&this.resetInitialTimestamp(R),h||this.resetContiguity();const V=this.transmux(a,M,T,E,r),U=this.currentTransmuxState;return U.contiguous=!0,U.discontinuity=!1,U.trackSwitch=!1,o.executeEnd=yn(),V}flush(e){const t=e.transmuxing;t.executeStart=yn();const{decrypter:r,currentTransmuxState:s,decryptionPromise:o}=this;if(o)return o.then(()=>this.flush(e));const a=[],{timeOffset:c}=s;if(r){const p=r.flush();p&&a.push(this.push(p,null,e))}const{demuxer:f,remuxer:h}=this;if(!f||!h)return t.executeEnd=yn(),[Ol(e)];const g=f.flush(c);return oo(g)?g.then(p=>(this.flushRemux(a,p,e),a)):(this.flushRemux(a,g,e),a)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:c}=t,{accurateTimeOffset:f,timeOffset:h}=this.currentTransmuxState;F.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const g=this.remuxer.remux(s,o,a,c,h,f,!0,this.id);e.push({remuxResult:g,chunkMeta:r}),r.transmuxing.executeEnd=yn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,o){const{demuxer:a,remuxer:c}=this;!a||!c||(a.resetInitSegment(e,t,r,s),c.resetInitSegment(e,t,r,o))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,o){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,r,s,o):a=this.transmuxUnencrypted(e,r,s,o),a}transmuxUnencrypted(e,t,r,s){const{audioTrack:o,videoTrack:a,id3Track:c,textTrack:f}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(o,a,c,f,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,o){return this.demuxer.demuxSampleAes(e,t,r).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,r,s,!1,this.id),chunkMeta:o}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s,vendor:o}=this;let a;for(let E=0,T=so.length;E<T;E++){var c;if((c=so[E].demux)!=null&&c.probe(e)){a=so[E];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const f=this.demuxer,h=this.remuxer,g=a.remux,p=a.demux;(!h||!(h instanceof g))&&(this.remuxer=new g(r,t,s,o)),(!f||!(f instanceof p))&&(this.demuxer=new p(r,t,s),this.probe=p.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new gu(this.config)),e}}function yE(l,e){let t=null;return l.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Ol=l=>({remuxResult:{},chunkMeta:l});function oo(l){return"then"in l&&l.then instanceof Function}class EE{constructor(e,t,r,s,o){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=o||null}}class xE{constructor(e,t,r,s,o,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=o,this.initSegmentChange=a}}var pg={exports:{}};(function(l){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(f,h,g){this.fn=f,this.context=h,this.once=g||!1}function o(f,h,g,p,E){if(typeof g!="function")throw new TypeError("The listener must be a function");var T=new s(g,p||f,E),x=t?t+h:h;return f._events[x]?f._events[x].fn?f._events[x]=[f._events[x],T]:f._events[x].push(T):(f._events[x]=T,f._eventsCount++),f}function a(f,h){--f._eventsCount===0?f._events=new r:delete f._events[h]}function c(){this._events=new r,this._eventsCount=0}c.prototype.eventNames=function(){var h=[],g,p;if(this._eventsCount===0)return h;for(p in g=this._events)e.call(g,p)&&h.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(g)):h},c.prototype.listeners=function(h){var g=t?t+h:h,p=this._events[g];if(!p)return[];if(p.fn)return[p.fn];for(var E=0,T=p.length,x=new Array(T);E<T;E++)x[E]=p[E].fn;return x},c.prototype.listenerCount=function(h){var g=t?t+h:h,p=this._events[g];return p?p.fn?1:p.length:0},c.prototype.emit=function(h,g,p,E,T,x){var S=t?t+h:h;if(!this._events[S])return!1;var v=this._events[S],R=arguments.length,k,C;if(v.fn){switch(v.once&&this.removeListener(h,v.fn,void 0,!0),R){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,g),!0;case 3:return v.fn.call(v.context,g,p),!0;case 4:return v.fn.call(v.context,g,p,E),!0;case 5:return v.fn.call(v.context,g,p,E,T),!0;case 6:return v.fn.call(v.context,g,p,E,T,x),!0}for(C=1,k=new Array(R-1);C<R;C++)k[C-1]=arguments[C];v.fn.apply(v.context,k)}else{var M=v.length,_;for(C=0;C<M;C++)switch(v[C].once&&this.removeListener(h,v[C].fn,void 0,!0),R){case 1:v[C].fn.call(v[C].context);break;case 2:v[C].fn.call(v[C].context,g);break;case 3:v[C].fn.call(v[C].context,g,p);break;case 4:v[C].fn.call(v[C].context,g,p,E);break;default:if(!k)for(_=1,k=new Array(R-1);_<R;_++)k[_-1]=arguments[_];v[C].fn.apply(v[C].context,k)}}return!0},c.prototype.on=function(h,g,p){return o(this,h,g,p,!1)},c.prototype.once=function(h,g,p){return o(this,h,g,p,!0)},c.prototype.removeListener=function(h,g,p,E){var T=t?t+h:h;if(!this._events[T])return this;if(!g)return a(this,T),this;var x=this._events[T];if(x.fn)x.fn===g&&(!E||x.once)&&(!p||x.context===p)&&a(this,T);else{for(var S=0,v=[],R=x.length;S<R;S++)(x[S].fn!==g||E&&!x[S].once||p&&x[S].context!==p)&&v.push(x[S]);v.length?this._events[T]=v.length===1?v[0]:v:a(this,T)}return this},c.prototype.removeAllListeners=function(h){var g;return h?(g=t?t+h:h,this._events[g]&&a(this,g)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,l.exports=c})(pg);var TE=pg.exports,Tu=Vp(TE);class yg{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const o=e.config;this.hls=e,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const a=(h,g)=>{g=g||{},g.frag=this.frag,g.id=this.id,h===L.ERROR&&(this.error=g.error),this.hls.trigger(h,g)};this.observer=new Tu,this.observer.on(L.FRAG_DECRYPTED,a),this.observer.on(L.ERROR,a);const c=nr(o.preferManagedMediaSource)||{isTypeSupported:()=>!1},f={mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:c.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(o.workerPath||By())){try{o.workerPath?(F.log(`loading Web Worker ${o.workerPath} for "${t}"`),this.workerContext=Gy(o.workerPath)):(F.log(`injecting Web Worker for "${t}"`),this.workerContext=$y()),this.onwmsg=p=>this.onWorkerMessage(p);const{worker:g}=this.workerContext;g.addEventListener("message",this.onwmsg),g.onerror=p=>{const E=new Error(`${p.message}  (${p.filename}:${p.lineno})`);o.enableWorker=!1,F.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:Se.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:E})},g.postMessage({cmd:"init",typeSupported:f,vendor:"",id:t,config:JSON.stringify(o)})}catch(g){F.warn(`Error setting up "${t}" Web Worker, fallback to inline`,g),this.resetWorker(),this.error=null,this.transmuxer=new fh(this.observer,f,o,"",t)}return}this.transmuxer=new fh(this.observer,f,o,"",t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,s,o,a,c,f,h,g){var p,E;h.transmuxing.start=self.performance.now();const{transmuxer:T}=this,x=a?a.start:o.start,S=o.decryptdata,v=this.frag,R=!(v&&o.cc===v.cc),k=!(v&&h.level===v.level),C=v?h.sn-v.sn:-1,M=this.part?h.part-this.part.index:-1,_=C===0&&h.id>1&&h.id===(v==null?void 0:v.stats.chunkCount),V=!k&&(C===1||C===0&&(M===1||_&&M<=0)),U=self.performance.now();(k||C||o.stats.parsing.start===0)&&(o.stats.parsing.start=U),a&&(M||!V)&&(a.stats.parsing.start=U);const j=!(v&&((p=o.initSegment)==null?void 0:p.url)===((E=v.initSegment)==null?void 0:E.url)),ee=new xE(R,V,f,k,x,j);if(!V||R||j){F.log(`[transmuxer-interface, ${o.type}]: Starting new transmux session for sn: ${h.sn} p: ${h.part} level: ${h.level} id: ${h.id}
        discontinuity: ${R}
        trackSwitch: ${k}
        contiguous: ${V}
        accurateTimeOffset: ${f}
        timeOffset: ${x}
        initSegmentChange: ${j}`);const H=new EE(r,s,t,c,g);this.configureTransmuxer(H)}if(this.frag=o,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:S,chunkMeta:h,state:ee},e instanceof ArrayBuffer?[e]:[]);else if(T){const H=T.push(e,S,h,ee);oo(H)?(T.async=!0,H.then(Q=>{this.handleTransmuxComplete(Q)}).catch(Q=>{this.transmuxerError(Q,h,"transmuxer-interface push error")})):(T.async=!1,this.handleTransmuxComplete(H))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);oo(r)||t.async?(oo(r)||(r=Promise.resolve(r)),r.then(o=>{this.handleFlushResult(o,e)}).catch(o=>{this.transmuxerError(o,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data;if(!(t!=null&&t.event)){F.warn(`worker message received with no ${t?"event name":"data"}`);return}const r=this.hls;if(this.hls)switch(t.event){case"init":{var s;const o=(s=this.workerContext)==null?void 0:s.objectURL;o&&self.URL.revokeObjectURL(o);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":F[t.data.logType]&&F[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function Eg(l,e){if(l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(!Ur(l[t].attrs,e[t].attrs))return!1;return!0}function Ur(l,e,t){const r=l["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>l[s]!==e[s])}function eu(l,e){return e.label.toLowerCase()===l.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(l.lang||"").toLowerCase())}const dh=100;class SE extends mu{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",Ee.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:o}){if(r==="main"){const a=t.cc;this.initPTS[t.cc]={baseTime:s,timescale:o},this.log(`InitPTS for cc: ${a} found from main: ${s}`),this.videoTrackCC=a,this.state===W.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=W.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(dh),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=W.IDLE):(this.loadedmetadata=!1,this.state=W.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case W.IDLE:this.doTickIdle();break;case W.WAITING_TRACK:{var e;const{levels:r,trackId:s}=this,o=r==null||(e=r[s])==null?void 0:e.details;if(o){if(this.waitForCdnTuneIn(o))break;this.state=W.WAITING_INIT_PTS}break}case W.FRAG_LOADING_WAITING_RETRY:{var t;const r=performance.now(),s=this.retryDate;if(!s||r>=s||(t=this.media)!=null&&t.seeking){const{levels:o,trackId:a}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((o==null?void 0:o[a])||null),this.state=W.IDLE}break}case W.WAITING_INIT_PTS:{const r=this.waitingData;if(r){const{frag:s,part:o,cache:a,complete:c}=r;if(this.initPTS[s.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=W.FRAG_LOADING;const f=a.flush(),h={frag:s,part:o,payload:f,networkDetails:null};this._handleFragmentLoadProgress(h),c&&super._handleFragmentLoadComplete(h)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${s.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const f=this.getLoadPosition(),h=Ne.bufferInfo(this.mediaBuffer,f,this.config.maxBufferHole);Jl(h.end,this.config.maxFragLookUpTolerance,s)<0&&(this.log(`Waiting fragment cc (${s.cc}) @ ${s.start} cancelled because another fragment at ${h.end} is needed`),this.clearWaitingFragment())}}else this.state=W.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=W.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:s}=this,o=e.config;if(!this.buffering||!r&&(this.startFragRequested||!o.startFragPrefetch)||!(t!=null&&t[s]))return;const a=t[s],c=a.details;if(!c||c.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(c)){this.state=W.WAITING_TRACK;return}const f=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&f&&(this.bufferFlushed=!1,this.afterBufferFlushed(f,Fe.AUDIO,Ee.AUDIO));const h=this.getFwdBufferInfo(f,Ee.AUDIO);if(h===null)return;const{bufferedTrack:g,switchingTrack:p}=this;if(!p&&this._streamEnded(h,c)){e.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=W.ENDED;return}const E=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Ee.MAIN),T=h.len,x=this.getMaxBufferLength(E==null?void 0:E.len),S=c.fragments,v=S[0].start;let R=this.flushing?this.getLoadPosition():h.end;if(p&&r){const _=this.getLoadPosition();g&&!Ur(p.attrs,g.attrs)&&(R=_),c.PTSKnown&&_<v&&(h.end>v||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=v+.05)}if(T>=x&&!p&&R<S[S.length-1].start)return;let k=this.getNextFragment(R,c),C=!1;if(k&&this.isLoopLoading(k,R)&&(C=!!k.gap,k=this.getNextFragmentLoopLoading(k,c,h,Ee.MAIN,x)),!k){this.bufferFlushed=!0;return}const M=E&&k.start>E.end+c.targetduration;if(M||!(E!=null&&E.len)&&h.len){const _=this.getAppendedFrag(k.start,Ee.MAIN);if(_===null||(C||(C=!!_.gap||!!M&&E.len===0),M&&!C||C&&h.nextStart&&h.nextStart<_.end))return}this.loadFragment(k,a,R)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Mr(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?this.setInterval(dh):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=W.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=W.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(L.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Audio tracks were reset while loading level ${a}`);return}this.log(`Audio track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`);const c=s[a];let f=0;if(o.live||(r=c.details)!=null&&r.live){this.checkLiveUpdate(o);const g=this.mainDetails;if(o.deltaUpdateFailed||!g)return;if(!c.details&&o.hasProgramDateTime&&g.hasProgramDateTime)Eo(o,g),f=o.fragments[0].start;else{var h;f=this.alignPlaylists(o,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}}c.details=o,this.levelLastLoaded=c,!this.startFragRequested&&(this.mainDetails||!o.live)&&this.setStartPosition(this.mainDetails||o,f),this.state===W.WAITING_TRACK&&!this.waitForCdnTuneIn(o)&&(this.state=W.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:s,payload:o}=e,{config:a,trackId:c,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const h=f[c];if(!h){this.warn("Audio track is undefined on fragment load progress");return}const g=h.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const p=a.defaultAudioCodec||h.audioCodec||"mp4a.40.2";let E=this.transmuxer;E||(E=this.transmuxer=new yg(this.hls,Ee.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const T=this.initPTS[r.cc],x=(t=r.initSegment)==null?void 0:t.data;if(T!==void 0){const v=s?s.index:-1,R=v!==-1,k=new hu(r.level,r.sn,r.stats.chunkCount,o.byteLength,v,R);E.push(o,x,p,"",r,s,g.totalduration,!1,k,T)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${g.startSN} ,${g.endSN}],track ${c}`);const{cache:S}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new tg,complete:!1};S.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=W.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type!==Ee.AUDIO){if(!this.loadedmetadata&&r.type===Ee.MAIN){const o=this.videoBuffer||this.media;o&&Ne.getBuffered(o).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(r.sn!=="initSegment"){this.fragPrevious=r;const o=this.switchingTrack;o&&(this.bufferedTrack=o,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,rt({},o)))}this.fragBufferedComplete(r,s)}onError(e,t){var r;if(t.fatal){this.state=W.ERROR;return}switch(t.details){case G.FRAG_GAP:case G.FRAG_PARSING_ERROR:case G.FRAG_DECRYPT_ERROR:case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ee.AUDIO,t);break;case G.AUDIO_TRACK_LOAD_ERROR:case G.AUDIO_TRACK_LOAD_TIMEOUT:case G.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===W.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===we.AUDIO_TRACK&&(this.state=W.IDLE);break;case G.BUFFER_APPEND_ERROR:case G.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;if(t.details===G.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case G.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Fe.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Fe.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===W.ENDED&&(this.state=W.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,Ee.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:o,chunkMeta:a}=e,c=this.getCurrentContext(a);if(!c){this.resetWhenMissingContext(a);return}const{frag:f,part:h,level:g}=c,{details:p}=g,{audio:E,text:T,id3:x,initSegment:S}=o;if(this.fragContextChanged(f)||!p){this.fragmentTracker.removeFragment(f);return}if(this.state=W.PARSING,this.switchingTrack&&E&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const v=f.initSegment||f;this._bufferInitSegment(g,S.tracks,v,a),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:r,tracks:S.tracks})}if(E){const{startPTS:v,endPTS:R,startDTS:k,endDTS:C}=E;h&&(h.elementaryStreams[Fe.AUDIO]={startPTS:v,endPTS:R,startDTS:k,endDTS:C}),f.setElementaryStreamInfo(Fe.AUDIO,v,R,k,C),this.bufferFragmentData(E,f,h,a)}if(x!=null&&(t=x.samples)!=null&&t.length){const v=je({id:r,frag:f,details:p},x);s.trigger(L.FRAG_PARSING_METADATA,v)}if(T){const v=je({id:r,frag:f,details:p},T);s.trigger(L.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,r,s){if(this.state!==W.PARSING)return;t.video&&delete t.video;const o=t.audio;if(!o)return;o.id="audio";const a=e.audioCodec;this.log(`Init audio buffer, container:${o.container}, codecs[level/parsed]=[${a}/${o.codec}]`),a&&a.split(",").length===1&&(o.levelCodec=a),this.hls.trigger(L.BUFFER_CODECS,t);const c=o.initSegment;if(c!=null&&c.byteLength){const f={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:c};this.hls.trigger(L.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||s===nt.NOT_LOADED||s===nt.PARTIAL){var o;if(e.sn==="initSegment")this._loadInitSegment(e,t);else if((o=t.details)!=null&&o.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=W.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragments[0].start!==t.details.fragments[0].start&&Eo(t.details,a)}else this.startFragRequested=!0,super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:r}=this,s=r==null?void 0:r.attrs,o=e.attrs;t&&s&&(s.CHANNELS!==o.CHANNELS||r.name!==e.name||r.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,rt({},e))}}class vE extends du{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:o}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==s){this.warn(`Audio track with id:${r} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const c=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${s} loaded [${o.startSN}-${o.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let o=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(c=>(s==null?void 0:s.indexOf(c))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(E=>!r||r.indexOf(E.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(E=>E.default)&&(this.selectDefaultTrack=!1),c.forEach((E,T)=>{E.id=T});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const f=this.hls.config.audioPreference;if(!o&&f){const E=nn(f,c,Dr);if(E>-1)o=c[E];else{const T=nn(f,this.tracks);o=this.tracks[T]}}let h=this.findTrackId(o);h===-1&&o&&(h=this.findTrackId(null));const g={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,g);const p=this.trackId;if(h!==-1&&p===-1)this.setAudioTrack(h);else if(c.length&&p===-1){var a;const E=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${c.length}`);this.warn(E.message),this.hls.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:E})}}else this.shouldReloadPlaylist(o)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===we.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&br(e,s,Dr))return s;const o=nn(e,this.tracksInGroup,Dr);if(o>-1){const a=this.tracksInGroup[o];return this.setAudioTrack(o),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const c=vy(e,t.levels,r,a,Dr);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const a=nn(e,r);if(a>-1)return r[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],o=s.details&&!s.details.live;if(e===this.trackId&&s===r&&o||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,rt({},s)),o))return;const a=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(!(this.selectDefaultTrack&&!s.default)&&(!e||br(e,s,Dr)))return r}if(e){const{name:r,lang:s,assocLang:o,characteristics:a,audioCodec:c,channels:f}=e;for(let h=0;h<t.length;h++){const g=t[h];if(br({name:r,lang:s,assocLang:o,characteristics:a,audioCodec:c,channels:f},g,Dr))return h}for(let h=0;h<t.length;h++){const g=t[h];if(Ur(e.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return h}for(let h=0;h<t.length;h++){const g=t[h];if(Ur(e.attrs,g.attrs,["LANGUAGE"]))return h}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const r=t.id,s=t.groupId;let o=t.url;if(e)try{o=e.addDirectives(o)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${s}`),this.clearTimer(),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:o,id:r,groupId:s,deliveryDirectives:e||null})}}}const hh=500;class LE extends mu{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",Ee.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.ERROR,this.onError,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.ERROR,this.onError,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=W.IDLE,this.setInterval(hh),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragPrevious=r,this.state=W.IDLE,!s)return;const o=this.tracksBuffered[this.currentTrackId];if(!o)return;let a;const c=r.start;for(let h=0;h<o.length;h++)if(c>=o[h].start&&c<=o[h].end){a=o[h];break}const f=r.start+r.duration;a?a.end=f:(a={start:c,end:f},o.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(r===0&&s!==Number.POSITIVE_INFINITY){const o=s-1;if(o<=0)return;t.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach(a=>{for(let c=0;c<a.length;){if(a[c].end<=o){a.shift();continue}else if(a[c].start<o)a[c].start=o;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(r,o,Ee.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===Ee.MAIN){var r;(r=this.media)!=null&&r.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===Ee.SUBTITLE&&(t.details===G.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==W.STOPPED&&(this.state=W.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Eg(this.levels,t)){this.levels=t.map(r=>new Mr(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const s=new Mr(r);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ee.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.setInterval(hh)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:o}=this,{details:a,id:c}=t;if(!o){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const f=o[c];if(c>=o.length||!f)return;this.log(`Subtitle track ${c} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let h=0;if(a.live||(r=f.details)!=null&&r.live){const p=this.mainDetails;if(a.deltaUpdateFailed||!p)return;const E=p.fragments[0];if(!f.details)a.hasProgramDateTime&&p.hasProgramDateTime?(Eo(a,p),h=a.fragments[0].start):E&&(h=E.start,Ql(a,h));else{var g;h=this.alignPlaylists(a,f.details,(g=this.levelLastLoaded)==null?void 0:g.details),h===0&&E&&(h=E.start,Ql(a,h))}}f.details=a,this.levelLastLoaded=f,c===s&&(!this.startFragRequested&&(this.mainDetails||!a.live)&&this.setStartPosition(this.mainDetails||a,h),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===W.IDLE&&(yo(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,o=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&s!=null&&s.key&&s.iv&&s.method==="AES-128"){const a=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer).catch(c=>{throw o.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const f=performance.now();o.trigger(L.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:a,tdecrypt:f}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=W.IDLE})}}doTick(){if(!this.media){this.state=W.IDLE;return}if(this.state===W.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details)return;const{config:s}=this,o=this.getLoadPosition(),a=Ne.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o,s.maxBufferHole),{end:c,len:f}=a,h=this.getFwdBufferInfo(this.media,Ee.MAIN),g=r.details,p=this.getMaxBufferLength(h==null?void 0:h.len)+g.levelTargetDuration;if(f>p)return;const E=g.fragments,T=E.length,x=g.edge;let S=null;const v=this.fragPrevious;if(c<x){const R=s.maxFragLookUpTolerance,k=c>x-R?0:R;S=yo(v,E,Math.max(E[0].start,c),k),!S&&v&&v.start<E[0].start&&(S=E[0])}else S=E[T-1];if(!S)return;if(S=this.mapToInitFragWhenRequired(S),S.sn!=="initSegment"){const R=S.sn-g.startSN,k=E[R-1];k&&k.cc===S.cc&&this.fragmentTracker.getState(k)===nt.NOT_LOADED&&(S=k)}this.fragmentTracker.getState(S)===nt.NOT_LOADED&&this.loadFragment(S,r,c)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new AE(this.tracksBuffered[this.currentTrackId]||[])}}class AE{constructor(e){this.buffered=void 0;const t=(r,s,o)=>{if(s=s>>>0,s>o-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${o})`);return e[s][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}class RE extends du{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=to(this.media.textTracks);for(let o=0;o<r.length;o++)if(r[o].mode==="hidden")t=r[o];else if(r[o].mode==="showing"){t=r[o];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),to(this.media.textTracks).forEach(t=>{Fr(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:o}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const c=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${s} loaded [${o.startSN}-${o.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let o=this.currentTrack;if(!r||(s==null?void 0:s.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(g=>!r||r.indexOf(g.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(g=>g.default)&&(this.selectDefaultTrack=!1),a.forEach((g,p)=>{g.id=p});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const c=this.hls.config.subtitlePreference;if(!o&&c){this.selectDefaultTrack=!1;const g=nn(c,a);if(g>-1)o=a[g];else{const p=nn(c,this.tracks);o=this.tracks[p]}}let f=this.findTrackId(o);f===-1&&o&&(f=this.findTrackId(null));const h={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,h),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}else this.shouldReloadPlaylist(o)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const o=t[s];if(!(r&&!o.default||!r&&!e)&&(!e||br(o,e)))return s}if(e){for(let s=0;s<t.length;s++){const o=t[s];if(Ur(e.attrs,o.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const o=t[s];if(Ur(e.attrs,o.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if(eu(s,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===we.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&br(e,r))return r;const s=nn(e,this.tracksInGroup);if(s>-1){const o=this.tracksInGroup[s];return this.setSubtitleTrack(s),o}else{if(r)return null;{const o=nn(e,t);if(o>-1)return t[o]}}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const r=t.id,s=t.groupId;let o=t.url;if(e)try{o=e.addDirectives(o)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:o,id:r,groupId:s,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=to(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(o=>eu(r,o))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(o=>{o.mode!=="disabled"&&o!==s&&(o.mode="disabled")}),s){const o=this.subtitleDisplay?"showing":"hidden";s.mode!==o&&(s.mode=o)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!se(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const o=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&o)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:c="",name:f,type:h,url:g}=s;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:a,groupId:c,name:f,type:h,url:g});const p=this.switchParams(s.url,r==null?void 0:r.details,s.details);this.loadPlaylist(p)}}class IE{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,r){const s=this.queues[t];s.push(e),s.length===1&&!r&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise(o=>{t=o}),s={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(s,e),r}executeNext(e){const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(s){F.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${s}`),r.onError(s);const o=this.buffers[e];o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const gh=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class CE{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=r=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:r,mediaSource:s}=this;this.log("Media source opened"),r&&(r.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:r,mediaSource:s})),s&&s.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:s}=this;r!==s&&F.error(`Media element src was set while attaching MediaSource (${s} > ${r})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=N0(nr(e.config.preferManagedMediaSource)),this.log=F.log.bind(F,t),this.warn=F.warn.bind(F,t),this.error=F.error.bind(F,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new IE(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media,s=nr(this.appendSource);if(r&&s){var o;const a=this.mediaSource=new s;this.log(`created media source: ${(o=a.constructor)==null?void 0:o.name}`),a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.addEventListener("startstreaming",this._onStartStreaming),a.addEventListener("endstreaming",this._onEndStreaming));const c=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{r.removeAttribute("src");const f=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||f&&a instanceof f,mh(r),wE(r,c),r.load()}catch{r.src=c}else r.src=c;r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(this.log("media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(s){this.warn(`onMediaDetaching: ${s.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&mh(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(L.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer(),this.hls.resumeBuffering()}resetBuffer(e){const t=this.sourceBuffer[e];try{if(t){var r;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(s){this.warn(`onBufferReset ${e}`,s)}}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length,s=Object.keys(t);if(s.forEach(a=>{if(r){const f=this.tracks[a];if(f&&typeof f.buffer.changeType=="function"){var c;const{id:h,codec:g,levelCodec:p,container:E,metadata:T}=t[a],x=Nd(f.codec,f.levelCodec),S=x==null?void 0:x.replace(gh,"$1");let v=Nd(g,p);const R=(c=v)==null?void 0:c.replace(gh,"$1");if(v&&S!==R){a.slice(0,5)==="audio"&&(v=ho(v,this.appendSource));const k=`${E};codecs=${v}`;this.appendChangeType(a,k),this.log(`switching codec ${x} to ${v}`),this.tracks[a]={buffer:f.buffer,codec:g,container:E,levelCodec:p,metadata:T,id:h}}}}else this.pendingTracks[a]=t[a]}),r)return;const o=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==o&&(this.log(`${o} bufferCodec event(s) expected ${s.join(",")}`),this.bufferCodecEventsExpected=o),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:r}=this,s={execute:()=>{const o=this.sourceBuffer[e];o&&(this.log(`changing ${e} sourceBuffer type to ${t}`),o.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};r.append(s,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:r,operationQueue:s,tracks:o}=this,{data:a,type:c,frag:f,part:h,chunkMeta:g}=t,p=g.buffering[c],E=self.performance.now();p.start=E;const T=f.stats.buffering,x=h?h.stats.buffering:null;T.start===0&&(T.start=E),x&&x.start===0&&(x.start=E);const S=o.audio;let v=!1;c==="audio"&&(S==null?void 0:S.container)==="audio/mpeg"&&(v=!this.lastMpegAudioChunk||g.id===1||this.lastMpegAudioChunk.sn!==g.sn,this.lastMpegAudioChunk=g);const R=f.start,k={execute:()=>{if(p.executeStart=self.performance.now(),v){const C=this.sourceBuffer[c];if(C){const M=R-C.timestampOffset;Math.abs(M)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${R} (delta: ${M}) sn: ${f.sn})`),C.timestampOffset=R)}}this.appendExecutor(a,c)},onStart:()=>{},onComplete:()=>{const C=self.performance.now();p.executeEnd=p.end=C,T.first===0&&(T.first=C),x&&x.first===0&&(x.first=C);const{sourceBuffer:M}=this,_={};for(const V in M)_[V]=Ne.getBuffered(M[V]);this.appendErrors[c]=0,c==="audio"||c==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:c,frag:f,part:h,chunkMeta:g,parent:f.type,timeRanges:_})},onError:C=>{const M={type:Se.MEDIA_ERROR,parent:f.type,details:G.BUFFER_APPEND_ERROR,sourceBufferName:c,frag:f,part:h,chunkMeta:g,error:C,err:C,fatal:!1};if(C.code===DOMException.QUOTA_EXCEEDED_ERR)M.details=G.BUFFER_FULL_ERROR;else{const _=++this.appendErrors[c];M.details=G.BUFFER_APPEND_ERROR,this.warn(`Failed ${_}/${r.config.appendErrorMaxRetry} times to append segment in "${c}" sourceBuffer`),_>=r.config.appendErrorMaxRetry&&(M.fatal=!0)}r.trigger(L.ERROR,M)}};s.append(k,c,!!this.pendingTracks[c])}onBufferFlushing(e,t){const{operationQueue:r}=this,s=o=>({execute:this.removeExecutor.bind(this,o,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:o})},onError:a=>{this.warn(`Failed to remove from ${o} SourceBuffer`,a)}});t.type?r.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(o=>{r.append(s(o),o)})}onFragParsed(e,t){const{frag:r,part:s}=t,o=[],a=s?s.elementaryStreams:r.elementaryStreams;a[Fe.AUDIOVIDEO]?o.push("audiovideo"):(a[Fe.AUDIO]&&o.push("audio"),a[Fe.VIDEO]&&o.push("video"));const c=()=>{const f=self.performance.now();r.stats.buffering.end=f,s&&(s.stats.buffering.end=f);const h=s?s.stats:r.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:r,part:s,stats:h,id:r.type})};o.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(c,o)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((s,o)=>{const a=this.sourceBuffer[o];return a&&(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} sourceBuffer now EOS`))),s&&!!(!a||a.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(o=>{const a=this.sourceBuffer[o];a&&(a.ending=!1)});const{mediaSource:s}=this;if(!s||s.readyState!=="open"){s&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${s.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),s.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.getSourceBufferTypes().length)return;const o=e.config,a=r.currentTime,c=t.levelTargetDuration,f=t.live&&o.liveBackBufferLength!==null?o.liveBackBufferLength:o.backBufferLength;if(se(f)&&f>0){const h=Math.max(f,c),g=Math.floor(a/c)*c-h;this.flushBackBuffer(a,c,g)}if(se(o.frontBufferFlushThreshold)&&o.frontBufferFlushThreshold>0){const h=Math.max(o.maxBufferLength,o.frontBufferFlushThreshold),g=Math.max(h,c),p=Math.floor(a/c)*c+g;this.flushFrontBuffer(a,c,p)}}flushBackBuffer(e,t,r){const{details:s,sourceBuffer:o}=this;this.getSourceBufferTypes().forEach(c=>{const f=o[c];if(f){const h=Ne.getBuffered(f);if(h.length>0&&r>h.start(0)){if(this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:r}),s!=null&&s.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(f.ended&&h.end(h.length-1)-e<t*2){this.log(`Cannot flush ${c} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:c})}}})}flushFrontBuffer(e,t,r){const{sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(a=>{const c=s[a];if(c){const f=Ne.getBuffered(c),h=f.length;if(h<2)return;const g=f.start(h-1),p=f.end(h-1);if(r>g||e>=g&&e<=p)return;if(c.ended&&e-p<2*t){this.log(`Cannot flush ${a} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:g,endOffset:1/0,type:a})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:r,mediaSource:s}=this,o=e.fragments[0].start+e.totalduration,a=r.duration,c=se(s.duration)?s.duration:0;e.live&&t.config.liveDurationInfinity?(s.duration=1/0,this.updateSeekableRange(e)):(o>c&&o>a||!se(a))&&(this.log(`Updating Media Source duration to ${o.toFixed(3)}`),s.duration=o)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){const o=Math.max(0,r[0].start),a=Math.max(o,o+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${o}-${a}.`),t.setLiveSeekableRange(o,a)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,s=Object.keys(r).length;if(s&&(!e||s===2||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};const o=this.getSourceBufferTypes();if(o.length)this.hls.trigger(L.BUFFER_CREATED,{tracks:this.tracks}),o.forEach(a=>{t.executeNext(a)});else{const a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const o in e)if(!t[o]){var s;const a=e[o];if(!a)throw Error(`source buffer exists for track ${o}, however track does not`);let c=((s=a.levelCodec)==null?void 0:s.indexOf(","))===-1?a.levelCodec:a.codec;c&&o.slice(0,5)==="audio"&&(c=ho(c,this.appendSource));const f=`${a.container};codecs=${c}`;this.log(`creating sourceBuffer(${f})`);try{const h=t[o]=r.addSourceBuffer(f),g=o;this.addBufferListener(g,"updatestart",this._onSBUpdateStart),this.addBufferListener(g,"updateend",this._onSBUpdateEnd),this.addBufferListener(g,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(g,"bufferedchange",(p,E)=>{const T=E.removedRanges;T!=null&&T.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:o})}),this.tracks[o]={buffer:h,codec:c,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(h){this.error(`error while trying to add sourceBuffer: ${h.message}`),this.hls.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:o,mimeType:f})}}}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const{operationQueue:r}=this;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const o=this.operationQueue.current(e);o&&o.onError(s)}removeExecutor(e,t,r){const{media:s,mediaSource:o,operationQueue:a,sourceBuffer:c}=this,f=c[e];if(!s||!o||!f){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),a.shiftAndExecuteNext(e);return}const h=se(s.duration)?s.duration:1/0,g=se(o.duration)?o.duration:1/0,p=Math.max(0,t),E=Math.min(r,h,g);E>p&&(!f.ending||f.ended)?(f.ended=!1,this.log(`Removing [${p},${E}] from the ${e} SourceBuffer`),f.remove(p,E)):a.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.sourceBuffer[t];if(!r){if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}r.ended=!1,r.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:r}=this,s=t.map(o=>r.appendBlocker(o));Promise.all(s).then(()=>{e(),t.forEach(o=>{const a=this.sourceBuffer[o];a!=null&&a.updating||r.shiftAndExecuteNext(o)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const s=this.sourceBuffer[e];if(!s)return;const o=r.bind(this,e);this.listeners[e].push({event:t,listener:o}),s.addEventListener(t,o)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(r=>{t.removeEventListener(r.event,r.listener)})}}function mh(l){const e=l.querySelectorAll("source");[].slice.call(e).forEach(t=>{l.removeChild(t)})}function wE(l,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,l.appendChild(t)}const DE={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},xg=l=>String.fromCharCode(DE[l]||l),zt=15,mn=100,kE={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},_E={17:2,18:4,21:6,22:8,23:10,19:13,20:15},PE={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},FE={25:2,26:4,29:6,30:8,31:10,27:13,28:15},bE=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class OE{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;F.log(`${this.time} [${e}] ${r}`)}}}const Jn=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class Tg{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class NE{constructor(){this.uchar=" ",this.penState=new Tg}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class ME{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Tg,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<mn;t++)this.chars.push(new NE);this.logger=e}equals(e){for(let t=0;t<mn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<mn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<mn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>mn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=mn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=xg(e);if(this.pos>=mn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<mn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<mn;r++){const s=this.chars[r].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Nl{constructor(e){this.rows=[],this.currRow=zt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<zt;t++)this.rows.push(new ME(e));this.logger=e}reset(){for(let e=0;e<zt;e++)this.rows[e].clear();this.currRow=zt-1}equals(e){let t=!0;for(let r=0;r<zt;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<zt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<zt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<zt;c++)this.rows[c].clear();const o=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const c=a.rows[o].cueStartTime,f=this.logger.time;if(c!==null&&f!==null&&c<f)for(let h=0;h<this.nrRollUpRows;h++)this.rows[t-this.nrRollUpRows+h+1].copy(a.rows[o+h])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const o=e.indent,a=Math.max(o-1,0);r.setCursor(e.indent),e.color=r.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let o=0;o<zt;o++){const a=this.rows[o].getTextString();a&&(s=o+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class ph{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Nl(r),this.nonDisplayedMemory=new Nl(r),this.lastOutputScreen=new Nl(r),this.currRollUpRow=this.displayedMemory.rows[zt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[zt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class yh{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=BE(),this.logger=void 0;const s=this.logger=new OE;this.channels=[null,new ph(e,t,s),new ph(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const s=t[r]&127,o=t[r+1]&127;let a=!1,c=null;if(s===0&&o===0)continue;this.logger.log(3,()=>"["+Jn([t[r],t[r+1]])+"] -> ("+Jn([s,o])+")");const f=this.cmdHistory;if(s>=16&&s<=31){if(UE(s,o,f)){Xs(null,null,f),this.logger.log(3,()=>"Repeated command ("+Jn([s,o])+") is dropped");continue}Xs(s,o,this.cmdHistory),a=this.parseCmd(s,o),a||(a=this.parseMidrow(s,o)),a||(a=this.parsePAC(s,o)),a||(a=this.parseBackgroundAttributes(s,o))}else Xs(null,null,f);if(!a&&(c=this.parseChars(s,o),c)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Jn([s,o])+" orig: "+Jn([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(r||s))return!1;const o=e===20||e===21||e===23?1:2,a=this.channels[o];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=o,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Jn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,o=(e===16||e===24)&&t>=64&&t<=95;if(!(s||o))return!1;const a=e<=23?1:2;t>=64&&t<=95?r=a===1?kE[e]:PE[e]:r=a===1?_E[e]:FE[e];const c=this.channels[a];return c?(c.setPAC(this.interpretPAC(r,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,s.underline=(r&1)===1,r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((r-16)/2)*4,s}parseChars(e,t){let r,s=null,o=null;if(e>=25?(r=2,o=e-8):(r=1,o=e),o>=17&&o<=19){let a;o===17?a=t+80:o===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+xg(a)+"' in channel "+r),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Jn(s).join(",")),s}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(r||s))return!1;let o;const a={};e===16||e===24?(o=Math.floor((t-32)/2),a.background=bE[o],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Xs(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Xs(l,e,t){t.a=l,t.b=e}function UE(l,e,t){return t.a===l&&t.b===e}function BE(){return{a:null,b:null}}class Qs{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Su=function(){if(Nr!=null&&Nr.VTTCue)return self.VTTCue;const l=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,f){if(typeof f!="string"||!Array.isArray(c))return!1;const h=f.toLowerCase();return~c.indexOf(h)?h:!1}function r(c){return t(l,c)}function s(c){return t(e,c)}function o(c,...f){let h=1;for(;h<arguments.length;h++){const g=arguments[h];for(const p in g)c[p]=g[p]}return c}function a(c,f,h){const g=this,p={enumerable:!0};g.hasBeenReset=!1;let E="",T=!1,x=c,S=f,v=h,R=null,k="",C=!0,M="auto",_="start",V=50,U="middle",j=50,ee="middle";Object.defineProperty(g,"id",o({},p,{get:function(){return E},set:function(H){E=""+H}})),Object.defineProperty(g,"pauseOnExit",o({},p,{get:function(){return T},set:function(H){T=!!H}})),Object.defineProperty(g,"startTime",o({},p,{get:function(){return x},set:function(H){if(typeof H!="number")throw new TypeError("Start time must be set to a number.");x=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",o({},p,{get:function(){return S},set:function(H){if(typeof H!="number")throw new TypeError("End time must be set to a number.");S=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",o({},p,{get:function(){return v},set:function(H){v=""+H,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",o({},p,{get:function(){return R},set:function(H){R=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",o({},p,{get:function(){return k},set:function(H){const Q=r(H);if(Q===!1)throw new SyntaxError("An invalid or illegal string was specified.");k=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",o({},p,{get:function(){return C},set:function(H){C=!!H,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",o({},p,{get:function(){return M},set:function(H){if(typeof H!="number"&&H!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");M=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",o({},p,{get:function(){return _},set:function(H){const Q=s(H);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");_=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",o({},p,{get:function(){return V},set:function(H){if(H<0||H>100)throw new Error("Position must be between 0 and 100.");V=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",o({},p,{get:function(){return U},set:function(H){const Q=s(H);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");U=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",o({},p,{get:function(){return j},set:function(H){if(H<0||H>100)throw new Error("Size must be between 0 and 100.");j=H,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",o({},p,{get:function(){return ee},set:function(H){const Q=s(H);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");ee=Q,this.hasBeenReset=!0}})),g.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class $E{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Sg(l){function e(r,s,o,a){return(r|0)*3600+(s|0)*60+(o|0)+parseFloat(a||0)}const t=l.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class GE{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function vg(l,e,t,r){const s=r?l.split(r):[l];for(const o in s){if(typeof s[o]!="string")continue;const a=s[o].split(t);if(a.length!==2)continue;const c=a[0],f=a[1];e(c,f)}}const tu=new Su(0,0,""),Js=tu.align==="middle"?"middle":"center";function KE(l,e,t){const r=l;function s(){const c=Sg(l);if(c===null)throw new Error("Malformed timestamp: "+r);return l=l.replace(/^[^\sa-zA-Z-]+/,""),c}function o(c,f){const h=new GE;vg(c,function(E,T){let x;switch(E){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===T){h.set(E,t[S].region);break}break;case"vertical":h.alt(E,T,["rl","lr"]);break;case"line":x=T.split(","),h.integer(E,x[0]),h.percent(E,x[0])&&h.set("snapToLines",!1),h.alt(E,x[0],["auto"]),x.length===2&&h.alt("lineAlign",x[1],["start",Js,"end"]);break;case"position":x=T.split(","),h.percent(E,x[0]),x.length===2&&h.alt("positionAlign",x[1],["start",Js,"end","line-left","line-right","auto"]);break;case"size":h.percent(E,T);break;case"align":h.alt(E,T,["start",Js,"end","left","right"]);break}},/:/,/\s/),f.region=h.get("region",null),f.vertical=h.get("vertical","");let g=h.get("line","auto");g==="auto"&&tu.line===-1&&(g=-1),f.line=g,f.lineAlign=h.get("lineAlign","start"),f.snapToLines=h.get("snapToLines",!0),f.size=h.get("size",100),f.align=h.get("align",Js);let p=h.get("position","auto");p==="auto"&&tu.position===50&&(p=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=p}function a(){l=l.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),l.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);l=l.slice(3),a(),e.endTime=s(),a(),o(l,e)}function Lg(l){return l.replace(/<br(?: \/)?>/gi,`
`)}class VE{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new $E,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let o=t.buffer,a=0;for(o=Lg(o);a<o.length&&o[a]!=="\r"&&o[a]!==`
`;)++a;const c=o.slice(0,a);return o[a]==="\r"&&++a,o[a]===`
`&&++a,t.buffer=o.slice(a),c}function s(o){vg(o,function(a,c){},/:/)}try{let o="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;o=r();const c=o.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:o=r(),t.state){case"HEADER":/:/.test(o)?s(o):o||(t.state="ID");continue;case"NOTE":o||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(o)){t.state="NOTE";break}if(!o)continue;if(t.cue=new Su(0,0,""),t.state="CUE",o.indexOf("-->")===-1){t.cue.id=o;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{KE(o,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=o.indexOf("-->")!==-1;if(!o||c&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=o}continue;case"BADCUE":o||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const HE=/\r\n|\n\r|\n|\r/g,Ml=function(e,t,r=0){return e.slice(r,r+t.length)===t},zE=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),o=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!se(t)||!se(r)||!se(s)||!se(o))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*s,t+=60*60*1e3*o,t},Ul=function(e){let t=5381,r=e.length;for(;r;)t=t*33^e.charCodeAt(--r);return(t>>>0).toString()};function vu(l,e,t){return Ul(l.toString())+Ul(e.toString())+Ul(t)}const WE=function(e,t,r){let s=e[t],o=e[s.prevCC];if(!o||!o.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=o)!=null&&a.new;){var a;e.ccOffset+=s.start-o.start,s.new=!1,s=o,o=e[s.prevCC]}e.presentationOffset=r};function jE(l,e,t,r,s,o,a){const c=new VE,f=rn(new Uint8Array(l)).trim().replace(HE,`
`).split(`
`),h=[],g=e?cE(e.baseTime,e.timescale):0;let p="00:00.000",E=0,T=0,x,S=!0;c.oncue=function(v){const R=t[r];let k=t.ccOffset;const C=(E-g)/9e4;if(R!=null&&R.new&&(T!==void 0?k=t.ccOffset=R.start:WE(t,r,C)),C){if(!e){x=new Error("Missing initPTS for VTT MPEGTS");return}k=C-t.presentationOffset}const M=v.endTime-v.startTime,_=bt((v.startTime+k-T)*9e4,s*9e4)/9e4;v.startTime=Math.max(_,0),v.endTime=Math.max(_+M,0);const V=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(V)),v.id||(v.id=vu(v.startTime,v.endTime,V)),v.endTime>0&&h.push(v)},c.onparsingerror=function(v){x=v},c.onflush=function(){if(x){a(x);return}o(h)},f.forEach(v=>{if(S)if(Ml(v,"X-TIMESTAMP-MAP=")){S=!1,v.slice(16).split(",").forEach(R=>{Ml(R,"LOCAL:")?p=R.slice(6):Ml(R,"MPEGTS:")&&(E=parseInt(R.slice(7)))});try{T=zE(p)/1e3}catch(R){x=R}return}else v===""&&(S=!1);c.parse(v+`
`)}),c.flush()}const Bl="stpp.ttml.im1t",Ag=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Rg=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,YE={left:"start",center:"center",right:"end",start:"start",end:"end"};function Eh(l,e,t,r){const s=Ae(new Uint8Array(l),["mdat"]);if(s.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const o=s.map(c=>rn(c)),a=uE(e.baseTime,1,e.timescale);try{o.forEach(c=>t(qE(c,a)))}catch(c){r(c)}}function qE(l,e){const s=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const o={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(o).reduce((p,E)=>(p[E]=s.getAttribute(`ttp:${E}`)||o[E],p),{}),c=s.getAttribute("xml:space")!=="preserve",f=xh($l(s,"styling","style")),h=xh($l(s,"layout","region")),g=$l(s,"body","[begin]");return[].map.call(g,p=>{const E=Ig(p,c);if(!E||!p.hasAttribute("begin"))return null;const T=Kl(p.getAttribute("begin"),a),x=Kl(p.getAttribute("dur"),a);let S=Kl(p.getAttribute("end"),a);if(T===null)throw Th(p);if(S===null){if(x===null)throw Th(p);S=T+x}const v=new Su(T-e,S-e,E);v.id=vu(v.startTime,v.endTime,v.text);const R=h[p.getAttribute("region")],k=f[p.getAttribute("style")],C=XE(R,k,f),{textAlign:M}=C;if(M){const _=YE[M];_&&(v.lineAlign=_),v.align=M}return je(v,C),v}).filter(p=>p!==null)}function $l(l,e,t){const r=l.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function xh(l){return l.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function Ig(l,e){return[].slice.call(l.childNodes).reduce((t,r,s)=>{var o;return r.nodeName==="br"&&s?t+`
`:(o=r.childNodes)!=null&&o.length?Ig(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function XE(l,e,t){const r="http://www.w3.org/ns/ttml#styling";let s=null;const o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=l!=null&&l.hasAttribute("style")?l.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),o.reduce((c,f)=>{const h=Gl(e,r,f)||Gl(l,r,f)||Gl(s,r,f);return h&&(c[f]=h),c},{})}function Gl(l,e,t){return l&&l.hasAttributeNS(e,t)?l.getAttributeNS(e,t):null}function Th(l){return new Error(`Could not parse ttml timestamp ${l}`)}function Kl(l,e){if(!l)return null;let t=Sg(l);return t===null&&(Ag.test(l)?t=QE(l,e):Rg.test(l)&&(t=JE(l,e))),t}function QE(l,e){const t=Ag.exec(l),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function JE(l,e){const t=Rg.exec(l),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class ZE{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=vh(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new Qs(this,"textTrack1"),t=new Qs(this,"textTrack2"),r=new Qs(this,"textTrack3"),s=new Qs(this,"textTrack4");this.cea608Parser1=new yh(1,e,t),this.cea608Parser2=new yh(3,r,s)}}addCues(e,t,r,s,o){let a=!1;for(let c=o.length;c--;){const f=o[c],h=ex(f[0],f[1],t,r);if(h>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],r),a=!0,h/(r-t)>.5))return}if(a||o.push([t,r]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,r,s)}else{const c=this.Cues.newCue(null,t,r,s);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:o}){const{unparsedVttFrags:a}=this;r==="main"&&(this.initPTS[t.cc]={baseTime:s,timescale:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(c=>{this.onFragLoaded(L.FRAG_LOADED,c)}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const o=r.textTracks[s];if(Sh(o,{name:e,lang:t,attrs:{}}))return o}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:o,languageCode:a}=t[e],c=this.getExistingTrack(o,a);if(c)r[e]=c,Fr(r[e]),Wh(r[e],s);else{const f=this.createTextTrack("captions",o,a);f&&(f[e]=!0,r[e]=f)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,s={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Fr(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=vh(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Fr(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(o=>o.textCodec===Bl);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Eg(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const a=this.media,c=a?to(a.textTracks):null;if(this.tracks.forEach((f,h)=>{let g;if(c){let p=null;for(let E=0;E<c.length;E++)if(c[E]&&Sh(c[E],f)){p=c[E],c[E]=null;break}p&&(g=p)}if(g)Fr(g);else{const p=Cg(f);g=this.createTextTrack(p,f.name,f.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),c!=null&&c.length){const f=c.filter(h=>h!==null).map(h=>h.label);f.length&&F.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const s=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!s)return;const o=`textTrack${s[1]}`,a=this.captionsProperties[o];a&&(a.label=r.name,r.lang&&(a.languageCode=r.lang),a.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Ee.MAIN){var r,s;const{cea608Parser1:o,cea608Parser2:a,lastSn:c}=this,{cc:f,sn:h}=t.frag,g=(r=(s=t.part)==null?void 0:s.index)!=null?r:-1;o&&a&&(h!==c+1||h===c&&g!==this.lastPartIndex+1||f!==this.lastCc)&&(o.reset(),a.reset()),this.lastCc=f,this.lastSn=h,this.lastPartIndex=g}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===Ee.SUBTITLE)if(s.byteLength){const o=r.decryptdata,a="stats"in t;if(o==null||!o.encrypted||a){const c=this.tracks[r.level],f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),c&&c.textCodec===Bl?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;Eh(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),r.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{F.log(`Failed to parse IMSC1: ${s}`),r.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:o,unparsedVttFrags:a}=this,c=o.length-1;if(!o[r.cc]&&c===-1){a.push(e);return}const f=this.hls,h=(t=r.initSegment)!=null&&t.data?Nt(r.initSegment.data,new Uint8Array(s)):s;jE(h,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,g=>{this._appendCues(g,r.level),f.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},g=>{const p=g.message==="Missing initPTS for VTT MPEGTS";p?a.push(e):this._fallbackToIMSC1(r,s),F.log(`Failed to parse VTT cue: ${g}`),!(p&&c>r.cc)&&f.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:g})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||Eh(t,this.initPTS[e.cc],()=>{r.textCodec=Bl,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(o=>jh(s,o))}else{const s=this.tracks[t];if(!s)return;const o=s.default?"default":"subtitles"+t;r.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:o})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===Ee.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:r,cea608Parser2:s}=this;if(!this.enabled||!r||!s)return;const{frag:o,samples:a}=t;if(!(o.type===Ee.MAIN&&this.closedCaptionsForLevel(o)==="NONE"))for(let c=0;c<a.length;c++){const f=a[c].bytes;if(f){const h=this.extractCea608Data(f);r.addData(a[c].pts,h[0]),s.addData(a[c].pts,h[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:o}){const{media:a}=this;if(!(!a||a.currentTime<r)){if(!o||o==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(f=>Yl(c[f],t,r))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(f=>Yl(c[f],t,s))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let s=2;for(let o=0;o<r;o++){const a=e[s++],c=127&e[s++],f=127&e[s++];if(c===0&&f===0)continue;if((4&a)!==0){const g=3&a;(g===0||g===1)&&(t[g].push(c),t[g].push(f))}}return t}}function Cg(l){return l.characteristics&&/transcribes-spoken-dialog/gi.test(l.characteristics)&&/describes-music-and-sound/gi.test(l.characteristics)?"captions":"subtitles"}function Sh(l,e){return!!l&&l.kind===Cg(e)&&eu(e,l)}function ex(l,e,t,r){return Math.min(e,r)-Math.max(l,t)}function vh(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Lu{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&se(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&F.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((s,o)=>this.isLevelAllowed(s)&&o<=e);return this.clientRect=null,Lu.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const s=(c,f)=>f?c.width!==f.width||c.height!==f.height:!0;let o=e.length-1;const a=Math.max(t,r);for(let c=0;c<e.length;c+=1){const f=e[c];if((f.width>=a||f.height>=a)&&s(f,e[c+1])){o=c;break}}return o}}class tx{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const o=s-this.lastTime,a=r-this.lastDroppedFrames,c=t-this.lastDecodedFrames,f=1e3*a/o,h=this.hls;if(h.trigger(L.FPS_DROP,{currentDropped:a,currentDecoded:c,totalDroppedFrames:r}),f>0&&a>h.config.fpsDroppedMonitoringThreshold*c){let g=h.currentLevel;F.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(h.autoLevelCapping===-1||h.autoLevelCapping>=g)&&(g=g-1,h.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:h.currentLevel}),h.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const Zs="[eme]";class Or{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Or.CDMCleanupPromise?[Or.CDMCleanupPromise]:[],this.debug=F.debug.bind(F,Zs),this.log=F.log.bind(F,Zs),this.warn=F.warn.bind(F,Zs),this.error=F.error.bind(F,Zs),this.onMediaEncrypted=t=>{const{initDataType:r,initData:s}=t,o=`"${t.type}" event: init data type: "${r}"`;if(this.debug(o),s!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Vs(this.config));const c=a.map(Al).filter(f=>!!f);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(a=>{const c=vl(a);let f,h;if(r==="sinf"){if(c!==_e.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${c}`);return}const x=Xe(new Uint8Array(s));try{const S=lu(JSON.parse(x).sinf),v=Gh(S);if(!v)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");f=v.subarray(8,24),h=_e.FAIRPLAY}catch(S){this.warn(`${o} Failed to parse sinf: ${S}`);return}}else{if(c!==_e.WIDEVINE&&c!==_e.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${c}`);return}const x=P0(s),S=x.filter(R=>!!R.systemId&&Ll(R.systemId)===c);S.length>1&&this.warn(`${o} Using first of ${S.length} pssh found for selected key-system ${c}`);const v=S[0];if(!v){x.length===0||x.some(R=>!R.systemId)?this.warn(`${o} contains incomplete or invalid pssh data`):this.log(`ignoring ${o} for ${x.map(R=>Ll(R.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(h=Ll(v.systemId),v.version===0&&v.data)if(h===_e.WIDEVINE){const R=v.data.length-22;f=v.data.subarray(R,R+16)}else h===_e.PLAYREADY&&(f=Fh(v.data))}if(!h||!f){this.log(`Unable to handle ${o} with key-system ${c}`);return}const g=Zt.hexDump(f),{keyIdToKeySessionPromise:p,mediaKeySessions:E}=this;let T=p[g];for(let x=0;x<E.length;x++){const S=E[x],v=S.decryptdata;if(!v.keyId)continue;const R=Zt.hexDump(v.keyId);if(g===R||v.uri.replace(/-/g,"").indexOf(g)!==-1){if(T=p[R],v.pssh)break;delete p[R],v.pssh=new Uint8Array(s),v.keyId=f,T=p[g]=T.then(()=>this.generateRequestWithPreferredKeySession(S,r,s,"encrypted-event-key-match")),T.catch(k=>this.handleError(k));break}}if(!T){if(h!==c){this.log(`Ignoring "${o}" with ${h} init data for selected key-system ${c}`);return}T=p[g]=this.getKeySystemSelectionPromise([h]).then(({keySystem:x,mediaKeys:S})=>{var v;this.throwIfDestroyed();const R=new Di("ISO-23001-7",g,(v=Al(x))!=null?v:"");return R.pssh=new Uint8Array(s),R.keyId=f,this.attemptSetMediaKeys(x,S).then(()=>{this.throwIfDestroyed();const k=this.createMediaKeySessionContext({decryptdata:R,keySystem:x,mediaKeys:S});return this.generateRequestWithPreferredKeySession(k,r,s,"encrypted-event-no-match")})}),T.catch(x=>this.handleError(x))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=t[e];if(s)return s.licenseUrl;if(e===_e.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(a,c,f)=>!!a&&f.indexOf(a)===c,s=t.map(a=>a.audioCodec).filter(r),o=t.map(a=>a.videoCodec).filter(r);return s.length+o.length===0&&o.push("avc1.42e01e"),new Promise((a,c)=>{const f=h=>{const g=h.shift();this.getMediaKeysPromise(g,s,o).then(p=>a({keySystem:g,mediaKeys:p})).catch(p=>{h.length?f(h):p instanceof Ft?c(p):c(new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};f(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${r}`;return Ph===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return r(e,t)}getMediaKeysPromise(e,t,r){const s=a0(e,t,r,this.config.drmSystemOptions),o=this.keySystemAccessPromises[e];let a=o==null?void 0:o.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(s)}`),a=this.requestMediaKeySystemAccess(e,s);const c=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(f=>{this.log(`Failed to obtain access to key-system "${e}": ${f}`)}),a.then(f=>{this.log(`Access for key-system "${f.keySystem}" obtained`);const h=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),c.mediaKeys=f.createMediaKeys().then(g=>(this.log(`Media-keys created for "${e}"`),h.then(p=>p?this.setMediaKeysServerCertificate(g,e,p):g))),c.mediaKeys.catch(g=>{this.error(`Failed to create media-keys for "${e}"}: ${g}`)}),c.mediaKeys})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Zt.hexDump(e.keyId||[])}`);const s=r.createSession(),o={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=this.getKeyIdString(t),o="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,o,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Zt.hexDump(e.keyId)}updateKeySession(e,t){var r;const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyID ${Zt.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),s.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,r)=>{const s=Vs(this.config),o=e.map(vl).filter(a=>!!a&&s.indexOf(a)!==-1);return this.getKeySystemSelectionPromise(o).then(({keySystem:a})=>{const c=Al(a);c?t(c):r(new Error(`Unable to find format for key-system "${a}"`))}).catch(r)})}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),s=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${s}`);let o=this.keyIdToKeySessionPromise[r];return o||(o=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${s}`),this.attemptSetMediaKeys(a,c).then(()=>{this.throwIfDestroyed();const f=this.createMediaKeySessionContext({keySystem:a,mediaKeys:c,decryptdata:t});return this.generateRequestWithPreferredKeySession(f,"cenc",t.pssh,"playlist-key")}))),o.catch(a=>this.handleError(a))),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Ft?this.hls.trigger(L.ERROR,e.data):this.hls.trigger(L.ERROR,{type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const s=vl(e.keyFormat),o=s?[s]:Vs(this.config);return this.attemptKeySystemAccess(o)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Vs(this.config)),e.length===0)throw new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(o=>r.indexOf(o)===-1)})}generateRequestWithPreferredKeySession(e,t,r,s){var o,a;const c=(o=this.config.drmSystems)==null||(a=o[e.keySystem])==null?void 0:a.generateRequest;if(c)try{const x=c.call(this.hls,t,r,e);if(!x)throw new Error("Invalid response from configured generateRequest filter");t=x.initDataType,r=e.decryptdata.pssh=x.initData?new Uint8Array(x.initData):null}catch(x){var f;if(this.warn(x.message),(f=this.hls)!=null&&f.config.debug)throw x}if(r===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const h=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${s}": ${h} (init data type: ${t} length: ${r?r.byteLength:null})`);const g=new Tu,p=e._onmessage=x=>{const S=e.mediaKeysSession;if(!S){g.emit("error",new Error("invalid state"));return}const{messageType:v,message:R}=x;this.log(`"${v}" message event for session "${S.sessionId}" message size: ${R.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,R).catch(k=>{this.handleError(k),g.emit("error",k)}):v==="license-release"?e.keySystem===_e.FAIRPLAY&&(this.updateKeySession(e,Wl("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${v}"`)},E=e._onkeystatuseschange=x=>{if(!e.mediaKeysSession){g.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const v=e.keyStatus;g.emit("keyStatus",v),v==="expired"&&(this.warn(`${e.keySystem} expired for key ${h}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",p),e.mediaKeysSession.addEventListener("keystatuseschange",E);const T=new Promise((x,S)=>{g.on("error",S),g.on("keyStatus",v=>{v.startsWith("usable")?x():v==="output-restricted"?S(new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):v==="internal-error"?S(new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${v}"`)):v==="expired"?S(new Error("key expired while generating request")):this.warn(`unhandled key status change "${v}"`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{var x;this.log(`Request generated for key-session "${(x=e.mediaKeysSession)==null?void 0:x.sessionId}" keyId: ${h}`)}).catch(x=>{throw new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_NO_SESSION,error:x,fatal:!1},`Error generating key-session request: ${x}`)}).then(()=>T).catch(x=>{throw g.removeAllListeners(),this.removeSession(e),x}).then(()=>(g.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,r)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Zt.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${Zt.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,r=t.loader,s=new r(t),o=this.getServerCertificateUrl(e);return o?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,c)=>{const f={responseType:"arraybuffer",url:o},h=t.certLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(E,T,x,S)=>{a(E.data)},onError:(E,T,x,S)=>{c(new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:x,response:rt({url:f.url,data:void 0},E)},`"${e}" certificate request failed (${o}). Status: ${E.code} (${E.text})`))},onTimeout:(E,T,x)=>{c(new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:x,response:{url:f.url,data:void 0}},`"${e}" certificate request timed out (${o})`))},onAbort:(E,T,x)=>{c(new Error("aborted"))}};s.load(f,g,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,o)=>{e.setServerCertificate(r).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${r==null?void 0:r.byteLength}) on "${t}"`),s(e)}).catch(a=>{o(new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(s=>{throw new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:s,fatal:!0},s.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(r,"application/xml"),o=s.querySelectorAll("HttpHeader");if(o.length>0){let g;for(let p=0,E=o.length;p<E;p++){var a,c;g=o[p];const T=(a=g.querySelector("name"))==null?void 0:a.textContent,x=(c=g.querySelector("value"))==null?void 0:c.textContent;T&&x&&e.setRequestHeader(T,x)}}const f=s.querySelector("Challenge"),h=f==null?void 0:f.textContent;if(!h)throw new Error("Cannot find <Challenge> in key message");return Wl(atob(h))}setupLicenseXHR(e,t,r,s){const o=this.config.licenseXhrSetup;return o?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return o.call(this.hls,e,t,r,s)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),o.call(this.hls,e,t,r,s)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,o)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return o(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let f=c.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const h=this.config.licenseResponseCallback;if(h)try{f=h.call(this.hls,c,a,e)}catch(g){this.error(g)}s(f)}else{const f=r.errorRetry,h=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>h||c.status>=400&&c.status<500)o(new Ft({type:Se.KEY_SYSTEM_ERROR,details:G.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:a,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${a}). Status: ${c.status} (${c.statusText})`));else{const g=h-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(e,t).then(s,o)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,a,e,t).then(({xhr:f,licenseChallenge:h})=>{e.keySystem==_e.PLAYREADY&&(h=this.unpackPlayReadyKeyMessage(f,h)),f.send(h)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Di.clearKeyUriToKeyIdMap();const r=t.length;Or.CDMCleanupPromise=Promise.all(t.map(s=>this.removeSession(s)).concat(e==null?void 0:e.setMediaKeys(null).catch(s=>{this.log(`Could not clear media keys: ${s}`)}))).then(()=>{r&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(s=>{this.log(`Could not close sessions and clear media keys: ${s}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((s,o)=>(s.indexOf(o.keyFormat)===-1&&s.push(o.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const s=this.mediaKeySessions.indexOf(e);return s>-1&&this.mediaKeySessions.splice(s,1),t.remove().catch(o=>{this.log(`Could not remove session: ${o}`)}).then(()=>t.close()).catch(o=>{this.log(`Could not close session: ${o}`)})}}}Or.CDMCleanupPromise=void 0;class Ft extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var ft;(function(l){l.MANIFEST="m",l.AUDIO="a",l.VIDEO="v",l.MUXED="av",l.INIT="i",l.CAPTION="c",l.TIMED_TEXT="tt",l.KEY="k",l.OTHER="o"})(ft||(ft={}));var nu;(function(l){l.DASH="d",l.HLS="h",l.SMOOTH="s",l.OTHER="o"})(nu||(nu={}));var er;(function(l){l.OBJECT="CMCD-Object",l.REQUEST="CMCD-Request",l.SESSION="CMCD-Session",l.STATUS="CMCD-Status"})(er||(er={}));const nx={[er.OBJECT]:["br","d","ot","tb"],[er.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[er.SESSION]:["cid","pr","sf","sid","st","v"],[er.STATUS]:["bs","rtp"]};class Br{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(r=>r instanceof Br?r:new Br(r))),this.value=e,this.params=t}}class wg{constructor(e){this.description=void 0,this.description=e}}const rx="Dict";function ix(l){return Array.isArray(l)?JSON.stringify(l):l instanceof Map?"Map{}":l instanceof Set?"Set{}":typeof l=="object"?JSON.stringify(l):String(l)}function sx(l,e,t,r){return new Error(`failed to ${l} "${ix(e)}" as ${t}`,{cause:r})}const Lh="Bare Item",ox="Boolean",ax="Byte Sequence",lx="Decimal",ux="Integer";function cx(l){return l<-999999999999999||999999999999999<l}const fx=/[\x00-\x1f\x7f]+/,dx="Token",hx="Key";function sn(l,e,t){return sx("serialize",l,e,t)}function gx(l){if(typeof l!="boolean")throw sn(l,ox);return l?"?1":"?0"}function mx(l){return btoa(String.fromCharCode(...l))}function px(l){if(ArrayBuffer.isView(l)===!1)throw sn(l,ax);return`:${mx(l)}:`}function Dg(l){if(cx(l))throw sn(l,ux);return l.toString()}function yx(l){return`@${Dg(l.getTime()/1e3)}`}function kg(l,e){if(l<0)return-kg(-l,e);const t=Math.pow(10,e);if(Math.abs(l*t%1-.5)<Number.EPSILON){const s=Math.floor(l*t);return(s%2===0?s:s+1)/t}else return Math.round(l*t)/t}function Ex(l){const e=kg(l,3);if(Math.floor(Math.abs(e)).toString().length>12)throw sn(l,lx);const t=e.toString();return t.includes(".")?t:`${t}.0`}const xx="String";function Tx(l){if(fx.test(l))throw sn(l,xx);return`"${l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function Sx(l){return l.description||l.toString().slice(7,-1)}function Ah(l){const e=Sx(l);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw sn(e,dx);return e}function ru(l){switch(typeof l){case"number":if(!se(l))throw sn(l,Lh);return Number.isInteger(l)?Dg(l):Ex(l);case"string":return Tx(l);case"symbol":return Ah(l);case"boolean":return gx(l);case"object":if(l instanceof Date)return yx(l);if(l instanceof Uint8Array)return px(l);if(l instanceof wg)return Ah(l);default:throw sn(l,Lh)}}function iu(l){if(/^[a-z*][a-z0-9\-_.*]*$/.test(l)===!1)throw sn(l,hx);return l}function Au(l){return l==null?"":Object.entries(l).map(([e,t])=>t===!0?`;${iu(e)}`:`;${iu(e)}=${ru(t)}`).join("")}function _g(l){return l instanceof Br?`${ru(l.value)}${Au(l.params)}`:ru(l)}function vx(l){return`(${l.value.map(_g).join(" ")})${Au(l.params)}`}function Lx(l,e={whitespace:!0}){if(typeof l!="object")throw sn(l,rx);const t=l instanceof Map?l.entries():Object.entries(l),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,o])=>{o instanceof Br||(o=new Br(o));let a=iu(s);return o.value===!0?a+=Au(o.params):(a+="=",Array.isArray(o.value)?a+=vx(o):a+=_g(o)),a}).join(`,${r}`)}function Ax(l,e){return Lx(l,e)}const Rx=l=>l==="ot"||l==="sf"||l==="st",Ix=l=>typeof l=="number"?se(l):l!=null&&l!==""&&l!==!1;function Cx(l,e){const t=new URL(l),r=new URL(e);if(t.origin!==r.origin)return l;const s=t.pathname.split("/").slice(1),o=r.pathname.split("/").slice(1,-1);for(;s[0]===o[0];)s.shift(),o.shift();for(;o.length;)o.shift(),s.unshift("..");return s.join("/")}function wx(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const o=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?o:o&3|8).toString(16)})}}}const ao=l=>Math.round(l),Dx=(l,e)=>(e!=null&&e.baseUrl&&(l=Cx(l,e.baseUrl)),encodeURIComponent(l)),eo=l=>ao(l/100)*100,kx={br:ao,d:ao,bl:eo,dl:eo,mtp:eo,nor:Dx,rtp:eo,tb:ao};function _x(l,e){const t={};if(l==null||typeof l!="object")return t;const r=Object.keys(l).sort(),s=je({},kx,e==null?void 0:e.formatters),o=e==null?void 0:e.filter;return r.forEach(a=>{if(o!=null&&o(a))return;let c=l[a];const f=s[a];f&&(c=f(c,e)),!(a==="v"&&c===1)&&(a=="pr"&&c===1||Ix(c)&&(Rx(a)&&typeof c=="string"&&(c=new wg(c)),t[a]=c))}),t}function Pg(l,e={}){return l?Ax(_x(l,e),je({whitespace:!1},e)):""}function Px(l,e={}){if(!l)return{};const t=Object.entries(l),r=Object.entries(nx).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),s=t.reduce((o,a)=>{var c,f;const[h,g]=a,p=((c=r.find(E=>E[1].includes(h)))==null?void 0:c[0])||er.REQUEST;return(f=o[p])!=null||(o[p]={}),o[p][h]=g,o},{});return Object.entries(s).reduce((o,[a,c])=>(o[a]=Pg(c,e),o),{})}function Fx(l,e,t){return je(l,Px(e,t))}const bx="CMCD";function Ox(l,e={}){if(!l)return"";const t=Pg(l,e);return`${bx}=${encodeURIComponent(t)}`}const Rh=/CMCD=[^&#]+/;function Nx(l,e,t){const r=Ox(e,t);if(!r)return l;if(Rh.test(l))return l.replace(Rh,r);const s=l.includes("?")?"&":"?";return`${l}${s}${r}`}class Mx{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:ft.MANIFEST,su:!this.initialized})}catch(o){F.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=s=>{try{const o=s.frag,a=this.hls.levels[o.level],c=this.getObjectType(o),f={d:o.duration*1e3,ot:c};(c===ft.VIDEO||c===ft.AUDIO||c==ft.MUXED)&&(f.br=a.bitrate/1e3,f.tb=this.getTopBandwidth(c)/1e3,f.bl=this.getBufferLength(c)),this.apply(s,f)}catch(o){F.warn("Could not generate segment CMCD data.",o)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||wx(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:nu.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){je(t,this.createData());const r=t.ot===ft.INIT||t.ot===ft.VIDEO||t.ot===ft.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((o,a)=>(s.includes(a)&&(o[a]=t[a]),o),{})),this.useHeaders?(e.headers||(e.headers={}),Fx(e.headers,t)):e.url=Nx(e.url,t)}getObjectType(e){const{type:t}=e;if(t==="subtitle")return ft.TIMED_TEXT;if(e.sn==="initSegment")return ft.INIT;if(t==="audio")return ft.AUDIO;if(t==="main")return this.hls.audioTracks.length?ft.VIDEO:ft.MUXED}getTopBandwidth(e){let t=0,r;const s=this.hls;if(e===ft.AUDIO)r=s.audioTracks;else{const o=s.maxAutoLevel,a=o>-1?o+1:s.levels.length;r=s.levels.slice(0,a)}for(const o of r)o.bitrate>t&&(t=o.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,r=e===ft.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:Ne.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(o){this.loader=void 0,this.loader=new r(o)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(o,a,c){t(o),this.loader.load(o,a,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(o){this.loader=void 0,this.loader=new r(o)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(o,a,c){t(o),this.loader.load(o,a,c)}}}}const Ux=3e5;class Bx{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=F.log.bind(F,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===ot.SendAlternateToPenaltyBox&&r.flags===Ht.MoveAllAlternatesMatchingHost){const s=this.levels;let o=this.pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:c,pathwayId:f,type:h}=t.context;c&&s?a=this.getPathwayForGroupId(c,h,a):f&&(a=f)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!o&&s&&(o=s.reduce((c,f)=>(c.indexOf(f.pathwayId)===-1&&c.push(f.pathwayId),c),[])),o&&o.length>1&&(this.updatePathwayPriority(o),r.resolved=this.pathwayId!==a),r.resolved||F.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${JSON.stringify(o)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(o=>{s-r[o]>Ux&&delete r[o]});for(let o=0;o<e.length;o++){const a=e[o];if(a in r)continue;if(a===this.pathwayId)return;const c=this.hls.nextLoadLevel,f=this.hls.levels[c];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,Qh(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const h=this.hls.levels[c];f&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${h.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let o=0;o<s.length;o++)if(t===we.AUDIO_TRACK&&s[o].hasAudioGroup(e)||t===we.SUBTITLE_TRACK&&s[o].hasSubtitleGroup(e))return s[o].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(o=>{const{ID:a,"BASE-ID":c,"URI-REPLACEMENT":f}=o;if(t.some(g=>g.pathwayId===a))return;const h=this.getLevelsForPathway(c).map(g=>{const p=new Ke(g.attrs);p["PATHWAY-ID"]=a;const E=p.AUDIO&&`${p.AUDIO}_clone_${a}`,T=p.SUBTITLES&&`${p.SUBTITLES}_clone_${a}`;E&&(r[p.AUDIO]=E,p.AUDIO=E),T&&(s[p.SUBTITLES]=T,p.SUBTITLES=T);const x=Fg(g.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),S=new Mr({attrs:p,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:x,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let v=1;v<g.audioGroups.length;v++)S.addGroupId("audio",`${g.audioGroups[v]}_clone_${a}`);if(g.subtitleGroups)for(let v=1;v<g.subtitleGroups.length;v++)S.addGroupId("text",`${g.subtitleGroups[v]}_clone_${a}`);return S});t.push(...h),Ih(this.audioTracks,r,f,a),Ih(this.subtitleTracks,s,f,a)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+g)}const o={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,c=a.errorRetry||a.timeoutRetry||{},f={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},h={onSuccess:(g,p,E,T)=>{this.log(`Loaded steering manifest: "${s}"`);const x=g.data;if(x.VERSION!==1){this.log(`Steering VERSION ${x.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=x.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":v,"PATHWAY-PRIORITY":R}=x;if(S)try{this.uri=new self.URL(S,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||E.url),v&&this.clonePathways(v);const k={steeringManifest:x,url:s.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,k),R&&this.updatePathwayPriority(R)},onError:(g,p,E,T)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${p.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let x=this.timeToLoad*1e3;if(g.code===429){const S=this.loader;if(typeof(S==null?void 0:S.getResponseHeader)=="function"){const v=S.getResponseHeader("Retry-After");v&&(x=parseFloat(v)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,x)},onTimeout:(g,p,E)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(o,f,h)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const s=(r=this.hls)==null?void 0:r.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Ih(l,e,t,r){l&&Object.keys(e).forEach(s=>{const o=l.filter(a=>a.groupId===s).map(a=>{const c=je({},a);return c.details=void 0,c.attrs=new Ke(c.attrs),c.url=c.attrs.URI=Fg(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[s],c.attrs["PATHWAY-ID"]=r,c});l.push(...o)})}function Fg(l,e,t,r){const{HOST:s,PARAMS:o,[t]:a}=r;let c;e&&(c=a==null?void 0:a[e],c&&(l=c));const f=new self.URL(l);return s&&!c&&(f.host=s),o&&Object.keys(o).sort().forEach(h=>{h&&f.searchParams.set(h,o[h])}),f.href}const $x=/^age:\s*[\d.]+\s*$/im;class bg{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new So,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const o=this.xhrSetup;o?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return o(r,t.url)}).catch(a=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),o(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(a=>{this.callbacks.onError({code:r.status,text:a.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:o,maxLoadTimeMs:a}=r.loadPolicy;if(s)for(const c in s)e.setRequestHeader(c,s[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=o&&se(o)?o:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,o=this.config;if(!r.aborted&&s>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),o.timeout!==o.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),o.timeout=o.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const a=t.status,c=t.responseType==="text"?t.responseText:null;if(a>=200&&a<300){const p=c??t.response;if(p!=null){r.loading.end=Math.max(self.performance.now(),r.loading.first);const E=t.responseType==="arraybuffer"?p.byteLength:p.length;if(r.loaded=r.total=E,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first),!this.callbacks)return;const T=this.callbacks.onProgress;if(T&&T(r,e,p,t),!this.callbacks)return;const x={url:t.responseURL,data:p,code:a};this.callbacks.onSuccess(x,r,e,t);return}}const f=o.loadPolicy.errorRetry,h=r.retry,g={url:e.url,data:void 0,code:a};po(f,h,!1,g)?this.retry(f):(F.error(`${a} while loading ${e.url}`),this.callbacks.onError({code:a,text:t.statusText},e,t,r))}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(po(e,t,!0))this.retry(e);else{var r;F.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=fu(e,r.retry),r.retry++,F.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&$x.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function Gx(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const Kx=/(\d+)-(\d+)\/(\d+)/;class Ch{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Wx,this.controller=new self.AbortController,this.stats=new So}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const o=Vx(e,this.controller.signal),a=r.onProgress,c=e.responseType==="arraybuffer",f=c?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:g}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,o),self.clearTimeout(this.requestTimeout),t.timeout=h&&se(h)?h:g,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(s,e,this.response)},t.timeout),self.fetch(this.request).then(p=>{this.response=this.loader=p;const E=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=g,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(s,e,this.response)},g-(E-s.loading.start)),!p.ok){const{status:T,statusText:x}=p;throw new jx(x||"fetch, bad network response",T,p)}return s.loading.first=E,s.total=zx(p.headers)||s.total,a&&se(t.highWaterMark)?this.loadProgressively(p,s,e,t.highWaterMark,a):c?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{const E=this.response;if(!E)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const T=p[f];T&&(s.loaded=s.total=T);const x={url:E.url,data:p,code:E.status};a&&!se(t.highWaterMark)&&a(s,e,p,E),r.onSuccess(x,s,e,E)}).catch(p=>{if(self.clearTimeout(this.requestTimeout),s.aborted)return;const E=p&&p.code||0,T=p?p.message:null;r.onError({code:E,text:T},e,p?p.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,o){const a=new tg,c=e.body.getReader(),f=()=>c.read().then(h=>{if(h.done)return a.dataLength&&o(t,r,a.flush(),e),Promise.resolve(new ArrayBuffer(0));const g=h.value,p=g.length;return t.loaded+=p,p<s||a.dataLength?(a.push(g),a.dataLength>=s&&o(t,r,a.flush(),e)):o(t,r,g,e),f()}).catch(()=>Promise.reject());return f()}}function Vx(l,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(je({},l.headers))};return l.rangeEnd&&t.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),t}function Hx(l){const e=Kx.exec(l);if(e)return parseInt(e[2])-parseInt(e[1])+1}function zx(l){const e=l.get("Content-Range");if(e){const r=Hx(e);if(se(r))return r}const t=l.get("Content-Length");if(t)return parseInt(t)}function Wx(l,e){return new self.Request(l.url,e)}class jx extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const Yx=/\s/,qx={newCue(l,e,t,r){const s=[];let o,a,c,f,h;const g=self.VTTCue||self.TextTrackCue;for(let E=0;E<r.rows.length;E++)if(o=r.rows[E],c=!0,f=0,h="",!o.isEmpty()){var p;for(let S=0;S<o.chars.length;S++)Yx.test(o.chars[S].uchar)&&c?f++:(h+=o.chars[S].uchar,c=!1);o.cueStartTime=e,e===t&&(t+=1e-4),f>=16?f--:f++;const T=Lg(h.trim()),x=vu(e,t,T);l!=null&&(p=l.cues)!=null&&p.getCueById(x)||(a=new g(e,t,T),a.id=x,a.line=E+1,a.align="left",a.position=10+Math.min(80,Math.floor(f*8/32)*10),s.push(a))}return l&&s.length&&(s.sort((E,T)=>E.line==="auto"||T.line==="auto"?0:E.line>8&&T.line>8?T.line-E.line:E.line-T.line),s.forEach(E=>jh(l,E))),s}},Xx={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Og=rt(rt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:bg,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ly,bufferController:CE,capLevelController:Lu,errorController:fy,fpsController:tx,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Ph,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:Xx},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},Qx()),{},{subtitleStreamController:LE,subtitleTrackController:RE,timelineController:ZE,audioStreamController:SE,audioTrackController:vE,emeController:Or,cmcdController:Mx,contentSteeringController:Bx});function Qx(){return{cueHandler:qx,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Jx(l,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=su(l),r=["manifest","level","frag"],s=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,c=e[a]===void 0,f=[];s.forEach(h=>{const g=`${o}Loading${h}`,p=e[g];if(p!==void 0&&c){f.push(g);const E=t[a].default;switch(e[a]={default:E},h){case"TimeOut":E.maxLoadTimeMs=p,E.maxTimeToFirstByteMs=p;break;case"MaxRetry":E.errorRetry.maxNumRetry=p,E.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":E.errorRetry.retryDelayMs=p,E.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":E.errorRetry.maxRetryDelayMs=p,E.timeoutRetry.maxRetryDelayMs=p;break}}}),f.length&&F.warn(`hls.js config: "${f.join('", "')}" setting(s) are deprecated, use "${a}": ${JSON.stringify(e[a])}`)}),rt(rt({},t),e)}function su(l){return l&&typeof l=="object"?Array.isArray(l)?l.map(su):Object.keys(l).reduce((e,t)=>(e[t]=su(l[t]),e),{}):l}function Zx(l){const e=l.loader;e!==Ch&&e!==bg?(F.log("[config]: Custom loader detected, cannot enable progressive streaming"),l.progressive=!1):Gx()&&(l.loader=Ch,l.progressive=!0,l.enableSoftwareAES=!0,F.log("[config]: Progressive streaming enabled, using FetchLoader"))}let Vl;class eT extends du{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],o={},a={};let c=!1,f=!1,h=!1;t.levels.forEach(g=>{var p,E;const T=g.attrs;let{audioCodec:x,videoCodec:S}=g;((p=x)==null?void 0:p.indexOf("mp4a.40.34"))!==-1&&(Vl||(Vl=/chrome|firefox/i.test(navigator.userAgent)),Vl&&(g.audioCodec=x=void 0)),x&&(g.audioCodec=x=ho(x,r)),((E=S)==null?void 0:E.indexOf("avc1"))===0&&(S=g.videoCodec=$0(S));const{width:v,height:R,unknownCodecs:k}=g;if(c||(c=!!(v&&R)),f||(f=!!S),h||(h=!!x),k!=null&&k.length||x&&!wl(x,"audio",r)||S&&!wl(S,"video",r))return;const{CODECS:C,"FRAME-RATE":M,"HDCP-LEVEL":_,"PATHWAY-ID":V,RESOLUTION:U,"VIDEO-RANGE":j}=T,H=`${`${V||"."}-`}${g.bitrate}-${U}-${M}-${C}-${j}-${_}`;if(o[H])if(o[H].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const Q=a[H]+=1;g.attrs["PATHWAY-ID"]=new Array(Q+1).join(".");const ge=new Mr(g);o[H]=ge,s.push(ge)}else o[H].addGroupId("audio",T.AUDIO),o[H].addGroupId("text",T.SUBTITLES);else{const Q=new Mr(g);o[H]=Q,a[H]=1,s.push(Q)}}),this.filterAndSortMediaOptions(s,t,c,f,h)}filterAndSortMediaOptions(e,t,r,s,o){let a=[],c=[],f=e;if((r||s)&&o&&(f=f.filter(({videoCodec:x,videoRange:S,width:v,height:R})=>(!!x||!!(v&&R))&&Z0(S))),f.length===0){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const x=new Error("no level with compatible codecs found in manifest");this.hls.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:x,reason:x.message})}});return}if(t.audioTracks){const{preferManagedMediaSource:x}=this.hls.config;a=t.audioTracks.filter(S=>!S.audioCodec||wl(S.audioCodec,"audio",x)),wh(a)}t.subtitles&&(c=t.subtitles,wh(c));const h=f.slice(0);f.sort((x,S)=>{if(x.attrs["HDCP-LEVEL"]!==S.attrs["HDCP-LEVEL"])return(x.attrs["HDCP-LEVEL"]||"")>(S.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&x.height!==S.height)return x.height-S.height;if(x.frameRate!==S.frameRate)return x.frameRate-S.frameRate;if(x.videoRange!==S.videoRange)return go.indexOf(x.videoRange)-go.indexOf(S.videoRange);if(x.videoCodec!==S.videoCodec){const v=Od(x.videoCodec),R=Od(S.videoCodec);if(v!==R)return R-v}if(x.uri===S.uri&&x.codecSet!==S.codecSet){const v=fo(x.codecSet),R=fo(S.codecSet);if(v!==R)return R-v}return x.averageBitrate!==S.averageBitrate?x.averageBitrate-S.averageBitrate:0});let g=h[0];if(this.steering&&(f=this.steering.filterParsedLevels(f),f.length!==h.length)){for(let x=0;x<h.length;x++)if(h[x].pathwayId===f[0].pathwayId){g=h[x];break}}this._levels=f;for(let x=0;x<f.length;x++)if(f[x]===g){var p;this._firstLevel=x;const S=g.bitrate,v=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${f.length} level(s) found, first bitrate: ${S}`),((p=this.hls.userConfig)==null?void 0:p.abrEwmaDefaultEstimate)===void 0){const R=Math.min(S,this.hls.config.abrEwmaDefaultEstimateMax);R>v&&v===Og.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=R)}break}const E=o&&!s,T={levels:f,audioTracks:a,subtitleTracks:c,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:s,altAudio:!E&&a.some(x=>!!x.url)};this.hls.trigger(L.MANIFEST_PARSED,T),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const g=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(L.ERROR,{type:Se.OTHER_ERROR,details:G.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:g,reason:g.message}),p)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,o=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],c=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&a.details&&s&&o===c)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${c?" with Pathway "+c:""} from level ${r}${o?" with Pathway "+o:""}`);const f={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,f);const h=a.details;if(!h||h.live){const g=this.switchParams(a.uri,s==null?void 0:s.details,h);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===we.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Ee.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(o=>!!r[o]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:o}=t,a=this._levels[s];if(!a){var c;this.warn(`Invalid level index ${s}`),(c=t.deliveryDirectives)!=null&&c.skip&&(o.deltaUpdateFailed=!0);return}s===this.currentLevelIndex?(a.fragmentError===0&&(a.loadError=0),this.playlistLoaded(s,t,a.details)):(r=t.deliveryDirectives)!=null&&r.skip&&(o.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){let s=r.uri;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}const o=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${o?" Pathway "+o:""} ${s}`),this.clearTimer(),this.hls.trigger(L.LEVEL_LOADING,{url:s,level:t,pathwayId:r.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const r=this._levels.filter((s,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(s),s===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,s.details&&s.details.fragments.forEach(a=>a.level=-1)),!1));Qh(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(L.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function wh(l){const e={};l.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}class tT{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const s=this.keyUriToKeyInfo[r].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=G.KEY_LOAD_ERROR,r,s,o){return new pn({type:Se.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:o,error:r,networkDetails:s})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:s}=e;for(let o=0;o<t.length;o++){const a=t[o];if(s<=a.cc&&(r==="initSegment"||a.sn==="initSegment"||r<a.sn)){this.emeController.selectKeySystemFormat(a).then(c=>{a.setKeyFormat(c)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const o=e.decryptdata;if(!o){const h=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,h))}const a=o.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let c=this.keyUriToKeyInfo[a];if((r=c)!=null&&r.decryptdata.key)return o.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if((s=c)!=null&&s.keyLoadPromise){var f;switch((f=c.mediaKeySessionContext)==null?void 0:f.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then(h=>(o.key=h.keyInfo.decryptdata.key,{frag:e,keyInfo:c}))}}switch(c=this.keyUriToKeyInfo[a]={decryptdata:o,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},o.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return o.keyFormat==="identity"?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,G.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${o.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const s=this.emeController.loadKey(r);if(s)return(e.keyLoadPromise=s.then(o=>(e.mediaKeySessionContext=o,r))).catch(o=>{throw e.keyLoadPromise=null,o})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=r.loader,o=new s(r);return t.keyLoader=e.loader=o,e.keyLoadPromise=new Promise((a,c)=>{const f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},h=r.keyLoadPolicy.default,g={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(E,T,x,S)=>{const{frag:v,keyInfo:R,url:k}=x;if(!v.decryptdata||R!==this.keyUriToKeyInfo[k])return c(this.createKeyLoadError(v,G.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));R.decryptdata.key=v.decryptdata.key=new Uint8Array(E.data),v.keyLoader=null,R.loader=null,a({frag:v,keyInfo:R})},onError:(E,T,x,S)=>{this.resetLoader(T),c(this.createKeyLoadError(t,G.KEY_LOAD_ERROR,new Error(`HTTP Error ${E.code} loading key ${E.text}`),x,rt({url:f.url,data:void 0},E)))},onTimeout:(E,T,x)=>{this.resetLoader(T),c(this.createKeyLoadError(t,G.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),x))},onAbort:(E,T,x)=>{this.resetLoader(T),c(this.createKeyLoadError(t,G.INTERNAL_ABORTED,new Error("key loading aborted"),x))}};o.load(f,g,p)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,o=r.loader;t.keyLoader===o&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[s],o&&o.destroy()}}function Ng(){return self.SourceBuffer||self.WebKitSourceBuffer}function Mg(){if(!nr())return!1;const e=Ng();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function nT(){if(!Mg())return!1;const l=nr();return typeof(l==null?void 0:l.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>l.isTypeSupported(ki(e,"video")))||["mp4a.40.2","fLaC"].some(e=>l.isTypeSupported(ki(e,"audio"))))}function rT(){var l;const e=Ng();return typeof(e==null||(l=e.prototype)==null?void 0:l.changeType)=="function"}const iT=250,lo=2,sT=.1,oT=.05;class aT{constructor(e,t,r,s){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=s}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:s,stalled:o}=this;if(s===null)return;const{currentTime:a,seeking:c}=s,f=this.seeking&&!c,h=!this.seeking&&c;if(this.seeking=c,a!==e){if(this.moved=!0,c||(this.nudgeRetry=0),o!==null){if(this.stallReported){const v=self.performance.now()-o;F.warn(`playback not stuck anymore @${a}, after ${Math.round(v)}ms`),this.stallReported=!1}this.stalled=null}return}if(h||f){this.stalled=null;return}if(s.paused&&!c||s.ended||s.playbackRate===0||!Ne.getBuffered(s).length){this.nudgeRetry=0;return}const g=Ne.bufferInfo(s,a,0),p=g.nextStart||0;if(c){const v=g.len>lo,R=!p||t&&t.start<=a||p-a>lo&&!this.fragmentTracker.getPartialFragment(a);if(v||R)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var E;if(!(g.len>0)&&!p)return;const R=Math.max(p,g.start||0)-a,k=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,M=(k==null||(E=k.details)==null?void 0:E.live)?k.details.targetduration*2:lo,_=this.fragmentTracker.getPartialFragment(a);if(R>0&&(R<=M||_)){s.paused||this._trySkipBufferHole(_);return}}const T=self.performance.now();if(o===null){this.stalled=T;return}const x=T-o;if(!c&&x>=iT&&(this._reportStall(g),!this.media))return;const S=Ne.bufferInfo(s,a,r.maxBufferHole);this._tryFixBufferStall(S,x)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:s,media:o}=this;if(o===null)return;const a=o.currentTime,c=s.getPartialFragment(a);c&&(this._trySkipBufferHole(c)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-a<r.maxBufferHole)&&t>r.highBufferWatchdogPeriod*1e3&&(F.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:s}=this;if(!s&&r){this.stallReported=!0;const o=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);F.warn(o.message),t.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:s}=this;if(s===null)return 0;const o=s.currentTime,a=Ne.bufferInfo(s,o,0),c=o<a.start?a.start:a.nextStart;if(c){const f=a.len<=t.maxBufferHole,h=a.len>0&&a.len<1&&s.readyState<3,g=c-o;if(g>0&&(f||h)){if(g>t.maxBufferHole){const{fragmentTracker:E}=this;let T=!1;if(o===0){const x=E.getAppendedFrag(0,Ee.MAIN);x&&c<x.end&&(T=!0)}if(!T){const x=e||E.getAppendedFrag(o,Ee.MAIN);if(x){let S=!1,v=x.end;for(;v<c;){const R=E.getPartialFragment(v);if(R)v+=R.duration;else{S=!0;break}}if(S)return 0}}}const p=Math.max(c+oT,o+sT);if(F.warn(`skipping hole, adjusting currentTime from ${o} to ${p}`),this.moved=!0,this.stalled=null,s.currentTime=p,e&&!e.gap){const E=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${p}`);r.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:E,reason:E.message,frag:e})}return p}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:s}=this;if(r===null)return;const o=r.currentTime;if(this.nudgeRetry++,s<e.nudgeMaxRetry){const a=o+(s+1)*e.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${o} to ${a}`);F.warn(c.message),r.currentTime=a,t.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${e.nudgeMaxRetry} nudges`);F.error(a.message),t.trigger(L.ERROR,{type:Se.MEDIA_ERROR,details:G.BUFFER_STALLED_ERROR,error:a,fatal:!0})}}}const lT=100;class uT extends mu{constructor(e,t,r){super(e,t,r,"[stream-controller]",Ee.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.ERROR,this.onError,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.ERROR,this.onError,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(lT),this.level=-1,!this.startFragRequested){let s=r.startLevel;s===-1&&(r.config.testBandwidth&&this.levels.length>1?(s=0,this.bitrateTest=!0):s=r.firstAutoLevel),r.nextLoadLevel=s,this.level=r.loadLevel,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=W.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=W.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case W.WAITING_LEVEL:{const{levels:t,level:r}=this,s=t==null?void 0:t[r],o=s==null?void 0:s.details;if(o&&(!o.live||this.levelLastLoaded===s)){if(this.waitForCdnTuneIn(o))break;this.state=W.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=W.IDLE;break}break}case W.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:s,level:o}=this,a=s==null?void 0:s[o];this.resetStartWhenNotLoaded(a||null),this.state=W.IDLE}}break}this.state===W.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(t===null||!s&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const o=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[o]))return;const a=r[o],c=this.getMainFwdBufferInfo();if(c===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(c,f)){const S={};this.altAudio&&(S.type="video"),this.hls.trigger(L.BUFFER_EOS,S),this.state=W.ENDED;return}if(!this.buffering)return;e.loadLevel!==o&&e.manualLevel===-1&&this.log(`Adapting to level ${o} from level ${this.level}`),this.level=e.nextLoadLevel=o;const h=a.details;if(!h||this.state===W.WAITING_LEVEL||h.live&&this.levelLastLoaded!==a){this.level=o,this.state=W.WAITING_LEVEL;return}const g=c.len,p=this.getMaxBufferLength(a.maxBitrate);if(g>=p)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const E=this.backtrackFragment?this.backtrackFragment.start:c.end;let T=this.getNextFragment(E,h);if(this.couldBacktrack&&!this.fragPrevious&&T&&T.sn!=="initSegment"&&this.fragmentTracker.getState(T)!==nt.OK){var x;const v=((x=this.backtrackFragment)!=null?x:T).sn-h.startSN,R=h.fragments[v-1];R&&T.cc===R.cc&&(T=R,this.fragmentTracker.removeFragment(R))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(T&&this.isLoopLoading(T,E)){if(!T.gap){const v=this.audioOnly&&!this.altAudio?Fe.AUDIO:Fe.VIDEO,R=(v===Fe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,v,Ee.MAIN)}T=this.getNextFragmentLoopLoading(T,h,c,Ee.MAIN,p)}T&&(T.initSegment&&!T.initSegment.data&&!this.bitrateTest&&(T=T.initSegment),this.loadFragment(T,a,E))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);this.fragCurrent=e,s===nt.NOT_LOADED||s===nt.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ee.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const o=this.getLevelDetails();if(o!=null&&o.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<o.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,f=e[c],h=this.fragLastKbps;h&&this.fragCurrent?r=this.fragCurrent.duration*f.maxBitrate/(1e3*h)+1:r=0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const c=this.followingBufferedFrag(a);if(c){this.abortCurrentFrag();const f=c.maxStartPTS?c.maxStartPTS:c.start,h=c.duration,g=Math.max(a.end,f+Math.min(Math.max(h-this.config.maxFragLookUpTolerance,h*(this.couldBacktrack?.5:.125)),h*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case W.KEY_LOADING:case W.FRAG_LOADING:case W.FRAG_LOADING_WAITING_RETRY:case W.PARSING:case W.PARSED:this.state=W.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new aT(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;se(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();if(r===null||r.len===0){this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let r=!1,s=!1;t.levels.forEach(o=>{const a=o.audioCodec;a&&(r=r||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&s&&!rT(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==W.IDLE)return;const s=r[t.level];(!s.details||s.details.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(s.details))&&(this.state=W.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:s}=this,o=t.level,a=t.details,c=a.totalduration;if(!s){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${c}`);const f=s[o],h=this.fragCurrent;h&&(this.state===W.FRAG_LOADING||this.state===W.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let g=0;if(a.live||(r=f.details)!=null&&r.live){var p;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;g=this.alignPlaylists(a,f.details,(p=this.levelLastLoaded)==null?void 0:p.details)}if(f.details=a,this.levelLastLoaded=f,this.hls.trigger(L.LEVEL_UPDATED,{details:a,level:o}),this.state===W.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=W.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,g),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:s,payload:o}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const c=a[r.level],f=c.details;if(!f){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const h=c.videoCodec,g=f.PTSKnown||!f.live,p=(t=r.initSegment)==null?void 0:t.data,E=this._getAudioCodec(c),T=this.transmuxer=this.transmuxer||new yg(this.hls,Ee.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),x=s?s.index:-1,S=x!==-1,v=new hu(r.level,r.sn,r.stats.chunkCount,o.byteLength,x,S),R=this.initPTS[r.cc];T.push(o,p,E,h,r,s,f.totalduration,g,v,R)}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const o=this.hls;r&&(o.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),o.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=t.id,s=!!this.hls.audioTracks[r].url;if(s){const o=this.videoBuffer;o&&this.mediaBuffer!==o&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=o)}this.altAudio=s,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,o,a=!1;for(const c in r){const f=r[c];if(f.id==="main"){if(o=c,s=f,c==="video"){const h=r[c];h&&(this.videoBuffer=h.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${o}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r&&r.type!==Ee.MAIN)return;if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===W.PARSED&&(this.state=W.IDLE);return}const o=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}onError(e,t){var r;if(t.fatal){this.state=W.ERROR;return}switch(t.details){case G.FRAG_GAP:case G.FRAG_PARSING_ERROR:case G.FRAG_DECRYPT_ERROR:case G.FRAG_LOAD_ERROR:case G.FRAG_LOAD_TIMEOUT:case G.KEY_LOAD_ERROR:case G.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ee.MAIN,t);break;case G.LEVEL_LOAD_ERROR:case G.LEVEL_LOAD_TIMEOUT:case G.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===W.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===we.LEVEL&&(this.state=W.IDLE);break;case G.BUFFER_APPEND_ERROR:case G.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;if(t.details===G.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case G.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!Ne.getBuffered(e).length){const r=this.state!==W.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=W.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Fe.AUDIO||this.audioOnly&&!this.altAudio){const r=(t===Fe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,t,Ee.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const s=Ne.getBuffered(e),a=(s.length?s.start(0):0)-r;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),r+=a,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:s}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state=W.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=e.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),s.trigger(L.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r="main",{hls:s}=this,{remuxResult:o,chunkMeta:a}=e,c=this.getCurrentContext(a);if(!c){this.resetWhenMissingContext(a);return}const{frag:f,part:h,level:g}=c,{video:p,text:E,id3:T,initSegment:x}=o,{details:S}=g,v=this.altAudio?void 0:o.audio;if(this.fragContextChanged(f)){this.fragmentTracker.removeFragment(f);return}if(this.state=W.PARSING,x){if(x!=null&&x.tracks){const C=f.initSegment||f;this._bufferInitSegment(g,x.tracks,C,a),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:r,tracks:x.tracks})}const R=x.initPTS,k=x.timescale;se(R)&&(this.initPTS[f.cc]={baseTime:R,timescale:k},s.trigger(L.INIT_PTS_FOUND,{frag:f,id:r,initPTS:R,timescale:k}))}if(p&&S&&f.sn!=="initSegment"){const R=S.fragments[f.sn-1-S.startSN],k=f.sn===S.startSN,C=!R||f.cc>R.cc;if(o.independent!==!1){const{startPTS:M,endPTS:_,startDTS:V,endDTS:U}=p;if(h)h.elementaryStreams[p.type]={startPTS:M,endPTS:_,startDTS:V,endDTS:U};else if(p.firstKeyFrame&&p.independent&&a.id===1&&!C&&(this.couldBacktrack=!0),p.dropped&&p.independent){const j=this.getMainFwdBufferInfo(),ee=(j?j.end:this.getLoadPosition())+this.config.maxBufferHole,H=p.firstKeyFramePTS?p.firstKeyFramePTS:M;if(!k&&ee<H-this.config.maxBufferHole&&!C){this.backtrack(f);return}else C&&(f.gap=!0);f.setElementaryStreamInfo(p.type,f.start,_,f.start,U,!0)}else k&&M>lo&&(f.gap=!0);f.setElementaryStreamInfo(p.type,M,_,V,U),this.backtrackFragment&&(this.backtrackFragment=f),this.bufferFragmentData(p,f,h,a,k||C)}else if(k||C)f.gap=!0;else{this.backtrack(f);return}}if(v){const{startPTS:R,endPTS:k,startDTS:C,endDTS:M}=v;h&&(h.elementaryStreams[Fe.AUDIO]={startPTS:R,endPTS:k,startDTS:C,endDTS:M}),f.setElementaryStreamInfo(Fe.AUDIO,R,k,C,M),this.bufferFragmentData(v,f,h,a)}if(S&&T!=null&&(t=T.samples)!=null&&t.length){const R={id:r,frag:f,details:S,samples:T.samples};s.trigger(L.FRAG_PARSING_METADATA,R)}if(S&&E){const R={id:r,frag:f,details:S,samples:E.samples};s.trigger(L.FRAG_PARSING_USERDATA,R)}}_bufferInitSegment(e,t,r,s){if(this.state!==W.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:o,video:a,audiovideo:c}=t;if(o){let f=e.audioCodec;const h=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const g=o.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&h.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&h.indexOf("android")!==-1&&o.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),e.audioCodec&&e.audioCodec!==f&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${f}"`),o.levelCodec=f,o.id="main",this.log(`Init audio buffer, container:${o.container}, codecs[selected/level/parsed]=[${f||""}/${e.audioCodec||""}/${o.codec}]`)}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${a.codec}]`)),c&&this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),this.hls.trigger(L.BUFFER_CODECS,t),Object.keys(t).forEach(f=>{const g=t[f].initSegment;g!=null&&g.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:f,data:g,frag:r,part:null,chunkMeta:s,parent:r.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Ee.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=W.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(Ne.isBuffered(e,r)?t=this.getAppendedFrag(r):Ne.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,o=t.level;(!s||t.sn!==s.sn||s.level!==o)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!s||s.level!==o)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:o}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&se(t)&&se(r.programDateTime)){const s=r.programDateTime+(t-r.start)*1e3;return new Date(s)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Ot{static get version(){return"1.5.19"}static isMSESupported(){return Mg()}static isSupported(){return nT()}static getMediaSource(){return nr()}static get Events(){return L}static get ErrorTypes(){return Se}static get ErrorDetails(){return G}static get DefaultConfig(){return Ot.defaultConfig?Ot.defaultConfig:Og}static set DefaultConfig(e){Ot.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new Tu,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,Qp(e.debug||!1,"Hls instance");const t=this.config=Jx(Ot.DefaultConfig,e);this.userConfig=e,t.progressive&&Zx(t);const{abrController:r,bufferController:s,capLevelController:o,errorController:a,fpsController:c}=t,f=new a(this),h=this.abrController=new r(this),g=this.bufferController=new s(this),p=this.capLevelController=new o(this),E=new c(this),T=new z0(this),x=new X0(this),S=t.contentSteeringController,v=S?new S(this):null,R=this.levelController=new eT(this,v),k=new Ry(this),C=new tT(this.config),M=this.streamController=new uT(this,k,C);p.setStreamController(M),E.setStreamController(M);const _=[T,R,M];v&&_.splice(1,0,v),this.networkControllers=_;const V=[h,g,p,E,x,k];this.audioTrackController=this.createController(t.audioTrackController,_);const U=t.audioStreamController;U&&_.push(new U(this,k,C)),this.subtitleTrackController=this.createController(t.subtitleTrackController,_);const j=t.subtitleStreamController;j&&_.push(new j(this,k,C)),this.createController(t.timelineController,V),C.emeController=this.emeController=this.createController(t.emeController,V),this.cmcdController=this.createController(t.cmcdController,V),this.latencyController=this.createController(Q0,V),this.coreComponents=V,_.push(f);const ee=f.onErrorOut;typeof ee=="function"&&this.on(L.ERROR,ee,f)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(F.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const s=e===L.ERROR;this.trigger(L.ERROR,{type:Se.OTHER_ERROR,details:G.INTERNAL_EXCEPTION,fatal:s,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){F.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){F.log("attachMedia"),this._media=e,this.trigger(L.MEDIA_ATTACHING,{media:e})}detachMedia(){F.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,r=this.url,s=this.url=au.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,F.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}startLoad(e=-1){F.log(`startLoad(${e})`),this.started=!0,this.resumeBuffering();for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].startLoad(e),!(!this.started||!this.networkControllers));t++);}stopLoad(){F.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}resumeBuffering(){F.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()})}pauseBuffering(){F.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()})}swapAudioCodec(){F.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){F.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){F.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){F.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){F.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){F.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){F.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(F.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){J0(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,r)for(let o=s;o--;){const a=e[o].attrs["HDCP-LEVEL"];if(a&&a<=r)return o}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return(t=this.audioTrackController)==null?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return(t=this.subtitleTrackController)==null||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Ot.defaultConfig=void 0;const cT=({isStreaming:l,onToggle:e})=>Le.jsx("div",{className:"flex items-center justify-center space-x-2",children:Le.jsx("div",{onClick:()=>e(),className:"flex items-center justify-center w-9 h-14 cursor-pointer text-black hover:text-gray-700 transition",children:Le.jsx("i",{className:`fas ${l?"fa-pause":"fa-play"} text-xl`})})}),fT=({duration:l,currentTime:e,bufferedTime:t,onTimeChange:r})=>{const s=e===0?0:e/l*100,o=t===0?0:t/l*100;return Le.jsxs("div",{className:"flex justify-between items-center w-full space-x-2",children:[Le.jsx("p",{className:"text-sm text-black min-w-8",children:Hl(e)}),Le.jsx("input",{type:"range",min:"0",max:l,value:e,onChange:a=>r(Number(a.target.value)),className:"progress-bar w-full",style:{background:`
            linear-gradient(
              to right, 
              black ${s}%, 
              darkgray ${s}% ${o}%, 
              lightgray ${o}%
            )
          `}}),Le.jsx("p",{className:"text-sm text-black min-w-8",children:Hl(l)})]})},dT=({volume:l,onVolumeChange:e})=>{const t=s=>{e(Number(s.target.value))},r=()=>{l==0?e(100):e(0)};return Le.jsxs("div",{className:"flex items-center justify-start space-x-2",children:[Le.jsx("i",{className:`fas ${l==0?"fa-volume-xmark":l>50?"fa-volume-high":"fa-volume-low"} text-sm text-black cursor-pointer min-w-6`,onClick:r}),Le.jsx("input",{type:"range",min:"0",max:"100",value:l,onChange:t,className:"progress-bar",style:{background:`linear-gradient(to right, black ${l}%, gray ${l}%)`}})]})},hT=tt.forwardRef((l,e)=>{const t=tt.useRef(null),r=tt.useRef(null),[s,o]=tt.useState(!1),a=tt.useRef(null),[c,f]=tt.useState(0),[h,g]=tt.useState(0),[p,E]=tt.useState(100);tt.useImperativeHandle(e,()=>({setSong:S}));const T=()=>{t.current&&(s?t.current.pause():t.current.play().catch(console.error),o(!s))},x=C=>{t.current&&(t.current.volume=C/100,E(C))};tt.useEffect(()=>{const C=t.current,M=()=>{if(t.current){f(Math.ceil(t.current.currentTime));const V=t.current.buffered;V.length>0&&g(Math.round(V.end(V.length-1)))}},_=()=>{o(!1),a.current&&f(a.current.duration)};return C&&(C.addEventListener("timeupdate",M),C.addEventListener("ended",_)),()=>{C&&(C.removeEventListener("timeupdate",M),C.removeEventListener("ended",_))}},[]);const S=C=>{k(),a.current=C,g(0),f(0),R(C.id)},v=C=>{t.current&&(t.current.currentTime=C)},R=C=>{if(!t.current)return;const M=`/audio/${C}/playlist.m3u8`;if(Ot.isSupported()){r.current&&r.current.destroy();const _=new Ot({enableWorker:!0,lowLatencyMode:!0});r.current=_,_.loadSource(M),_.attachMedia(t.current),_.on(Ot.Events.MANIFEST_PARSED,()=>{var V;(V=t.current)==null||V.play().then(()=>o(!0)).catch(console.error)}),_.on(Ot.Events.ERROR,(V,U)=>{if(U.fatal)switch(U.type){case Ot.ErrorTypes.NETWORK_ERROR:console.error("Network error, trying to recover..."),_.startLoad();break;case Ot.ErrorTypes.MEDIA_ERROR:console.error("Media error, trying to recover..."),_.recoverMediaError();break;default:console.error("Fatal error, stopping playback"),k();break}})}else t.current.canPlayType("application/vnd.apple.mpegurl")&&(t.current.src=M,t.current.play().then(()=>o(!0)).catch(console.error))},k=()=>{o(!1),g(0),f(0),r.current&&(r.current.destroy(),r.current=null),t.current&&(t.current.pause(),t.current.removeAttribute("src"),t.current.load())};return Le.jsxs("div",{className:"flex justify-between items-center px-[5rem] sm:px-[5rem] lg:px-[7rem] xl:px-[10rem]",children:[Le.jsx("div",{className:"flex items-center justify-center",children:Le.jsx(cT,{isStreaming:s,onToggle:T})}),Le.jsx("div",{className:"flex-grow mx-5 flex items-center justify-center",children:Le.jsx(fT,{currentTime:c,bufferedTime:h,duration:a.current?a.current.duration:0,onTimeChange:v})}),Le.jsx("div",{className:"flex items-center min-w-40 max-w-40",children:Le.jsx(dT,{volume:p,onVolumeChange:x})}),Le.jsx("audio",{ref:t})]})}),gT=()=>{const[l,e]=tt.useState(null),t=async()=>{try{const r=await fetch("/get-id");if(!r.ok)throw new Error(`Erroron fetch: ${r.statusText}`);const s=await r.json();console.log("Client ID:",s),e(s)}catch(r){console.error("Error fetching client ID:",r)}};return tt.useEffect(()=>{t()},[]),Le.jsxs("div",{className:"flex justify-between items-center px-6 py-4",children:[Le.jsx("div",{className:"flex items-center",children:Le.jsx("span",{className:"text-xl font-bold",children:"Rust-eze"})}),Le.jsx("div",{className:"text-xl text-gray-800",children:"Ruste-eze Audio Streaming"}),Le.jsxs("div",{className:"text-sm text-gray-600",children:["Client ID: ",l]})]})};function mT(){const l=tt.useRef(null),[e,t]=tt.useState(!1);return tt.useEffect(()=>{let r=null;const s=async()=>{try{await(await fetch("/is-ready")).json()&&(t(!0),r&&clearInterval(r))}catch(o){console.error("Error checking client readiness:",o)}};return s(),r=setInterval(s,1e3),()=>{r&&clearInterval(r)}},[]),e?Le.jsxs("div",{className:"bg-orange-200 min-h-screen flex flex-col",children:[Le.jsx("div",{className:"fixed top-0 left-0 w-full z-10 bg-orange-200",children:Le.jsx(gT,{})}),Le.jsx("div",{className:"pt-[4rem] pb-[3rem] overflow-y-auto flex-1 px-[5rem] sm:px-[5rem] lg:px-[7rem] xl:px-[10rem]",children:Le.jsx(Kp,{callback:r=>{l.current&&l.current.setSong(r)}})}),Le.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-orange-300 text-white text-center z-10",children:Le.jsx(hT,{ref:l})})]}):Le.jsx("div",{className:"flex items-center justify-center min-h-screen bg-orange-100",children:Le.jsxs("div",{className:"text-center",children:[Le.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-orange-500 mx-auto"}),Le.jsx("p",{className:"text-orange-600 mt-4 font-medium",children:"Loading..."})]})})}Gp.createRoot(document.getElementById("root")).render(Le.jsx(tt.StrictMode,{children:Le.jsx(mT,{})}));
